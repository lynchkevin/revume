/* RevuMe - 2016-03-11 */"use strict";angular.module("RevuMe",["config","ionic","ngResource","ngAnimate","evaporate","ngCookies","FBAngular","braintree-angular","ngIOS9UIWebViewPatch","fileBox","ionic-datepicker","ionic-timepicker","ionic-toast","chart.js"]).provider("$moment",function(){this.$get=function(){return moment}}).constant("$PALLET",{$light:"#dcdcdc",$positive:"#1D75B7",$balanced:"#5ECC93",$calm:"#9FDDCF",$royal:"#105594",$dark:"#404040",$energized:"#f0b840",$assertive:"#ef4e3a"}).run(["$ionicPlatform","$rootScope","$window","$http","mainChannel","userService","pnFactory","$timeout","$location","$state","$cookieStore","authService","$ionicLoading","$ionicHistory","Library","ScriptService","logService","$q",function($ionicPlatform,$rootScope,$window,$http,mainChannel,userService,pnFactory,$timeout,$location,$state,$cookieStore,authService,$ionicLoading,$ionicHistory,Library,ScriptService,logService,$q){$ionicPlatform.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&(StatusBar.hide(),ionic.Platform.fullScreen()),window.shouldRotateToOrientation=function(degrees){return!0},document.addEventListener("pause",function(){console.log("got Pause event!!"),$rootScope.$broadcast("Revu.Me::Pause")},!1),document.addEventListener("resume",function(){console.log("got Resume event!!"),$rootScope.$broadcast("Revu.Me::Resume")},!1)}),$rootScope.deepLink=!1,$rootScope.user={},$rootScope.archive={},$rootScope.archive.menu=!1,$rootScope.spinnerShowing=!1,$rootScope.toggleArchive=function(){$rootScope.archive.menu=!$rootScope.archive.menu,$rootScope.$broadcast("Revu.Me:Archive")},$rootScope.archiveOn=function(){var isArchive=$rootScope.archive.menu;return isArchive},$rootScope.showLoading=function(spinner){var spinnerType=spinner||"ripple";$rootScope.spinnerShowing||($rootScope.spinnerShowing=!0,$timeout(function(){$ionicLoading.show({template:'<ion-spinner icon="'+spinnerType+'"></ion-spinner>'})},0))},$rootScope.hideLoading=function(){$rootScope.spinnerShowing&&($rootScope.spinnerShowing=!1,$timeout(function(){$ionicLoading.hide()}))},$rootScope.history=$ionicHistory,$rootScope.userInit=function(user,userOptions){var defer=$q.defer(),options=angular.extend({},userOptions);return $rootScope.user._id=user._id,$rootScope.user.firstName=user.firstName,$rootScope.user.lastName=user.lastName,$rootScope.user.name=user.firstName+" "+user.lastName,$rootScope.user.email=user.email,$rootScope.user.authData=user.authData,ScriptService.userScript(user._id).then(function(script){return $rootScope.user.script=script,$rootScope.$broadcast("userID",$rootScope.user),$rootScope.mHandler=function(message){console.log("message from presence service",message),$rootScope.$broadcast("Revu.Me.Activity",message)},$rootScope.pHandler=function(message){"user_log"!=message.uuid&&$rootScope.mainChannel.resolveUsers(message).then(function(users){$rootScope.users=users,console.log("got a status message",message),$timeout(function(){$rootScope.$broadcast("presence_change")},0)})["catch"](function(err){console.log(err)})},pnFactory.init(user._id),void 0==$rootScope.mainChannel&&($rootScope.connected=!0,$rootScope.mainChannel=pnFactory.newChannel(mainChannel.name),$rootScope.mainChannel.setUser($rootScope.user.name),$rootScope.mainChannel.subscribe($rootScope.mHandler,$rootScope.pHandler)),options.stealthMode||($rootScope.isMobile?$window.localStorage.setItem("user",JSON.stringify($rootScope.user)):$cookieStore.put("user",$rootScope.user)),$rootScope.$broadcast("Revu.Me:Ready"),$rootScope.isMobile||Library.cacheImages().then(function(){"Cached "+Library.cachedImages.length+" Images"}),defer.resolve()}),defer.promise},$rootScope.getLocalUser=function(){var userString=$window.localStorage.getItem("user"),user=void 0;return void 0!=userString&&(user=JSON.parse(userString)),user};var device={};device.isWebView=ionic.Platform.isWebView(),device.isIPad=ionic.Platform.isIPad(),device.isIOS=ionic.Platform.isIOS(),device.isAndroid=ionic.Platform.isAndroid(),device.isWindowsPhone=ionic.Platform.isWindowsPhone(),device.currentPlatform=ionic.Platform.platform(),device.currentPlatformVersion=ionic.Platform.version(),device.notMobileOS=!(device.isIOS||device.isIPad||device.isAndroid||device.isWindowsPhone),device.userAgent=ionic.Platform.navigator.userAgent,$rootScope.device=device,console.log("device is: ",$rootScope.device);var app=-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://");app?$rootScope.isMobile=!0:$rootScope.isMobile=!1,$rootScope.showArchive=!1,$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){logService.log(event,fromState,toState),authService.listen(event,toState)}),$rootScope.goHome=function(){$rootScope.deepLink=!1,$state.go("app.welcome")},$rootScope.newMeeting=function(stateName){"app.newMeeting"==$state.current.name?$rootScope.$broadcast("Revu.Me:NewMeeting"):$state.go(stateName)},$rootScope.fullUrl=function(src){return baseUrl+src},$rootScope.screenSize=function(){var width=verge.viewportW(),height=verge.viewportH();return{width:width,height:height}},$rootScope.smallScreen=function(){var width=verge.viewportW();return 450>width?!0:!1},$rootScope.firesize=function(src,w,h){var size;h&w?size=w.toString()+"x"+h.toString()+"c":void 0!=w&&(size=w.toString()+"x");var resizeUrl=thumbrio(src,size,"thumb");return resizeUrl},$window.addEventListener("beforeunload",function(e){return void 0!=$rootScope.mainChannel&&$rootScope.mainChannel.unsubscribe(),null})}]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function($stateProvider,$urlRouterProvider,$ionicConfigProvider){$ionicConfigProvider.views.maxCache(30),$stateProvider.state("app",{url:"/app","abstract":!0,templateUrl:"templates/menu.html"}).state("app.welcome",{url:"/welcome",views:{menuContent:{templateUrl:"templates/dashboardTemplate.html",controller:"dashboardCtrl"}}}).state("app.tour",{url:"/tour",views:{menuContent:{templateUrl:"templates/splash.html",controller:"splashCtrl"}}}).state("app.signup",{url:"/signup",views:{menuContent:{templateUrl:"templates/signup.html",controller:"signupCtrl"}}}).state("app.signIn",{url:"/signin",views:{menuContent:{templateUrl:"templates/signin.html",controller:"signinCtrl"}}}).state("app.newMeeting",{url:"/newMeeting",views:{menuContent:{templateUrl:"templates/sessions.html",controller:"SessionsCtrl"}}}).state("app.library",{url:"/library",views:{menuContent:{templateUrl:"templates/library.html",controller:"libraryCtrl"}}}).state("app.mobileNewMeeting",{url:"/mobile/newMeeting",views:{menuContent:{templateUrl:"templates/sessions.html",controller:"SessionsCtrl"}}}).state("app.mobileLib",{url:"/mobile/library",views:{menuContent:{templateUrl:"templates/libNav.html",controller:"libraryCtrl"}}}).state("app.slideShow",{url:"/library/slideShow",views:{menuContent:{templateUrl:"templates/slideShow.html",controller:"slideShowCtrl"}}}).state("app.viewer",{url:"/viewer/:id?sessionId",resolve:{session:["Session","$stateParams","$q",function(Session,$stateParams,$q){var deckIdx,defer=new $q.defer,session={};return Session.get({id:$stateParams.id}).$promise.then(function(sess){session=sess,deckIdx=0;session.decks[deckIdx]._id;defer.resolve(session)})["catch"](function(err){defer.reject(err)}),defer.promise}]},views:{menuContent:{templateUrl:"templates/viewer.html",controller:"ViewCtrl"}}}).state("app.viewerSessions",{url:"/viewerSessions",views:{menuContent:{templateUrl:"templates/sessions.html",controller:"SessionsCtrl"}}}).state("app.sessions",{url:"/sessions",views:{menuContent:{templateUrl:"templates/sessions.html",controller:"SessionsCtrl"}}}).state("app.attendeeSessions",{url:"/attendeeSessions",views:{menuContent:{templateUrl:"templates/attendeeSessions.html",controller:"SessionsCtrl"}}}).state("app.session",{url:"/sessions/:id",resolve:{session:["Session","$stateParams","$q",function(Session,$stateParams,$q){var deckIdx,defer=new $q.defer,session={};return Session.get({id:$stateParams.id}).$promise.then(function(sess){if(void 0!=sess._id){session=sess,deckIdx=0;session.decks[deckIdx]._id;defer.resolve(session)}else defer.reject({})})["catch"](function(err){defer.reject(err)}),defer.promise}]},views:{menuContent:{templateUrl:"templates/session.html",controller:"SessionCtrl"}}}).state("app.attsession",{url:"/attsessions/:id",resolve:{session:["Session","$stateParams","$q",function(Session,$stateParams,$q){var deckIdx,defer=new $q.defer,session={};return Session.get({id:$stateParams.id}).$promise.then(function(sess){if(void 0!=sess._id){session=sess,deckIdx=0;session.decks[deckIdx]._id;defer.resolve(session)}else defer.reject({})})["catch"](function(err){defer.reject(err)}),defer.promise}]},views:{menuContent:{templateUrl:"templates/attendeesession.html",controller:"SessionCtrl"}}}).state("app.presentations",{url:"/presentations",views:{menuContent:{templateUrl:"templates/presentations.html",controller:"presentationsCtrl"}}}).state("app.presentation",{url:"/presentations/:id?idx",resolve:{session:["Session","Decks","$stateParams","$q",function(Session,Decks,$stateParams,$q){var deckIdx,defer=new $q.defer,session={};return Session.get({id:$stateParams.id}).$promise.then(function(sess){session=sess,deckIdx=parseInt($stateParams.idx);var _id=session.decks[deckIdx]._id;return Decks.get({id:_id}).$promise}).then(function(deck){session.decks[deckIdx]=deck,session.deckIdx=deckIdx,defer.resolve(session)})["catch"](function(err){defer.reject(err)}),defer.promise}]},views:{menuContent:{templateUrl:"templates/presentation.html",controller:"presentationCtrl"}}}).state("app.revu",{url:"/revu/:id?uid",resolve:{session:["Session","Decks","$stateParams","$q",function(Session,Decks,$stateParams,$q){var defer=new $q.defer,session={};return Session.get({id:$stateParams.id}).$promise.then(function(sess){session=sess;var promises=[];return session.decks.forEach(function(deck){promises.push(Decks.get({id:deck._id}).$promise)}),$q.all(promises)}).then(function(decks){session.decks=[],decks.forEach(function(deck){session.decks.push(deck)}),session.deckIdx=0,defer.resolve(session)})["catch"](function(err){defer.reject(err)}),defer.promise}]},views:{menuContent:{templateUrl:"templates/review.html",controller:"reviewCtrl"}}}).state("app.teams",{url:"/teams",views:{menuContent:{templateUrl:"templates/teams.html",controller:"teamsCtrl"}}}).state("app.team",{url:"/team/:id?name",views:{menuContent:{templateUrl:"templates/team.html",controller:"teamsCtrl"}}}).state("app.newteam",{url:"/newTeam",views:{menuContent:{templateUrl:"templates/team.html",controller:"teamsCtrl"}}}).state("app.batman",{url:"/batman",views:{menuContent:{templateUrl:"templates/batman.html",controller:"batmanCtrl"}}}).state("app.settings",{url:"/settings",views:{menuContent:{templateUrl:"templates/settings.html",controller:"settingsCtrl"}}}).state("app.changePassword",{url:"/changepassword",views:{menuContent:{templateUrl:"templates/changePassword.html",controller:"changePasswordCtrl"}}}).state("app.confirmEmail",{url:"/confirmEmail/:id?",resolve:{user:["Users","DoConfirm","$stateParams","$q",function(Users,DoConfirm,$stateParams,$q){var defer=new $q.defer,byId=Users.byId;return DoConfirm.confirm({id:$stateParams.id}).$promise.then(function(result){result.success?byId.get({id:$stateParams.id}).$promise.then(function(user){defer.resolve(user)}):defer.reject(result.reason)}),defer.promise}]},views:{menuContent:{templateUrl:"templates/emailConfirmed.html",controller:"confirmCtrl"}}}).state("app.userAdmin",{url:"/useradmin",views:{menuContent:{templateUrl:"templates/userAdmin.html",controller:"userAdminCtrl"}}}).state("app.myAccount",{url:"/myAccount",views:{menuContent:{templateUrl:"templates/myAccount.html",controller:"accountCtrl"}}}).state("app.payment",{url:"/payment",views:{menuContent:{templateUrl:"templates/payment.html",controller:"paymentCtrl"}}}).state("app.changeCard",{url:"/changeCard",views:{menuContent:{templateUrl:"templates/changeCard.html",controller:"cardCtrl"}}}).state("app.dashboard",{url:"/dashboard",views:{menuContent:{templateUrl:"templates/dashboardTemplate.html",controller:"dashboardCtrl"}}}).state("app.systemMonitor",{url:"/systemMonitor",views:{menuContent:{templateUrl:"templates/systemMonitor.html",controller:"systemMonitorCtrl"}}}),$urlRouterProvider.otherwise("/app/signup")}]),angular.module("config",[]).constant("baseUrl",{name:"production",endpoint:"https://m.revu.me",volerro:"https://rb.volerro.com"}).constant("buildDate","Fri Mar 11 2016 10:34:09 GMT-0600 (CST)").constant("clientTokenPath","https://m.revu.me/api/braintree/client_token").constant("redirectUrl","https://m.revu.me/").constant("helloInitParams",{dropbox:"f9cdswrtfz1jsd9",box:"11rseev2g1yripmmx833cp5jhiqy82v2",google:"945597499290-106uaa9etsaft53ln0olrv8dbse6h9an.apps.googleusercontent.com",windows:"000000004C17505E",sfdc:"3MVG9sG9Z3Q1RlbdEH3x71mLE7o4tBdvBgDi8S7KMxAOEvtS4wwwdhHSi5N681cL3LHUcN8HrE4D8A74u31ax"}).constant("mainChannel",{name:"Revu.Me:User"}),angular.module("RevuMe").controller("batmanCtrl",["$scope","$rootScope","$cookieStore","userService","$state","Library","introContent","buildDate","ScriptService","Braintree","$timeout",function($scope,$rootScope,$cookieStore,userService,$state,Library,introContent,buildDate,ScriptService,Braintree,$timeout){function batmanOn(){$timeout(function(){$rootScope.user.batman=!0,$scope.utility.actions[1].name="Stop Snooping...",$scope.utility.actions[1].action=$scope.logOutAs},0)}function batmanOff(){$timeout(function(){$rootScope.user.batman=!1,$scope.utility.actions[1].name="Log In As..",$scope.utility.actions[1].action=$scope.logInAs},0)}$scope.build={date:buildDate},$scope.Library=Library,$scope.start=new Date,$scope.clearUserCookie=function(){$cookieStore.remove("user")},$scope.logInAs=function(){$rootScope.user={},$rootScope.user.email="klynch@volerro.com",userService.getUser($rootScope).then(function(user){$rootScope.userInit(user,{stealthMode:!0}),batmanOn(),$state.go("app.welcome")},function(err){console.log(err)})},$scope.logOutAs=function(){$rootScope.isMobile?$rootScope.user=$scope.ls.user:$rootScope.user=$cookieStore.get("user"),batmanOff()},$scope.setIntroContent=function(){$rootScope.user={},$rootScope.user.email="klynch@volerro.com",userService.getUser($rootScope).then(function(user){introContent.addIntroContent(user._id).then(function(){$rootScope.userInit(user,{stealthMode:!0}),batmanOn(),$state.go("app.welcome")})},function(err){console.log(err)})},$scope.userAdmin=function(){$state.go("app.userAdmin")},$scope.systemMonitor=function(){$state.go("app.systemMonitor")},$scope.setToTrial=function(){ScriptService.setToTrial().then(function(script){return $rootScope.user.script=script,Braintree.cancel(script)}).then(function(){$rootScope.user.script.braintreeId=void 0,$rootScope.user.script.members[0].user=$rootScope.user})["catch"](function(err){console.log(err)})},$scope.utility={actions:[{name:"System Monitor",action:$scope.systemMonitor},{name:"Clear User Cookie",action:$scope.clearUserCookie},{name:"Log In As..",action:$scope.logInAs},{name:"Set Intro Content",action:$scope.setIntroContent},{name:"User Admin",action:$scope.userAdmin},{name:"Set to Trial",action:$scope.setToTrial}]},$scope.ls={},$scope.ls.user=$rootScope.getLocalUser()}]),angular.module("RevuMe").controller("cardCtrl",["$scope","$rootScope","Braintree","ScriptService","$state","baseUrl","$http","$q",function($scope,$rootScope,Braintree,ScriptService,$state,baseUrl,$http,$q){$scope.init=function(){$scope.paymentDisabled=!1,$scope.script=ScriptService,$scope.script=ScriptService.getPendingScript(),$scope.status={},$scope.script.cost=ScriptService.calculateCost($scope.script),$scope.processCardDisabled=!1,Braintree.init($scope,$scope.pmrCallback),void 0!=$scope.script.customerId?Braintree.findCustomer($scope.script).then(function(customer){$scope.script.customer=customer,$scope.script.defaultMethod=void 0,$scope.showCardEntry=!0,customer.paymentMethods.forEach(function(method){method["default"]&&($scope.script.defaultMethod=method)})}):$scope.showCardEntry=!1,$scope.dropinOptions={onPaymentMethodReceived:function(payload){Braintree.changeCard(payload)},onError:function(payload){console.log(payload)}}},$scope.pmrCallback=function(){$scope.status.message="New Card Successfully Added",$scope.showCardEntry=!1,$scope.processCardDisabled=!0},$scope.cancel=function(){$state.go("app.myAccount")},void 0==$rootScope.user.script?$rootScope.$on("Revu.Me:Ready",function(event,data){$scope.init()}):$scope.init()}]),angular.module("RevuMe").controller("dashboardCtrl",["$scope","$rootScope","$window","$timeout","$state","$filter","$ionicScrollDelegate","$ionicModal","$ionicHistory","$ionicNavBarDelegate","$ionicSideMenuDelegate","tourService","Dashboard","$q","$PALLET",function($scope,$rootScope,$window,$timeout,$state,$filter,$ionicScrollDelegate,$ionicModal,$ionicHistory,$ionicNavBarDelegate,$ionicSideMenuDelegate,tourService,Dashboard,$q,$PALLET){$scope.w=angular.element($window),$scope.doughnutOptions={percentageInnerCutout:60};var doughnutChart=function(){var chart={};return chart.options=$scope.doughnutOptions,chart},emptyChart=function(name,color,center){var chart=doughnutChart();return chart.center=center,chart.data=[1],chart.labels=[name],chart.colors=[color],chart},setMeetingChart=function(target,yet,done,colors){if(yet.hasOwnProperty(target)&&done.hasOwnProperty(target)){var chart=doughnutChart();return chart.center=yet[target]+done[target],0==chart.center?chart=emptyChart("No Meetings",$PALLET.$light,chart.center):(chart.labels=["Scheduled","Completed"],chart.data=[yet[target],done[target]],chart.colors=colors),chart}return void 0},genMeetingView=function(){var deferred=$q.defer();return Dashboard.getMeetingStats().then(function(stats){$scope.rawMeetingStats=stats;var all=stats.all,yet=stats.upcomming,done=stats.completed,today=setMeetingChart("today",yet,done,[$PALLET.$positive,$PALLET.$dark]),thisWeek=setMeetingChart("thisWeek",yet,done,[$PALLET.$balanced,$PALLET.$dark]),thisMonth=setMeetingChart("thisMonth",yet,done,[$PALLET.$calm,$PALLET.$dark]),allChart={};return allChart.center=all.all,0==allChart.center?allChart=emptyChart("No Meetings",$PALLET.$light,allChart.center):(allChart.lalels=["Active","Archived"],allChart.data=[all.active,all.archived],allChart.colors=[$PALLET.$positive,$PALLET.$energized]),$timeout(function(){$scope.meetings={today:today,thisWeek:thisWeek,thisMonth:thisMonth,all:allChart}},0),Dashboard.getRecentInteractions()}).then(function(interactions){$scope.interactions=[],interactions.results.forEach(function(i){var iView={};iView.date=i.eventDate,i.slideViews.length>0&&(i.slideViews[0].views.length>0?iView.contact=i.slideViews[0].views[0].userName:iView.contact="No Name Found"),iView.meetingName=i.session.name,iView.totalSlides=i.slideViews.length,iView.totalTime=0,iView.data=[],iView.labels=[],iView.isShowing=!1,i.slideViews.forEach(function(sv){iView.totalTime+=sv.duration,iView.labels.push("slide "+sv.slideIndex),iView.data.push(sv.duration)}),$scope.interactions.push(iView)}),deferred.resolve()}),deferred.promise},subSample=function(data){var maxPoints=25,population=data.length,window=Math.round(population/maxPoints),accumulator=0,result=[],elem={};if(1>window)return data;for(var i=0,w=0;population>i;i++,w++)0==w&&(elem={},elem.date=data[i].date,accumulator=0),accumulator+=data[i].engagement,w>=window-1&&(elem.engagement=accumulator/window,result.push(elem),w=-1);return result},parseData=function(data){var results={e:[],d:[]},mirror=data.reverse();return mirror.forEach(function(elem){var x=$filter("date")(elem.date,"MMM dd"),y=$filter("number")(100*elem.engagement,1);results.d.push(x),results.e.push(y)}),results},genEngagementView=function(){var deferred=$q.defer();return Dashboard.getEngagment().then(function(engagement){$scope.rawEngagement=engagement;var rData=parseData(engagement.recentData),oData=parseData(subSample(engagement.overallData));$scope.engagement={recentChart:doughnutChart(),rDetailChart:{data:[rData.e],labels:rData.d,colors:[$PALLET.$balanced],series:["Viewer Engagement"],options:{scaleShowLabels:!0,scaleLabel:"<%= value + ' %'%>"}},overallChart:doughnutChart(),oDetailChart:{data:[oData.e],labels:oData.d,colors:[$PALLET.$royal],series:["Viewer Engagement"],options:{scaleShowLabels:!0,scaleLabel:"<%= value + ' %'%>"}}},engagement.recent=Math.round(engagement.recent),engagement.overall=Math.round(engagement.overall),$scope.engagement.recentChart.data=[engagement.recent,100-engagement.recent],$scope.engagement.recentChart.labels=["%Engaged","%Distracted"],$scope.engagement.recentChart.center=engagement.recent,$scope.engagement.recentChart.colors=[$PALLET.$balanced,$PALLET.$light],$scope.engagement.overallChart.data=[engagement.overall,100-engagement.overall],$scope.engagement.overallChart.labels=["%Engaged","%Distracted"],$scope.engagement.overallChart.center=engagement.overall,$scope.engagement.overallChart.colors=[$PALLET.$royal,$PALLET.$light],deferred.resolve()}),deferred.promise},genFileView=function(){var deferred=$q.defer();return Dashboard.getFileStats().then(function(stats){$scope.rawFileStats=stats;var f=stats.files,af=stats.archivedFiles,d=stats.decks,ad=stats.archivedDecks,recentActivity=doughnutChart();recentActivity.center=f.thisMonth;var all=f.today+f.thisWeek+f.thisMonth;0==all?recentActivity=emptyChart("No Activity",$PALLET.$light,recentActivity.center):(recentActivity.labels=["Today","This Week","This Month"],recentActivity.data=[f.today,f.thisWeek,f.thisMonth],recentActivity.colors=[$PALLET.$positive,$PALLET.$balanced,$PALLET.$calm]);var nativeActivity=doughnutChart();nativeActivity.center=f.all+af.stubs.length,0==nativeActivity.center?nativeActivity=emptyChart("No Files",$PALLET.$light,nativeActivity.center):(nativeActivity.labels=["Active","Archived"],nativeActivity.data=[f.all,af.stubs.length],nativeActivity.colors=[$PALLET.$positive,$PALLET.$energized]),$timeout(function(){$scope.files={recent:recentActivity,"native":nativeActivity}},0);var deckRecent=doughnutChart();deckRecent.center=d.thisMonth;var all=d.today+d.thisWeek+d.thisMonth;0==all?deckRecent=emptyChart("No Activity",$PALLET.$light,deckRecent.center):(deckRecent.labels=["Today","This Week","This Month"],deckRecent.data=[d.today,d.thisWeek,d.thisMonth],deckRecent.colors=[$PALLET.$positive,$PALLET.$balanced,$PALLET.$calm]);var deckNative=doughnutChart();deckNative.center=d.all+ad.stubs.length,0==deckNative.center?deckNative=emptyChart("No Decks",$PALLET.$light,deckNative.center):(deckNative.labels=["Active","Archived"],deckNative.data=[d.all,ad.stubs.length],deckNative.colors=[$PALLET.$positive,$PALLET.$energized]),$timeout(function(){$scope.decks={recent:deckRecent,"native":deckNative}},0),deferred.resolve()}),deferred.promise},firstButton={name:"Today",clicked:!1,click:function(){this.clicked=!0,genMeetingView().then(function(){$ionicScrollDelegate.resize()})}},secondButton={name:"Engagement",clicked:!1,click:function(){this.clicked=!0,genEngagementView().then(function(){$ionicScrollDelegate.resize()})}},thirdButton={name:"Files",clicked:!1,click:function(){this.clicked=!0,genFileView().then(function(){$ionicScrollDelegate.resize()})}};$scope.navButtons={"class":"button button-dark button-outline dashboard-nav-button",clickedClass:"button button-dark dashboard-nav-button",buttons:[firstButton,secondButton,thirdButton],todayButton:0,engageButton:1,fileButton:2,click:function(index){this.buttons.forEach(function(button){button.clicked=!1}),this.buttons[index].click()}},$scope.goMeetings=function(){$state.go("app.sessions")},$scope.hideInteractions=function(){$scope.interactions.forEach(function(i){i.isShowing=!1})},$scope.showInteraction=function($index){$scope.interactions[$index].isShowing?$scope.hideInteractions():($scope.hideInteractions(),$scope.iChart.data=[$scope.interactions[$index].data],$scope.iChart.labels=$scope.interactions[$index].labels,$scope.iChart.series=[$scope.interactions[$index].contact],$scope.iChart.colors=[$PALLET.$balanced],$scope.iChart.options={scaleShowLabels:!0,scaleLabel:"<%= value + ' sec'%>"},$scope.interactions[$index].isShowing=!0),$ionicScrollDelegate.resize()};var testWidth=function(){verge.viewportW()<600?$timeout(function(){$scope.minWidth=!1,$ionicScrollDelegate.resize()},0):$timeout(function(){$scope.minWidth=!0,$ionicScrollDelegate.resize()},0)};$scope.init=function(){$scope.navButtons.buttons[0].click(),$scope.iChart={},testWidth()},$scope.$on("$ionicView.enter",function(){var backView=$ionicHistory.backView();void 0!=backView&&("app.signup"==backView.stateName||"app.signin"==backView.stateName?$ionicNavBarDelegate.showBackButton(!1):$ionicNavBarDelegate.showBackButton(!0)),void 0!=$rootScope.user._id&&$scope.init()}),$scope.$on("$ionicView.beforeLeave",function(){$scope.navButtons.buttons.forEach(function(button){button.clicked=!1})}),$scope.$on("userID",function(event,user){$scope.init()}),$scope.w.on("orientationchange",function(){testWidth()}),$scope.w.bind("resize",function(){testWidth()}),$scope.$on("Revu.Me:Ready",function(){$ionicModal.fromTemplateUrl("templates/splashModal.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.splash=modal,$scope.splash.show(),$timeout(function(){$scope.splash.hide().then(function(){$scope.splash.remove(),void 0!=$rootScope.firstLogin&&1==$rootScope.firstLogin&&($rootScope.firstLogin=!1,$ionicSideMenuDelegate.toggleLeft(!0),$timeout(function(){$ionicSideMenuDelegate.toggleLeft(!1)},2e3))})},3e3)})}),$scope.tourService=tourService}]),angular.module("RevuMe").controller("libraryCtrl",["$scope","$rootScope","$state","$window","$timeout","$resource","Library","$ionicScrollDelegate","$ionicListDelegate","$ionicPopup","wizardService","baseUrl","shareMediator","slideShow","$q","ionicToast",function($scope,$rootScope,$state,$window,$timeout,$resource,Library,$ionicScrollDelegate,$ionicListDelegate,$ionicPopup,wizardService,baseUrl,shareMediator,slideShow,$q,ionicToast){function add(){$scope.addingTo.user={},$scope.addingTo.user._id=$rootScope.user._id,$scope.addingTo.slides=[],$scope.addingTo.thumb="",$scope.addingTo.isArchived=!1,Library.newNavItem($scope).then(function(result){Library.updateModel($scope).then(function(){$timeout(function(){$scope.endNavAdd()},0)})})["catch"](function(err){var alert=$ionicPopup.alert({title:"Error",template:"Error Code: "+err});alert.then(function(){})})}function fixSharedTeams($scope){$scope.navItems.forEach(function(item){item.sharedTeams=[]})}function showConfirm(filename){var confirmPopup=$ionicPopup.confirm({title:"Delete "+filename,template:"Are you sure to delete this?"});return confirmPopup}function reAspect(){("app.library"==$state.current.name||"app.mobileLib"==$state.current.name)&&($rootScope.smallScreen()&&"app.library"==$state.current.name&&$state.go("app.mobileLib"),$scope.width=verge.viewportW(),$scope.width<=1100?$timeout(function(){$scope.navClass="col col-50",$scope.thumbClass="col col-50"},0):$timeout(function(){$scope.navClass="col col-33",$scope.thumbClass="col col-67"},0),$ionicScrollDelegate.scrollTop())}function reOrder($scope,newPos,oldPos){var slide=$scope.slides[oldPos],num=0;newPos>oldPos&&newPos--,$scope.slides.splice(oldPos,1),$scope.slides.splice(newPos,0,slide),$scope.slides.forEach(function(slide){slide.originalOrder=num++}),num=0}function editCB(index,buttonIndex,$event,type){var action=$scope.navItems[index].actions[buttonIndex];action.name="Done",action.callBack=doneCB,$scope.editContainer(index),"button"!=type?($scope.navItems[index].actions[0].name="Editing...",$scope.navItems[index].actions[0]["class"]="button-assertive"):($event.stopPropagation(),action["class"]="button-assertive"),$timeout(function(){$scope.navItems[index].action.selected=$scope.navItems[index].actions[0]},0)}function doneCB(index,buttonIndex,$event,type){var action=$scope.navItems[index].actions[buttonIndex];action.name="Edit",action.callBack=editCB,$scope.editContainer(index),"button"!=type?($scope.navItems[index].actions[0].name="Options",$scope.navItems[index].actions[0]["class"]="button-positive"):(action["class"]="button-positive",$event.stopPropagation()),$timeout(function(){$scope.navItems[index].action.selected=$scope.navItems[index].actions[0]},0)}function newMeetingCB(index,buttonIndex,$event,type){"button"==type&&$event.stopPropagation(),"files"==$scope.modelName?Library.newDeckFromFile($scope.navItems[index]).then(function(navItem){$scope.buildSession(navItem,0),$scope.navItems[index].action.selected=$scope.navItems[index].actions[0]}):($scope.buildSession($scope.navItems[index],index),$scope.navItems[index].action.selected=$scope.navItems[index].actions[0])}function shareCB(index,buttonIndex,$event,type){"button"==type&&$event.stopPropagation(),$scope.selectedNavId=index,shareMediator.shareItem(index),$scope.navItems[index].action.selected=$scope.navItems[index].actions[0]}function archiveCB(index,buttonIndex,$event,type){"button"==type&&$event.stopPropagation(),$rootScope.archiveOn()?$scope.unArchiveNavItem(index):$scope.archiveNavItem(index),$scope.navItems[index].action.selected=$scope.navItems[index].actions[0]}function slideShowCB(index,buttonIndex,$event,type){"button"==type&&$event.stopPropagation(),$scope.selectedNavId=index,slideShow.startSlideShow($scope.navItems[index]),$scope.navItems[index].action.selected=$scope.navItems[index].actions[0]}function setActions($scope){$scope.actions=[{name:"Options"},{name:"Edit","class":"button-positive"},{name:"Meeting","class":"button-calm"},{name:"Show","class":"button-balanced"},{name:"Share","class":"button-royal"},{name:"Archive","class":"button-energized"}],$scope.actions[1].callBack=editCB,$scope.actions[2].callBack=newMeetingCB,$scope.actions[3].callBack=slideShowCB,$scope.actions[4].callBack=shareCB,$scope.actions[5].callBack=archiveCB,$scope.editActions=[{name:"Editing..."},{name:"Done","class":"button-assertive"},{name:"Meeting","class":"button-calm"},{name:"Show","class":"button-balanced"},{name:"Share","class":"button-royal"},{name:"Archive","class":"button-energized"}],$scope.editActions[1].callBack=doneCB,$scope.editActions[2].callBack=newMeetingCB,$scope.editActions[3].callBack=slideShowCB,$scope.editActions[4].callBack=shareCB,$scope.editActions[5].callBack=archiveCB}$scope.w=angular.element($window),$scope.init=function(){$scope.updating=!1,$scope.scrollDelegate=$ionicScrollDelegate,$timeout(function(){$scope.title="Slide Library",$scope.navItemsShowing=!0},0),$scope.library=Library,Library.init($scope),$scope.baseUrl=baseUrl.endpoint,$scope.slidePartial=baseUrl.endpoint+"/templates/slideItems.html",$scope.navPartial=baseUrl.endpoint+"/templates/navItems.html",reAspect(),$scope.user={},$scope.progress="0%",$scope.spinner=!1,$scope.timeLeft=0,setActions($scope),$scope.selectedNavId=0,$scope.navItems=[],$scope.listName="Uploaded Files",$scope.setModel("files"),$scope.tap={on:!1,index:0},$ionicListDelegate.showDelete(!1),$scope.deck={name:""},$scope.category={name:""},$scope.addingTo=void 0,$rootScope.archiveOn()||($scope.showAddItem=!0),shareMediator.init($scope),$scope.fileTypes=void 0,Library.fileTypes().then(function(types){$scope.fileTypes=types})},$scope.slideOver=function(){$scope.navItemsShowing=!1,$scope.$broadcast("library::slide")},$scope.slideBack=function(){$scope.navItemsShowing=!0,$scope.$broadcast("!library::slide")},$scope.editButton=function($index){return $scope.navItems[$index].beingEdited?"Done":"Edit"},$scope.buildSession=function(navItem,index){wizardService.build($scope,navItem,index).then(function(){$scope.slideBack(),ionicToast.show("A New Meeting has been Created","top",!1,2e3)})["catch"](function(err){$scope.slideBack()})},$scope.addSlide=function($index){Library.addSlide($scope,$index)},$scope.addAll=function(){Library.addAll($scope)},$scope.deleteSlide=function($index){Library.deleteSlide($scope,$index)},$scope.playVideo=function($index){
$scope.slides[$index].playing=!0},$scope.editContainer=function(index){$scope.isEditing?Library.closeCollection($scope,index):($scope.slideOver(),Library.openCollection($scope,index))},$scope.doRefresh=function(){Library.updateView().then(function(){$scope.$broadcast("scroll.refreshComplete")})},$scope.addDeck=function(){$scope.addingTo=new Library.decks,$scope.addingTo.name=$scope.deck.name,add()},$scope.addCategory=function(){$scope.addingTo=new Library.categories,$scope.addingTo.name=$scope.category.name,add()},$scope.setModel=function(model){switch($rootScope.showLoading(),$scope.modelName=model,model){case"files":$scope.listName="Uploaded Files",Library.setModel($scope,Library.files);break;case"decks":$scope.listName="Your Decks",Library.setModel($scope,Library.decks);break;case"categories":$scope.listName="Your Categories",Library.setModel($scope,Library.categories)}$scope.updating=!0,Library.updateModel($scope).then(function(){fixSharedTeams($scope),$rootScope.hideLoading(),$timeout(function(){$scope.updating=!1,$ionicScrollDelegate.scrollTop()},0)})},$scope.toggleNavAdd=function(){$scope.showAddItem?$scope.endNavAdd():$scope.addNavItem()},$scope.addNavItem=function(){$scope.deck.name="",$scope.category.name="",$scope.showAddItem=!0},$scope.endNavAdd=function(){$scope.showAddItem=!1,$ionicListDelegate.showDelete(!1)},$scope.delNavItem=function($index){var filename=$scope.navItems[$index].name;showConfirm(filename).then(function(res){res&&Library.removeNavItem($scope,$index).then(function(){Library.updateView(),ionicToast.show("Your item has been deleted","top",!1,2e3)})})},$scope.toggleListDelete=function(){$ionicListDelegate.showDelete()?$ionicListDelegate.showDelete(!1):$ionicListDelegate.showDelete(!0)},$scope.setNavSelection=function(id){$rootScope.showLoading(),$scope.slideOver(),$scope.selectedNavId=id,Library.updateSlides($scope).then(function(){$rootScope.hideLoading(),$ionicScrollDelegate.$getByHandle("slideItems").scrollTop()})},$scope.shareNavItem=function($index){TeamService.getAll($rootScope.user._id).then(function(teams){$scope.teams=teams,$scope.selectedNavId=$index,$scope.shareModal.show()})["catch"](function(err){console.log("library controller shaveNavItem - error: ",err)})},$scope.cancelNavShare=function(){$scope.shareModal.hide()},$scope.updateNavSharing=function(){console.log("updating sharing status for item: ",$scope.selectedNavId),console.log("Teams are...",$scope.teams),console.log("Sharing status is :",$scope.navItems[$scope.selectedNavId].sharedTeams),Library.shareNavItem($scope).then(function(){$scope.shareModal.hide(),ionicToast.show("Your item has been shared","top",!1,2e3)})},$scope.tapThumb=function(index){if(!$scope.isEditing&&$scope.navItems[$scope.selectedNavId]._$Reorder){var newPosition=index,oldPosition=$scope.tap.index;$scope.tap.on&&(reOrder($scope,newPosition,oldPosition),Library.updateNavItem($scope)),$scope.tap.on=!$scope.tap.on,$scope.tap.index=index}},$scope.archiveNavItem=function(index){console.log("Archive Nav Item: ",index),$scope.navItems[index].isArchived=!0,Library.setArchive($scope,index).then(function(){Library.updateView(),ionicToast.show("Your item has been achived","top",!1,2e3)})},$scope.unArchiveNavItem=function(index,$event){$event.stopPropagation(),$event.preventDefault(),console.log("UnArchive Nav Item: ",index),$scope.navItems[index].isArchived=!1,Library.setArchive($scope,index).then(function(){Library.updateView(),ionicToast.show("Your item has been unachived","top",!1,2e3)})},$scope.$on("$destroy",function(){void 0!=$scope.shareMediator&&$scope.shareMediator.destroy(),void 0!=channel&&channel.unsubscribe()}),$scope.w.on("orientationchange",function(){reAspect()}),$scope.w.bind("resize",function(){reAspect()}),void 0==$rootScope.user._id?$rootScope.$on("Revu.Me:Ready",function(event,data){$scope.init()}):$scope.init(),$scope.$on("$ionicView.enter",function(){void 0!=$rootScope.user._id&&"app.library"==$state.current.name&&setTimeout(function(){Library.init($scope),$scope.updating||$scope.setModel($scope.modelName)},0)}),$scope.$on("Revu.Me:Archive",function(event){Library.updateModel($scope),$rootScope.archiveOn()?($scope.title="Slide Library ARCHIVE",$scope.showAddItem=!1):($rootScope.isMobile||$rootScope.smallScreen()||$rootScope.archiveOn()||($scope.showAddItem=!0),$scope.title="Slide Library")}),$scope.$on("SUCCESS",function(){alert("ALL LOADED")}),$scope.tourShow=function(){var idx=0,foundIdx=-1;$scope.navItems.forEach(function(item){"Getting Started.pptx"==item.name&&(foundIdx=idx),idx++}),foundIdx>=0&&slideShow.startSlideShow($scope.navItems[foundIdx])}}]),angular.module("RevuMe").controller("accountCtrl",["$scope","$rootScope","Braintree","ScriptService","$ionicScrollDelegate","$ionicModal","$ionicPopup","TeamService","userService","$state","$filter","$q","ionicToast",function($scope,$rootScope,Braintree,ScriptService,$ionicScrollDelegate,$ionicModal,$ionicPopup,TeamService,userService,$state,$filter,$q,ionicToast){function setRenewMessage(script){script.autoRenew?script.renewMessage="Subscription Renews in "+script.daysLeft+" days":script.renewMessage="Subscription Expires in "+script.daysLeft+" days"}function setChangeButtonName(script){"Trial"==script.type?$scope.changeButton={text:"Upgrade Account"}:("Monthly"==script.type||"Annually"==script.type)&&($scope.changeButton={text:"Change Account"})}function showConfirm(confirmMessage){var confirmPopup=$ionicPopup.confirm(confirmMessage);return confirmPopup}function keepMembers(){$scope.currentMembers=[],$scope.script.members.forEach(function(member){$scope.currentMembers.push(member)})}function restoreMembers(){$scope.script.members=[],$scope.currentMembers.forEach(function(member){$scope.script.members.push(member)}),$scope.script.availableSeats=$scope.script.totalSeats-$scope.script.members.length}$scope.sd=$ionicScrollDelegate,$scope.User=userService.user,$ionicModal.fromTemplateUrl("templates/manageSeats.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.seatModal=modal}),$scope.init=function(){Braintree.init($scope),$scope.showChange=!1,$scope.script=$rootScope.user.script,void 0!=$scope.script.customerId&&Braintree.findCustomer($scope.script).then(function(customer){$scope.script.customer=customer,$scope.script.defaultMethod=void 0,$scope.showCardEntry=!1,customer.paymentMethods.forEach(function(method){method["default"]&&($scope.script.defaultMethod=method)})}),setChangeButtonName($scope.script),$scope.script.daysLeft=ScriptService.getDaysLeft($scope.script),$scope.script.scriptTypes=ScriptService.scriptTypes,$scope.script.cost=ScriptService.calculateCost($scope.script),setRenewMessage($scope.script);var members=[{user:$rootScope.user._id,role:"Admin"}];$scope.order=ScriptService.newScript(ScriptService.scriptTypes[1],members),("Monthly"==$scope.script.type||"Annually"==$scope.script.type)&&($scope.order.totalSeats=$scope.script.totalSeats,$scope.order.type=$scope.script.type),$scope.order.scriptTypes=ScriptService.scriptTypes.slice(1,3),$scope.order.stopRenew=!$scope.script.autoRenew,$scope.order.price=ScriptService.calculateCost($scope.order),$scope.order.hint="Pay Annually and Save $"+ScriptService.annualSavings($scope.order),$scope.admin=ScriptService.getAdmin($scope.script),$scope.script.members.forEach(function(member){member.user.name=member.user.firstName+" "+member.user.lastName}),$scope.script.showTeams=!1,$scope.form={},TeamService.getAll($rootScope.user._id).then(function(teams){$scope.script.teamList=teams,$scope.script.teamList.length>0&&($scope.script.team=$scope.script.teamList[0])}),$scope.newMember={}},$scope.changeAccount=function(){$scope.showChange=!0},$scope.cancelChange=function(){$scope.showChange=!1},$scope.changeTerm=function(){if("Trial"!=$scope.script.type)if("Monthly"==$scope.order.type&&"Annually"==$scope.script.type){var confirmMessage={title:"Downgrade to Monthly",template:"Please Confirm Monthly Billing"};showConfirm(confirmMessage).then(function(res){if(res){var dateString=$filter("date")($scope.script.expirationDate,"shortDate");$scope.script.type=$scope.order.type,ScriptService.update($scope.script._id,$scope.script),Braintree.updateBTScript($scope.script),$scope.order.hint="Monthly Billing Starts "+dateString,ionicToast.show("Your account has been updated","top",!1,2e3)}else $scope.order.type="Annually"})}else Braintree.isAnnualPlan($scope.script).then(function(isAnnual){isAnnual?($scope.script.autoRenew=!0,$scope.script.type="Annually",ScriptService.update($scope.script._id,$scope.script),Braintree.updateBTScript($scope.script),$scope.order.hint="Annual Plan Reinstated",ionicToast.show("Your account has been updated","top",!1,2e3)):$scope.updateOrderSize()})},$scope.decreaseSeats=function(){var script=$scope.script,order=$scope.order,deferred=$q.defer(),confirmMessage={title:"Reduce Seats",template:"Please Confirm Fewer Seats"};return showConfirm(confirmMessage).then(function(res){res?(script.totalSeats=order.totalSeats,script.availableSeats=script.totalSeats-script.members.length,Braintree.updateBTScript(script).then(function(){return ScriptService.update(script._id,script)}).then(function(){deferred.resolve(),ionicToast.show("Your account has been updated","top",!1,2e3)})["catch"](function(err){deferred.reject(err)})):deferred.resolve()}),deferred.promise},$scope.changeSeatCount=function(){var order=$scope.order,script=$scope.script;order.totalSeats<script.totalSeats?$scope.decreaseSeats().then(function(){$scope.updateOrderSize()}):$scope.updateOrderSize()},$scope.updateOrderSize=function(){$scope.order.price=ScriptService.calculateCost($scope.order);var savings=ScriptService.annualSavings($scope.order),saveStr=$filter("number")(savings,0);switch($scope.order.type){case"Monthly":$scope.order.hint="Pay Annually and Save $"+saveStr;break;case"Annually":$scope.order.hint="You Save $"+saveStr+"!"}ionicToast.show("Your account has been updated","top",!1,2e3)},$scope.renewChange=function(){$scope.script.autoRenew=!$scope.order.stopRenew,ScriptService.update($scope.script._id,$scope.script),Braintree.updateBTScript($scope.script),setRenewMessage($scope.script),ionicToast.show("Your account has been updated","top",!1,2e3)},$scope.checkout=function(){var script=angular.copy($scope.script);$scope.order.show=!1,$scope.sd.scrollTop(),$scope.sd.resize(),script.totalSeats=$scope.order.totalSeats,script.type=$scope.order.type,ScriptService.setPendingScript(script),$state.go("app.payment")},$scope.changeCard=function(){$state.go("app.changeCard")},$scope.manageSeats=function(){keepMembers(),$scope.seatModal.show()},$scope.cancelManager=function(){$scope.seatModal.hide(),restoreMembers()},$scope.setPendingScript=function(){$scope.script.totalSeats=$scope.order.totalSeats,$scope.script.type=$scope.order.type},$scope.addMember=function(){var member=new Object,_id=-1,names=$scope.newMember.name.split(" ");member.name=$scope.newMember.name,member.firstName=names[0],member.lastName=names[1],member.email=$scope.newMember.email,$scope.User.byEmail.get({email:member.email}).$promise.then(function(user){if(void 0==user._id){var usr=new $scope.User.byId;angular.extend(usr,member),usr.$save().then(function(usr){_id=usr._id,$scope.script.members.push({user:member,role:"Viewer"}),$scope.newMember.name="",$scope.newMember.email=""})["catch"](function(err){console.log(err)})}else member._id=user._id,$scope.script.members.push({user:member,role:"Viewer"}),$scope.newMember.name="",$scope.newMember.email="";$scope.script.availableSeats=$scope.script.totalSeats-$scope.script.members.length})["catch"](function(err){console.log(err)}),this.forms.members.aName.$dirty=!1,this.forms.members.aEmail.$dirty=!1},$scope.delMember=function($index){$scope.script.members.splice($index,1),$scope.script.availableSeats=$scope.script.totalSeats-$scope.script.members.length},$scope.addTeam=function(){$scope.script.team.members.forEach(function(member){$scope.script.availableSeats>0&&(member.name=member.firstName+" "+member.lastName,$scope.script.members.push({user:member,role:"Viewer"}),$scope.script.availableSeats=$scope.script.totalSeats-$scope.script.members.length)})},$scope.$on("$ionicView.enter",function(){void 0!=$rootScope.user._id&&"app.myAccount"==$state.current.name&&setTimeout(function(){$scope.init()},0)}),$scope.$on("$destroy",function(){void 0!=$scope.seatModal&&$scope.seatModal.remove()}),void 0==$rootScope.user.script?$rootScope.$on("Revu.Me:Ready",function(event,data){$scope.init()}):$scope.init()}]),angular.module("RevuMe").controller("paymentCtrl",["$scope","$rootScope","Braintree","ScriptService","$state","baseUrl","$http","$q",function($scope,$rootScope,Braintree,ScriptService,$state,baseUrl,$http,$q){$scope.status={message:void 0,errors:void 0},$scope.init=function(){$scope.paymentDisabled=!1,$scope.script=ScriptService.getPendingScript(),$scope.status={message:void 0,errors:void 0},$scope.script.cost=ScriptService.calculateCost($scope.script),$scope.processCardDisabled=!1,Braintree.init($scope,$scope.pmrCallback).then(function(){console.log("payment controlller init: script is: ",$scope.script),void 0!=$scope.script.customerId?Braintree.findCustomer($scope.script).then(function(customer){$scope.script.customer=customer,$scope.script.defaultMethod=void 0,$scope.showCardEntry=!1,customer.paymentMethods.forEach(function(method){method["default"]&&($scope.script.defaultMethod=method)})}):$scope.showCardEntry=!0,$scope.dropinOptions={onPaymentMethodReceived:function(payload){Braintree.payMethReceived(payload)},onError:function(payload){console.log(payload)}}})},$scope.pmrCallback=function(){$scope.status.message="Successfully Processed - Thank You!",$scope.showCardEntry=!1,$scope.processCardDisabled=!0},$scope.defaultPay=function(){$scope.paymentDisabled=!0,$scope.status.message="Processing Payment...",$scope.status.errors=void 0,Braintree.updateBTScript($scope.script).then(function(result){return $scope.showCardEntry=!1,ScriptService.update($scope.script._id,$scope.script)}).then(function(result){$rootScope.user.script=angular.copy($scope.script),$scope.status.message="Completed Successfully - Thank You!"})["catch"](function(result){$scope.status.errors=result.errors,$scope.status.errorMessage="Failed : "+result.message})},$scope.cancelOrder=function(){$state.go("app.myAccount")},$scope.$on("$ionicView.enter",function(){void 0!=$rootScope.user._id&&"app.payment"==$state.current.name&&setTimeout(function(){$scope.init()},0)}),void 0==$rootScope.user.script?$rootScope.$on("Revu.Me:Ready",function(event,data){$scope.init()}):$scope.init()}]),angular.module("RevuMe").controller("presentationCtrl",["$scope","$rootScope","$stateParams","$timeout","pnFactory","$ionicSlideBoxDelegate","session","userMonitor","recorder","presAnalyzer","BridgeService","$ionicScrollDelegate","Screenleap","$ionicModal",function($scope,$rootScope,$stateParams,$timeout,pnFactory,$ionicSlideBoxDelegate,session,userMonitor,recorder,presAnalyzer,BridgeService,$ionicScrollDelegate,Screenleap,$ionicModal){function setInitials(){$scope.session.attendees.forEach(function(attendee){attendee.initials=attendee.firstName[0]+attendee.lastName[0]});var organizer=$scope.session.organizer;organizer.initials=organizer.firstName[0]+organizer.lastName[0]}function sendEnd(){var m={action:"end"};recorder.record(m)}function newPresentation(id){var m={action:"new",value:id,caller:"newPresentation"};recorder.record(m),$scope.channel.publish(m)}function handlePresence(m){if(m.caller="handlePresence",userMonitor.rollCall(m),void 0!=m.userName){recorder.record(m);var statusMessage=m.userName+" has ";switch(m.action){case"join":statusMessage+="joined";break;case"leave":case"timeout":statusMessage+="left"}$timeout(function(){$scope.everyone=userMonitor.everyone,$scope.present=userMonitor.present,$scope.$broadcast("show_message",statusMessage)},0),console.log($scope.everyone)}}function handleMessage(msg){switch(msg.action){case"engagement":var str=msg.who+" is "+msg.status;console.log(str),msg.caller="handleMessage",recorder.record(msg),userMonitor.noteEngagement(msg.id,msg.status),$timeout(function(){$scope.everyone=userMonitor.everyone},0);break;case"catchup":$scope.catchUp()}}$scope.footerClasses=["normal","tall","hidden"],$scope.footer={},$scope.footer.index=0,$scope.footer["class"]=$scope.footerClasses[$scope.footer.index],$scope.session=session,$scope.deckIdx=session.deckIdx,$scope.name=session.name,$scope.presentation=$scope.session.decks[$scope.deckIdx],$scope.bridgeService=BridgeService,$scope.screenleap=Screenleap,$scope.init=function(){setInitials(),$scope.current=0,$scope.showUsers=!0;var everyone=$scope.session.attendees;everyone.push($scope.session.organizer),userMonitor.init(everyone),$scope.everyone=everyone,$scope.present=[],$scope.mapShowing=!1,$scope.buttonText="Show All";var channelName=$stateParams.id.toString()+".view_channel";$scope.channel=pnFactory.newChannel(channelName),$scope.channel.setUser($rootScope.user.name),recorder.setChannel($scope.channel),BridgeService.setChannel($scope.channel),$scope.channel.subscribe(handleMessage,handlePresence),newPresentation($scope.presentation._id),$scope.setSlide($scope.current),$ionicSlideBoxDelegate.update(),$scope.session.bridge&&!$scope.bridgeService.activeBridge()&&$scope.bridgeService.startBridge($scope.session.ufId),$ionicModal.fromTemplateUrl("templates/screenleap.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.instructions=modal}),$scope.screenSharingEnabled=!($rootScope.device.isIOS||$rootScope.device.isAndroid||$rootScope.device.isWindowsPhone||$rootScope.isMobile),$scope.isSharing=!1},$scope.screenleap.$on("screenShareEnd",function(){$scope.isSharing=!1;var m={action:"screenShare",value:void 0,caller:"screenShare"};recorder.record(m),$scope.channel.publish(m),$scope.catchUp()}),$scope.screenleap.$on("downloadStarting",function(){$scope.instructions.show()}),$scope.screenleap.$on("screenShareStarted",function(){$scope.instructions.hide()}),$scope.restartDownload=function(){$scope.screenleap.downloadAndStart()},$scope.startNative=function(){$scope.screenleap.startFromClick()},$scope.$on("$destroy",function(){void 0!=$scope.instructions&&$scope.instructions.remove()}),$scope.showDialin=function(){BridgeService.showBridgeInfo()},$scope.endPresentation=function(){sendEnd();var results=presAnalyzer.analyze(recorder["export"]()),record={session:$stateParams.id,presentation:$scope.presentation._id,results:results};presAnalyzer.save(record).then(function(_id){console.log(_id)})},$scope.cleanUp=function(){$scope.endPresentation(),"undefined"!=$scope.channel&&$scope.channel.unsubscribe()},$scope.toggleShowUsers=function(){$scope.footer.index+=1,$scope.footer.index==$scope.footerClasses.length&&($scope.footer.index=0),$scope.footer["class"]=$scope.footerClasses[$scope.footer.index]},$scope.toggleMap=function(){$scope.mapShowing=!$scope.mapShowing,$scope.buttonText=$scope.mapShowing?"Hide All":"Show All"},$scope.nextSlide=function(){$scope.setSlide(++$scope.current),$ionicSlideBoxDelegate.slide($scope.current),$ionicSlideBoxDelegate.update()},$scope.prevSlide=function(){$scope.setSlide(--$scope.current),$ionicSlideBoxDelegate.slide($scope.current),$ionicSlideBoxDelegate.update()},$scope.screenShare=function(){$rootScope.showLoading(),$scope.screenleap.startSharing().then(function(shareSession){$scope.isSharing=!0,$scope.shareSession=shareSession;var m={action:"screenShare",value:shareSession.viewerUrl,caller:"screenShare"};recorder.record(m),$scope.channel.publish(m),$rootScope.hideLoading()})["catch"](function(response){$scope.isSharing=!1,$rootScope.hideLoading()})},$scope.setSlide=function(slideNumber){slideNumber>=$scope.presentation.slides.length-1?($scope.current=$scope.presentation.slides.length-1,$scope.nextEnabled=!1,$scope.prevEnabled=!0):0>=slideNumber?($scope.current=0,$scope.prevEnabled=!1,$scope.nextEnabled=!0):($scope.current=slideNumber,$scope.nextEnabled=!0,$scope.prevEnabled=!0),$scope.viewingSlide=$scope.presentation.slides[$scope.current];var val=$scope.current.toString(),m={action:"set",value:val,caller:"setSlide"};recorder.record(m),$scope.channel.publish(m),$scope.$broadcast("slideChange",val)},$scope.catchUp=function(){if($scope.isSharing){var shareSession=$scope.shareSession,m={action:"screenShare",value:shareSession.viewerUrl,caller:"screenShare"};$scope.channel.publish(m)}else $scope.setSlide($scope.current)},$scope.viewIdx=function(){return $scope.current},$scope.$on("$destroy",function(){$scope.cleanUp()}),void 0==$rootScope.user._id?$rootScope.$on("Revu.Me:Ready",function(event,data){$scope.init()}):$scope.init(),$scope.updateSlideStatus=function(slide){var zoomFactor=$ionicScrollDelegate.$getByHandle("scrollHandle"+slide).getScrollPosition().zoom;1==zoomFactor?$ionicSlideBoxDelegate.enableSlide(!0):$ionicSlideBoxDelegate.enableSlide(!1)}}]),angular.module("RevuMe").controller("resetPasswordCtrl",["$scope","$rootScope","userService","$timeout","$ionicPopup",function($scope,$rootScope,userService,$timeout,$ionicPopup){$scope.resetPassword=function(){var credentials={};if(credentials.email=$scope.forms.resetPw.email,credentials.oldPassword=$scope.forms.resetPw.oldPassword,credentials.password=$scope.forms.resetPw.newPassword,credentials.repeat=$scope.forms.resetPw.repeat,credentials.password!=credentials.repeat){var alert=$ionicPopup.alert({title:"Uh Oh!",template:"New Password Fields Don't Match"});alert.then(function(res){})}else $scope.forms.resetPw.message="",userService.checkExists(credentials.email).then(function(exists){if(exists)userService.resetPassword(credentials).then(function(result){if(result.success){var alert=$ionicPopup.alert({title:"Success!",template:"Your Password is Reset"});alert.then(function(res){})}else{var alert=$ionicPopup.alert({title:"Reset PW Error",template:result.reason});alert.then(function(res){})}});else{var alert=$ionicPopup.alert({title:"Reset PW Error",template:credentials.email+" not found"});alert.then(function(res){})}})["catch"](function(err){console.log(err)})}}]),angular.module("RevuMe").controller("reviewCtrl",["$scope","$rootScope","$stateParams","$timeout","$window","session","$ionicSlideBoxDelegate","$ionicScrollDelegate","$ionicModal","EngagementMetrics","Revu","$q",function($scope,$rootScope,$stateParams,$timeout,$window,session,$ionicSlideBoxDelegate,$ionicScrollDelegate,$ionicModal,EngagementMetrics,Revu,$q){function execTimeout($scope){$scope.cleanUp(),$window.location.href="https://www.revu.me"}function startTimeout($scope){if(void 0!=$scope.timeout){$timeout.cancel($scope.timeout);console.log("startTimeout - killing orphaned timeout")}$scope.timeout=$timeout(function(){execTimeout($scope)},timeLimit)}function stopTimeout($scope){var cancelled=!1;void 0!=$scope.timeout&&(cancelled=$timeout.cancel($scope.timeout),console.log("cancel timeout = ",cancelled),$scope.timeout=void 0)}function logView($scope){var view={};stopTimeout($scope),view.timeStamp=Date.now(),view.deckIdx=$scope.deckIdx,view.page=current;var length=$scope.metrics.views.length;if(length>0){var lastView=$scope.metrics.views[length-1];lastView.duration=(view.timeStamp-lastView.timeStamp)/1e3}$scope.metrics.views.push(view),view.page>=0&&startTimeout($scope)}function initInteraction($scope){var si={};return si.viewers=[],si.slideViews=[],si.viewers.push($rootScope.user._id),si.session=$scope.session._id,si.eventDate=new Date,si}function buildMetrics($scope){var interactions=[],si=initInteraction($scope),currentDeck=$scope.metrics.views[0].deckIdx;return si.deck=$scope.session.decks[currentDeck]._id,$scope.metrics.views.forEach(function(view){if((view.deckIdx!=currentDeck||-1==view.page)&&(interactions.push(si),si=initInteraction($scope),currentDeck=view.deckIdx,si.deck=$scope.session.decks[currentDeck]._id),view.page>=0){var sv={},v={};sv.slideIndex=view.page,sv.duration=view.duration,sv._id=$scope.session.decks[view.deckIdx].slides[view.page]._id,sv.views=[],v.userName=$rootScope.user.name,v.viewed=view.duration,v._id=sv._id,sv.views.push(v),si.slideViews.push(sv)}}),interactions}function startRevu($scope){$scope.metrics.user=$rootScope.user,$scope.session.who=$rootScope.user,logView($scope),startTimeout($scope),Revu.start.send({},$scope.session)}function saveMetrics(interactions){var defer=$q.defer(),promises=[];return interactions.forEach(function(si){var metrics=new EngagementMetrics;angular.extend(metrics,si),promises.push(metrics.$save())}),$q.all(promises).then(function(){defer.resolve()})["catch"](function(err){defer.reject()}),defer.promise}function endRevu($scope){current=-1,logView($scope);var si=buildMetrics($scope);saveMetrics(si).then(function(){})["catch"](function(err){console.log(err)}),Revu.end.send({},$scope.session)}function validateSlide(slideNumber){slideNumber>=$scope.deckLength-1?$scope.deckIdx<$scope.session.decks.length-1?($scope.offset+=$scope.deckLength,$scope.deckIdx++,$scope.deckLength=$scope.session.decks[$scope.deckIdx].slides.length,current=0):(current=$scope.session.decks[$scope.deckIdx].slides.length-1,$scope.nextEnabled=!1,$scope.prevEnabled=!0):0>slideNumber?$scope.deckIdx>0?($scope.deckIdx--,$scope.deckLength=$scope.session.decks[$scope.deckIdx].slides.length,$scope.offset-=$scope.deckLength,current=$scope.session.decks[$scope.deckIdx].slides.length-1):(current=0,$scope.prevEnabled=!1,$scope.nextEnabled=!0):($scope.current=slideNumber,$scope.nextEnabled=!0,$scope.prevEnabled=!0)}var current=0,userName=($rootScope.user._id,$rootScope.user.name),timeLimit=3e5;$ionicSlideBoxDelegate.enableSlide(!0),Date.now||(Date.now=function(){return(new Date).getTime()}),$scope.session=session,$scope.deckId=session.decks[0]._id,$scope.name=session.name,$scope.init=function(){$scope.deckIdx=0,$scope.deckLength=$scope.session.decks[$scope.deckIdx].slides.length,$scope.offset=0,$scope.presentation={},angular.extend($scope.presentation,$scope.session.decks[$scope.deckIdx]),$scope.presentation.slides=[];for(var i=0;i<$scope.session.decks.length;i++){var deck=$scope.session.decks[i];deck.slides.forEach(function(slide){$scope.presentation.slides.push(slide)})}current=0,$scope.current=current,$scope.nextEnabled=!0,$scope.prevEnabled=!1,$scope.metrics={},$scope.metrics.views=[],$scope.timeout=void 0,$scope.cleanupDone=!1,startRevu($scope)},$scope.cleanUp=function(){$scope.cleanupDone||($scope.cleanupDone=!0,$scope.session.leaveBehind?$scope.welcomeModal.remove():$scope.contentRemoved.remove(),endRevu($scope))},$scope.nextSlide=function(){$scope.setSlide(++current)},$scope.prevSlide=function(){$scope.setSlide(--current)},$scope.swipeSlide=function(slideNumber){current=slideNumber,validateSlide(slideNumber),logView($scope)},$scope.setSlide=function(slideNumber){validateSlide(slideNumber),$scope.viewingSlide=$scope.presentation.slides[current+$scope.offset],$ionicSlideBoxDelegate.slide(current+$scope.offset)},$scope.updateSlideStatus=function(slide){var zoomFactor=$ionicScrollDelegate.$getByHandle("scrollHandle"+slide).getScrollPosition().zoom;1==zoomFactor?$ionicSlideBoxDelegate.enableSlide(!0):$ionicSlideBoxDelegate.enableSlide(!1)},$scope.$on("Revu.Me::Pause",function(){var msg={action:"engagement",status:"distracted",who:userName,id:$rootScope.user._id};console.log("Pause:distracted"),$scope.channel.publish(msg)}),$scope.$on("Revu.Me::Resume",function(){var msg={action:"engagement",status:"engaged",who:userName,id:$rootScope.user._id};console.log("Resume:engaged"),$scope.channel.publish(msg)}),$scope.w=$window,$window.onfocus=function(event){({action:"engagement",status:"engaged",who:userName,id:$rootScope.user._id});console.log("engaged")},$window.onblur=function(event){({action:"engagement",status:"distracted",who:userName,id:$rootScope.user._id});console.log("distracted")},$window.onbeforeunload=function(event){$scope.cleanUp()},$scope.$on("$destroy",function(){$scope.cleanUp()}),$scope.$on("visibilityChanged",function(event,isHidden){if(document.hidden){({action:"engagement",status:"distracted",who:userName,id:$rootScope.user._id});console.log("distracted")}else{({action:"engagement",status:"engaged",who:userName,id:$rootScope.user._id});console.log("engaged")}}),$scope.session.leaveBehind?$ionicModal.fromTemplateUrl("templates/welcomeTemplate.html",{scope:$scope}).then(function(modal){$scope.welcomeModal=modal,$scope.welcomeModal.show(),$timeout(function(){$scope.welcomeModal.hide(),$scope.welcomeModal.remove()},3500)}):$ionicModal.fromTemplateUrl("templates/contentRemoved.html",{scope:$scope}).then(function(modal){$scope.contentRemoved=modal,$scope.contentRemoved.show()}),void 0==$rootScope.user._id?$rootScope.$on("Revu.Me:Ready",function(event,data){$scope.init()}):$scope.init()}]),angular.module("RevuMe").controller("SessionsCtrl",["$scope","$rootScope","Sess","Decks","$ionicListDelegate","$ionicPopup","wizardService","$state","$timeout","ionicToast",function($scope,$rootScope,Sess,Decks,$ionicListDelegate,$ionicPopup,wizardService,$state,$timeout,ionicToast){function showConfirm(filename){var confirmPopup=$ionicPopup.confirm({title:"Delete "+filename,template:"Are you sure to delete this?"});return confirmPopup}$scope.titles={},$scope.init=function(){var _id=$rootScope.user._id;$scope.setTitles(),$scope.action={selected:$scope.actions[0]},void 0!=_id&&Sess.orgSessions.get({id:_id,isArchived:$rootScope.archiveOn()}).$promise.then(function(os){return $scope.orgSessions=os,Sess.attSessions.get({id:_id,isArchived:$rootScope.archiveOn()}).$promise}).then(function(as){$scope.attSessions=as,$scope.bridge={}})["catch"](function(err){console.log(err)})},$scope.doRefresh=function(){var _id=$rootScope.user._id;$scope.checkArchive(),void 0!=_id&&Sess.orgSessions.get({id:_id,isArchived:$rootScope.archiveOn()}).$promise.then(function(os){return $scope.orgSessions=os,Sess.attSessions.get({id:_id,isArchived:$rootScope.archiveOn()}).$promise}).then(function(as){$scope.attSessions=as,$scope.$broadcast("scroll.refreshComplete")})},$scope.go=function(id){$state.transitionTo("app.session",{id:id})},$scope.toggleListDelete=function(which){$ionicListDelegate.$getByHandle(which).showDelete()?$ionicListDelegate.$getByHandle(which).showDelete(!1):$ionicListDelegate.$getByHandle(which).showDelete(!0)},$scope.delOrgSession=function(idx){var filename=$scope.orgSessions[idx].name;showConfirm(filename).then(function(res){if(res){var _id=$scope.orgSessions[idx]._id;Sess.sessions["delete"]({id:_id}),$scope.orgSessions.splice(idx,1),ionicToast.show("Meeting has been deleted","top",!1,2e3)}})},$scope.delAttSession=function(idx){var filename=$scope.attSessions[idx].name;showConfirm(filename).then(function(res){if(res){var _id=$scope.attSessions[idx]._id;Sess.sessions["delete"]({id:_id}),$scope.attSessions.splice(idx,1),ionicToast.show("Meeting has been deleted","top",!1,2e3)}})},$scope.editSession=function(idx){var _id=$scope.orgSessions[idx].decks[0]._id;Decks.get({id:_id}).$promise.then(function(deck){return void 0!=deck._id&&($scope.orgSessions[idx].decks[0]=deck),wizardService.edit($scope,$scope.orgSessions[idx])}).then(function(){$scope.doRefresh()})["catch"](function(){console.log("Edit Canceled")})},$scope.newSession=function(){wizardService["new"]($scope).then(function(){$scope.doRefresh()})["catch"](function(){console.log("New Cancelled")})},$scope.markArchive=function(idx){var user=$rootScope.user,_id=$scope.orgSessions[idx]._id;$scope.orgSessions[idx].archiveStatus.forEach(function(stat){stat.id==user._id&&(stat.isArchived=!$rootScope.archiveOn())}),Sess.archive.update({id:_id},$scope.orgSessions[idx]).$promise.then(function(){$scope.doRefresh();var archiveText=$rootScope.archiveOn()?"unarchived":"archived",text="Your Meeting has been "+archiveText;ionicToast.show(text,"top",!1,2e3)})},$scope.markAttArchive=function(idx){var user=$rootScope.user,_id=$scope.attSessions[idx]._id;$scope.attSessions[idx].archiveStatus.forEach(function(stat){stat.id==user._id&&(stat.isArchived=!$rootScope.archiveOn())}),Sess.archive.update({id:_id},$scope.attSessions[idx]).$promise.then(function(){
$scope.doRefresh();var archiveText=$rootScope.archiveOn()?"unarchived":"archived",text="Your Meeting has been "+archiveText;ionicToast.show(text,"top",!1,2e3)})},$scope.actions=[{name:"Options",callback:{}},{name:"Edit",callback:$scope.editSession},{name:"Archive",callback:$scope.markArchive}],$scope.doAction=function(idx){var action=$scope.action.selected;console.log("Session doAction: ",action),action.callback(idx),$scope.action.selected=$scope.actions[0]},$scope.checkArchive=function(){$rootScope.archiveOn()?$scope.actions[2].name="UnArchive":$scope.actions[2].name="Archive"},$scope.setTitles=function(){$rootScope.archiveOn()?($scope.titles.organizer="Your ARCHIVED Meetings",$scope.titles.attendee="Your ARCHIVED Invitations"):($scope.titles.organizer="Your Meetings",$scope.titles.attendee="Your Invitations")},$scope.init(),$scope.$on("userID",function(event,user){$scope.init()}),"app.newMeeting"==$state.current.name&&$scope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){"app.newMeeting"==toState.name&&void 0!=$rootScope.user._id&&$timeout(function(){$scope.newSession()},50)}),"app.newMeeting"==$state.current.name&&$scope.$on("Revu.Me:NewMeeting",function(){$scope.newSession()}),$scope.$on("Revu.Me:Archive",function(event){$ionicListDelegate.$getByHandle("att").showDelete()&&$ionicListDelegate.$getByHandle("att").showDelete(!1),$ionicListDelegate.$getByHandle("org").showDelete()&&$ionicListDelegate.$getByHandle("org").showDelete(!1),$scope.checkArchive(),$scope.init()}),$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){("app.session"==toState.name||"app.attendeeSessions"!=toState.name)&&$scope.doRefresh()})}]).controller("SessionCtrl",["$scope","$rootScope","$stateParams","Sess","session","Decks","presAnalyzer","$ionicModal","$ionicPopup","$state","BridgeService","$timeout","wizardService","ionicToast","baseUrl",function($scope,$rootScope,$stateParams,Sess,session,Decks,presAnalyzer,$ionicModal,$ionicPopup,$state,BridgeService,$timeout,wizardService,ionicToast,baseUrl){$scope.bridgeService=BridgeService,$scope.session=session,$scope.baseUrl=baseUrl,$scope.meetingUrl=$scope.baseUrl.endpoint+"/#/app/session/"+session._id,$scope.init=function(){void 0!=session._id&&($scope.activeMeeting=!1,$scope.bridgeService.findBridge($scope.session.ufId),$scope.session.confId=$scope.session.ufId.replace(/-/g,""),$scope.loadReports())},$scope.loadReports=function(){if($scope.session.decks.length>0){var sid=$scope.session._id;$scope.deckIdx=0,$scope.reportsEnabled=[];for(var i=0;i<$scope.session.decks.length;i++){var did=$scope.session.decks[i]._id;presAnalyzer.get(sid,did).then(function(results){results.length>0?$scope.reportsEnabled.push(!0):$scope.reportsEnabled.push(!1)})["catch"](function(err){console.log(err)})}}},$scope.editSession=function(){wizardService.edit($scope,$scope.session).then(function(updated){$scope.session=updated})["catch"](function(){console.log("Edit Canceled")})},$scope.handyDial=function(){var confId=$scope.session.ufId.replace(/-/g,""),dialStr=$scope.session.bridgeNumber+",,,"+confId+"#";return dialStr},$ionicModal.fromTemplateUrl("templates/presAnalytics.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modal=modal}),$scope.go=function(id,index){$scope.session.organizer._id==$rootScope.user._id?($scope.activeMeeting=!0,$scope.session.bridge&&!$scope.bridgeService.activeBridge()?$scope.bridgeService.startBridge($scope.session.ufId).then(function(){$state.transitionTo("app.presentation",{id:id,idx:index})}):$state.transitionTo("app.presentation",{id:id,idx:index})):$scope.session.bridge?$scope.bridgeService.startBridge($scope.session.ufId).then(function(){$state.transitionTo("app.viewer",{id:$scope.session._id,idx:0})}):$state.transitionTo("app.viewer",{id:$scope.session._id,idx:0})},$scope.showAlert=function(title,msg){var alertPopup=$ionicPopup.alert({title:title,template:msg});return alertPopup},$scope.showResults=function(idx){if($scope.session.decks.length>0){var sid=$scope.session._id,did=$scope.session.decks[idx]._id;presAnalyzer.get(sid,did).then(function(results){results.length>0&&Decks.get({id:did}).$promise.then(function(deck){void 0!=deck._id&&($scope.session,$scope.session.decks[idx].metrics=results,$scope.session.decks[idx].slides=deck.slides,$scope.deckIdx=idx,$scope.modal.show())})})["catch"](function(err){console.log(err)})}},$scope.closeModal=function(){$scope.modal.hide()},$scope.startMeeting=function(){$scope.activeMeeting=!0,$scope.session.bridge?$scope.bridgeService.startBridge(session.ufId).then(function(){1==$scope.session.decks.length?$scope.go($scope.session._id,0):$scope.showAlert("Meeting Started","Please Select your Deck <br> by Clicking Click 'Show'")}):1==$scope.session.decks.length?$scope.go($scope.session._id,0):$scope.showAlert("Meeting Started","Please Select your Deck <br> by Clicking 'Show'")},$scope.endMeeting=function(){$scope.activeMeeting=!1,$scope.bridgeService.endMeeting(),$scope.loadReports(),$scope.bridgeService.activeBridge()&&$scope.bridgeService.endBridge($scope.session.ufId)},$scope.setLeaveBehind=function(){console.log($scope.session.leaveBehind),Sess.leaveBehind.update({id:$scope.session._id},$scope.session),1==$scope.session.leaveBehind?ionicToast.show("Your Attendees Can View Your Presentation","top",!1,2e3):ionicToast.show("You've Revoked Viewing Rights for Attendees","top",!1,2e3)},$scope.resendInvites=function(){Sess.invite.update({id:$scope.session._id}),ionicToast.show("Invitations have been re-sent","top",!1,2e3)},$scope.$on("$destroy",function(){$scope.modal.remove(),$rootScope.deepLink&&$scope.welcomeModal.remove()}),$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){"app.session"==fromState.name&&"app.presentation"!=toState.name&&$scope.activeMeeting&&$scope.endMeeting()}),$rootScope.deepLink&&$ionicModal.fromTemplateUrl("templates/welcomeTemplate.html",{scope:$scope}).then(function(modal){$scope.welcomeModal=modal,$scope.welcomeModal.show(),$timeout(function(){$scope.welcomeModal.hide()},3500)}),$scope.init()}]),angular.module("RevuMe").controller("settingsCtrl",["$scope","$rootScope","$state","$cookieStore","hello","SigninPartners",function($scope,$rootScope,$state,$cookieStore,hello,SigninPartners){$scope.myAccount=function(){$state.go("app.myAccount")},$scope.logOut=function(){if(void 0!=$rootScope.mainChannel&&$rootScope.mainChannel.unsubscribe(),$cookieStore.remove("user"),$rootScope.user._id=void 0,void 0!=$rootScope.user.network){var networkName=$rootScope.user.network;if(SigninPartners.network.hasOwnProperty(networkName)){var service=SigninPartners.network[networkName].helloService;hello.logout(service,{force:!0})}}$state.go("app.welcome")},$scope.changePassword=function(){$state.go("app.changePassword")},$scope.setting={actions:[{name:"My Account",action:$scope.myAccount},{name:"Log Out",action:$scope.logOut},{name:"Change My Password",action:$scope.changePassword}]}}]),angular.module("RevuMe").factory("Share",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/share/:id";return $resource(target,{id:"@id"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}})}]).service("shareMediator",["Share","libraryRights","teamService","$rootScope","$q",function(Share,libRights,teamService,$rootScope,$q){function getRole(team,userId){var role=void 0;return team.members.forEach(function(member){member.user._id==userId&&(role=member.role)}),role}var $=this;$.shareItem=function(model,item,teams){var deferred=$q.defer(),share=new Share;return share.model=model,share.item=item._id,share.teams=[],teams.forEach(function(team){share.teams.push(team._id)}),share.$save().then(function(){deferred.resolve()})["catch"](function(err){deferred.reject(err)}),deferred.promise},$.getItems=function(model){var deferred=$q.defer();return model.query({user:$rootScope.user._id}).$promise.then(function(owned){var ownedItems=owned;return ownedItems.forEach(function(item){item.accessRights=libRights.getAccessRights(model,libRights.roles[0])}),Share.query({model:model.name,user:$rootScope.user._id}).$promise}).then(function(shares){var sharedItems=[];shares.forEach(function(share){var item=share.item,role=getRole(share.team,$rootScope.user._id);item.accessRights=librRights.getAccessRights(model,role)}),ownedItems.concat(sharedItems),deferred.resolve()})["catch"](function(err){deferred.reject(err)}),deferred.promise}}]),angular.module("RevuMe").controller("signinCtrl",["$scope","$rootScope","authService","$ionicPopup","$state",function($scope,$rootScope,authService,$ionicPopup,$state){$scope.doSignIn=function(){var credentials={};credentials.email=$scope.forms.signin.email.toLowerCase(),credentials.password=$scope.forms.signin.password,authService.authenticate(credentials).then(function(result){if(result.success){var user=result.user;user.authData=user.password,$rootScope.userInit(user),$state.go("app.welcome")}else{var alert=$ionicPopup.alert({title:"Authentication Failed",template:result.reason});alert.then(function(res){})}})}}]).controller("signupCtrl",["$scope","$rootScope","$state","authService","$ionicPopup","SendConfirm","DoConfirm","introContent","ScriptService","SigninPartners","$q",function($scope,$rootScope,$state,authService,$ionicPopup,SendConfirm,DoConfirm,introContent,ScriptService,SigninPartners,$q){function partnerSignin(networkName,user){var deferred=$q.defer();if(user&&user.email)authService.checkExists(user.email).then(function(usr){usr._id?$rootScope.userInit(usr).then(function(){ScriptService.checkScript($rootScope.user.script),$state.go("app.welcome"),deferred.resolve()}):(user.service=networkName,user.password=authService.randomKey(6),authService.signUp(user).then(function(u){user._id=u._id;var members=[{user:user._id,role:"Admin"}],type=ScriptService.scriptTypes[0],script=ScriptService.newScript(type,members);return ScriptService.save(script)}).then(function(script){return $rootScope.userInit(user)}).then(function(){return introContent.addIntroContent(user._id)}).then(function(){$rootScope.firstLogin=!0,$state.go("app.welcome"),deferred.resolve()}))});else{var titleStr=networkName+" Authentication Failed!";$ionicPopup.alert({title:titleStr,template:"Please Try Again"}).then(function(){})}return deferred.promise}$scope.network=SigninPartners.network,$scope.mouse={over:!1},$scope.doSignUp=function(){authService.checkExists($scope.forms.signup.email).then(function(user){if(user._id)if(user.password){var alert=$ionicPopup.alert({title:"You're Already Signed Up",template:"Please Sign In"});alert.then(function(){$state.go("app.welcome")})}else{DoConfirm.confirm({id:user._id});var credentials={};credentials.oldPassword="",credentials.email=$scope.forms.signup.email.toLowerCase(),credentials.password=$scope.forms.signup.password,authService.resetPassword(credentials).then(function(result){if(result.success){var members=[{user:user._id,role:"Admin"}],type=ScriptService.scriptTypes[0],script=ScriptService.newScript(type,members);ScriptService.save(script).then(function(){return introContent.addIntroContent(user._id)}).then(function(){$state.go("app.welcome")})}else{var alert=$ionicPopup.alert({title:"Error Setting PW!",template:"Please Try Again"});alert.then(function(){})}})}else{var newUser={};newUser.firstName=$scope.forms.signup.firstName,newUser.lastName=$scope.forms.signup.lastName,newUser.email=$scope.forms.signup.email.toLowerCase(),newUser.password=$scope.forms.signup.password,authService.signUp(newUser).then(function(user){SendConfirm.send(user),newUser._id=user._id;var members=[{user:user._id,role:"Admin"}],type=ScriptService.scriptTypes[0],script=ScriptService.newScript(type,members);return ScriptService.save(script)}).then(function(script){return introContent.addIntroContent(newUser._id)}).then(function(){$rootScope.firstLogin=!0,$state.go("app.welcome")})}})},$scope.signIn=function(){authService.forceCredentials("app.welcome")},$scope.signInWith=function(partnerName){$scope.network.hasOwnProperty(partnerName)&&$scope.network[partnerName].getUser().then(function(user){return partnerSignin(partnerName,user)}).then(function(){$scope.network.authService.hideSignup(partnerName)})["catch"](function(error){$scope.network.authService.hideSignup(void 0);var titleStr=partnerName+" Authentication Failed!";$ionicPopup.alert({title:titleStr,template:"Please Try Again"}).then(function(){})})},$scope.mouseEnter=function(){$scope.mouse.over=!0},$scope.mouseLeave=function(){$scope.mouse.over=!1}}]).controller("confirmCtrl",["$scope","user",function($scope,user){$scope.user=user}]).controller("profileCtrl",["$scope","$rootScope","$state","authService","$ionicPopup",function($scope,$rootScope,$state,authService,$ionicPopup){var fullName=$rootScope.user.name,parts=fullName.split(" "),firstName=parts[0],lastName=parts[1],email=$rootScope.user.email;$scope.forms.signup.firstName=firstName,$scope.forms.signup.lastName=lastName,$scope.forms.signup.email=email,$scope.updateProfile=function(){authService.checkExists($scope.forms.signup.email).then(function(exists){if(exists){var alert=$ionicPopup.alert({title:"You're Already Signed Up",template:"Please Sign In"});alert.then(function(){$state.go("app.welcome")})}else{var newUser={};newUser.firstName=$scope.forms.signup.firstName,newUser.lastName=$scope.forms.signup.lastName,newUser.email=$scope.forms.signup.email.toLowerCase(),newUser.password=$scope.forms.signup.password,authService.signUp(newUser).then(function(user){console.log(user)})}})},$scope.signIn=function(){authService.forceCredentials("app.welcome")}}]).controller("changePasswordCtrl",["$scope","$rootScope","authService","$timeout","$ionicPopup",function($scope,$rootScope,authService,$timeout,$ionicPopup){$scope.resetPassword=function(){var credentials={};if(credentials.email=$scope.forms.resetPw.email.toLowerCase(),credentials.oldPassword=$scope.forms.resetPw.oldPassword,credentials.password=$scope.forms.resetPw.newPassword,credentials.repeat=$scope.forms.resetPw.repeat,credentials.password!=credentials.repeat){var alert=$ionicPopup.alert({title:"Uh Oh!",template:"New Password Fields Don't Match"});alert.then(function(res){})}else $scope.forms.resetPw.message="",authService.checkExists(credentials.email).then(function(exists){if(exists)authService.resetPassword(credentials).then(function(result){if(result.success){var alert=$ionicPopup.alert({title:"Success!",template:"Your Password is Reset"});alert.then(function(res){})}else{var alert=$ionicPopup.alert({title:"Reset PW Error",template:result.reason});alert.then(function(res){})}});else{var alert=$ionicPopup.alert({title:"Reset PW Error",template:credentials.email+" not found"});alert.then(function(res){})}})["catch"](function(err){console.log(err)})}}]),angular.module("RevuMe").controller("slideShowCtrl",["$scope","$rootScope","$state","$ionicSlideBoxDelegate","$ionicScrollDelegate","$timeout","slideShow","Fullscreen",function($scope,$rootScope,$state,sbDelegate,$ionicScrollDelegate,$timeout,slideShow,Fullscreen){function makeHandle(idx){return"slide-box-"+idx}function loadSlideBoxes(){var slides=$scope.presentation.slides,boxIdx=0,slideBoxIdx=0,sbName=makeHandle(slideBoxIdx),sb=sbDelegate,slideBox={idx:slideBoxIdx,slides:new Array,handle:sbName,delegate:sb,show:!0};$scope.slideBoxes.push(slideBox);for(var i=0;i<slides.length;i++)boxIdx<$scope.boxLength?(slideBox.slides.push(slides[i]),boxIdx++):(slideBoxIdx++,sbName=makeHandle(slideBoxIdx),sb=sbDelegate,slideBox={idx:slideBoxIdx,slides:new Array,handle:sbName,delegate:sb,show:!1},$scope.slideBoxes.push(slideBox),boxIdx=1,slideBox.slides.push(slides[i]))}function enableNextPrevious(){$scope.current<$scope.presentation.slides.length-1?$scope.nextEnabled=!0:$scope.nextEnabled=!1,$scope.current>0?$scope.prevEnabled=!0:$scope.prevEnabled=!1}slideShow.connect($scope),$scope.current=0,$scope.nextEnabled=!0,$scope.prevEnabled=!1,$scope.boxLength=5,$scope.boxCurrent=0,$scope.expectEcho=!1,$scope.slideBoxes=[],$scope.slideBoxIdx=0,$scope.loadingMessage="",$scope.zoomFactor=1,$scope.fullScreen=!0,$scope.loadNext=function(){return $scope.boxCurrent+1>$scope.boxLength-1?($scope.loadingMessage="Loading Slides...",$scope.slideBoxes[$scope.slideBoxIdx].show=!1,$scope.slideBoxIdx++,$scope.boxCurrent=0,$scope.current++,!0):!1},$scope.slidesDone=function(){$timeout(function(){$scope.loadingMessage=""},300)},$scope.loadPrevious=function(){return $scope.boxCurrent-1<0?($scope.loadingMessage="Loading Slides...",$scope.slideBoxIdx--,$scope.boxCurrent=$scope.boxLength-1,$scope.current--,!0):!1},loadSlideBoxes(),$scope.nextClicked=function(){1==$scope.zoomFactor&&$scope.current<$scope.presentation.slides.length-1&&($scope.loadNext()||($scope.current++,$scope.boxCurrent++,$scope.expectEcho=!0,$scope.slideBoxes[$scope.slideBoxIdx].delegate.slide($scope.boxCurrent)),enableNextPrevious())},$scope.previousClicked=function(){1==$scope.zoomFactor&&$scope.current>0&&($scope.loadPrevious()||($scope.current--,$scope.boxCurrent--,$scope.expectEcho=!0,$scope.slideBoxes[$scope.slideBoxIdx].delegate.slide($scope.boxCurrent)),enableNextPrevious())},$scope.onSlideChange=function(toSlide){$scope.expectEcho?$scope.expectEcho=!1:(toSlide>$scope.boxCurrent?$scope.loadNext()||($scope.current++,$scope.boxCurrent++):toSlide<$scope.boxCurrent&&($scope.loadPrevious()||($scope.current--,$scope.boxCurrent--)),enableNextPrevious())},$scope.updateSlideStatus=function(slide){"video"!=$scope.presentation.slides[$scope.current].type&&($scope.zoomFactor=$ionicScrollDelegate.$getByHandle("scrollHandle"+slide).getScrollPosition().zoom,1==$scope.zoomFactor?(sbDelegate.enableSlide(!0),console.log("slide enabled")):(sbDelegate.enableSlide(!1),console.log("slide disabled")))}}]),angular.module("RevuMe").controller("splashCtrl",["$scope","$rootScope","$timeout","$http","baseUrl","$ionicNavBarDelegate","tourService","ScriptService","$ionicSideMenuDelegate","Screenleap",function($scope,$rootScope,$timeout,$http,baseUrl,$ionicNavBarDelegate,tourService,ScriptService,$ionicSideMenuDelegate,ScreenLeap){$scope.image=baseUrl.endpoint+"/img/splash.png",$scope.init=function(){$timeout(function(){$scope.user._id=$rootScope.user._id,$scope.user.name=$rootScope.user.name,$scope.user.script=$rootScope.user.script,$scope.users=$rootScope.users,$scope.user.daysLeft=ScriptService.getDaysLeft($scope.user.script),$scope.buyButton={text:"Upgrade Now"};var script=$scope.user.script;script.autoRenew||("Monthly"==script.type||"Annually"==script.type)&&($scope.buyButton.text="Renew Now")},0),void 0!=$rootScope.firstLogin&&1==$rootScope.firstLogin&&($rootScope.firstLogin=!1,$ionicSideMenuDelegate.toggleLeft(!0),$timeout(function(){$ionicSideMenuDelegate.toggleLeft(!1)},3e3))},$scope.$on("presence_change",function(){$scope.$apply(function(){$scope.users=$rootScope.users})}),void 0==$rootScope.user.script?$rootScope.$on("Revu.Me:Ready",function(event,data){$scope.init()}):$scope.init(),$scope.tourService=tourService}]),angular.module("RevuMe").filter("handyTime",["$filter",function($filter){return function(input){var retVal="handyTime filter error - undefined input";if(void 0!=input)if(60>input){var sec=$filter("number")(Number(input),2),nStr=sec.toString();retVal=nStr+" sec"}else if(3600>input){var min=$filter("number")(Number(input)/60,2),nStr=min.toString();retVal=nStr+" min"}else{var num=parseFloat(input),hr=Math.floor(num/3600),nStr=hr.toString(),min=(num-3600*hr)/60;min=$filter("number")(min,2),retVal=hr+" hr "+min+" min"}return retVal}}]).controller("systemMonitorCtrl",["$scope","$rootScope","$window","$timeout","$interval","$ionicScrollDelegate","logService","ionicToast","$PALLET","$filter","$moment","$q",function($scope,$rootScope,$window,$timeout,$interval,$ionicScrollDelegate,logService,ionicToast,$PALLET,$filter,$moment,$q){$scope.pollingInterval=5e3,$scope.startingGaugeMax=5,$scope.timelineLength=20,$scope.timeline={},$scope.channel=void 0,$scope.users=[],$scope.uChart={},$scope.poller=void 0;var firstButton={name:"Now",clicked:!1,click:function(){this.clicked=!0,engageTheMechanism()}},secondButton={name:"Trends",clicked:!1,click:function(){this.clicked=!0,buildTrends()}},thirdButton={name:"Analyze",clicked:!1,click:function(){this.clicked=!0}};$scope.navButtons={"class":"button button-dark button-outline dashboard-nav-button",clickedClass:"button button-dark dashboard-nav-button",buttons:[firstButton,secondButton,thirdButton],nowButton:0,trendsButton:1,analyzeButton:2,click:function(index){this.buttons.forEach(function(button){button.clicked=!1}),this.buttons[index].click()}};var buildGuage=function(count){void 0==$scope.uChart.guage&&($scope.uChart.guage={});var guage=$scope.uChart.guage;void 0==guage.max&&(guage.max=$scope.startingGaugeMax),count>=guage.max&&(guage.max*=2),guage.count=count,guage.headRoom=guage.max-guage.count,guage.options={percentageInnerCutout:60},guage.data=[guage.count,guage.headRoom],guage.labels=["Users Online"," "],guage.colors=[$PALLET.$calm,$PALLET.$light],guage.center=guage.count},startPoller=function(){angular.isDefined($scope.poller)||($scope.poller=$interval(function(){buildTimeline($scope.users.length)},$scope.pollingInterval))},stopPoller=function(){angular.isDefined($scope.poller)&&$interval.cancel($scope.poller)},updateSampleTime=function(){var sec=$scope.sampleTime.getSeconds(),min=$scope.sampleTime.getMinutes(),hour=$scope.sampleTime.getHours(),secInterval=$scope.pollingInterval/1e3;sec+=secInterval,sec>=60&&(sec=0,min+=1),min>=60&&(min=0,hour+=1),hour>=23&&(hour=0),$scope.sampleTime.setHours(hour),$scope.sampleTime.setMinutes(min),$scope.sampleTime.setSeconds(sec)},initializeLabelsAndData=function(count){var now=new Date,secInterval=$scope.pollingInterval/1e3,sec=now.getSeconds(),min=now.getMinutes(),hour=now.getHours();sec=Math.ceil(sec/secInterval)*secInterval;var numSamples=$scope.timelineLength,sampleTime=new Date;sampleTime.setHours(hour),sampleTime.setMinutes(min),sampleTime.setSeconds(sec);var timeLabels=[],timeSeries=[];timeLabels.push($filter("date")(sampleTime,"HH:mm:ss")),timeSeries.push(count),$scope.sampleTime=sampleTime;for(var i=1;numSamples>i;i++)sec-=secInterval,0>=sec&&(sec=60-secInterval,min-=1),0>=min&&(min=59,hour-=1),0>=hour&&(hour=23),sampleTime.setHours(hour),sampleTime.setMinutes(min),sampleTime.setSeconds(sec),timeLabels.push($filter("date")(sampleTime,"HH:mm:ss")),timeSeries.push(0);return{labels:timeLabels,data:timeSeries}},buildTimeline=function(count){void 0==$scope.uChart.timeline&&($scope.uChart.timeline={});var tl=$scope.uChart.timeline;if(void 0==tl.labels){var labelsAndData=initializeLabelsAndData(count);tl.labels=labelsAndData.labels,tl.data=[labelsAndData.data]}else updateSampleTime(),tl.data[0].unshift(count),tl.data[0].pop(),tl.labels.unshift($filter("date")($scope.sampleTime,"HH:mm:ss")),tl.labels.pop();tl.series=["Users Online"],tl.colors=[$PALLET.$balanced],tl.options={animation:!1},$scope.uChart.timeline=tl};$scope.getUserPath=function(){};var groupById=function(){var findId=function(array,id){var idx=void 0,i=0;return array.some(function(elem){return elem.user._id==id?(idx=i,!0):(i++,!1)}),idx},dayIdx=0;$scope.trends.byDay.forEach(function(day){var users=day.userData;day.data.forEach(function(item){if(item.user){var idx=findId(users,item.user._id);void 0==idx?(users.push({user:item.user,data:[item],visitTime:item.elapsed,show:!1}),$scope.trends.byDayTotals[dayIdx]++):(users[idx].data.push(item),users[idx].visitTime+=item.elapsed)}}),dayIdx++})},groupByDay=function(daysBack,trends){for(var sorted={byDay:[],byDayTotals:[]},startMoment=$moment(),sampleDate=new Date,i=0;daysBack>i;i++)sampleDate=new Date(startMoment.toDate()),sorted.byDayTotals.push(0),sorted.byDay.push({date:sampleDate,data:[],userData:[]}),startMoment.subtract(1,"days");return trends.forEach(function(trend){var idx=$moment().dayOfYear()-$moment(trend.date).dayOfYear();sorted.byDay[idx].data.push(trend)}),sorted},buildTrendCharts=function(){$scope.trendChart={week:{},month:{}};var tChart=$scope.trendChart;tChart.week.data=[$scope.trends.byDayTotals.slice(0,7)];for(var weekLabels=[],i=0;7>i;i++){var day=$scope.trends.byDay[i],dateStr=$filter("date")(day.date,"EEE dd");weekLabels.push(dateStr)}var monthLabels=[];$scope.trends.byDay.forEach(function(day){var dateStr=$filter("date")(day.date,"MMM dd");monthLabels.push(dateStr)}),tChart.week.labels=weekLabels,tChart.week.colors=[$PALLET.$balanced],tChart.week.series=["Unique Visits"],tChart.week.options={},tChart.month.data=[$scope.trends.byDayTotals.slice(0)],tChart.month.labels=monthLabels,tChart.month.colors=[$PALLET.$dark],tChart.month.series=["Unique Visits"],tChart.month.options={}},buildTrends=function(){var month=($q.defer(),31);logService.getRecentHistory(month).then(function(activities){$scope.trends=groupByDay(month,activities),groupById(),buildTrendCharts(),updateView()})},resolveUsers=function(pnUsers){var deferred=$q.defer(),promises=[];return $scope.users=[],pnUsers.uuids.forEach(function(uuid){"user_log"!=uuid?promises.push($scope.channel.getUser(uuid)):promises.push($q.defer().resolve())}),$q.all(promises).then(function(users){$scope.users=[],users.forEach(function(user){user&&(user.showHistory=!1,$scope.users.push(user))}),deferred.resolve()}),deferred.promise},setWhosOnline=function(){function hnCallBack(userInfo){console.log("systemMonitor: hereNow returns: ",userInfo),resolveUsers(userInfo).then(function(){deferred.resolve()})}var deferred=$q.defer();return $scope.channel.hereNow(hnCallBack),deferred.promise},engageTheMechanism=function(){setWhosOnline().then(function(){buildGuage($scope.users.length),buildTimeline($scope.users.length),$scope.users.forEach(function(user){initUserHistory(user)}),startPoller(),$ionicScrollDelegate.resize()})},findUser=function(array,_id){var u=void 0,idx=0;return array.some(function(user){return user._id==_id?(u=user,u.idx=idx,!0):(idx++,!1)}),u},initTotalTime=function(user){if(user&&user.history){var totalTime=0;user.history.forEach(function(elem){totalTime+=Number(elem.elapsed)}),user.totalTime=totalTime}},initUserHistory=function(user){var deferred=$q.defer();return user&&user._id?(logService.getRecentUserHistory(user._id,0).then(function(activities){$timeout(function(){user.history=activities.slice(0),initTotalTime(user)},0),deferred.resolve()})["catch"](function(err){console.log("systemMonitor: initUserHistory - logService err: ",err),deferred.reject()}),deferred.promise):(deferred.resolve(),deferred.promise)},updateUserHistory=function(message){var user=findUser($scope.users,message.user._id);void 0!=user&&(void 0==user.history?initUserHistory(user).then(function(){message&&$timeout(function(){user.history.unshift(message)},0)})["catch"](function(err){console.log("systemMonitor: updateUserHistory - logService err: ",err)}):$timeout(function(){user.history.unshift(message),user.totalTime+=Number(message.elapsed)},0))},updateView=function(){$ionicScrollDelegate.resize()};$scope.toggleUserData=function(dayIdx,userIdx){if($scope.trends&&$scope.trends.byDay&&dayIdx<$scope.trends.byDay.length){var day=$scope.trends.byDay[dayIdx];day&&day.userData&&userIdx<day.userData.length&&(day.userData[userIdx].show=!day.userData[userIdx].show,updateView())}},$scope.showHistory=function($index){$scope.users[$index].showHistory?$scope.users[$index].showHistory=!1:$scope.users[$index].showHistory=!0,updateView()},$scope.$on("Revu.Me.Activity",function(event,message){console.log("systemMonitor Activity: ",message),message.fromState=message.fromState.name,message.toState=message.toState.name,updateUserHistory(message)}),$scope.$on("presence_change",function(){engageTheMechanism()}),$scope.$on("Revu.Me:Ready",function(){$scope.channel=$rootScope.mainChannel,$scope.navButtons.buttons[$scope.navButtons.nowButton].click()}),$scope.$on("$ionicView.enter",function(){$rootScope.mainChannel&&($scope.channel=$rootScope.mainChannel,$scope.navButtons.buttons[$scope.navButtons.nowButton].click())}),$scope.$on("$destroy",function(){stopPoller()}),angular.element($window).on("orientationchange",function(){updateView()}),angular.element($window).bind("resize",function(){updateView()})}]),angular.module("RevuMe").controller("teamsCtrl",["$scope","$rootScope","TeamService","userService","$ionicListDelegate","$ionicPopup","$ionicModal","$state","ionicToast",function($scope,$rootScope,teamService,userService,$ionicListDelegate,$ionicPopup,$ionicModal,$state,ionicToast){function validateMembers(){teamService.validateMembers($scope)}function showConfirm(teamName){var confirmPopup=$ionicPopup.confirm({title:"Delete "+teamName,template:"Are you sure to delete this?"});return confirmPopup}switch($state.current.name){case"app.team":$scope.teamName=$state.params.name;break;case"app.newteam":$scope.teamName="New Team"}$scope.init=function(){var _id=$rootScope.user._id;$scope.forms={},void 0!=_id&&(teamService.init($scope),teamService.getAll(_id).then(function(teams){switch($scope.teams=teams,$state.current.name){case"app.team":var idx=parseInt($state.params.id);setTimeout(function(){teamService.editTeam($scope,idx),$scope.addTeam.name=$scope.teams[idx].name},0),$scope.modalCallback=$scope.updateTeam;break;case"app.newteam":teamService.newTeam($scope),$scope.modalCallback=$scope.saveTeam}}),$scope.commaDelimited=!1)},$scope.doRefresh=function(){teamService.refreshTeams($scope)},$scope.newTeam=function(){teamService.newTeam($scope),$scope.modalTitle="New Team",$scope.modalCallback=$scope.saveTeam,$state.go("app.newteam")},$scope.addMember=function(){teamService.addMember($scope)},$scope.delMember=function($index){teamService.delMember($scope,$index)},$scope.saveTeam=function(){console.log("save team: ",$scope.addTeam.name),$scope.commaDelimited&&validateMembers();var team=teamService.teamFromInput($scope);if(void 0==team.name||0==team.members.length){$ionicPopup.alert({title:"Save Team",template:"Your team needs a name and members"})}else teamService.save(team).then(function(){return teamService.refreshTeams($scope)}).then(function(){ionicToast.show("New Team Created","top",!1,2e3),void 0!=$scope.forms.teamForm&&$scope.forms.teamForm.$setPristine()})["catch"](function(err){console.log(err)})},$scope.toggleListDelete=function(which){$ionicListDelegate.$getByHandle(which).showDelete()?$ionicListDelegate.$getByHandle(which).showDelete(!1):$ionicListDelegate.$getByHandle(which).showDelete(!0)},$scope.delTeam=function(idx,$event){var teamName=$scope.teams[idx].name;$event.stopPropagation(),showConfirm(teamName).then(function(res){if(res){var _id=$scope.teams[idx]._id;teamService["delete"](_id).then(function(){$scope.teams.splice(idx,1),ionicToast.show("Team Deleted","top",!1,2e3)})["catch"](function(err){console.log(err)})}})},$scope.editTeam=function(idx){teamService.editTeam($scope,idx),$scope.modalTitle="Edit Team",$scope.modalCallback=$scope.updateTeam;var teamName=$scope.teams[idx].name;$state.go("app.team",{id:idx,name:teamName})},$scope.updateTeam=function(){$scope.commaDelimited&&validateMembers();var team=teamService.teamFromInput($scope);teamService.update(team).then(function(){return teamService.refreshTeams($scope)}).then(function(){$scope.forms.teamForm.$setPristine(),ionicToast.show("Your Team has been updated","top",!1,2e3)})["catch"](function(err){console.log(err)})},$scope.setDirty=function(){$scope.forms.teamForm.$setDirty()},$scope.$on("userID",function(event,user){$scope.init()}),$scope.showNavConfirm=function(){var confirmPopup=$ionicPopup.confirm({title:"Unsaved Work",template:"Should We Save It?"});return confirmPopup},$scope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){switch(fromState.name){case"app.team":case"app.newteam":void 0!=$scope.forms.teamForm&&($scope.forms.teamForm.$pristine||$scope.showNavConfirm().then(function(res){res&&$scope.modalCallback()}))}}),$scope.$on("$ionicView.enter",function(){void 0!=$rootScope.user._id&&"app.teams"==$state.current.name&&setTimeout(function(){
teamService.refreshTeams($scope)},0)}),void 0==$rootScope.user._id?$rootScope.$on("Revu.Me:Ready",function(event,data){$scope.init()}):$scope.init()}]),angular.module("RevuMe").controller("userAdminCtrl",["$scope","$rootScope","ScriptService","Users","ionicToast",function($scope,$rootScope,ScriptService,Users,ionicToast){$scope.revume={},$scope.revume.scriptTypes=ScriptService.scriptTypes,Users.byId.query().$promise.then(function(users){$scope.revume.allUsers=users,$scope.revume.allUsers.forEach(function(user){ScriptService.userScript(user._id).then(function(script){if(void 0!=script)user.script=script;else{var members=[{user:user._id,role:"Admin"}],type=$scope.revume.scriptTypes[0];user.script=ScriptService.newScript(type,members),ScriptService.save(user.script).then(function(script){user.script._id=script._id;var text="User: "+user.firstName+" "+user.lastName+" new subscription created";ionicToast.show(text,"top",!1,2e3),console.log("User: ",user.firstName+" "+user.lastName," new subscription created")})}})})}),$scope.updateScript=function($index){var user=$scope.revume.allUsers[$index];ScriptService.update(user.script._id,user.script).then(function(){console.log("user subscription updated")})}}]),angular.module("RevuMe").controller("ViewCtrl",["$scope","$rootScope","$stateParams","$timeout","$window","pnFactory","userMonitor","session","Decks","$ionicSlideBoxDelegate","BridgeService","$q","$ionicModal","authService","$state","$ionicPopup","$ionicScrollDelegate","$location","$sce",function($scope,$rootScope,$stateParams,$timeout,$window,pnFactory,userMonitor,session,Decks,$ionicSlideBoxDelegate,BridgeService,$q,$ionicModal,authService,$state,$ionicPopup,$ionicScrollDelegate,$location,$sce){function newPresentation(id){var defer=$q.defer();return Decks.get({id:id}).$promise.then(function(decks){$scope.name=decks.name,$scope.presentation=decks,current=0,$scope.setSlide(current),$ionicSlideBoxDelegate.update(),defer.resolve()}),defer.promise}function handleMessage(m){switch(m.action){case"new":newPresentation(m.value).then(function(){$timeout(function(){$scope.name=$scope.presentation.name},0)});break;case"set":$timeout(function(){var n=$scope.presentation.name;$scope.name=n,$scope.setSlide(m.value)}),console.log($scope.presentation.name);break;case"screenShare":void 0!=m.value?$scope.screenSharing.visible||$timeout(function(){$scope.screenSharing={visible:!0,url:$sce.trustAsResourceUrl(m.value)}},0):$timeout(function(){$scope.screenSharing={visible:!1}},0);break;case"end":$scope.signupModal.show()}}function handlePresence(m){if(userMonitor.rollCall(m),void 0!=m.userName){var statusMessage=m.userName+" has ";switch(m.action){case"join":statusMessage+="joined";break;case"leave":case"timeout":statusMessage+="left"}$scope.$broadcast("show_message",statusMessage)}}var current=0,userName=($rootScope.user._id,$rootScope.user.name);$scope.session=session,$scope.deckId=session.decks[0]._id,$scope.name=session.name,$scope.bridgeService=BridgeService,$scope.init=function(){newPresentation($scope.deckId).then(function(){var channelName=$stateParams.id.toString()+".view_channel";$scope.channel=pnFactory.newChannel(channelName);var everyone=$scope.session.attendees;everyone.push($scope.session.organizer),userMonitor.init(everyone),$scope.channel.subscribe(handleMessage,handlePresence),$scope.screenSharing={visible:!1};var msg={action:"catchup",status:"now",who:userName,id:$rootScope.user._id};console.log("catchup"),$scope.channel.publish(msg)}),$ionicModal.fromTemplateUrl("templates/presEndTemplate.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.signupModal=modal})},$scope.cleanUp=function(){$scope.channel.unsubscribe(),void 0!=$scope.signupModal&&$scope.signupModal.remove()},$scope.doSignUp=function(){$scope.signupModal.hide();var newMember={};if(void 0!=this.forms){var password=this.forms.signup.password,names=$rootScope.user.name.split(" ");newMember.firstName=names[0],newMember.lastName=names[1],newMember.email=$rootScope.user.email,newMember.password=password,newMember.oldPassword="",authService.checkExists(newMember.email).then(function(user){user.password?$state.go("app.welcome"):authService.resetPassword(newMember).then(function(result){if(result.success)$state.go("app.welcome");else{var alert=$ionicPopup.alert({title:"Error Setting PW!",template:"Please Try Again"});alert.then(function(){})}})})}},$scope.nextSlide=function(){$scope.setSlide(++current)},$scope.prevSlide=function(){$scope.setSlide(--current)},$scope.setSlide=function(slideNumber){current=slideNumber,$scope.viewingSlide=$scope.presentation.slides[current],$ionicSlideBoxDelegate.slide(current)},$scope.$on("Revu.Me::Pause",function(){var msg={action:"engagement",status:"distracted",who:userName,id:$rootScope.user._id};console.log("Pause:distracted"),$scope.channel.publish(msg)}),$scope.$on("Revu.Me::Resume",function(){var msg={action:"engagement",status:"engaged",who:userName,id:$rootScope.user._id};console.log("Resume:engaged"),$scope.channel.publish(msg)}),$scope.w=$window,$window.onfocus=function(event){var msg={action:"engagement",status:"engaged",who:userName,id:$rootScope.user._id};console.log("engaged"),$scope.channel.publish(msg)},$window.onblur=function(event){var msg={action:"engagement",status:"distracted",who:userName,id:$rootScope.user._id};console.log("distracted"),$scope.channel.publish(msg)},$scope.goFullScreen=function(){},$scope.$on("$destroy",function(){$scope.cleanUp()}),void 0==$rootScope.user._id?$rootScope.$on("Revu.Me:Ready",function(event,data){$scope.init()}):$scope.init()}]),angular.module("RevuMe").controller("wizardCtrl",["$scope","$rootScope","$timeout","$ionicSlideBoxDelegate","$ionicScrollDelegate","$ionicModal","SalesforceService",function($scope,$rootScope,$timeout,$ionicSlideBoxDelegate,session,$ionicScrollDelegate,$ionicModal,SalesforceService){$scope.wizard={},$scope.wizard.name="Create a New Meeting",$scope.wizard.steps=[],$scope.wizard.current=0,$scope.wizard.nextEnabled=!0,$scope.sfdc=SalesforceService,$scope.nextStep=function(){$scope.setStep(++$scope.wizard.current),$ionicSlideBoxDelegate.slide($scope.wizard.current),$ionicSlideBoxDelegate.update()},$scope.prevStep=function(){$scope.setStep(--$scope.wizard.current),$ionicSlideBoxDelegate.slide($scope.wizard.current),$ionicSlideBoxDelegate.update()},$scope.setStep=function(stepNumber){stepNumber>=$scope.wizard.steps.length-1?($scope.wizard.current=$scope.wizard.steps.length-1,$scope.wizard.nextEnabled=!1,$scope.wizard.prevEnabled=!0):0>=stepNumber?($scope.wizard.current=0,$scope.wizard.prevEnabled=!1,$scope.wizard.nextEnabled=!0):($scope.wizard.current=stepNumber,$scope.wizard.nextEnabled=!0,$scope.wizard.prevEnabled=!0),$ionicSlideBoxDelegate.slide($scope.wizard.current)};var step1={form:{}};step1.heading="Date & Time",step1.template="templates/datetime.html",step1.date=new Date,step1.time=step1.date,step1.datepickerObject={titleLabel:"Title",todayLabel:"Today",closeLabel:"Close",setLabel:"Set",setButtonType:"button-dark",todayButtonType:"button-stable",closeButtonType:"button-assertive",inputDate:new Date,mondayFirst:!0,templateType:"popup",showTodayButton:"true",modalHeaderColor:"bar-positive",modalFooterColor:"bar-positive",from:new Date(2012,8,2),to:new Date(2018,8,25),callback:function(val){void 0!=val&&(step1.datepickerObject.inputDate=val,step1.date=val)},dateFormat:"dd-MM-yyyy",closeOnSelect:!1},step1.timePickerObject={inputEpochTime:60*(new Date).getHours()*60,step:15,format:12,titleLabel:"12-hour Format",setLabel:"Set",closeLabel:"Close",setButtonType:"button-positive",closeButtonType:"button-stable",callback:function(val){if(void 0!=val){step1.timePickerObject.inputEpochTime=val;var hours=Math.trunc(val/3600),minutes=(val-3600*hours)/60;step1.time=step1.date,step1.time.setHours(hours),step1.time.setMinutes(minutes),step1.time.setSeconds(0),step1.time.setMilliseconds(0)}}},step1.timePickerObject.inputEpochTime=3600*step1.time.getHours(),$scope.wizard.steps.push(step1);var step2={form:{}};step2.heading="Who's Invited",$scope.wizard.steps.push(step2);var step3={form:{}};step3.heading="Shared Content",$scope.wizard.steps.push(step3)}]),angular.module("RevuMe").directive("addTemplate",[function(){return{restrict:"AE",templateUrl:function(tElement,tAttrs){return tAttrs.templateUrl}}}]),angular.module("RevuMe").directive("appearUp",["$animate","$timeout","ionicToast",function($animate,$timeout,ionicToast){return{restrict:"A",link:function(scope,element,attrs){scope.$on(attrs.appearUp,function(event,args){$timeout(function(){ionicToast.show(args,"bottom",!1,2e3)})})}}}]),angular.module("RevuMe").directive("datePicker",[function(){return{restrict:"A",link:function(scope,element,attrs){var el=element[0];if("fred"!=el.type){var picker=new Pikaday({field:el,format:"yyyy-MM-dd"});picker._o.onSelect=function(date){var m=(date.getMonth()+1).toString(),d=date.getUTCDate().toString(),y=date.getFullYear().toString(),mmddyyyy=(y+"-"+(m[1]?m:"0"+m)+"-"+(d[1]?d:"0"+d),(m[1]?m:"0"+m)+"/"+(d[1]?d:"0"+d)+"/"+y);el.value=mmddyyyy}}}}}]),angular.module("RevuMe").directive("timeFormat",["$filter",function($filter){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModel){function validTime(value){var parts=value.split(" "),hrMn=parts[0].split(":");if(0!=hrMn[0].length&&hrMn[1].length>1){var hour=parseInt(hrMn[0]),min=hrMn[1],amPm=parts[1];switch(amPm){case"PM":break;case"AM":break;default:amPm="PM"}return"PM"==amPm&&12>hour&&(hour+=12),{hour:hour.toString(),min:min,amPm:amPm}}return null}function formatTime(value){var stripMilli=value.slice(0,value.indexOf(".")),parts=stripMilli.split(":");if(parts[0].length>0&&parts[1].length>1){var hr=parseInt(parts[0]),amPm=hr>=12?"PM":"AM";hr>12&&(hr-=12);var mn=parts[1];mn.length<2&&(mn="0"+mn);var str=hr.toString()+":"+mn+" "+amPm;return str}return null}scope.el=element[0],"time"!=scope.el.type&&ngModel&&(ngModel.$formatters.unshift(function(value){var pure=null;return void 0!=value&&""!=value&&(pure=formatTime(value)),pure?pure:value}),ngModel.$parsers.unshift(function(viewValue){var pure=validTime(viewValue);if(null!=pure){var str=pure.hour+":"+pure.min+":00.000";return ngModel.$setValidity("time",!0),str}return void 0}))}}}]).directive("dateFormat",["$parse",function($parse){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModel){var el=element[0];"date"!=el.type&&(ngModel.$formatters.unshift(function(value){var parts=value.split("-"),pure=parts[1]+"/"+parts[2]+"/"+parts[0];return pure}),ngModel.$parsers.unshift(function(viewValue){var parts=viewValue.split("/"),str=parts[2]+"-"+parts[0]+"-"+parts[1];return str}))}}}]),angular.module("RevuMe").directive("dragEnter",["$timeout",function($timeout){return{scope:!1,link:function(scope,element,attrs){function isFileDrag(dragEvent){var fileDrag=!1,dataTransfer=dragEvent.dataTransfer||dragEvent.originalEvent.dataTransfer;return angular.forEach(dataTransfer&&dataTransfer.types,function(val){"Files"===val&&(fileDrag=!0)}),fileDrag}var promise,enter=!1;element.bind("dragover",function(event){isFileDrag(event)&&(enter||(scope.$apply(attrs.dragEnter),enter=!0),$timeout.cancel(promise),event.preventDefault())}),element.bind("dragleave drop",function(event){$timeout.cancel(promise),promise=$timeout(function(){scope.$eval(attrs.dragLeave),promise=null,enter=!1},100)})}}}]).directive("dragDrop",function(){return{scope:!1,link:function(scope,element,attrs){element.bind("drop",function(evt){evt.stopPropagation(),evt.preventDefault();for(var f,files=evt.dataTransfer.files,i=0;f=files[i];i++){var reader=new FileReader;reader.readAsArrayBuffer(f),reader.onload=function(theFile){return function(e){var newFile={name:theFile.name,type:theFile.type,size:theFile.size,lastModifiedDate:theFile.lastModifiedDate};scope.addfile(newFile)}}(f)}}),element.bind("change",function(event){console.log(event)})}}}),angular.module("RevuMe").directive("elemHeight",["$window","$timeout",function($window,$timeout){return{restrict:"A",link:function(scope,element,attrs){function reAspect(){var height=verge.viewportH()*targetHeight,heightStr=height.toString()+"px";el.style.height=heightStr}var w=angular.element($window),el=element[0],targetHeight=attrs.elemHeight;reAspect(),w.on("orientationchange",reAspect),w.bind("resize",function(){reAspect()})}}}]),angular.module("RevuMe").directive("elemSize",["$window","$timeout",function($window,$timeout){return{restrict:"A",link:function(scope,element,attrs){function reAspect(){var width=verge.viewportW(),height=verge.viewportH()-heightMargin,aspectRatio=width/height;if(aspectRatio>targetAspect){var targetWidthSetting=Math.trunc(height*targetAspect);console.log("height: ",height,"width: ",width,"targetW: ",targetWidthSetting);var styleStr=targetWidthSetting.toString()+"px";el.style.width=styleStr}else el.style.width="100%"}var w=angular.element($window),el=element[0],targetAspect=1.333333,heightMargin=60;void 0!=attrs.controls&&"true"==attrs.controls&&"true"!=attrs.host&&(heightMargin=0),reAspect(),w.on("orientationchange",reAspect),w.bind("resize",function(){reAspect()})}}}]),angular.module("RevuMe").directive("flashWeight",["$animate","$timeout",function($animate,$timeout){return{restrict:"A",link:function(scope,element,attrs){void 0!=attrs.flashWeight?scope.$on(attrs.flashWeight,function(event,args){$timeout(function(){element.html(args),$animate.addClass(element,"heavy").then(function(){$timeout(function(){$animate.removeClass(element,"heavy")},100)})})}):$timeout(function(){$animate.addClass(element,"heavy").then(function(){$timeout(function(){$animate.removeClass(element,"heavy")},100)})})}}}]),angular.module("RevuMe").directive("fullScreen",[function($animate,$timeout){return{restrict:"A",scope:{goFull:"="},link:function(scope,element,attrs){function launchFullScreen(){element[0].requestFullscreen?element[0].requestFullscreen():element[0].mozRequestFullScreen?element[0].mozRequestFullScreen():element[0].webkitRequestFullscreen?element[0].webkitRequestFullscreen():element[0].msRequestFullscreen&&element[0].msRequestFullscreen()}scope.$watch("goFull",function(){1==scope.goFull?launchFullScreen():cancellFullScreen()},!0)}}}]),angular.module("RevuMe").directive("parentHeight",["$window","$timeout",function($window,$timeout){return{restrict:"A",link:function(scope,element,attrs){function setHeight(){if(void 0!=referenceHeight)if(""==percent)if(isNaN(top))el.style.height=referenceHeight.toString()+"px";else{var h=referenceHeight-top;el.style.height=h.toString()+"px"}else{var h=referenceHeight*percent;""!=top?(h-=top,el.style.height=h.toString()+"px"):el.style.height=h.toString()+"px"}}for(var w=angular.element($window),el=element[0],current=el,referenceHeight=void 0,foundParent=void 0,percent=attrs.parentHeight,top=Number(attrs.top),i=0;30>i;i++){var p=current.parentElement;if(p.className.indexOf("ParentMarker")>=0){referenceHeight=p.clientHeight,foundParent=p;break}current=p}setHeight(),w.bind("resize",function(){void 0!=foundParent&&(referenceHeight=foundParent.clientHeight,setHeight())})}}}]),angular.module("RevuMe").directive("portHeight",["$window","$timeout",function($window,$timeout){return{restrict:"A",link:function(scope,element,attrs){function reAspect(){var targetHeight=attrs.portHeight;verge.viewportH()<verge.viewportW()&&(targetHeight=1.3*targetHeight);var height=verge.viewportH()*targetHeight,heightStr=height.toString()+"px";el.style.height=heightStr}var w=angular.element($window),el=element[0];reAspect(),w.on("orientationchange",reAspect),w.bind("resize",function(){reAspect()})}}}]),angular.module("RevuMe").directive("resizeWidth",["$compile",function($compile){return{restrict:"A",replace:!0,link:function(scope,element,attrs){var el=element[0],width=el.clientWidth,src=attrs.resizeWidth,resizeUrl=(width.toString()+"x",'src="'+src+'"'),html=el.outerHTML,directiveText="resize-width=",start=el.outerHTML.indexOf("resize-width"),end=el.outerHTML.slice(start).indexOf(" "),restOfHTML=(directiveText.length,src.length,end+start),newHTML=html.slice(0,start)+resizeUrl+html.slice(restOfHTML),e=$compile(newHTML)(scope);element.replaceWith(e)}}}]),angular.module("RevuMe").directive("slideRight",["$window","$timeout",function($window,$timeout){return{restrict:"A",link:function(scope,element,attrs){var el=(angular.element($window),element[0]),right=verge.viewportW()+10+"px",slideOver=attrs.slideRight,noSlide="!"+slideOver;scope.$on(slideOver,function(event,args){$timeout(function(){el.style.right=right},0)}),scope.$on(noSlide,function(event,args){$timeout(function(){el.style.right="0px"},0)})}}}]),angular.module("RevuMe").directive("standardTimeMeridian",[function(){return{restrict:"AE",replace:!0,scope:{etime:"=etime"},template:"<strong>{{stime}}</strong>",link:function(scope,elem,attrs){function prependZero(param){return String(param).length<2?"0"+String(param):param}function epochParser(val,opType){if(null===val)return"00:00";var meridian=["AM","PM"];if("time"===opType){var hours=parseInt(val/3600),minutes=val/60%60,hoursRes=hours>12?hours-12:hours,currentMeridian=meridian[parseInt(hours/12)];return prependZero(hoursRes)+":"+prependZero(minutes)+" "+currentMeridian}}scope.stime=epochParser(scope.etime,"time"),scope.$watch("etime",function(newValue,oldValue){scope.stime=epochParser(scope.etime,"time")})}}}]),angular.module("RevuMe").directive("tourStep",["$state","tourService","$parse",function($state,tourService,$parse){return{restrict:"AE",templateUrl:"templates/tour-template.html",scope:{ext:"&"},link:function(scope,element,attrs){scope.step=tourService.find($state.current.name),scope.step.scope=scope,scope.tourService=tourService,scope.step.hide=function(){element.css("display","none")},scope.step.show=function(position){element.css("position","absolute"),void 0!=scope.step.position.top&&element.css("top",scope.step.position.top),void 0!=scope.step.position.left&&element.css("left",scope.step.position.left),void 0!=scope.step.position.right&&element.css("right",scope.step.position.right),void 0!=scope.step.position.bottom&&element.css("bottom",scope.step.position.bottom),element.css("display","inherit")},scope.step.hide(),void 0!=scope.step.defer&&scope.step.defer.resolve(),void 0!=scope.ext&&(scope.step.ext=scope.ext)}}}]),angular.module("RevuMe").directive("userComplete",["$rootScope","userService","$parse","$state",function($rootScope,userService,$parse,$state){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModelController){var el=element[0],fieldType=attrs.fieldType,model=$parse(attrs.ngModel),autoFilled=!1;scope.instanceName=attrs.instanceName,scope.state=$state.current.name,scope.doFinish=function($index){var user=userService.getResults($index);switch(fieldType){case"name":var name=user.firstName+" "+user.lastName;autoFilled=!0,model.assign(scope,name),userService.hidePopover(scope);break;case"email":autoFilled=!0,ngModelController.$setDirty(),model.assign(scope,user.email),userService.hidePopover(scope)}},userService.createPopover(),userService.onAutoComplete(scope),scope.$watch(model,function(str){if(autoFilled)autoFilled=!1;else switch(void 0==userService.popover&&userService.createPopover(),fieldType){case"name":if(void 0!=str)if(str.length>0){var query={first:str};userService.usersIKnow(query).then(function(results){userService.setResults(results),results.length>0?userService.showPopover(scope,el):userService.hidePopover(scope)})}else userService.hidePopover(scope);break;case"email":if(void 0!=str&&str.indexOf("@")>0){var query={email:str};userService.usersIKnow(query).then(function(results){userService.setResults(results),results.length>0?userService.showPopover(scope,el):userService.hidePopover(scope)})}}}),scope.$on("$stateChangeStart",function(){userService.removePopover(scope)})}}}]),angular.module("RevuMe").directive("vBackgroundImage",function(){return function(scope,element,attrs){element.css({width:"100%",height:"100%","background-image":"url("+attrs.vBackgroundImage+")","background-size":"cover","background-repeat":"no-repeat"})}}),angular.module("RevuMe").directive("vFollow",["pnFactory","$stateParams",function(pnFactory,$stateParams){return{restrict:"A",link:function(scope,element,attrs){scope.channelName=$stateParams.id.toString()+".vidActions";var channel=pnFactory.newChannel(scope.channelName);scope.myPlayer=element[0];var waitForLeader=function(){void 0!=scope.myPlayer&&scope.myPlayer.pause()};scope.myPlayer.onplay=waitForLeader;var doPlay=function(time){var noop=function(){};void 0!=scope.myPlayer&&(scope.myPlayer.onplay=noop,scope.myPlayer.currentTime=time,scope.myPlayer.play(),scope.myPlayer.controls=!1)},doPause=function(){void 0!=scope.myPlayer&&scope.myPlayer.pause()},doSeek=function(time){void 0!=scope.myPlayer&&(scope.myPlayer.currentTime=time,console.log("seek!",time))},handleAction=function(action){switch(action.command){case"play":doPlay(action.where);break;case"pause":doPause();break;case"seekTo":doSeek(action.where)}};channel.subscribe(handleAction),scope.$on("slideChange",function(event,args){var currentSlide=args,me=attrs.vLead;currentSlide==me&&(scope.myPlayer.onplay=waitForLeader)}),scope.$on("$destroy",function(){void 0!=channel&&channel.unsubscribe()})}}}]),angular.module("RevuMe").directive("vLead",["pnFactory","$stateParams",function(pnFactory,$stateParams){return{restrict:"A",link:function(scope,element,attrs){scope.channelName=$stateParams.id.toString()+".vidActions";var channel=pnFactory.newChannel(scope.channelName),onPlay=function(){var time=scope.myPlayer.currentTime;channel.publish({command:"play",where:time}),console.log("play!")},onPause=function(){channel.publish({command:"pause"}),console.log("pause")},onSeeked=function(){var time=scope.myPlayer.currentTime;channel.publish({command:"seekTo",where:time}),console.log("seeked")};scope.$on("slideChange",function(event,args){var currentSlide=args,me=attrs.vLead;currentSlide==me||scope.myPlayer.pause()}),scope.myPlayer=element[0],scope.myPlayer.controls=!0,scope.myPlayer.onplay=onPlay,scope.myPlayer.onpause=onPause,scope.myPlayer.onseeked=onSeeked,scope.$on("$destroy",function(){void 0!=channel&&channel.unsubscribe()})}}}]),angular.module("RevuMe").directive("vSource",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){if(scope.myPlayer=element[0],scope.myPlayer.setAttribute("src",attrs.vSource),void 0!=attrs.autoPlay){var model=$parse(attrs.autoPlay);scope.$watch(model,function(value){var showing=value;showing&&scope.myPlayer.play()})}}}}]),angular.module("RevuMe").run(["$templateCache",function($templateCache){$templateCache.put("templates/addDeckTemplate.html",'<ion-modal-view><ion-header-bar class="bar-calm"><h1 class="title">Add a Deck</h1><div class="buttons"><button class="button button-clear button-light" style="color:black" ng-click="sb.defer.pop().reject(\'cancel\')">Close</button></div></ion-header-bar><ion-content><file-box close-on-select="true"></file-box><div ng-show="eva.Data.ready"><div class="flow-drop-zone centered-container" drag-enter="class=\'flow-drag-enter\'" drag-leave="class=\'flow-drag-leave\'" evaporate eva-model="eva.Data" ng-model="eva.Inbox" ng-class="class" ng-if="!device.IOS() && !device.isIPad() && !device.isAndroid() && !device.isWindowsPhone()"><p>Drop your file(s) here</p></div><ion-list ng-if="library.uploading.files.length > 0"><ion-item ng-repeat="file in library.uploading.files" class="upload-content" style="min-height:70px" ng-cloak><ion-spinner icon="ios" class="upload-spinner" ng-if="file.spinner"></ion-spinner><h2>{{file.name}}</h2><p ng-show="file.timeLeft != 0">{{file.timeLeft}} seconds remaining...</p><p ng-show="file.message != \'\'">{{file.message}}</p><div ng-show="!file.spinner" class="progress-bar" elem-height="0.01" ng-style="{\'width\':file.progressString}"></div></ion-item></ion-list></div><ion-list><ion-item ng-repeat="deck in sb.decks" class="item-thumbnail-left item-button-right"><img ng-src="{{deck.thumb}}" alt="New" ng-class="{\'alt\':deck.thumb==undefined}"><h2>{{deck.name}} <span ng-show="deck.added" class="add-color heavy">-Added-</span></h2><p>{{deck.user.firstName}} {{deck.user.lastName}}</p><p>{{deck.createdDate | date:"MM/dd/yyyy h:mma"}}</p><button class="ion-plus-circled button icon button-icon add-color" ng-click="sb.addDeck($index)" ng-show="!deck.added"></button> <button class="ion-minus-circled button icon button-icon del-color" ng-click="sb.delDeck($index)" ng-show="deck.added"></button></ion-item></ion-list></ion-content><ion-footer-bar><div class="centered-container"><button ng-disabled="sb.session.decks.length==0" class="button button-positive button-calm" ng-click="sb.defer.pop().resolve()">Ok</button> <button class="button button-stable" ng-click="sb.defer.pop().reject(\'cancel\')">Cancel</button></div></ion-footer-bar></ion-modal-view>'),$templateCache.put("templates/addUserPopup.html",'<form name="userForm" nonvalidate><ion-list><ion-item class="item" style="padding:0px"><label class="item-input item-floating-label"><span class="input-label">First Name</span> <input type="text" placeholder="First Name" ng-model="step.firstName" required></label></ion-item><ion-item class="item" style="padding:0px"><label class="item-input item-floating-label"><span class="input-label">Last Name</span> <input type="text" placeholder="Last Name" ng-model="step.lastName" required></label></ion-item><ion-item class="item" style="padding:0px"><label class="item-input item-floating-label"><span class="input-label">Email</span> <input type="text" placeholder="Email" ng-model="step.email" required></label></ion-item></ion-list><input style="width:10%" type="checkbox" ng-model="step.addMultiple"><p class="dark" style="line-height:normal;display:inline">I\'m Adding a Few, Don\'t Close</p><p class="assertive" style="text-align:center">{{step.message}}</p></form>'),$templateCache.put("templates/attendeeSessions.html",'<ion-view title="{{titles.attendee}}"><ion-nav-buttons side="left"><button menu-toggle="left" class="button button-icon icon ion-navicon"></button></ion-nav-buttons><ion-content class="has-header"><div class="revu-list-header calm-bg"><button ng-if="!archiveOn()" class="button button-icon icon ion-minus-circled revu-list-button revu-left" ng-click="toggleListDelete(\'att\')"></button> You\'re an Attendee:</div><ion-scroll elem-height="0.8"><ion-refresher pulling-text="Pull to refresh..." on-refresh="doRefresh()"></ion-refresher><ion-list show-delete="shouldShowDelete" delegate-handle="att"><ion-item class="item-thumbnail-left item-button-right" ng-repeat="session in attSessions" href="#/app/attsessions/{{session._id}}"><ion-delete-button class="ion-minus-circled" ng-click="markAttArchive($index)" style="color:#ffe900"></ion-delete-button><img ng-src="{{firesize(session.decks[0].thumb,80,80)}}"><h2>{{session.name}}</h2><p>{{session.date | date:"MM/dd/yyyy"}} {{session.time | date:"h:mma"}}</p><ion-option-button ng-if="smallScreen()&&archiveOn()" class="button button-energized" ng-click="markAttArchive($index); $event.preventDefault(); $event.stopPropagation();">UnArchive</ion-option-button><button ng-if="!smallScreen()&&archiveOn()" class="button item-button button-energized" ng-click="markAttArchive($index,$event); $event.preventDefault(); $event.stopPropagation();">UnArchive</button></ion-item></ion-list></ion-scroll></ion-content></ion-view>'),$templateCache.put("templates/attendees.html",'<div parent-height top="125" ng-controller="attendeesCtrl"><ion-content><div class="centered-container"><div class="button-bar"><!--Manual Attendee Entry --><a class="button" ng-click="step.setView(0)">{{::step.views[0].name}}</a><!--Team Attendee Entry --> <a class="button" ng-click="step.setView(1)">{{::step.views[1].name}}</a> <a ng-controller="sfdcCtrl" class="button" ng-click="showSalesforce(true)"><img ng-src="{{sfdc.img}}" style="height:20px;margin-bottom:-5px"></a></div><!--Invitees --><div class="revu-list-header calm-bg" ng-show="step.currentView==0"><button class="button button-icon icon ion-minus-circled revu-list-button revu-left" ng-click="step.toggleShowDelete()"></button> Invitees <button class="button button-icon icon ion-plus-circled revu-list-button revu-right" ng-click="step.addUserPopup()"></button></div><ion-scroll direction="y" parent-height top="225" ng-show="step.currentView == 0"><ion-list show-delete="step.showDelete"><ion-item ng-repeat="attendee in step.attendees" class="item"><p>{{::attendee.firstName}} {{::attendee.lastName}} <b>|</b> {{::attendee.email}}</p><ion-delete-button class="ion-minus-circled" ng-click="step.delUser($index); $event.stopPropogation();" ng-show="step.showDelete"></ion-delete-button></ion-item></ion-list></ion-scroll><!-- Teams --><ion-scroll direction="y" parent-height top="225" ng-show="step.currentView == 1"><ion-list><ion-item ng-repeat="team in teams" class="item-checkbox"><label class="checkbox"><input ng-model="team.included" ng-change="step.teamChange($index)" type="checkbox"></label>{{::team.name}}<p>Total Members: {{::team.members.length}}</p></ion-item></ion-list></ion-scroll><!-- salesforce --><ion-list ng-show="step.currentView==2"><ion-item ng-repeat="item in step.sfdcItems" class="item"><p>{{::item.Name}}</p></ion-item></ion-list></div></ion-content></div>'),$templateCache.put("templates/attendeesession.html",'<ion-view view-title="{{session.name}}" ng-cloak><ion-content class="has-header"><div class="list card"><div class="item item-divider">Meeting Detalis</div><div class="item item-thumbnail-left item-button-right"><img ng-src="{{firesize(session.decks[0].thumb,80,80)}}"><p><strong>Date:&#160&#160&#160&#160&#160&#160&#160&#160&#160&#160</strong>{{session.date | date:"MM/dd/yyyy"}}</p><p><strong>Time:&#160&#160&#160&#160&#160&#160&#160&#160&#160&#160</strong>{{session.time | date:"h:mma"}}</p><p><strong>Organizer:</strong> {{session.organizer.firstName}} {{session.organizer.lastName}}</p><p ng-if="session.bridge && !isMobile"><strong>Dial in:</strong>&#160&#160&#160&#160&#160&#160{{session.bridgeNumber}}</p><p ng-if="session.bridge && isMobile"><strong>Dial in:</strong>&#160&#160&#160&#160&#160&#160<a href="tel:{{session.bridgeNumber}},,,{{session.confId}}#">{{session.bridgeNumber}}</a></p><p><strong>meeting id:</strong> {{session.ufId}}</p><p ng-if="session.bridge && !bridgeService.activeBridge()" class="notice">Join to Open Bridge</p><p ng-if="session.bridge && bridgeService.activeBridge()" class="advise">Bridge is Open</p><button class="button button-positive" ng-click="go(session._id,0)">Join</button></div><div class="item item-divider">Attendees</div><div class="item"><span><strong>Organizer:</strong>{{session.organizer.firstName}} {{session.organizer.lastName}}</span><br><span ng-repeat="attendee in session.attendees">{{attendee.firstName}} {{attendee.lastName}} e: {{attendee.email}}<br></span></div><div class="item item-body">{{session.description}}</div></div></ion-content></ion-view>'),$templateCache.put("templates/autocomplete.html",'<ion-popover-view><ion-content><div class="list"><div class="item" ng-repeat="entry in auto.entries"><p ng-click="finishComplete($index)">{{entry.firstName}} {{entry.lastName}}</p></div></div></ion-content></ion-popover-view>'),$templateCache.put("templates/batman.html",'<ion-view view-title="Revu.Me Demo"><ion-content ng-class="{\'dark-bg\':isMobile}"><div class="centered-container"><div class="row row-center"><div class="col col-10 collapse"></div><div class="col col-80 collapse"><!--   <img ng-src="{{image}}" class="splash-image"> --><div class="centered-container hero-container positive-bg" elem-height="0.20"><h3 class="hero-welcome">Welcome Batman</h3></div></div><div class="col col-10 collapse"></div></div><div class="row row-center"><div class="col col-10 collapse"></div><div class="col col-80 collapse"><div class="centered-container user_list"><ion-list><div class="item item-divider">Utility Belt</div><ion-item ng-repeat="action in utility.actions" ng-click="action.action()"><h2>{{action.name}}</h2></ion-item><ion-item><h2>Device Info:</h2><p>Platform: {{device.currentPlatform}}</p><p>Mobile:{{isMobile}}</p><p ng-if="device.isIPad">iPad</p><p ng-if="device.isIOS">IOS</p><p ng-if="device.isAndroid">Android</p><p ng-if="device.isWindowsPhone">WindowPhone</p></ion-item><ion-item><h2>User From Local Store</h2><p>Name: {{ls.user.name}}</p><p>Email: {{ls.user.email}}</p><p>_id: {{ls.user._id}}</p></ion-item><ion-item><h2>Total Cached Images</h2><p>{{Library.cachedImages.length}}</p></ion-item><ion-item><h2>Build Date</h2><p>{{build.date}}</p></ion-item></ion-list></div></div><div class="col col-10 collapse"></div></div></div></ion-content></ion-view>'),
$templateCache.put("templates/buildSession.html",'<ion-modal-view style="z-index:15"><ion-header-bar class="bar-dark"><h1 class="title">{{sb.session.name}}</h1><div class="buttons"><button class="button button-clear button-light" ng-click="sb.defer.pop().reject()">Close</button></div></ion-header-bar><ion-content class="ionic-modal-hack"><div class="revu-list-header positive-bg"><button class="button button-icon icon ion-minus-circled revu-list-button revu-left" ng-click="toggleListDelete(\'sb\')"></button> Add or Remove Decks <button class="button button-icon icon ion-plus-circled revu-list-button revu-right" ng-click="sb.subEdit()"></button></div><form name="sb.sessionForm"><ion-list show-delete="shouldShowDelete" delegate-handle="sb"><ion-item ng-repeat="deck in sb.session.decks" class="item item-thumbnail-left"><ion-delete-button class="ion-minus-circled" ng-click="sb.delDeck($index)"></ion-delete-button><img class="thumb-small" ng-src="{{deck.thumb}}" alt="New" class="alt"><h2>{{deck.name}}</h2><p>{{deck.user.firstName}} {{deck.user.lastName}}</p><p>{{deck.createdDate | date:"MM/dd/yyyy h:mma"}}</p></ion-item></ion-list><label class="item item-input"><span class="input-label">Name</span> <input type="text" ng-model="sb.session.name" placeholder="Meeting Name" required></label><label class="item item-input"><span class="input-label">Description</span> <input type="text" ng-model="sb.session.description" placeholder="Description"></label><label class="item item-input" ng-if="screenSize().width<900"><span class="input-label">Date</span><ionic-datepicker input-obj="datepickerObject"><button class="button button-clear button-positive" style="min-height:30px;line-height:30px;color:black">{{datepickerObject.inputDate | date:\'MM/dd/yyyy\'}}</button></ionic-datepicker></label><div class="row" ng-if="screenSize().width<900"><div class="col col-50"><label class="item item-input"><span class="input-label">Time</span><ionic-timepicker input-obj="timePickerObject"><button class="button button-clear button-positive overflowShow" style="min-height:30px;line-height:30px;color:black;font-weight:normal"><standard-time-meridian etime="timePickerObject.inputEpochTime"></standard-time-meridian></button></ionic-timepicker></label></div><div class="col col-50"><label class="item item-input"><span class="input-label">length</span><select ng-model="sb.session.length"><option ng-repeat="l in sb.session.lengthOptions">{{l}}</option></select></label></div></div><div class="row" ng-if="screenSize().width>900"><div class="col col-33"><label class="item item-input"><span class="input-label">Date</span><!--input type="Date" name="date" date-format ng-model="sb.session.date" placeholder="Date"  required--><ionic-datepicker input-obj="datepickerObject"><button class="button button-clear button-positive" style="min-height:30px;line-height:30px;color:black">{{datepickerObject.inputDate | date:\'MM/dd/yyyy\'}}</button></ionic-datepicker></label></div><div class="col col-33"><label class="item item-input"><span class="input-label">Time</span><!--input type="time" name="time" time-format ng-model="sb.session.time" placeholder="Time"  required--><ionic-timepicker input-obj="timePickerObject"><button class="button button-clear button-positive overflowShow" style="min-height:30px;line-height:30px;color:black;font-weight:normal"><standard-time-meridian etime="timePickerObject.inputEpochTime"></standard-time-meridian></button></ionic-timepicker></label></div><div class="col col-33"><label class="item item-input"><span class="input-label">Length</span><select ng-model="sb.session.length"><option ng-repeat="l in sb.session.lengthOptions">{{l}}</option></select></label></div></div><div class="list"><div class="item item-input-inset"><label class="item-input-wrapper"><input type="text" name="aName" user-complete field-type="name" instance-name="session" ng-model="sb.session.formname" placeholder="Attendee Name"></label><label class="item-input-wrapper"><input type="email" name="aEmail" user-complete field-type="email" instance-name="session" ng-model="sb.session.formemail" placeholder="Attendee Email"></label><button class="button button-small" ng-click="sb.addAttendee()" ng-disabled="!sb.sessionForm.aName.$dirty || !sb.sessionForm.aEmail.$dirty \n                                         || sb.sessionForm.aEmail.$invalid">add</button></div><div class="item item-divider item-button-right">Attendees <button class="button button-small button-positive divider-button two-buttons" ng-click="sb.session.showTeams=!sb.session.showTeams" style="right:100px !important">Add Teams</button> <button class="button button-small button-positive divider-button" ng-click="showSalesforce();" ng-controller="sfdcCtrl">Salesforce</button></div><div class="item item-button-right" ng-if="sb.session.showTeams && sb.session.teamList.length > 0" style="padding:0px"><label class="item-input"><span class="input-label" style="width:20%">Teams</span><select ng-model="sb.session.team" ng-options="t.name for t in sb.session.teamList"></select></label><button class="button button-small shove-right" ng-click="sb.addTeam()" style="font-size:14px">add</button></div><div class="list"><div ng-repeat="attendee in sb.session.attendees" class="item item-icon-left"><i class="icon ion-minus-circled" style="font-size:95%" ng-click="sb.delAttendee($index)"><p class="padding-left">{{sb.session.attendees[$index].name}} {{sb.session.attendees[$index].email}}</p></i></div></div><div class="item item-checkbox"><label class="checkbox"><input ng-model="sb.session.bridge" type="checkbox"></label>conference bridge</div></div></form></ion-content><ion-footer-bar class="bar-positive"><div class="centered-container"><button class="button button-calm" ng-click="sb.defer.pop().resolve()" ng-disabled="sb.sessionForm.$invalid">OK</button> <button class="button padding-left button-assertive" ng-click="sb.defer.pop().reject()">Cancel</button><div class="centered-container" style="padding-bottom:30px"><p ng-show="sb.sessionForm.sName.$invalid">Session Name is Required</p><p ng-show="sb.sessionForm.date.$invalid">Session Date is Required</p><p ng-show="sb.sessionForm.time.$invalid">Session Time is Required</p></div></div></ion-footer-bar></ion-modal-view>'),$templateCache.put("templates/changeCard.html",'<ion-view view-title="Change Card"><ion-content class="presentation-background"><div ng-class="{\'row row-center\':!smallScreen()}"><div ng-class="{\'col col-10\':!smallScreen()}"></div><div ng-class="{\'col col-80\':!smallScreen()}"><div class="centered-container account-list" style="background:white;padding-bottom:30px"><ion-item ng-if="showCardEntry"><h2>Current Card: <img ng-src="{{script.defaultMethod.imageUrl}}" style="width:30px"> {{script.defaultMethod.cardType}} ending in {{script.defaultMethod.last4}}</h2></ion-item><ion-item><form ng-if="showCardEntry"><braintree-dropin options="dropinOptions">Loading payment form...</braintree-dropin><div><button class="button button-small button-positive" style="margin-top:5px" type="submit">Change Card</button> <button class="button button-small button-stable" style="margin-top:5px" ng-click="cancel()">Cancel</button></div><span ng-if="status.errors!=undefined" class="assertive">{{status.errorMessage}}</span><p ng-if="status.errors==undefined">{{status.message}}</p></form></ion-item><ion-item><p ng-if="status.errors==undefined">{{status.message}}</p></ion-item></div><div ng-class="{\'col col-10\':!smallScreen()}"></div></div></div></ion-content></ion-view>'),$templateCache.put("templates/changePassword.html",'<ion-view view-title="Change Password"><ion-content ng-class="{\'dark-bg\':isMobile}"><div class="centered-container"><div class="row row-center"><div class="col col-10"></div><div class="col col-80"><!--   <img ng-src="{{image}}" class="splash-image"> --><div class="centered-container hero-container positive-bg padding-bottom rounded-corners"><span class="hero-header">Revu.Me</span><div class="signup-form"><form name="forms.resetPw" ng-controller="changePasswordCtrl"><div class="list list-inset"><label class="item item-input"><span class="input-label">Email</span> <input name="inpEmail" ng-model="forms.resetPw.email" type="email" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">Old Password</span> <input name="inpOldPassword" ng-model="forms.resetPw.oldPassword" type="password" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">New Password</span> <input name="inpNewPassword" ng-model="forms.resetPw.newPassword" type="password" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">Retype PW</span> <input name="inpResetPW" ng-model="forms.resetPw.repeat" type="password" required></label></div><button class="button" ng-click="resetPassword()" ng-disabled="!forms.resetPw.inpEmail.$dirty ||\n                                         forms.resetPw.inpEmail.$invalid ||\n                                         !forms.resetPw.inpOldPassword.$dirty ||\n                                         !forms.resetPw.inpNewPassword.$dirty ||\n                                         !forms.resetPw.inpResetPW.$dirty">Change Password</button><div><span ng-if="forms.resetPw.inpEmail.$dirty && forms.resetPw.inpEmail.$invalid" class="signin-message">Invalid Email Format</span> <span ng-if="forms.resetPw.inpOldPassword.$dirty &&\n                                     forms.resetPw.inpOldPassword.$error.required" class="signin-message">Old Password is Required</span> <span ng-if="forms.resetPw.inpNewPassword.$dirty &&\n                                     forms.resetPw.inpNewPassword.$error.required" class="signin-message">New Password is Required</span> <span ng-if="forms.resetPw.inpResetPW.$dirty &&\n                                     forms.resetPw.inpResetPW.$error.required" class="signin-message">Please Retype New Password</span></div></form></div></div></div><div class="col col-10"></div></div></div></ion-content></ion-view>'),$templateCache.put("templates/contentPicker.html",'<div parent-height top="125"><ion-content><file-box close-on-select="true"></file-box><div ng-show="eva.Data.ready"><div class="flow-drop-zone centered-container" drag-enter="class=\'flow-drag-enter\'" drag-leave="class=\'flow-drag-leave\'" evaporate eva-model="eva.Data" ng-model="eva.Inbox" ng-class="class" ng-if="!device.IOS() && !device.isIPad() && !device.isAndroid() && !device.isWindowsPhone()"><p>Drop your file(s) here</p></div><ion-list ng-if="library.uploading.files.length > 0"><ion-item ng-repeat="file in library.uploading.files" class="upload-content" style="min-height:70px" ng-cloak><ion-spinner icon="ios" class="upload-spinner" ng-if="file.spinner"></ion-spinner><h2>{{file.name}}</h2><p ng-show="file.timeLeft != 0">{{file.timeLeft}} seconds remaining...</p><p ng-show="file.message != \'\'">{{file.message}}</p><div ng-show="!file.spinner" class="progress-bar" elem-height="0.01" ng-style="{\'width\':file.progressString}"></div></ion-item></ion-list></div><ion-list><ion-item ng-repeat="deck in sb.decks" class="item-thumbnail-left item-button-right"><img ng-src="{{deck.thumb}}" alt="New" ng-class="{\'alt\':deck.thumb==undefined}"><h2>{{deck.name}} <span ng-show="deck.added" class="add-color heavy">-Added-</span></h2><p>{{deck.user.firstName}} {{deck.user.lastName}}</p><p>{{deck.createdDate | date:"MM/dd/yyyy h:mma"}}</p><button class="ion-plus-circled button icon button-icon add-color" ng-click="sb.addDeck($index)" ng-show="!deck.added"></button> <button class="ion-minus-circled button icon button-icon del-color" ng-click="sb.delDeck($index)" ng-show="deck.added"></button></ion-item></ion-list></ion-content></div>'),$templateCache.put("templates/contentRemoved.html",'<ion-modal-view><ion-content><div class="centered-container hero-container positive-bg" style="margin-top:20px" elem-height="0.50"><span class="hero">Revu.me</span><h3 class="hero-welcome">The Presenter Closed this Meeting</h3></div></ion-content></ion-modal-view>'),$templateCache.put("templates/dashboardTemplate.html",'<ion-view view-title="Dashboard"><ion-nav-buttons side="right"><button class="button button-calm icon-left ion-compass" ng-click="tourService.start()">&nbsp Start Tour</button></ion-nav-buttons><ion-content><div class="centered-container dashboard-container"><div class="button-bar" style="margin-top:15px"><a ng-repeat="button in navButtons.buttons" ng-click="navButtons.click($index)" ng-class="button.clicked?navButtons.clickedClass:navButtons.class">{{button.name}}</a></div><div ng-if="navButtons.buttons[navButtons.todayButton].clicked"><div class="row responsive-sm"><div class="col"><h2 class="positive">Meetings at a Glance</h2></div></div><div class="row responsive-sm"><div class="col col-50"><h3>Today</h3><div style="position:relative"><h2 class="doughnut-center" ng-click="goMeetings()">{{meetings.today.center}}</h2><canvas class="chart chart-doughnut" chart-data="meetings.today.data" chart-labels="meetings.today.labels" chart-colours="meetings.today.colors" chart-options="meetings.today.options" chart-legend="true"></canvas></div></div><div class="col col-50"><h3>This Week</h3><div style="position:relative"><h2 class="doughnut-center" ng-click="goMeetings()">{{meetings.thisWeek.center}}</h2><canvas class="chart chart-doughnut" chart-data="meetings.thisWeek.data" chart-labels="meetings.thisWeek.labels" chart-colours="meetings.thisWeek.colors" chart-options="meetings.thisWeek.options" chart-legend="true"></canvas></div></div></div><div class="row"><div class="centered-container"><h2 class="positive" style="margin-top:10px;margin-bottom:20px">Recent Interactions</h2><ion-list ng-if="minWidth"><ion-item ng-repeat="i in interactions" ng-click="showInteraction($index)"><h2><span class="positive">When:</span>&nbsp {{i.date | date:\'medium\'}} &nbsp &nbsp <span class="positive">Contact:</span>&nbsp{{i.contact}}</h2><p><span style="color:black">Meeting:</span> &nbsp {{i.meetingName}} &nbsp <span style="color:black">Time Engaged(sec):</span> &nbsp{{i.totalTime | number:1}} &nbsp <span style="color:black">Total Slides:</span> &nbsp {{i.totalSlides}}</p><div ng-if="interactions[$index].isShowing"><canvas class="chart chart-line" chart-data="iChart.data" chart-labels="iChart.labels" chart-series="iChart.series" chart-colours="iChart.colors" chart-legend="true" chart-options="iChart.options"></canvas></div></ion-item></ion-list><ion-list ng-if="!minWidth"><ion-item ng-repeat="i in interactions" ng-click="showInteraction($index)"><h2><span class="positive">When:</span>&nbsp {{i.date | date:\'medium\'}}</h2><h2><span class="positive">Contact:</span>&nbsp{{i.contact}}</h2><p><span style="color:black">Meeting:</span> &nbsp {{i.meetingName}} &nbsp</p><p><span style="color:black">Time Engaged(sec):</span> &nbsp{{i.totalTime | number:1}} &nbsp <span style="color:black">Total Slides:</span> &nbsp {{i.totalSlides}}</p><div ng-if="interactions[$index].isShowing"><canvas class="chart chart-line" chart-data="iChart.data" chart-labels="iChart.labels" chart-series="iChart.series" chart-colours="iChart.colors" chart-legend="true" chart-options="iChart.options"></canvas></div></ion-item></ion-list></div></div></div><div ng-if="navButtons.buttons[navButtons.engageButton].clicked"><div class="row responsive-sm"><div class="col"><h2 class="positive">Viewer Engagement</h2></div></div><div class="row responsive-md"><div class="col col-50"><div class="row"><div class="col"><h3 style="margin-bottom:20px">Past Month</h3><div style="position:relative"><h2 class="doughnut-center">{{engagement.recentChart.center | number:0}}</h2><canvas class="chart chart-doughnut" chart-data="engagement.recentChart.data" chart-labels="engagement.recentChart.labels" chart-colours="engagement.recentChart.colors" chart-options="engagement.recentChart.options" chart-legend="true"></canvas></div></div></div><div class="row"><div class="col"><h3 style="margin-bottom:20px">Details Past Month</h3><canvas class="chart chart-line" chart-data="engagement.rDetailChart.data" chart-labels="engagement.rDetailChart.labels" chart-series="engagement.rDetailChart.series" chart-colours="engagement.rDetailChart.colors" chart-legend="true" chart-options="engagement.rDetailChart.options"></canvas></div></div></div><div class="col col-50"><div class="row"><div class="col"><h3 style="margin-bottom:20px">Overall</h3><div style="position:relative"><h2 class="doughnut-center">{{engagement.overallChart.center| number:0}}</h2><canvas class="chart chart-doughnut" chart-data="engagement.overallChart.data" chart-labels="engagement.overallChart.labels" chart-colours="engagement.overallChart.colors" chart-options="engagement.overallChart.options" chart-legend="true"></canvas></div></div></div><div class="row"><div class="col"><h3 style="margin-bottom:20px">Details Overall</h3><canvas class="chart chart-line" chart-data="engagement.oDetailChart.data" chart-labels="engagement.oDetailChart.labels" chart-series="engagement.oDetailChart.series" chart-colours="engagement.oDetailChart.colors" chart-legend="true" chart-options="engagement.oDetailChart.options"></canvas></div></div></div></div></div><div ng-if="navButtons.buttons[navButtons.fileButton].clicked"><div class="row responsive-sm"><div class="col"><h2 class="positive">File Activities</h2></div></div><div class="row responsive-md"><div class="col col-50"><h3>Recent File Uploads</h3><div style="position:relative"><h2 class="doughnut-center">{{files.recent.center}}</h2><canvas class="chart chart-doughnut" chart-data="files.recent.data" chart-labels="files.recent.labels" chart-colours="files.recent.colors" chart-options="files.recent.options" chart-legend="true"></canvas></div></div><div class="col col-50"><h3>Files: Active &amp Archived</h3><div style="position:relative"><h2 class="doughnut-center">{{files.native.center}}</h2><canvas class="chart chart-doughnut" chart-data="files.native.data" chart-labels="files.native.labels" chart-colours="files.native.colors" chart-options="files.recent.options" chart-legend="true"></canvas></div></div></div><div class="row responsive-md"><div class="col col-50"><h3>Decks Recently Created</h3><div style="position:relative"><h2 class="doughnut-center">{{decks.recent.center}}</h2><canvas class="chart chart-doughnut" chart-data="decks.recent.data" chart-labels="decks.recent.labels" chart-colours="decks.recent.colors" chart-options="decks.recent.options" chart-legend="true"></canvas></div></div><div class="col col-50"><h3>Decks: Active &amp Archived</h3><div style="position:relative"><h2 class="doughnut-center">{{decks.native.center}}</h2><canvas class="chart chart-doughnut" chart-data="decks.native.data" chart-labels="decks.native.labels" chart-colours="decks.native.colors" chart-options="decks.recent.options" chart-legend="true"></canvas></div></div></div></div></div></ion-content><div class="bar bar-footer" ng-class="{\'bar-positive\':user.daysLeft>=14,\'bar-energized\':(user.daysLeft < 14 && user.daysLeft > 7), \'bar-assertive\':(user.daysLeft <= 7),\'bar-tall\':smallScreen()}" ng-if="user.script!=undefined && user.script.autoRenew == false"><div class="title">Your {{user.script.type}} Subsction has {{user.daysLeft}} days left</div><button class="button button-calm" ng-class="{\'bar-button-bottom\':smallScreen()}" ng-if="user.script.type!=\'Elite\' && user.daysLeft < 21">{{buyButton.text}}</button></div></ion-view>'),$templateCache.put("templates/datetime.html",'<div parent-height top="125" ng-controller="datetimeCtrl"><div class="centered-container wizard-content"><h3 style="color:white">Title and Description</h3><div class="list" style="margin-bottom:10px"><label class="item item-input"><input ng-model="step.name" ng-change="step.changeName()" type="text" placeholder="Title"></label><label class="item item-input" style="margin-top:10px"><input ng-model="step.description" ng-change="step.changeDescription()" type="text" placeholder="Description"></label></div><h3 style="color:white;margin-top:0px">What Date and Time?</h3><div style="display:block;width:100%;margin-top:15px"><ionic-datepicker input-obj="step.datepickerObject"><i class="icon ion-calendar" style="display:inline;color:white;font-size:28px;margin-right:10px"></i> <button class="button button-calm button-large" style="min-height:30px;line-height:30px;color:black;width:140px">{{step.datepickerObject.inputDate | date:\'MM/dd/yyyy\'}}</button></ionic-datepicker></div><div style="display:block;width:100%;margin-top:15px;margin-bottom:15px"><ionic-timepicker input-obj="step.timePickerObject"><i class="icon ion-clock" style="display:inline;color:white;font-size:28px;margin-right:10px"></i> <button class="button button-large button-calm overflowShow" style="min-height:30px;line-height:30px;color:black;font-weight:normal;width:140px"><standard-time-meridian etime="step.timePickerObject.inputEpochTime"></standard-time-meridian></button></ionic-timepicker></div><div style="display:inline"><h4 style="display:inline;color:white;margin-right:15px">Length (min)</h4><select ng-model="session.length"><option ng-repeat="l in session.lengthOptions">{{l}}</option></select></div><div style="margin-top:7px"><h3 style="color:white;display:inline-block;line-height:23px;vertical-align:text-bottom">Conference Bridge?</h3><label class="toggle toggle-calm" style="display:inline-block;margin-left:10px;vertical-align:text-bottom"><input ng-model="step.bridge" type="checkbox" ng-change="step.changeBridge()"><div class="track"><div class="handle"></div></div></label></div></div></div>'),$templateCache.put("templates/editProfile.html",'<ion-view view-title="Your Profile"><ion-content ng-class="{\'dark-bg\':isMobile}"><div class="centered-container"><div class="row row-center"><div class="col col-10"></div><div class="col col-80"><!--   <img ng-src="{{image}}" class="splash-image"> --><div class="centered-container hero-container positive-bg padding-bottom"><span class="hero-header">Revu.Me</span><div class="signup-form"><form name="forms.signup" ng-controller="signupCtrl"><div class="list list-inset"><label class="item item-input"><span class="input-label">First Name</span> <input name="fName" ng-model="forms.signup.firstName" type="text" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">Last Name</span> <input name="lName" ng-model="forms.signup.lastName" type="text" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">Email</span> <input name="inpEmail" ng-model="forms.signup.email" type="email" required></label></div><button class="button" ng-click="updateProfile()" ng-disabled="!forms.signup.fName.$dirty || \n                                         !forms.signup.lName.$dirty || \n                                         !forms.signup.inpEmail.$dirty || \n                                         forms.signup.inpEmail.$invalid">Update</button><div><span ng-if="forms.signup.inpEmail.$dirty && forms.signup.inpEmail.$invalid" class="signin-message">Invalid Email Format</span> <span ng-if="forms.signup.fName.$dirty && forms.signup.fName.$error.required" class="signin-message">First Name is Required</span> <span ng-if="forms.signup.lName.$dirty && forms.signup.lName.$error.required" class="signin-message">Last Name is Required</span></div></form></div></div></div><div class="col col-10"></div></div></div></ion-content></ion-view>'),$templateCache.put("templates/emailConfirmed.html",'<ion-view view-title="Revu.Me"><ion-content ng-class="{\'dark-bg\':isMobile}"><div class="centered-container"><div class="row row-center"><div class="col col-10"></div><div class="col col-80"><!--   <img ng-src="{{image}}" class="splash-image"> --><div class="centered-container hero-container positive-bg" elem-height="0.50"><h3 class="hero-welcome">Thank You {{user.firstName}}</h3><h3 class="hero-welcome">Your Email is Confirmed</h3></div></div><div class="col col-10"></div></div></div></ion-content></ion-view>'),$templateCache.put("templates/fileBox.html",'<div ng-controller="fileNavCtrl" resize><div class="import-header dark-bg"><span>Import From...</span></div><div class="button-bar" evaporate eva-model="eva.Data" ng-model="eva.Inbox" ng-if="elWidth>510"><a class="button button-light" ng-click="commands.show(\'Google\')" google-button></a> <a class="button button-light" ng-click="commands.show(\'dropBox\')" dropbox-button></a> <a class="button button-light" ng-click="commands.show(\'Box\')" box-button></a> <a class="button button-light" ng-click="commands.show(\'Windows\')" windows-button></a></div><div class="button-bar" evaporate eva-model="eva.Data" ng-model="eva.Inbox" ng-if="elWidth<=510"><a class="button button-light" ng-click="commands.show(\'Google\')" google-button></a> <a class="button button-light" ng-click="commands.show(\'dropBox\')" dropbox-button></a></div><div class="button-bar" evaporate eva-model="eva.Data" ng-model="eva.Inbox" ng-if="elWidth<=510"><a class="button button-light" ng-click="commands.show(\'Box\')" box-button></a> <a class="button button-light" ng-click="commands.show(\'Windows\')" windows-button></a></div></div>'),$templateCache.put("templates/fileNavigator.html",'<ion-modal-view><ion-header-bar class="bar-positive"><button class="button icon ion-chevron-up" ng-if="fileNavigator.active.toParentVisible" ng-click="fileNavigator.active.toParent()"></button><h1 class="title">{{fileNavigator.active.name}}</h1><div class="buttons"><button class="button button-clear" ng-click="fileNavigator.hide()">Close</button></div></ion-header-bar><ion-header-bar class="bar bar-subheader"><ion-scroll direction="x" class="path-scroll" delegate-handle="path"><span ng-click="fileNavigator.active.showRoot()" style="cursor:pointer">Path:&nbsp {{fileNavigator.active.root}}</span> <span path-to-links ng-model="fileNavigator.active.folders" on-change="fileNavigator.active.showFolder"></span></ion-scroll></ion-header-bar><ion-content class="has-header has-subheader" delegate-handle="fileNavigator"><div ng-if="fileNavigator.active.name == \'Dropbox\'"><ion-list><ion-item ng-repeat="file in fileNavigator.active.folders.data" ng-click="fileNavigator.active.select($index)" ng-class="{\'item-icon-left\':file.is_dir||!file.thumb_exists,\'item-thumbnail-left\':!file.is_dir&&file.thumb_exists}"><i ng-if="file.is_dir" class="icon ion-folder positive"></i> <img ng-if="file.thumb_exists" style="box-shadow:5px 5px 5px #888888" ng-src="{{file.thumb}}"> <i ng-if="!file.is_dir&&!file.thumb_exists &&!file.is_empty" class="icon ion-document calm"></i> <i ng-if="file.is_empty" class="icon ion-alert assertive"></i><h3>{{file.name}}</h3><p ng-if="!file.is_empty">Type: {{file.type}}</p></ion-item></ion-list></div><div ng-if="fileNavigator.active.name == \'Box\'"><ion-list><ion-item ng-repeat="file in fileNavigator.active.folders.item_collection.entries" ng-click="fileNavigator.active.select($index)" ng-class="{\'item-icon-left\':file.type == \'folder\' || file.type!=\'folder\'}"><i ng-if="file.type == \'folder\'" class="icon ion-folder positive"></i> <img ng-if="file.thumb" style="box-shadow:5px 5px 5px #888888" ng-src="{{file.thumb}}"> <i ng-if="file.type != \'folder\'&&!file.is_empty" class="icon ion-document calm"></i> <i ng-if="file.is_empty" class="icon ion-alert assertive"></i><h3>{{file.name}}</h3><p ng-if="!file.is_empty">Type: {{file.type}}</p></ion-item></ion-list></div><div ng-if="fileNavigator.active.name == \'Google\'"><ion-list><ion-item ng-repeat="file in fileNavigator.active.folders.data" ng-click="fileNavigator.active.select($index)" ng-class="{\'item-icon-left\':file.type == \'folder\' || file.type!=\'folder\',\'item-thumbnail-left\':file.thumbnail}"><i ng-if="file.type == \'folder\'" class="icon ion-folder positive"></i> <img ng-if="file.thumbnail" style="box-shadow:5px 5px 5px #888888" ng-src="{{file.thumbnailLink}}"> <i ng-if="file.type != \'folder\'&&!file.thumbnail &&!file.is_empty" class="icon ion-document calm"></i> <i ng-if="file.is_empty" class="icon ion-alert assertive"></i><h3>{{file.title}}</h3><p ng-if="!file.is_empty">Type: {{file.type}}</p></ion-item></ion-list></div><div ng-if="fileNavigator.active.name == \'Microsoft\'"><ion-list><ion-item ng-repeat="file in fileNavigator.active.folders.data" ng-click="fileNavigator.active.select($index)" ng-class="{\'item-icon-left\':!file.thumbnail,\'item-thumbnail-left\':file.thumbnail}"><i ng-if="file.type == \'folder\' || file.type==\'album\'" class="icon ion-folder positive"></i> <img ng-if="file.thumbnail" style="box-shadow:5px 5px 5px #888888" ng-src="{{file.thumbnail}}"> <i ng-if="file.type !=\'folder\'&&file.type!=\'album\'&&!file.thumbnail &&!file.is_empty" class="icon ion-document calm"></i> <i ng-if="file.is_empty" class="icon ion-alert assertive"></i><h3>{{file.name}}</h3><p ng-if="!file.is_empty">Type: {{file.type}}</p></ion-item></ion-list></div></ion-content></ion-modal-view>'),$templateCache.put("templates/libNav.html",'<ion-view view-title="Slide Library" ng-if="navItemsShowing==false"><ion-content class="slideshow-container centered-container" overflow-scroll="false"><div class="revu-list-header positive-bg"><button class="button button-icon icon ion-chevron-left revu-list-button revu-left" ng-click="slideBack()"></button><div style="margin-left:10%;width:85%;overflow:hidden"><p style="white-space:nowrap;margin-bottom:0px">{{navItems[selectedNavId].name}}</p></div></div><ng-include src="\'templates/slideItems.html\'"></ng-include></ion-content></ion-view><ion-view view-title="Slide Library" ng-if="navItemsShowing==true"><ion-content slide-right="library::slide" style="background:white" overflow-scroll="true"><ng-include src="\'templates/navItems.html\'"></ng-include></ion-content><tour-step step-name="MobileLibrary" ext="tourShow()"></tour-step></ion-view>'),$templateCache.put("templates/library.html",'<ion-view view-title="{{title}}" ng-cloak><ion-content has-bouncing="false" ng-class="{\'slideshow-container\':!archiveOn(),\'archive-container\':archiveOn()}"><div class="row" style="padding:0px 5px 0px 0px"><div class="{{navClass}}" style="padding:0px 5px 0px 0px"><ng-include src="\'templates/navItems.html\'"></ng-include></div><div class="{{thumbClass}}"><add-template template-url="templates/slideItems.html"></add-template></div></div></ion-content><div class="presence-message dark-bg centered-container" appear-up="show_message">""</div><tour-step step-name="Library" ext="tourShow()"></tour-step></ion-view>'),$templateCache.put("templates/manageSeats.html",'<ion-modal-view><ion-header-bar class="bar-calm"><h1 class="title">Allocate Seats</h1><div class="buttons"><button class="button button-light" ng-click="cancelManager()">Close</button></div></ion-header-bar><ion-header-bar class="bar bar-subheader bar-positive"><h2 class="title">Available Seats : {{script.availableSeats}}</h2></ion-header-bar>><ion-content has-header="true" has-subheader="true"><form name="forms.members"><div class="list"><div class="item item-input-inset"><label class="item-input-wrapper"><input type="text" name="aName" user-complete field-type="name" instance-name="script" ng-model="newMember.name" placeholder="Member Name" required></label><label class="item-input-wrapper"><input type="email" name="aEmail" user-complete field-type="email" instance-name="script" ng-model="newMember.email" placeholder="Member Email" required></label><button class="button button-small" ng-click="addMember()" ng-disabled="!forms.members.$valid || script.availableSeats ==0">add</button></div></div></form><div class="item item-divider item-button-right">Members <button class="button button-small button-positive divider-button" ng-click="script.showTeams=!script.showTeams">Add Teams?</button></div><div class="item item-button-right" ng-if="script.showTeams && script.teamList.length > 0" style="padding:0px"><label class="item-input"><span class="input-label" style="width:20%">Teams</span><select ng-model="script.team" ng-options="t.name for t in script.teamList"></select></label><button class="button button-small" ng-click="addTeam()" style="font-size:14px" ng-class="{\'move-left\':smallScreen() == false}" ng-disabled="script.availableSeats ==0">add</button></div><div class="list"><div ng-repeat="member in script.members" class="item item-icon-left"><i class="icon ion-minus-circled" style="font-size:95%" ng-click="delMember($index)"><p class="padding-left">{{script.members[$index].user.name}}</p></i></div></div></ion-content><ion-footer-bar><div class="centered-container"><button class="button button-positive button-positive" ng-click="updateSubscription()">Ok</button> <button class="button button-stable" ng-click="cancelManager()">Cancel</button></div></ion-footer-bar></ion-modal-view>'),
$templateCache.put("templates/menu.html",'<ion-side-menus enable-menu-with-back-views="true"><ion-side-menu-content><ion-nav-bar class="bar-dark"><ion-nav-back-button class="button-clear"><i class="ion-arrow-left-c"></i> Back</ion-nav-back-button><ion-nav-buttons side="left"><button class="button button-icon button-clear ion-navicon" menu-toggle="left" ng-if="!deepLink"></button> <a class="button button-icon button-clear ion-home" ng-if="deepLink" href="https://www.revu.me"></a></ion-nav-buttons></ion-nav-bar><ion-nav-view style="background-color:transparent" name="menuContent"></ion-nav-view></ion-side-menu-content><ion-side-menu side="left"><ion-header-bar ng-class="{\'bar-calm\':!archive.menu,\'bar-stable\':archive.menu}"><h1 ng-if="!archive.menu" class="title">Menu</h1><h1 ng-if="archive.menu" class="title">Archive</h1></ion-header-bar><ion-content><ion-list><!-- Non-Archive Menu Items --><ion-item ng-if="!archive.menu" nav-clear menu-close href="#/app/settings"><i class="ion-gear-b menu-icon dark"></i>{{user.name}}</ion-item><ion-item ng-if="!archive.menu" nav-clear menu-close href="#/app/dashboard"><i class="ion-compass menu-icon dark"></i>Dashboard</ion-item><ion-item nav-clear menu-close ng-if="!archive.menu" ng-click="newMeeting(\'app.newMeeting\')"><i class="ion-ios-monitor-outline menu-icon balanced"></i>New Meeting</ion-item><ion-item nav-clear menu-close ng-if="smallScreen()&&!archive.menu" href="#/app/mobile/library"><i class="ion-ios-paper menu-icon royal"></i>Slide Library</ion-item><ion-item nav-clear menu-close ng-if="!smallScreen()&&!archive.menu" href="#/app/library"><i class="ion-ios-paper menu-icon royal"></i>Slide Library</ion-item><ion-item ng-if="!archive.menu" nav-clear menu-close href="#/app/teams"><i class="ion-android-contacts menu-icon positive"></i>Teams</ion-item><ion-item ng-if="!archive.menu" nav-clear menu-close href="#/app/sessions"><i class="ion-speakerphone menu-icon balanced"></i>Meetings You Lead</ion-item><ion-item ng-if="!archive.menu" nav-clear menu-close href="#/app/attendeeSessions"><i class="ion-calendar menu-icon calm"></i>Meeting Invitations</ion-item><ion-item ng-if="(!archive.menu&&!isMobile) || (!achive.menu && isMobile && showArchive)" nav-clear menu-close ng-click="toggleArchive()"><i class="ion-filing menu-icon energized"></i>Archive</ion-item><!-- Archive Menu Items --><ion-item ng-if="archive.menu" nav-clear menu-close ng-click="toggleArchive()"><i class="ion-arrow-left-b menu-icon dark"></i>Main Menu</ion-item><ion-item nav-clear menu-close ng-if="smallScreen()&&archive.menu" href="#/app/mobile/library"><i class="ion-ios-paper menu-icon royal"></i>Library</ion-item><ion-item nav-clear menu-close ng-if="!smallScreen()&&archive.menu" href="#/app/library"><i class="ion-ios-paper menu-icon royal"></i>Library</ion-item><ion-item ng-if="archive.menu" nav-clear menu-close href="#/app/sessions"><i class="ion-speakerphone menu-icon balanced"></i>Past Meetings</ion-item><ion-item ng-if="archive.menu" nav-clear menu-close href="#/app/attendeeSessions"><i class="ion-calendar menu-icon calm"></i>Past Invitations</ion-item><!-- backdoor menu item for me --><ion-item ng-if="user.email==\'klynch@volerro.com\' || user.batman" nav-clear menu-close href="#/app/batman"></ion-item></ion-list></ion-content></ion-side-menu></ion-side-menus>'),$templateCache.put("templates/myAccount.html",'<ion-view view-title="My Account"><ion-content class="presentation-background"><div ng-class="{\'row row-center\':!smallScreen()}"><div ng-class="{\'col col-10\':!smallScreen()}"></div><div ng-class="{\'col col-80\':!smallScreen()}"><div class="centered-container account-list"><ion-list><div class="item item-divider positive-bg" style="color:white">Account Information</div><ion-item><h2>Subscription Type: {{script.type}}</h2><h2>Administrator: {{admin.firstName}} {{admin.lastName}}</h2><p>Days Left {{script.daysLeft}}</p></ion-item><ion-item><h2>Total Seats: {{script.totalSeats}}</h2><h2>Available Seats: {{script.availableSeats}}</h2><span ng-if="order.type == \'Monthly\'" class="positive">Monthly Cost (USD) : {{order.price | currency: \'$\':0}}</span> <span ng-if="order.type == \'Annually\'" class="positive">Annual Cost (USD) : {{order.price | currency: \'$\':0}}</span><div style="margin-top:7px"><button class="button button-small button-positive" ng-click="changeAccount()" ng-if="script.type != \'Elite\'">{{changeButton.text}}</button> <button class="button button-small button-calm" style="color:black" ng-click="manageSeats()" ng-disabled="script.availableSeats == 0">Manage Seats</button></div></ion-item><ion-item ng-if="script.customerId != undefined"><h2>Current Card: <img ng-src="{{script.defaultMethod.imageUrl}}" style="width:30px"> {{script.defaultMethod.cardType}} ending in {{script.defaultMethod.last4}}</h2><button class="button button-small button-dark" ng-click="changeCard()">Change Card</button></ion-item><div ng-if="showChange"><div class="item item-divider positive-bg" style="color:white">Upgrade/Change Your Account</div><div class="item"><div ng-class="{\'row\':screenSize().width>800}"><div ng-class="{\'col col-50\':screenSize().width>800}"><label class="item item-input" style="border-style:none"><span class="input-label push-number">Number of Seats</span> <input type="number" ng-model="order.totalSeats" min="1" ng-change="changeSeatCount()"></label></div><div ng-class="{\'col col-50\':screenSize().width>800}"><div class="item item-input item-select" style="border-style:none"><span class="input-label">Subscription Type</span><select ng-model="order.type" ng-options="script for script in order.scriptTypes" ng-change="changeTerm()"></select></div></div></div></div><div class="item centered-container"><span ng-if="order.type == \'Monthly\'" class="positive">Monthly Cost (USD) : {{order.price | currency: \'$\':0}}</span> <span ng-if="order.type == \'Annually\'" class="positive">Annual Cost (USD) : {{order.price | currency: \'$\':0}}</span><p>{{order.hint}}</p><button class="button button-small button-positive" style="margin-top:5px" ng-click="checkout()" ng-disabled="(script.totalSeats == order.totalSeats)&&(script.type == order.type)">Check Out</button> <button class="button button-small button-stable" style="margin-top:5px" ng-click="cancelChange()">Cancel</button></div></div><div ng-if="script.type==\'Monthly\' || script.type==\'Annually\'" class="item item-divider dark-bg" style="color:white">Close Your Account</div><div style="background:white" ng-if="script.type==\'Monthly\' || script.type==\'Annually\'"><div class="item item-checkbox no-border" ng-class="{\'half-item\':!smallScreen()}"><label class="checkbox"><input ng-model="order.stopRenew" type="checkbox" ng-change="renewChange()"></label>Do Not AutoRenew</div><p ng-class="{\'assertive\':order.stopRenew,\'balanced\':script.autoRenew}">{{script.renewMessage}}</p></div></ion-list></div><div ng-class="{\'col col-10\':!smallScreen()}"></div></div></div><div class="presence-message dark-bg" appear-up="show_message">""</div></ion-content></ion-view>'),$templateCache.put("templates/navItems.html",'<div class="lib-list-header"><div class="button-bar bar-positive"><a class="button" ng-click="setModel(\'files\')" ng-class="{\'tab-selected\': modelName==\'files\'}">Files</a> <a class="button" ng-click="setModel(\'categories\')" ng-class="{\'tab-selected\': modelName==\'categories\'}">Categories</a> <a class="button" ng-click="setModel(\'decks\')" ng-class="{\'tab-selected\': modelName==\'decks\'}">Decks</a></div></div><div class="revu-list-header calm-bg"><button ng-if="archiveOn()" class="button button-icon icon ion-minus-circled revu-list-button revu-left" ng-click="toggleListDelete()"></button><p class="sub-title" ng-if="modelName==\'decks\'&&smallScreen()">(options:swipe left)</p>{{listName}} <button class="button button-icon icon ion-plus-circled revu-list-button revu-right" ng-click="toggleNavAdd()" ng-if="!archiveOn()"></button></div><div ng-show="eva.Data.ready && modelName==\'files\'" ng-if="!smallScreen()"><file-box close-on-select="false" file-box></file-box></div><div ng-show="eva.Data.ready && modelName==\'files\'" ng-if="smallScreen()"><file-box close-on-select="true" file-box></file-box></div><div ng-show="showAddItem"><div ng-switch on="modelName"><div ng-switch-when="files"><!------evaporate testing-------------><div ng-show="eva.Data.ready"><div class="flow-drop-zone centered-container" drag-enter="class=\'flow-drag-enter\'" drag-leave="class=\'flow-drag-leave\'" evaporate eva-model="eva.Data" ng-model="eva.Inbox" ng-class="class" ng-if="device.notMobileOS"><p>Drop your file(s) here</p></div><ion-list ng-if="library.uploading.files.length > 0"><ion-item ng-repeat="file in library.uploading.files" class="upload-content" style="min-height:70px" ng-cloak><ion-spinner icon="ios" class="upload-spinner" ng-if="file.spinner"></ion-spinner><h2>{{file.name}}</h2><p ng-show="file.timeLeft != 0">{{file.timeLeft}} seconds remaining...</p><p ng-show="file.message != \'\'">{{file.message}}</p><div ng-show="!file.spinner" class="progress-bar" elem-height="0.01" ng-style="{\'width\':file.progressString}"></div></ion-item></ion-list></div><!---------end evaporate--------------></div><div ng-switch-when="categories"><form name="categoryForm"><div class="list"><div class="item item-input-inset"><label class="item-input-wrapper"><input type="text" ng-model="category.name" placeholder="Category Name:" required></label><button ng-click="addCategory()" ng-disabled="categoryForm.$invalid" class="button button-small">Submit</button></div></div></form></div><div ng-switch-when="decks"><form name="deckForm"><div class="list"><div class="item item-input-inset"><label class="item-input-wrapper"><input type="text" name="deckName" ng-model="deck.name" placeholder="Deck Name:" required></label><button ng-click="addDeck()" ng-disabled="deckForm.$invalid" class="button button-small">Submit</button></div></div></form></div></div></div><ion-scroll elem-height="0.70"><ion-refresher pulling-text="Pull to refresh..." on-refresh="doRefresh()" spinner="ripple"></ion-refresher><ion-list show-delete="shouldShowDelete"><ion-item ng-repeat="(itemIndex,item) in navItems" class="item-thumbnail-left" ng-class="{\'item-select\':!archiveOn()}" ng-click="setNavSelection($index)"><ion-delete-button ng-if="!archiveOn()" class="ion-minus-circled" ng-click="archiveNavItem($index)" ng-disabled="!item._$Archive" style="color:#ffe900"></ion-delete-button><ion-delete-button ng-if="archiveOn()" class="ion-minus-circled" ng-click="delNavItem($index)" ng-disabled="!item._$Delete"></ion-delete-button><img ng-if="item.slides.length != 0" ng-src="{{firesize(item.thumb,80,80)}}" class="white-background" image-lazy-loader="lines"><h2>{{item.name}}</h2><p>{{item.user.firstName}} {{item.user.lastName}}</p><p>{{item.createdDate | date:"MM/dd/yyyy h:mma"}}</p><span ng-if="item.sharingString" class="positive">Sharing:{{item.sharingString}}</span><select ng-if="!smallScreen() && item.actions.length > 1 && !archiveOn()" ng-model="item.action.selected" ng-options="action.name for action in item.actions" ng-change="item.action.selected.callBack(itemIndex,item.action.selected.idx,$event,\'option\')" ng-class="{\'edit-color\':item.beingEdited}">{{option.callBack}}</select><div class="buttons"><button ng-if="!smallScreen()&&archiveOn()" class="button button-energized archive-button" ng-click="unArchiveNavItem($index,$event)">UnArchive</button></div><ion-option-button ng-repeat="action in item.actions" ng-model="item.action.selected" ng-if="smallScreen() && $index!=0 && !archiveOn()" ng-click="action.callBack(itemIndex,$index,$event,\'button\')" class="button ng-class:action.class;">{{action.name}}</ion-option-button><ion-option-button ng-if="smallScreen() && archiveOn()" class="button button-energized" ng-click="unArchiveNavItem($index,$event)">UnArchive</ion-option-button><i class="icon ion-plus-circled slide-adder top-corner" ng-show="isEditing && (selectedNavId == $index) " ng-click="addAll()"></i><p class="top-corner" ng-show="isEditing && !showEdit && (selectedNavId == $index) ">select all</p></ion-item></ion-list></ion-scroll><!--    ng-change="option.callBack(itemIndex,$idx,$event,\'option\')"-->'),$templateCache.put("templates/newTeamTemplate.html",'<ion-modal-view><ion-header-bar class="bar-positive"><h1 class="title">{{modalTitle}}</h1><div class="buttons"><button class="button button-clear button-light" ng-click="closeModal()">Close</button></div></ion-header-bar><ion-content><div><form name="teamForm"><label class="item item-input"><span class="input-label">Team Name</span> <input name="teamName" type="text" ng-model="addTeam.name" required></label><div class="list"><div class="item item-toggle">Comma Delimited Input<label class="toggle toggle-positive"><input type="checkbox" ng-model="commaDelimited"><div class="track"><div class="handle"></div></div></label></div><div ng-show="!commaDelimited"><div class="item item-input-inset"><label class="item-input-wrapper"><input type="text" name="mName" ng-model="addTeam.nameString" placeholder="Member Name" user-complete field-type="name" instance-name="team"></label><label class="item-input-wrapper"><input type="email" name="mEmail" ng-model="addTeam.emailString" placeholder="Member Email" user-complete field-type="email" instance-name="team"></label><button class="button button-small" ng-click="addMember()" ng-disabled="teamForm.mEmail.$invalid || teamForm.mName.$invalid">add</button></div><div class="item item-divider">Members</div><ion-scroll><div class="list" elem-height="0.12"><div ng-repeat="member in addTeam.members" class="item item-icon-left"><i class="icon ion-minus-circled" style="font-size:95%" ng-click="delMember($index)"><p class="padding-left">{{addTeam.members[$index].firstName}} {{addTeam.members[$index].lastName}} {{addTeam.members[$index].email}}</p></i></div></div></ion-scroll></div><div ng-show="commaDelimited"><label class="item item-input item-stacked-label"><span class="input-label">Add Members:(pattern:first,last,email;)</span><textarea class="team-textarea" name="members" ng-model="addTeam.memberString" style="width:97%" elem-height="0.185" wrap="hard">\n                        </textarea></label></div></div></form></div><div class="centered-container" style="margin-top:10px"><button class="button button-positive" ng-click="modalCallback()" ng-disabled="teamForm.teamName.$invalid || (addTeam.members.length == 0)">OK</button> <button class="button padding-left button-stable" ng-click="closeModal()">Cancel</button><p ng-show="teamForm.teamName.$invalid">Team Name is Required</p></div></ion-content></ion-modal-view>'),$templateCache.put("templates/payment.html",'<ion-view view-title="Payment"><ion-content class="presentation-background"><div ng-class="{\'row row-center\':!smallScreen()}"><div ng-class="{\'col col-10\':!smallScreen()}"></div><div ng-class="{\'col col-80\':!smallScreen()}"><div class="centered-container account-list" style="background:white;padding-bottom:30px"><ion-item><h2>Total Seats: {{script.totalSeats}}</h2><span class="positive" ng-if="script.type == \'Monthly\'">Monthly Fee (USD): {{script.cost | currency:\'$\':0}}</span> <span class="positive" ng-if="script.type == \'Annually\'">Annual Fee (USD): {{script.cost | currency:\'$\':0}}</span> <span ng-if="status.errors!=undefined" class="assertive">{{status.errorMessage}}</span><p ng-if="status.errors==undefined">{{status.message}}</p></ion-item><ion-item ng-if="script.defaultMethod!=undefined"><h2>Pay Using {{script.defaultMethod.cardType}} ending in {{script.defaultMethod.last4}} ?</h2><div><button class="button button-small button-positive" style="margin-top:5px" ng-click="defaultPay()" ng-disabled="paymentDisabled">OK</button> <button class="button button-small button-stable" style="margin-top:5px" ng-click="cancelOrder()">Cancel</button></div><span ng-if="status.errors!=undefined" class="assertive">{{status.errorMessage}}</span><p ng-if="status.errors==undefined">{{status.message}}</p></ion-item><form ng-if="showCardEntry"><braintree-dropin options="dropinOptions">Loading payment form...</braintree-dropin><div><button class="button button-small button-positive" style="margin-top:5px" type="submit">Place Order</button> <button class="button button-small button-stable" style="margin-top:5px" ng-click="cancelOrder()">Cancel</button></div><span ng-if="status.errors!=undefined" class="assertive">{{status.errorMessage}}</span><p ng-if="status.errors==undefined">{{status.message}}</p></form></div><div ng-class="{\'col col-10\':!smallScreen()}"></div><div class="presence-message dark-bg" appear-up="show_message">""</div></div></div></ion-content></ion-view>'),$templateCache.put("templates/presAnalytics.html",'<ion-modal-view><ion-header-bar class="bar-positive"><h1 class="title">{{session.name}}</h1><div class="buttons"><button class="button button-clear button-light" ng-click="closeModal()">Close</button></div></ion-header-bar><ion-content><div class="item item-divider">{{session.decks[deckIdx].name}}</div><div class="item item-divider" ng-repeat="metric in session.decks[deckIdx].metrics">{{metric.eventDate| date:"EEEE MM/dd/yyyy h:mma"}}<div class="list card" ng-repeat="sv in metric.slideViews"><div class="item item-avatar slide-report-header" ng-if="sv.slideIndex>=0"><img ng-if="session.decks[deckIdx].slides[sv.slideIndex].type == \'img\'" ng-src="{{session.decks[deckIdx].slides[sv.slideIndex].src}}" class="no-corners"> <img ng-if="session.decks[deckIdx].slides[sv.slideIndex].type == \'video\'" ng-src="{{session.decks[deckIdx].slides[sv.slideIndex].poster}}" class="no-corners"><h2>Slide Number {{sv.slideIndex+1}}</h2><p>Slide Duration: {{sv.duration | number:2}}(sec)</p></div><div class="item item-avatar slide-report-header" ng-if="sv.slideIndex<0"><img ng-src="{{baseUrl.endpoint}}/img/screenshare.png" class="no-corners"><h2>Screen Sharing</h2><p>Duration: {{sv.duration | number:2}}(sec)</p></div><div class="item"><div class="row"><div class="col col-50 centered-container">Viewer</div><div class="col col-50 centered-container">Time on Slide</div></div><div class="row" ng-repeat="view in sv.views"><div class="col col-50 centered-container">{{view.userName}}</div><div class="col col-50 centered-container">{{view.viewed| number:2}}(sec) {{(view.viewed/sv.duration)*100|number:0}}%</div></div></div></div></div></ion-content></ion-modal-view>'),$templateCache.put("templates/presEndTemplate.html",'<ion-modal-view><ion-header-bar class="bar-calm"><h1 class="title">Thank You</h1><div class="buttons"><button class="button button-clear" style="color:black" ng-click="signupModal.hide()">Close</button></div></ion-header-bar><div class="bar bar-subheader"><h2 class="title">The Meeting Has Ended</h2></div><ion-content has-subheader="true"><div class="centered-container hero-container padding-bottom with-subheader" ng-class="{\'rounded-corners\': !smallScreen()}"><p class="positive">Presented By:</p><p class="pres-end-header positive" style="line-height:100%">Revu.Me</p><p class="positive">If You Like Our Product<br>Just Enter a Password<br>and Click "Sign Up"</p><form name="forms.signup"><label class="item item-input padding-bottom" ng-class="{narrow : !smallScreen()}"><span class="input-label">Password</span> <input name="inpPassword" ng-model="forms.signup.password" type="password" required></label><button class="button button-balanced" style="margin-top:10px;color:black" ng-click="doSignUp()" ng-disabled="!forms.signup.inpPassword.$dirty">Sign Up</button><div class="signin-button"><p class="signin-message" ng-click="signupModal.hide()">No Thanks</p></div></form></div></ion-content></ion-modal-view>'),$templateCache.put("templates/presentation.html",'<ion-view view-title="{{name}}"><ion-nav-buttons side="right"><button class="button icon-left ion-ios-monitor" ng-if="screenSharingEnabled && screenSize().width>800" ng-click="screenShare()">ScreenShare</button> <button class="button icon ion-ios-monitor" ng-if="screenSharingEnabled && screenSize().width<=800" ng-click="screenShare()"></button> <button class="button icon ion-ios-telephone" ng-click="showDialin()" ng-if="screenSize().width<=800"></button> <button class="button icon-left ion-ios-telephone" ng-click="showDialin()" ng-if="screenSize().width>800">Dial In</button> <button class="button icon-left" ng-click="toggleShowUsers()"><i class="icon ion-person-stalker"></i><div class="user-indicator">{{present.length}}</div></button></ion-nav-buttons><ion-content class="has-header presentation-background" scroll="false" id="presentation" fullscreen><div class="centered-container slide" elem-size controls="true" host="true"><div class="row" ng-class="{\'vert-center\':screenSize().width < screenSize().height}"><div class="col col-5"><a class="button icon-left ion-chevron-left button-clear button-dark slider-button" ng-click="prevSlide();$event.preventDefault(); $event.stopPropagation();"></a></div><div class="col col-90"><ion-slide-box class="bordered-drop-shadow" on-slide-changed="setSlide(index)" show-pager="false"><ion-slide ng-repeat="slide in presentation.slides"><div ng-switch on="slide.type"><div ng-switch-when="img"><ion-scroll direction="xy" scrollbar-x="false" scrollbar-y="false" zooming="true" min-zoom="1.0" style="width: 100%; height: 100%" delegate-handle="scrollHandle{{$index}}" on-scroll="updateSlideStatus(current)" on-release="updateSlideStatus(current)"><img ng-src="{{slide.src}}" class="slide-content"></ion-scroll></div><div ng-switch-when="video"><video id="vid-slide" class="slide-content" v-source="{{slide.src}}" controls v-lead="{{$index}}"></video></div></div></ion-slide></ion-slide-box><div class="presence-message dark-bg" appear-up="show_message">""</div></div><div class="col col-5"><a class="button icon-right ion-chevron-right button-clear button-dark slider-button right" ng-click="nextSlide();$event.preventDefault(); $event.stopPropagation();"></a></div></div></div><div class="bar bar-footer bar-dark" ng-if="footer.class != \'hidden\'" ng-class="{\'tall\': footer.class == \'tall\'}"><div class="centered-container"><div ng-repeat="attendee in everyone" class="user-item"><div class="circle-initials" ng-class="{\'calm-bg\': attendee.isOnline,\n                                   \'circle-offline\':!attendee.isOnline,\n                                   \'ion-eye-disabled user-distracted circle-offline\': attendee.distracted}"><p ng-show="!attendee.distracted">{{attendee.initials}}</p></div><span ng-if="attendee.itsMe != true" class="user-item-text">{{attendee.firstName}} {{attendee.lastName}}</span> <span ng-if="attendee.itsMe" class="user-item-text">You</span></div></div></div></ion-content></ion-view>'),$templateCache.put("templates/presentations.html",'<ion-view title="Presentations"><ion-nav-buttons side="left"><button menu-toggle="left" class="button button-icon icon ion-navicon"></button></ion-nav-buttons><ion-content class="has-header"><ion-list><ion-item class="item-thumbnail-left" ng-repeat="deck in presentations" href="#/app/presentations/{{deck.id}}"><img ng-src="{{deck.slides[0].source}}"><h2>{{deck.name}}</h2><p>{{deck.slides.length}} total slides</p></ion-item></ion-list></ion-content></ion-view>'),$templateCache.put("templates/resetPassword.html",'<ion-view view-title="Change Password"><ion-content ng-class="{\'dark-bg\':isMobile}"><div class="centered-container"><div class="row row-center"><div class="col col-10"></div><div class="col col-80"><!--   <img ng-src="{{image}}" class="splash-image"> --><div class="centered-container hero-container positive-bg padding-bottom"><span class="hero-header">Revu.Me</span><div class="signup-form"><form name="forms.resetPw" ng-controller="resetPasswordCtrl"><div class="list list-inset"><label class="item item-input"><span class="input-label">Email</span> <input name="inpEmail" ng-model="forms.resetPw.email" type="email" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">Old Password</span> <input name="inpOldPassword" ng-model="forms.resetPw.oldPassword" type="password" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">New Password</span> <input name="inpNewPassword" ng-model="forms.resetPw.newPassword" type="password" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">Retype PW</span> <input name="inpResetPW" ng-model="forms.resetPw.repeat" type="password" required></label></div><button class="button" ng-click="resetPassword()" ng-disabled="!forms.resetPw.inpEmail.$dirty ||\n                                         forms.resetPw.inpEmail.$invalid ||\n                                         !forms.resetPw.inpOldPassword.$dirty ||\n                                         !forms.resetPw.inpNewPassword.$dirty ||\n                                         !forms.resetPw.inpResetPW.$dirty">Change Password</button><div><span ng-if="forms.resetPw.inpEmail.$dirty && forms.resetPw.inpEmail.$invalid" class="signin-message">Invalid Email Format</span> <span ng-if="forms.resetPw.inpOldPassword.$dirty &&\n                                     forms.resetPw.inpOldPassword.$error.required" class="signin-message">Old Password is Required</span> <span ng-if="forms.resetPw.inpNewPassword.$dirty &&\n                                     forms.resetPw.inpNewPassword.$error.required" class="signin-message">New Password is Required</span> <span ng-if="forms.resetPw.inpResetPW.$dirty &&\n                                     forms.resetPw.inpResetPW.$error.required" class="signin-message">Please Retype New Password</span></div></form></div></div></div><div class="col col-10"></div></div></div></ion-content></ion-view>'),$templateCache.put("templates/review.html",'<ion-view view-title="{{name}}"><ion-content class="has-header presentation-background" scroll="false"><div class="centered-container slide" elem-size controls="true"><div class="row"><div class="col col-5"><a class="button icon-left ion-chevron-left button-clear button-dark slider-button" ng-click="prevSlide()" ng-disabled="!prevEnabled"></a></div><div class="col col-90"><!--ion-slide-box disable-scroll="true"  class="bordered-drop-shadow" on-slide-changed="setSlide($index)" show-pager="false"--><ion-slide-box class="bordered-drop-shadow" on-slide-changed="swipeSlide($index)" show-pager="false"><ion-slide ng-repeat="slide in presentation.slides"><div ng-switch on="slide.type"><div ng-switch-when="img"><ion-scroll direction="xy" scrollbar-x="false" scrollbar-y="false" zooming="true" min-zoom="1.0" style="width: 100%; height: 100%" delegate-handle="scrollHandle{{$index}}" on-scroll="updateSlideStatus(current)" on-release="updateSlideStatus(current)"><img ng-src="{{slide.src}}" class="slide-content"></ion-scroll></div><div ng-switch-when="video"><video class="slide-content" controls="controls" v-source="{{slide.src}}" v-follow="{{$index}}"></video></div></div></ion-slide></ion-slide-box><div class="presence-message dark-bg" appear-up="show_message">""</div></div><div class="col col-5"><a class="button icon-right ion-chevron-right button-clear button-dark slider-button right" ng-click="nextSlide()" ng-disabled="!nextEnabled"></a></div></div></div></ion-content></ion-view>'),$templateCache.put("templates/screenleap.html",'<ion-modal-view style="height:150px"><ion-content><div style="margin-left:10%"><h2 class="positive">Downloading App...</h2><p style="line-height:50px">Your download should start in seconds. If it doesn\'t, <a class="dark" ng-click="restartDownload()" style="font-weight:600;cursor:pointer">restart the download.</a></p><hr><p>1. Wait for the app to download</p><p>2. Open/Run the installer app</p><p>3. After the app has installed, <a class="dark" ng-click="startNative()" style="font-weight:600;cursor:pointer">click here</a> to start the screen share</p></div></ion-content></ion-modal-view>'),$templateCache.put("templates/search.html",'<ion-view view-title="Search"><ion-content><h1>Search</h1></ion-content></ion-view>'),$templateCache.put("templates/session.html",'<ion-view view-title="{{session.name}}" hide-back-button="false" ng-cloak><ion-nav-buttons side="right"><button class="button" ng-click="editSession()">Edit</button></ion-nav-buttons><ion-content class="has-header"><div class="list card"><div class="item item-divider">Meeting Details</div><div class="item item-button-right"><p><strong>Date:&#160&#160&#160&#160&#160&#160&#160&#160&#160&#160</strong>{{session.date | date:"MM/dd/yyyy"}}</p><p><strong>Time:&#160&#160&#160&#160&#160&#160&#160&#160&#160&#160</strong>{{session.time | date:"h:mma"}}</p><p><strong>Organizer:</strong> &#160 {{session.organizer.firstName}} {{session.organizer.lastName}}</p><p ng-if="session.bridge && isMobile"><strong>Dial in:</strong>&#160&#160&#160&#160&#160&#160 <a href="tel:{{session.bridgeNumber}},,,{{session.confId}}#">{{session.bridgeNumber}}</a></p><p ng-if="session.bridge && !isMobile"><strong>Dial in:</strong>&#160&#160&#160&#160&#160&#160 {{session.bridgeNumber}}</p><p><strong>Meeting Id:</strong>&#160{{session.ufId}}</p><button class="button button-balanced" ng-click="startMeeting()" ng-if="!activeMeeting">Start Meeting</button> <button class="button button-assertive" ng-click="endMeeting()" ng-if="activeMeeting">End Meeting</button> <button class="button button-positive" style="top:55px" ng-click="resendInvites()">Resend Invites</button></div><div class="item item-body">{{session.description}}</div><div class="item item-checkbox"><label class="checkbox"><input ng-model="session.bridge" type="checkbox"></label>conference bridge</div><div class="item item-checkbox" ng-if="!reportDisabled($index)"><label class="checkbox"><input ng-model="session.leaveBehind" type="checkbox" ng-click="setLeaveBehind()"></label>Allow Post Meeting Review</div><div class="item item-divider">Presentations Decks</div><div class="item item-thumbnail-left item-button-right" ng-repeat="deck in session.decks"><img ng-src="{{firesize(deck.thumb,80,80)}}"><h2>{{deck.name}}</h2><p>{{deck.slides.length}} total slides</p><div class="buttons session-item-button"><button class="button button-positive" ng-click="go(session._id,$index)" ng-if="session.decks.length > 1">Show</button> <button class="button button-positive button-outline" ng-disabled="!reportsEnabled[$index]" ng-click="showResults($index)">Analytics</button></div></div><div class="item item-divider">Attendees</div><div class="item"><span><strong>Organizer:</strong>{{session.organizer.firstName}} {{session.organizer.lastName}}</span><br><span ng-repeat="attendee in session.attendees">{{attendee.firstName}} {{attendee.lastName}} e: {{attendee.email}}<br></span></div></div></ion-content></ion-view>'),$templateCache.put("templates/sessions.html",'<ion-view title="{{titles.organizer}}" ng-cloak><ion-nav-buttons side="left"><button menu-toggle="left" class="button button-icon icon ion-navicon"></button></ion-nav-buttons><ion-content class="has-header"><div class="revu-list-header balanced-bg"><button ng-if="!archiveOn()" class="button button-icon icon ion-minus-circled revu-list-button revu-left" ng-click="toggleListDelete(\'org\')"></button> You\'re the Organizer<p class="sub-title" ng-if="smallScreen()">(swipe left to edit)</p><button class="button button-icon icon ion-plus-circled revu-list-button revu-right" ng-click="newSession()" ng-if="!archiveOn()"></button></div><ion-scroll elem-height="0.80"><ion-refresher pulling-text="Pull to refresh..." on-refresh="doRefresh()"></ion-refresher><ion-list show-delete="shouldShowDelete" delegate-handle="org"><ion-item class="item-thumbnail-left item-button-right" ng-repeat="session in orgSessions" href="#/app/sessions/{{session._id}}"><ion-delete-button class="ion-minus-circled" style="color:#ffe900" ng-click="markArchive($index)"></ion-delete-button><img ng-src="{{firesize(session.decks[0].thumb,80,80)}}"><h2>{{session.name}}</h2><p>{{session.date | date:"MM/dd/yyyy"}} {{session.time | date:"h:mma"}}</p><p>Total Attendees: {{session.attendees.length}}</p><p>First Deck is: {{session.decks[0].name}} of {{session.decks.length}}</p><p ng-if="smallScreen()">(swipe left to edit)</p><ion-option-button ng-if="smallScreen()&&!archiveOn()" class="button button-positive" ng-click="editSession($index); $event.preventDefault(); $event.stopPropogation();">Edit</ion-option-button><ion-option-button ng-if="smallScreen()&&archiveOn()" class="button button-energized" ng-click="markArchive($index); $event.preventDefault(); $event.stopPropogation();">UnArchive</ion-option-button><!--\n              <ion-option-button ng-if="smallScreen()" class="button button-energized" \n                      ng-click="markArchive($index); $event.preventDefault(); $event.stopPropogation();">\n                  {{actions[2].name}}\n              </ion-option-button>\n              <select ng-if="!smallScreen()"\n                      ng-options="action as action.name for action in actions"\n                      ng-model="action.selected"\n                      ng-change="doAction($index)"\n                      style="z-index:500">\n              </select>\n                --><button ng-if="!smallScreen()&&!archiveOn()" class="button button-positive" ng-click="editSession($index); $event.preventDefault(); $event.stopPropogation();">Edit</button> <button ng-if="!smallScreen()&&archiveOn()" class="button button-energized" ng-click="markArchive($index); $event.preventDefault(); $event.stopPropogation();">UnArchive</button></ion-item></ion-list></ion-scroll></ion-content></ion-view>'),
$templateCache.put("templates/settings.html",'<ion-view view-title="Settings"><ion-content class="presentation-background"><div ng-class="{\'row row-center\':!smallScreen()}"><div ng-class="{\'col col-10\':!smallScreen()}"></div><div ng-class="{\'col col-80\':!smallScreen()}"><div class="centered-container account-list"><ion-list><ion-item><h2 class="positive">Account Email:&nbsp{{user.email}}</h2></ion-item><div class="item item-divider">Setting List</div><ion-item ng-repeat="action in setting.actions" ng-click="action.action()"><h2>{{action.name}}</h2></ion-item><div style="background:white;margin-top:1px"><div class="item item-checkbox"><label class="checkbox"><input ng-model="$rootScope.showArchive" class="centered-checkbox" type="checkbox"></label>Show Archive on Mobile</div></div></ion-list></div></div><div ng-class="{\'col col-10\':!smallScreen()}"></div></div></ion-content></ion-view>'),$templateCache.put("templates/sfdcAttendee.html",'<ion-modal-view><ion-content class="ParentMarker"><div class="centered-container" style="width:100%;height:44px;background-color:rgb(10,154,215)"><div class="row no-padding centered-container sfdcBanner"><div class="col no-padding"><img ng-src="{{sfdc.banner}}"></div><div class="col no-padding"><div style="display:table-cell;height:44px;vertical-align:middle"><select ng-model="sfdc.object" ng-change="sfdc.changeObject()" ng-options="object.name for object in sObjects" style="display:inline;margin-left:8px;width:150px;-webkit-appearance:menulist-button;height:25px;border-style:none"></select></div></div></div></div><div class="row"><div class="col col-50"><label class="item item-input"><i class="icon ion-search placeholder-icon"></i> <input ng-model="sfdc.person" ng-change="sfdc.changePerson()" type="search" placeholder="Person" style="height:24px"></label></div><div class="col col-50"><label class="item item-input"><i class="icon ion-search placeholder-icon"></i> <input ng-model="sfdc.company" ng-change="sfdc.changeCompany()" type="search" placeholder="Company" style="height:24px"></label></div></div><!-- users from leads,accounts,contacts,opportunities--><ion-scroll parent-height top="110"><ion-list><ion-item ng-repeat="user in sfdc.people" class="item-checkbox"><label class="checkbox"><input ng-model="user.included" ng-change="sfdc.changeAttendee($index)" ng-if="user.Email != undefined || user.Contact.Email != undfined" type="checkbox"></label>{{::user.Name}}<p ng-if="user.Email">{{::user.Email}}</p><h2 ng-if="user.Contact.Name">{{::user.Contact.Name}}</h2><p ng-if="user.Contact.Email">{{::user.Contact.Email}}</p><p ng-if="user.Account.Name!=undefined">{{::user.Account.Name}}</p><p ng-if="user.Company !=undefined">{{::user.Company}}</p></ion-item></ion-list></ion-scroll></ion-content><ion-footer-bar class="bar-positive"><div class="centered-container"><button class="button button-calm" ng-click="hideSalesforce()">Close</button></div></ion-footer-bar></ion-modal-view>'),$templateCache.put("templates/shareTemplate.html",'<ion-modal-view><ion-header-bar class="bar-calm"><h1 class="title">Share with Team</h1><div class="buttons"><button class="button button-clear button-light" ng-click="cancelShare()">Close</button></div></ion-header-bar><ion-content><ion-list><ion-item ng-repeat="team in teams" class="item-checkbox"><label class="checkbox"><input ng-model="team.included" type="checkbox"></label>{{team.name}}<p>Total Members: {{team.members.length}}</p></ion-item></ion-list></ion-content><ion-footer-bar><div class="centered-container"><button class="button button-positive button-calm" ng-click="updateSharing()">Ok</button> <button class="button button-stable" ng-click="cancelShare()">Cancel</button></div></ion-footer-bar></ion-modal-view>'),$templateCache.put("templates/sharedContent.html",'<div parent-height top="125" ng-controller="sharedContentCtrl"><file-box close-on-select="true"></file-box><div ng-show="eva.Data.ready"><div class="flow-drop-zone centered-container" drag-enter="class=\'flow-drag-enter\'" drag-leave="class=\'flow-drag-leave\'" evaporate eva-model="eva.Data" ng-model="eva.Inbox" ng-class="class" ng-if="!device.IOS() && !device.isIPad() && !device.isAndroid() && !device.isWindowsPhone()"><p>Drop your file(s) here</p></div><ion-list ng-if="library.uploading.files.length > 0"><ion-item ng-repeat="file in library.uploading.files" class="upload-content" style="min-height:70px" ng-cloak><ion-spinner icon="ios" class="upload-spinner" ng-if="file.spinner"></ion-spinner><h2>{{file.name}}</h2><p ng-show="file.timeLeft != 0">{{file.timeLeft}} seconds remaining...</p><p ng-show="file.message != \'\'">{{file.message}}</p><div ng-show="!file.spinner" class="progress-bar" elem-height="0.01" ng-style="{\'width\':file.progressString}"></div></ion-item></ion-list></div><ion-scroll direction="y" parent-height top="250"><ion-list style="margin-bottom:56px"><ion-item ng-repeat="deck in sb.decks" class="item-thumbnail-left item-button-right"><img ng-src="{{firesize(deck.thumb,80,80)}}" alt="New" ng-class="{\'alt\':deck.thumb==undefined}"><h2>{{deck.name}} <span ng-show="deck.added" class="add-color heavy">-Added-</span></h2><p>{{deck.user.firstName}} {{deck.user.lastName}}</p><p>{{deck.createdDate | date:"MM/dd/yyyy h:mma"}}</p><button class="ion-plus-circled button icon button-icon add-color" ng-click="step.addDeck($index)" ng-show="!deck.added"></button> <button class="ion-minus-circled button icon button-icon del-color" ng-click="step.delDeck($index)" ng-show="deck.added"></button></ion-item></ion-list></ion-scroll></div>'),$templateCache.put("templates/signin.html",'<ion-view view-title="Sign In"><ion-content ng-class="{\'dark-bg\':isMobile}"><div class="centered-container"><div class="row row-center"><div class="col col-10"></div><div class="col col-80"><!--   <img ng-src="{{image}}" class="splash-image"> --><div class="centered-container hero-container positive-bg padding-bottom rounded-corners"><span class="hero-header">Revu.Me</span><p ng-if="message != undefined" class="signin-message">{{message}}</p><div class="signup-form"><form name="forms.signin" ng-controller="signinCtrl"><div class="list list-inset"><label class="item item-input"><span class="input-label">Email</span> <input name="inpEmail" ng-model="forms.signin.email" type="email" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">Password</span> <input name="inpPassword" ng-model="forms.signin.password" type="password" required></label></div><button class="button" ng-click="doSignIn()" ng-disabled="!forms.signin.inpPassword.$dirty || !forms.signin.inpEmail.$dirty \n                                             || forms.signin.inpEmail.$invalid">Sign In</button><div><span ng-if="forms.signin.inpEmail.$dirty && forms.signin.inpEmail.$invalid" class="signin-message">Invalid Email Format</span> <span ng-if="forms.signin.inpPassword.$dirty && forms.signin.inpPassword.$error.required" class="signin-message">Password is Required</span></div></form></div></div></div><div class="col col-10"></div></div></div></ion-content></ion-view>'),$templateCache.put("templates/signinTemplate.html",'<div ng-controller="signupCtrl"><div class="row centered-container"><button class="button icon-left ion-social-google button-signin skinny sfdc" ng-click="signInWith(\'Salesforce\')">Sign-in with Salesforce</button></div><div class="row centered-container"><button class="button icon-left ion-social-google button-signin skinny google" ng-click="signInWith(\'Google\')">Sign-in with Google</button></div><div class="row centered-container"><button class="button icon-left ion-social-windows button-signin skinny windows" ng-click="signInWith(\'Windows\')">Sign-in with Microsoft</button></div><div class="row centered-container"><button class="button icon-left ion-social-dropbox button-signin skinny dropbox" ng-click="signInWith(\'Dropbox\')">Sign-in with Dropbox</button></div><div class="row centered-container"><button class="button button-signin skinny box" ng-click="signInWith(\'Box\')" ng-mouseenter="mouseEnter()" ng-mouseleave="mouseLeave()"><img ng-src="{{mouse.over && \'img/box_hover.png\' || \'img/box_white.png\'}}"> Sign-in with Box</button></div></div><input type="email" placeholder="email" ng-model="user.email"><br><input type="password" placeholder="password" ng-model="user.password"><br><input style="width:10%" type="checkbox" ng-model="user.resetPassword"><p class="dark" style="line-height:normal;display:inline">Reset My Password (add email)</p><br><p class="assertive" style="line-height:normal;text-align:center">{{user.message}}</p>'),$templateCache.put("templates/signup.html",'<ion-view view-title="Sign Up"><ion-content class="presentation-background"><div class="centered-container"><div ng-class="screenSize().width<800 ? \'col\' : \'row row-center signin-margin-top\'"><!--div ng-class="{\'col col-10\':screenSize().width<800, \'col col5\':screenSize().width>800}"--><div ng-class="screenSize().width<800 ? \'\' : \'col col-40\'"><div class="row centered-container"><button class="button icon-left ion-social-google button-signin sfdc" ng-click="signInWith(\'Salesforce\')">Sign-in with Salesforce</button></div><div class="row centered-container"><button class="button icon-left ion-social-google button-signin google" ng-click="signInWith(\'Google\')">Sign-in with Google</button></div><div class="row centered-container"><button class="button icon-left ion-social-windows button-signin windows" ng-click="signInWith(\'Windows\')">Sign-in with Microsoft</button></div><div class="row centered-container"><button class="button icon-left ion-social-dropbox button-signin dropbox" ng-click="signInWith(\'Dropbox\')">Sign-in with Dropbox</button></div><div class="row centered-container"><button class="button button-signin box" ng-click="signInWith(\'Box\')" ng-mouseenter="mouseEnter()" ng-mouseleave="mouseLeave()"><img ng-src="{{mouse.over && \'img/box_hover.png\' || \'img/box_white.png\'}}"> Sign-in with Box</button></div></div><div ng-class="{\'col col-10\':screenSize().width>800}" ng-if="screenSize().width>800"></div><div ng-class="screenSize().width<800 ? \'row\' : \'col col-40\'"><div class="centered-container positive-bg padding-bottom full-width"><span class="signup-header">Sign in with Email</span><div class="signup-form"><form name="forms.signup" ng-controller="signupCtrl"><div class="list"><label class="item item-input item-floating-label light-bg"><span class="input-label" style="text-align:left">First Name</span> <input name="fName" ng-model="forms.signup.firstName" type="text" placeholder="firstName" required></label><label class="item item-input item-floating-label light-bg"><span class="input-label" style="text-align:left">Last Name</span> <input name="lName" ng-model="forms.signup.lastName" type="text" placeholder="Lastname" required></label><label class="item item-input item-floating-label light-bg"><span class="input-label" style="text-align:left">Email</span> <input name="inpEmail" ng-model="forms.signup.email" type="email" placeholder="Email" required></label><label class="item item-input item-floating-label light-bg"><span class="input-label" style="text-align:left">Password</span> <input name="inpPassword" ng-model="forms.signup.password" type="password" placeholder="Password" required></label></div><button class="button" ng-click="doSignUp()" ng-disabled="!forms.signup.fName.$dirty || \n                                             !forms.signup.lName.$dirty || \n                                             !forms.signup.inpPassword.$dirty || \n                                             !forms.signup.inpEmail.$dirty || \n                                             forms.signup.inpEmail.$invalid">Sign Up</button><div class="signin-button"><p class="signin-message" ng-click="signIn()">Sign In</p></div><div><span ng-if="forms.signup.inpEmail.$dirty && forms.signup.inpEmail.$invalid" class="signin-message">Invalid Email Format</span> <span ng-if="forms.signup.inpPassword.$dirty && forms.signup.inpPassword.$error.required" class="signin-message">Password is Required</span> <span ng-if="forms.signup.fName.$dirty && forms.signup.fName.$error.required" class="signin-message">First Name is Required</span> <span ng-if="forms.signup.lName.$dirty && forms.signup.lName.$error.required" class="signin-message">Last Name is Required</span></div></form></div></div></div><div ng-class="{\'col col-10\':screenSize().width<800, \'col col-5\':screenSize().width>800} "></div></div></div></ion-content></ion-view>'),$templateCache.put("templates/slideItems.html",'<ion-scroll elem-height="0.90" overflow-scroll="true" delegate-handle="slideItems"><div ng-repeat="slide in slides" class="thumbnail" ng-class="{\'thumb-selected\':tap.on && tap.index==$index}" ng-cloak><div ng-switch on="slide.type"><div ng-switch-when="img"><div style="position:relative"><i class="icon ion-close-circled slide-deleter" ng-show="statesReady && isEditing && slide.included && !slide.available" ng-click="deleteSlide($index)" ng-cloak></i> <i class="icon ion-checkmark-round slide-included" ng-show="slide.included && slide.available"></i> <i class="icon ion-plus-circled slide-adder" ng-show="statesReady && isEditing && slide.available " ng-click="addSlide($index)" ng-cloak></i> <img resize-width="{{slide.src}}" style="width:100%" class="rounded-corners shadow white-background" ng-click="tapThumb($index)"></div></div><div ng-switch-when="video"><div style="position:relative"><i class="icon ion-close-circled slide-deleter" ng-show="statesReady && isEditing && slide.included && !slide.available" ng-click="deleteSlide($index)" ng-cloak></i> <i class="icon ion-checkmark-round slide-included" ng-show="slide.included && slide.available"></i> <i class="icon ion-plus-circled slide-adder" ng-show="statesReady && isEditing && slide.available " ng-click="addSlide($index)" ng-cloak></i><!--\n                    <i class="icon ion-play slide-play-video" \n                       ng-show="!slide.playing"  \n                       ng-click="playVideo($index)">\n                    </i>\n\n                    <video ng-show="slide.playing"\n                           class="rounded-corners shadow video-thumbnail"\n                           controls=true\n                           ng-click="tapThumb($index)"\n                           v-source={{slide.src}} auto-play="slide.playing">\n                    </video> \n--><video id="vid-slide" class="rounded-corners shadow" poster="https://dw69ofzd8w57f.cloudfront.net/transparant.png" v-source="{{slide.src}}" v-background-image="{{slide.poster}}" controls="true" ng-click="tapThumb($index)"></video><!--\n                    <img ng-show="!slide.playing"\n                         ng-src="{{slide.poster}}"  \n                         style="width:100%" class="rounded-corners shadow"\n                         ng-click="tapThumb($index)">\n--></div></div></div></div></ion-scroll>'),$templateCache.put("templates/slideShow.html",'<ion-view view-title="{{presentation.name}}"><ion-content class="has-header presentation-background" scroll="false" id="slideshow" fullscreen><div class="centered-container slide" elem-size controls="true" host="false"><div class="row" ng-class="{\'vert-center\':screenSize().width < screenSize().height}"><div class="col col-5"><a class="button icon-left ion-chevron-left button-clear button-dark slider-button" ng-click="previousClicked();$event.preventDefault(); $event.stopPropagation();" ng-disabled="!prevEnabled"></a></div><div class="col col-90"><ion-slide-box ng-repeat="box in slideBoxes" ng-if="box.idx == slideBoxIdx" disable-scroll="false" class="bordered-drop-shadow" show-pager="false" active-slide="boxCurrent" delegate-handle="{{box.handle}}" ng-cloak><ion-slide ng-repeat="slide in box.slides" ng-init="$last ? slidesDone() : null" ng-cloak><div ng-switch on="slide.type"><div ng-switch-when="img"><ion-scroll direction="xy" scrollbar-x="false" scrollbar-y="false" zooming="true" min-zoom="1.0" style="width: 100%; height: 100%" delegate-handle="scrollHandle{{$index}}" on-scroll="updateSlideStatus(boxCurrent)" on-release="updateSlideStatus(boxCurrent)"><img ng-src="{{slide.src}}" class="slide-content" on-swipe-left="nextClicked()" on-swipe-right="previousClicked()"></ion-scroll></div><div ng-switch-when="video"><video class="slide-content" controls="controls" v-source="{{slide.src}}" on-swipe-left="nextClicked()" on-swipe-right="previousClicked()"></video></div></div></ion-slide></ion-slide-box></div><div class="col col-5"><a class="button icon-right ion-chevron-right button-clear button-dark slider-button right" ng-click="nextClicked();$event.preventDefault(); $event.stopPropagation();" ng-disabled="!nextEnabled"></a></div></div></div></ion-content></ion-view>'),$templateCache.put("templates/splash.html",'<ion-view view-title="Revu.Me" hide-back-button="true"><ion-content class="presentation-background"><div class="centered-container" ng-intro-options="IntroOptions" ng-intro-method="DoIntro" ng-intro-oncomplete="CompletedEvent" ng-intro-onexit="ExitEvent" ng-intro-onchange="ChangeEvent" ng-intro-onbeforechange="BeforeChangeEvent" ng-intro-onafterchange="AfterChangeEvent" ng-intro-autostart="ShouldAutoStart"><div id="step1" class="row row-center"><div class="col col-10 collapse"></div><div class="col col-80 collapse"><!--   <img ng-src="{{image}}" class="splash-image"> --><div class="centered-container hero-container positive-bg" port-height="0.50"><h3 class="hero-welcome">Welcome {{user.name}}</h3><span class="hero" flash-weight="Revu.Me:Ready">Revu.Me</span> <button class="button button-calm tour-button" ng-click="tourService.start()">Take a Quick Tour</button></div></div><div class="col col-10 collapse"></div></div><div class="row row-center" ng-if="user.email==\'klynch@volerro.com\'"><div class="col col-10 collapse"></div><div class="col col-80 collapse"><div class="centered-container user_list"><ion-list><div id="step2" class="item item-divider">Users Online</div><ion-item class="item-icon-left" ng-repeat="user in users" ng-click="login()"><i class="icon ion-android-contact avatar_icon"></i><h2 ng-if="user.name != \'undefined undefined\'">{{user.name}}</h2></ion-item></ion-list></div></div><div class="col col-10 collapse"></div></div></div></ion-content><div class="bar bar-footer" ng-class="{\'bar-positive\':user.daysLeft>=14,\'bar-energized\':(user.daysLeft < 14 && user.daysLeft > 7), \'bar-assertive\':(user.daysLeft <= 7),\'bar-tall\':smallScreen()}" ng-if="user.script!=undefined && user.script.autoRenew == false"><div class="title">Your {{user.script.type}} Subsction has {{user.daysLeft}} days left</div><button class="button button-calm" ng-class="{\'bar-button-bottom\':smallScreen()}" ng-if="user.script.type!=\'Elite\' && user.daysLeft < 21">{{buyButton.text}}</button></div></ion-view>'),$templateCache.put("templates/splashModal.html",'<ion-modal-view><div class="centered-container hero-container positive-bg" style="width:100%" elem-height="1.0"><h3 class="hero-welcome" style="padding-top:20%">Welcome {{user.name}}</h3><span class="hero" flash-weight="Revu.Me:Ready">Revu.Me</span></div></ion-modal-view>'),$templateCache.put("templates/summaryConfirm.html",'<ion-modal-view ng-controller="summaryCtrl"><ion-header-bar class="bar-dark"><h1 class="title">Review &amp; Confirm</h1><div class="buttons"><button class="button button-clear button-light" ng-click="cancel()">Close</button></div></ion-header-bar><ion-content class="ionic-modal-hack"><div class="revu-list-header positive-bg"><button class="button button-icon icon ion-minus-circled revu-list-button revu-left" ng-click="toggleListDelete()"></button> Add or Remove Decks <button class="button button-icon icon ion-plus-circled revu-list-button revu-right" ng-click="showDecks()"></button></div><form name="session.inputForm"><ion-list show-delete="session.shouldShowDelete"><ion-item ng-repeat="deck in session.decks" class="item item-thumbnail-left"><ion-delete-button class="ion-minus-circled" ng-click="delDeck($index)"></ion-delete-button><img class="thumb-small" ng-src="{{deck.thumb}}" alt="New" class="alt"><h2>{{deck.name}}</h2><p>{{deck.user.firstName}} {{deck.user.lastName}}</p><p>{{deck.createdDate | date:"MM/dd/yyyy h:mma"}}</p></ion-item></ion-list><label class="item item-input"><span class="input-label">Name</span> <input type="text" ng-model="session.name" placeholder="Meeting Name" required></label><label class="item item-input"><span class="input-label">Description</span> <input type="text" ng-model="session.description" placeholder="Description"></label><label class="item item-input" ng-if="screenSize().width<=900"><span class="input-label">Date</span><ionic-datepicker input-obj="datepickerObject"><button class="button button-clear button-positive" style="min-height:30px;line-height:30px;color:black">{{datepickerObject.inputDate | date:\'MM/dd/yyyy\'}}</button></ionic-datepicker></label><div class="row" ng-if="screenSize().width<=900"><div class="col col-50"><label class="item item-input"><span class="input-label">Time</span><ionic-timepicker input-obj="timePickerObject"><button class="button button-clear button-positive overflowShow" style="min-height:30px;line-height:30px;color:black;font-weight:normal"><standard-time-meridian etime="timePickerObject.inputEpochTime"></standard-time-meridian></button></ionic-timepicker></label></div><div class="col col-50"><label class="item item-input"><span class="input-label">length</span><select ng-model="session.length"><option ng-repeat="l in session.lengthOptions">{{l}}</option></select></label></div></div><div class="row" ng-if="screenSize().width>900"><div class="col col-33"><label class="item item-input"><span class="input-label">Date</span><ionic-datepicker input-obj="datepickerObject"><button class="button button-clear button-positive" style="min-height:30px;line-height:30px;color:black">{{datepickerObject.inputDate | date:\'MM/dd/yyyy\'}}</button></ionic-datepicker></label></div><div class="col col-33"><label class="item item-input"><span class="input-label">Time</span><ionic-timepicker input-obj="timePickerObject"><button class="button button-clear button-positive overflowShow" style="min-height:30px;line-height:30px;color:black;font-weight:normal"><standard-time-meridian etime="timePickerObject.inputEpochTime"></standard-time-meridian></button></ionic-timepicker></label></div><div class="col col-33"><label class="item item-input"><span class="input-label">Length</span><select ng-model="session.length"><option ng-repeat="l in session.lengthOptions">{{l}}</option></select></label></div></div><div class="list"><div class="item item-input-inset"><label class="item-input-wrapper"><input type="text" name="aName" user-complete field-type="name" instance-name="session" ng-model="session.formname" placeholder="Attendee Name"></label><label class="item-input-wrapper"><input type="email" name="aEmail" user-complete field-type="email" instance-name="session" ng-model="session.formemail" placeholder="Attendee Email"></label><button class="button button-small" ng-click="addAttendee()" ng-disabled="!session.inputForm.aName.$dirty || !session.inputForm.aEmail.$dirty \n                                         || session.inputForm.aEmail.$invalid">add</button></div><div class="item item-divider item-button-right">Attendees <button class="button button-small button-positive divider-button two-buttons" ng-click="session.showTeams=!session.showTeams" style="right:100px !important">Add Teams</button> <button class="button button-small button-positive divider-button" ng-click="showSalesforce();" ng-controller="sfdcCtrl">Salesforce</button></div><div class="item item-button-right" ng-if="session.showTeams && session.teamList.length > 0" style="padding:0px"><label class="item-input"><span class="input-label" style="width:20%">Teams</span><select ng-model="session.team" ng-options="t.name for t in session.teamList"></select></label><button class="button button-small shove-right" ng-click="addTeam()" style="font-size:14px">add</button></div><div class="list"><div ng-repeat="attendee in session.attendees" class="item item-icon-left"><i class="icon ion-minus-circled" style="font-size:95%" ng-click="delAttendee($index)"><p class="padding-left">{{session.attendees[$index].name}} {{session.attendees[$index].email}}</p></i></div></div><div class="item item-checkbox"><label class="checkbox"><input ng-model="session.bridge" type="checkbox"></label>conference bridge</div></div></form></ion-content><ion-footer-bar class="bar-positive"><div class="centered-container"><button class="button button-calm" ng-click="confirm()" ng-disabled="session.inputForm.$invalid || wizardStep.valid != true ">OK</button> <button class="button padding-left button-assertive" ng-click="cancel()">Cancel</button><div class="centered-container" style="padding-bottom:30px"><p ng-show="session.inputForm.sName.$invalid">Session Name is Required</p><p ng-show="session.inputForm.date.$invalid">Session Date is Required</p><p ng-show="session.inputForm.time.$invalid">Session Time is Required</p></div></div></ion-footer-bar></ion-modal-view>'),$templateCache.put("templates/systemMonitor.html",'<ion-view title="System Monitor"><ion-content><div class="centered-container dashboard-container"><div class="button-bar" style="margin-top:15px"><a ng-repeat="button in navButtons.buttons" ng-click="navButtons.click($index)" ng-class="button.clicked?navButtons.clickedClass:navButtons.class">{{button.name}}</a></div><div ng-if="navButtons.buttons[navButtons.nowButton].clicked"><div class="row responsive-sm"><div class="col"><h2 class="positive">Users Online Now</h2></div></div><div class="row responsive-md"><div class="col col-50"><h3>Users Online</h3><div style="position:relative"><h2 class="doughnut-center no-legend" ng-click="goMeetings()">{{uChart.guage.center}}</h2><canvas class="chart chart-doughnut" chart-data="uChart.guage.data" chart-labels="uChart.guage.labels" chart-colours="uChart.guage.colors" chart-options="uChart.guage.options" chart-legend="false"></canvas></div></div><div class="col col-50"><h3>User Timeline</h3><canvas class="chart chart-bar" chart-data="uChart.timeline.data" chart-labels="uChart.timeline.labels" chart-series="uChart.timeline.series" chart-colours="uChart.timeline.colors" chart-legend="false" chart-options="uChart.timeline.options"></canvas></div></div><div style="margin-top:30px"><ion-list><div class="item item-divider item-positive">Users Online</div><ion-item class="item-icon-left" style="text-align:left" ng-repeat="user in users" ng-click="showHistory($index)"><i class="icon ion-android-contact positive"></i><h2 ng-if="user.name != \'undefined undefined\'">{{user.userName}}</h2><p>Total Time: {{user.totalTime | handyTime}}</p><p>Current State: {{user.history[0].toState}}</p><ion_list ng-if="user.showHistory"><ion-item style="test-align:left" ng-repeat="item in user.history"><p><span class="balanced">{{item.date | date:\'h:mm a\'}}</span> &nbsp {{item.fromState}} -> {{item.toState}}</p><p><span class="dark">Time: {{item.elapsed | handyTime}}</span></p></ion-item></ion_list></ion-item></ion-list></div></div><div ng-if="navButtons.buttons[navButtons.trendsButton].clicked"><div class="row responsive-sm"><div class="col"><h2 class="positive">Week and Month Trends</h2></div></div><div class="row responsive-md"><div class="col col-50"><h3>This Week</h3><div style="position:relative"><canvas class="chart chart-bar" chart-data="trendChart.week.data" chart-labels="trendChart.week.labels" chart-series="trendChart.week.series" chart-colours="trendChart.week.colors" chart-legend="false" chart-options="trendChart.week.options"></canvas></div></div><div class="col col-50"><h3>Past Month</h3><canvas class="chart chart-line" chart-data="trendChart.month.data" chart-labels="trendChart.month.labels" chart-series="trendChart.month.series" chart-colours="trendChart.month.colors" chart-legend="false" chart-options="trendChart.month.options"></canvas></div></div><div style="margin-top:30px"><ion-list ng-repeat="day in trends.byDay"><div class="item item-divider item-positive">{{day.date | date : \'MMM dd yyyy\'}}</div><div class="list" ng-repeat="item in day.userData" style="margin-bottom:0px"><div class="item item-divider item-calm item-icon-left"><i class="icon ion-android-contact" style="color:white"></i> {{item.user.firstName}}&nbsp{{item.user.lastName}}</div><div class="item item-divider" style="background-color:#EDEDED" ng-click="toggleUserData($parent.$index,$index)">Total Time: {{item.visitTime | handyTime}}</div><div class="item" style="text-align:left" ng-repeat="visit in item.data" ng-if="item.show == true"><div class="item-percent-bar" style="width:{{(visit.elapsed/item.visitTime)*100}}%"></div><h2>{{visit.fromState}} -> {{visit.toState}}</h2><p>Total Time: {{visit.elapsed | handyTime}}</p></div></div></ion-list></div></div></div></ion-content></ion-view>'),$templateCache.put("templates/team.html",'<ion-view title="{{teamName}}"><ion-nav-buttons side="right"><button class="button button-balanced" ng-disabled="teamForm.teamName.$invalid || (addTeam.members.length == 0) || !_$Save" ng-click="modalCallback()">Save</button></ion-nav-buttons><div class="bar bar-header item-input-inset"><label class="item-input-wrapper"><i class="icon ion-ios-search placeholder-icon"></i> <input type="search" placeholder="Search"></label></div><ion-content class="has-header"><form name="forms.teamForm"><label class="item item-input"><span class="input-label">Team Name</span> <input name="teamName" type="text" ng-model="addTeam.name" required></label><div class="list"><div class="item item-toggle">Comma Delimited Input<label class="toggle toggle-positive"><input type="checkbox" ng-model="commaDelimited"><div class="track"><div class="handle"></div></div></label></div><div ng-show="!commaDelimited"><div class="item item-input-inset"><label class="item-input-wrapper"><input type="text" name="mName" ng-model="addTeam.nameString" placeholder="Member Name" user-complete field-type="name" instance-name="team"></label><label class="item-input-wrapper"><input type="email" name="mEmail" ng-model="addTeam.emailString" placeholder="Member Email" user-complete field-type="email" instance-name="team"></label><button class="button button-small" ng-click="addMember()" ng-disabled="teamForm.mEmail.$invalid || teamForm.mName.$invalid || !_$AddMember">add</button></div></div><div ng-show="commaDelimited"><label class="item item-input item-stacked-label"><span class="input-label">Add Members:(pattern:first,last,email;)</span><textarea class="team-textarea" name="members" ng-model="addTeam.memberString" style="width:97%" elem-height="0.185" wrap="hard">\n                        </textarea></label></div></div></form><div class="revu-list-header positive-bg"><button class="button button-icon icon ion-minus-circled revu-list-button revu-left" ng-click="toggleListDelete(\'member\')" ng-disabled="!_$DeleteMember"></button> Members</div><ion-scroll elem-height="0.80"><ion-refresher pulling-text="Pull to refresh..." on-refresh="doRefresh()"></ion-refresher><ion-list show-delete="shouldShowDelete" delegate-handle="member"><ion-item ng-repeat="member in addTeam.members"><ion-delete-button class="ion-minus-circled" ng-click="delMember($index)"></ion-delete-button><div class="item item-input item-select" style="border-style:none"><div class="input label"><h2>{{member.firstName}} {{member.lastName}}</h2><p>email: {{member.email}}</p></div><select ng-model="member.role" ng-options="permission.name for permission in permissions" ng-disabled="!_$ChangeRole" ng-change="setDirty()"></select></div></ion-item></ion-list></ion-scroll></ion-content></ion-view>'),$templateCache.put("templates/teams.html",'<ion-view title=""><ion-content class="has-header"><div class="revu-list-header positive-bg"><button class="button button-icon icon ion-minus-circled revu-list-button revu-left" ng-click="toggleListDelete(\'team\')"></button> Your Teams <button class="button button-icon icon ion-plus-circled revu-list-button revu-right" ng-click="newTeam()"></button></div><ion-scroll elem-height="0.80"><ion-refresher pulling-text="Pull to refresh..." on-refresh="doRefresh()"></ion-refresher><ion-list show-delete="shouldShowDelete" delegate-handle="team"><ion-item class="item-button-right" ng-repeat="team in teams" ng-click="editTeam($index)"><ion-delete-button class="ion-minus-circled" ng-click="delTeam($index,$event); $event.stopPropogation();"></ion-delete-button><h2>{{team.name}}</h2><p>Total Members: {{team.members.length}}</p><p>{{team.previewString}}</p></ion-item></ion-list></ion-scroll></ion-content></ion-view>'),
$templateCache.put("templates/tour-template.html",'<div ng-class="step.position.class"><div class="tour-tip"><p ng-bind-html="step.text"></p></div><div class="tour-tip-buttons dark-bg"><a class="button button-clear button-small" ng-click="tourService.end()">End Tour</a><div class="tour-tip-controls"><a class="button button-clear button-small" ng-click="tourService.previous($event)">Previous</a> <a class="button button-clear button-small" ng-click="tourService.next($event)">Next</a></div></div></div>'),$templateCache.put("templates/userAdmin.html",'<ion-view title="User Admin"><ion-content><ion-scroll elem-height="0.95"><ion-refresher pulling-text="Pull to refresh..." on-refresh="doRefresh()"></ion-refresher><ion-list><ion-item ng-repeat="user in revume.allUsers"><div class="item item-input item-select" style="border-style:none"><div class="input label"><h2>{{user.firstName}} {{user.lastName}}</h2><p>email: {{user.email}}</p><p>Expires: {{user.script.expirationDate | date: \'mediumDate\'}}</p><p>AutoRenew: {{user.script.autoRenew}}</p></div><select ng-model="user.script.type" ng-options="script for script in revume.scriptTypes" ng-change="updateScript($index)"></select></div></ion-item></ion-list></ion-scroll></ion-content></ion-view>'),$templateCache.put("templates/users.html",'<ion-view title="Presentations"><ion-nav-buttons side="left"><button menu-toggle="left" class="button button-icon icon ion-navicon"></button></ion-nav-buttons><ion-content class="has-header"><ion-list><ion-item ng-repeat="deck in presentationList()" ng-click="setSelected($index)">{{deck.name}}</ion-item></ion-list></ion-content></ion-view>'),$templateCache.put("templates/viewer.html",'<ion-view view-title="{{name}}"><ion-nav-buttons side="right"><button class="button icon ion-ios-telephone" ng-click="bridgeService.showBridgeInfo()"></button></ion-nav-buttons><ion-content class="has-header presentation-background" scroll="false" id="viewer" fullscreen><div class="centered-container slide" ng-if="!screenSharing.visible" ng-class="{\'vert-center\':screenSize().width < screenSize().height}" elem-size controls="false"><!--            <div class="row">\n                <div class="col col-10">\n                </div>\n\n                <div class="col col-80" >\n--><ion-slide-box disable-scroll="true" class="bordered-drop-shadow" show-pager="false"><ion-slide ng-repeat="slide in presentation.slides"><div ng-switch on="slide.type"><div ng-switch-when="img"><ion-scroll direction="xy" scrollbar-x="false" scrollbar-y="false" zooming="true" min-zoom="1.0" style="width: 100%; height: 100%"><img ng-src="{{slide.src}}" class="slide-content"></ion-scroll></div><div ng-switch-when="video"><video class="slide-content" controls="controls" v-source="{{slide.src}}" v-follow="{{$index}}"></video></div></div></ion-slide></ion-slide-box><div class="presence-message dark-bg" appear-up="show_message">""</div></div><div ng-if="screenSharing.visible"><iframe ng-src="{{screenSharing.url}}" elem-height="0.95" style="width:100%"></iframe></div><!--                </div>\n\n                <div class="col col-10 ">\n                </div>  \n--></ion-content></ion-view>'),$templateCache.put("templates/welcomeTemplate.html",'<ion-modal-view><ion-content><div class="centered-container hero-container positive-bg" style="margin-top:20px" elem-height="0.50"><h3 class="hero-welcome">Welcome {{user.name}}</h3><span class="hero">Revu.me</span></div></ion-content></ion-modal-view>'),$templateCache.put("templates/wizard.html",'<ion-modal-view view-title="{{::wizard.name}}" ng-controller="wizardCtrl"><ion-content scroll="false" ng-show="!wizard.showSummary" ng-cloak><div class="wizard-container"><div class="wizard-top dark-bg"><div class="centered-container dark-bg" style="padding-top:10px"><h3 style="color:white">{{::wizard.name}}</h3><div class="text-center wizard-legend"><div class="centered-container" style="width:320px"><a ng-repeat="step in wizard.steps" ng-if="step.showInLegend == true" ng-click="wizard.setStep($index)"><span ng-class="wizard.current == $index ? \'calm-bg selected\' : \'not-selected\'">{{$index+1}}</span> {{::step.heading}}</a></div></div></div></div><div class="wizard-main positive-bg ParentMarker"><div class="centered-container" style="width:100%"><ion-slide-box disable-scroll="false" show-pager="false" style="position:relative" on-slide-changed="wizard.setStep(index)"><ion-slide ng-repeat="step in wizard.steps" class="positive-bg"><div class="centered-container" ng-if="step.type == \'pane\'"><ng-include src="step.template"></ng-include></div></ion-slide></ion-slide-box></div></div></div></ion-content><ion-footer-bar class="bar-positive"><div class="centered-container"><button class="button button-dark" ng-click="wizard.prevStep()" ng-disabled="wizard.current <= 0">Previous</button> <button class="button button-calm" ng-if="!wizard.showSummary" ng-click="wizard.nextStep()" ng-disabled="wizard.current>= wizard.steps.length || wizard.steps[wizard.current].valid==false">Next</button> <button class="button button-calm" ng-if="wizard.showSummary" ng-click="wizard.complete()">Submit</button></div><button class="button button-assertive pull-right" ng-click="wizard.cancel()">Cancel</button></ion-footer-bar></ion-modal-view>')}]),angular.module("RevuMe").factory("Auth",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/users/auth/:email";return $resource(target,{email:"@email"},{auth:{method:"PUT",params:{email:"@email"}}})}]).factory("Base64",[function(){var keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(input){var chr1,chr2,enc1,enc2,enc3,output="",chr3="",enc4="",i=0;do chr1=input.charCodeAt(i++),chr2=input.charCodeAt(i++),chr3=input.charCodeAt(i++),enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="";while(i<input.length);return output},decode:function(input){var chr1,chr2,enc1,enc2,enc3,output="",chr3="",enc4="",i=0,base64test=/[^A-Za-z0-9\+\/\=]/g;base64test.exec(input)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");do enc1=keyStr.indexOf(input.charAt(i++)),enc2=keyStr.indexOf(input.charAt(i++)),enc3=keyStr.indexOf(input.charAt(i++)),enc4=keyStr.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(15&enc2)<<4|enc3>>2,chr3=(3&enc3)<<6|enc4,output+=String.fromCharCode(chr1),64!=enc3&&(output+=String.fromCharCode(chr2)),64!=enc4&&(output+=String.fromCharCode(chr3)),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="";while(i<input.length);return output}}}]).service("authService",["Auth","Users","pnFactory","$q","$ionicPopup","$rootScope","Base64","$location","$cookieStore","$state","ScriptService",function(Auth,Users,pnFactory,$q,$ionicPopup,$rootScope,Base64,$location,$cookieStore,$state,ScriptService){function isPrivate(state){var isPrivate=!0;return $rootScope.user.batman?isPrivate=!1:publicStates.forEach(function(publicState){state.name==publicState&&(isPrivate=!1)}),isPrivate}var $=this;$.user=Users,$.signinPopup=void 0,$.checkExists=function(email){var defer=$q.defer();return $.user.byEmail.get({email:email}).$promise.then(function(user){defer.resolve(user)})["catch"](function(err){defer.reject(err)}),defer.promise},$.signUp=function(newUser){var defer=$q.defer(),usr=new $.user.byId;return angular.extend(usr,newUser),usr.password=Base64.encode(usr.email+":"+usr.password),usr.$save().then(function(u){defer.resolve(u)})["catch"](function(err){defer.reject(err)}),defer.promise},$.resetPassword=function(credentials){var defer=$q.defer(),authData=Base64.encode(credentials.email+":"+credentials.password);credentials.password=authData;var oldAuthData=Base64.encode(credentials.email+":"+credentials.oldPassword);return credentials.oldPassword=oldAuthData,$.user.byEmail.update({email:credentials.email},credentials).$promise.then(function(response){defer.resolve(response)}),defer.promise},$.authenticate=function(credentials){var defer=$q.defer(),authData=Base64.encode(credentials.email+":"+credentials.password);return credentials.password=authData,Auth.auth({email:credentials.email},credentials).$promise.then(function(result){defer.resolve(result)})["catch"](function(err){defer.reject(err)}),defer.promise},$.signIn=function(){var defer=$q.defer();return $rootScope.user={},$rootScope.user.message="",$.signinPopup=$ionicPopup.show({templateUrl:"templates/signinTemplate.html",title:"Sign In",scope:$rootScope,buttons:[{text:"<b>Sign In</b>",type:"button-positive",onTap:function(e){if(!$rootScope.user.resetPassword&&$rootScope.user.email&&$rootScope.user.password)return $rootScope.user.email.replace(/ /g,""),$rootScope.user.password.replace(/ /g,""),$rootScope.user;if($rootScope.user.resetPassword){if($rootScope.user.email)return $rootScope.user.message="",$rootScope.user.email.replace(/ /g,""),$rootScope.user;$rootScope.user.message="Please Enter Your Email!",e.preventDefault()}else e.preventDefault()}}]}),$.signinPopup.then(function(user){if($.signinPopup=void 0,void 0!=$rootScope.user.network){var result={success:!0};defer.resolve(result)}else if(void 0==user)defer.resolve({success:!1,reason:"authentication failed"});else if(user.resetPassword){var result={success:!1,reason:"resetPassword",user:user};defer.resolve(result)}else{var credentials={};credentials.email=user.email,credentials.password=user.password,$.authenticate(credentials).then(function(result){if(result.success)result.user.authData=result.user.password,defer.resolve(result);else{var alert=$ionicPopup.alert({title:"Authentication Failed",template:result.reason});alert.then(function(){var result={success:!1,reason:"authentication failed"};defer.resolve(result)})}})}}),defer.promise},$.hideSignup=function(network){$rootScope.user.network=network,void 0!=$.signinPopup&&($.signinPopup.close(),$.signinPopup=void 0)};var publicStates=["app.signup","app.changePassword","app.confirmEmail","app.myAccount","app.settings","app.batman"];$.randomKey=function(length){for(var text="",possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;length>i;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text},$.forceCredentials=function(successState){$.signIn().then(function(result){if(result.success)void 0==$rootScope.user.network&&$rootScope.userInit(result.user).then(function(){ScriptService.checkScript($rootScope.user.script),void 0!=successState&&$state.go(successState)});else if("resetPassword"==result.reason){if(result.user&&result.user.email){var User=$.user.pwReset,credentials={};credentials.email=result.user.email,credentials.pw=$.randomKey(6),credentials.authData=Base64.encode(credentials.email+":"+credentials.pw),User.reset({email:result.user.email},credentials).$promise.then(function(){var alert=$ionicPopup.alert({title:"Password Reset",template:"A New Password was Emailed to: "+result.user.email});alert.then(function(){$.forceCredentials(successState)})})}}else $.forceCredentials(successState)})},$.listen=function(event,toState){if($rootScope.deepLink=!1,isPrivate(toState)){var param=$location.search();if(void 0!=param.uid){$rootScope.deepLink=!0;var User=$.user.byId;User.get({id:param.uid}).$promise.then(function(user){$rootScope.user={},$rootScope.userInit(user)})}else if($rootScope.user._id)$rootScope.user.script&&ScriptService.checkScript($rootScope.user.script,event);else if($rootScope.isMobile){var lsUser=$rootScope.getLocalUser();if(void 0!=lsUser){var User=$.user.byId;User.get({id:lsUser._id}).$promise.then(function(user){return $rootScope.user={},$rootScope.userInit(user)}).then(function(){ScriptService.checkScript($rootScope.user.script,event)})}}else if(void 0!=$cookieStore.get("user")){var cookieUser=$cookieStore.get("user"),User=$.user.byId;User.get({id:cookieUser._id}).$promise.then(function(user){return $rootScope.user={},$rootScope.userInit(user)}).then(function(){ScriptService.checkScript($rootScope.user.script,event)})}else(void 0==$rootScope.user||void 0==$rootScope.user._id)&&($rootScope.deepLink=!1,$.forceCredentials())}else if(void 0==$rootScope.user._id){var lsUser=$rootScope.getLocalUser();if(void 0!=lsUser){var User=$.user.byId;User.get({id:lsUser._id}).$promise.then(function(user){$rootScope.user={},$rootScope.userInit(user),"app.signup"==toState.name&&$state.go("app.welcome")})}else{var cookieUser=$cookieStore.get("user");if(void 0!=cookieUser){var User=$.user.byId;User.get({id:cookieUser._id}).$promise.then(function(user){$rootScope.user={},$rootScope.userInit(user),"app.signup"==toState.name&&$state.go("app.welcome")})}}}}}]),angular.module("RevuMe").service("Braintree",["$rootScope","ScriptService","$http","baseUrl","$q",function($rootScope,ScriptService,$http,baseUrl,$q){var $=this;$.planData=void 0,$.basePath=baseUrl.endpoint+"/api/braintree/",$.init=function($scope,pmrCallback){var deferred=$q.defer();return $.scope=$scope,$.payCallCount=0,$.scope.error={},$.callback=pmrCallback||function(){},$.getPlansAndAddons().then(function(result){$.planData=result.data,deferred.resolve()}),deferred.promise},$.getPlansAndAddons=function(){var deferred=$q.defer(),endpoint=$.basePath+"plans";return $http.get(endpoint).then(function(result){deferred.resolve(result)}),deferred.promise},$.getPlan=function(name){var plan=void 0,plans=$.planData.plans;return plans.forEach(function(p){p.name==name&&(plan=p)}),plan},$.getAddOn=function(name){var addOn=void 0,addOns=$.planData.addOns;return addOns.forEach(function(a){a.name==name&&(addOn=a)}),addOn},$.getDiscount=function(name){var discount=void 0,discounts=$.planData.discounts;return discounts.forEach(function(d){d.name==name&&(discount=d)}),discount},$.createCustomer=function(payload){var deferred=$q.defer(),script=$.scope.script,endpoint=$.basePath+"customer",admin=ScriptService.getAdmin(script),customer={firstName:admin.firstName,lastName:admin.lastName,email:admin.email,nonce:payload.nonce};return $http.post(endpoint,customer).then(function(response){var result=response.data;result.success?($.scope.script.customerId=result.customer.id,$.scope.token=result.customer.paymentMethods[0].token,deferred.resolve(result)):deferred.reject(result)}),deferred.promise},$.deleteCustomer=function(customerId){var deferred=$q.defer(),endpoint=$.basePath+"customer/delete",params={id:customerId};return $http.post(endpoint,params).then(function(response){var result=response.data;result.success?deferred.resolve(result):deferred.reject(result)}),deferred.promise},$.createScript=function(script){var deferred=$q.defer(),token=$.scope.token,endpoint=$.basePath+"subscription",plan=void 0,addOn=$.getAddOn("RevuMe Seat Full Price"),discount=$.getDiscount("RevuMe L1 Seat Discount"),annualDiscount=$.getDiscount("RevuMe Annual Discount"),aoQuantity=script.totalSeats-1;if("Monthly"==script.type)plan=$.getPlan("RevuMe Monthly AutoRenew");else{plan=$.getPlan("RevuMe Annually AutoRenew");var applyAnnual=annualDiscount}if(addOn=$.getAddOn("RevuMe Seat Full Price"),discount=$.getDiscount("RevuMe L1 Seat Discount"),plan&&addOn&&discount){var params={token:token,plan:plan.id,addOn:{id:addOn.id,quantity:aoQuantity},discount:{id:discount.id,quantity:0},annualDiscount:{id:void 0,quantity:1}};void 0!=applyAnnual&&(params.annualDiscount.id=applyAnnual.id),0==aoQuantity&&(params.addOn.id=void 0),script.totalSeats>=discount["break"]?params.discount.quantity=script.totalSeats:params.discount.id=void 0,$http.post(endpoint,params).then(function(response){var result=response.data;result.success?deferred.resolve(result.subscription.id):deferred.reject(result)})}else deferred.reject("CreateScript: Undefined plan elements");return deferred.promise},$.cancel=function(script){var deferred=$q.defer(),endpoint=$.basePath+"subscription/cancel",params={id:script.braintreeId};return void 0!=script.braintreeId?($http.post(endpoint,params).then(function(response){var result=response.data;try{var code=result.errors.errorCollections.subscription.validationErrors.status[0].code;"81905"==code&&(result.success=!0)}catch(err){console.log("some other error")}result.success?deferred.resolve(result):deferred.reject(result)}),deferred.promise):void deferred.resolve()},$.upgradeToAnnual=function(script){var deferred=$q.defer();$.basePath+"subscription",{id:script.braintreeId};return $.cancel(script).then(function(result){result.success?$.createScript(script).then(function(btId){return script.braintreeId=btId,$.updateScript(script)}).then(function(result){var result={success:!0};result.subscription={id:script.braintreeId},deferred.resolve(result)}):deferred.reject(result)}),deferred.promise},$.isAnnualPlan=function(script){var deferred=$q.defer();return $.findSubscription(script).then(function(btScript){btScript.planId==$.getPlan("RevuMe Annually AutoRenew").id?deferred.resolve(!0):deferred.resolve(!1)}),deferred.promise},$.updateBTScript=function(script){var deferred=$q.defer(),endpoint=$.basePath+"subscription",plan=void 0,addOn=$.getAddOn("RevuMe Seat Full Price"),discount=$.getDiscount("RevuMe L1 Seat Discount"),aoQuantity=script.totalSeats-1,dcQuantity=0,monthlyAutoRenew=$.getPlan("RevuMe Monthly AutoRenew"),annuallyAutoRenew=$.getPlan("RevuMe Annually AutoRenew"),done=!1;return $.findSubscription(script).then(function(btScript){if("Annually"==script.type?(btScript.planId==monthlyAutoRenew.id&&(done=!0,$.getToken(script).then(function(token){return $.scope.token=token,$.upgradeToAnnual(script)}).then(function(result){deferred.resolve(result)})),plan=annuallyAutoRenew):btScript.planId==annuallyAutoRenew.id?(plan=annuallyAutoRenew,script.autoRenew=!1):plan=monthlyAutoRenew,plan&&addOn&&discount&&!done){var params={id:script.braintreeId,plan:plan.id,addOn:{id:addOn.id,quantity:aoQuantity},discount:{id:discount.id,quantity:dcQuantity}};script.totalSeats>=discount["break"]?dcQuantity=script.totalSeats:params.discount.id=void 0,0==aoQuantity&&(params.addOn.id=void 0),void 0!=script.newToken&&(params.newToken=script.newToken),1==btScript.neverExpires&&0==script.autoRenew?(params.numberOfBillingCycles=btScript.currentBillingCycle,params.neverExpires=!1):0==btScript.neverExpires&&1==script.autoRenew&&(params.neverExpires=!0),$http.put(endpoint,params).then(function(response){var result=response.data;result.success?deferred.resolve(result.subscription.id):deferred.reject(result)})}}),deferred.promise},$.createToken=function(script,nonce){var deferred=$q.defer(),endpoint=$.basePath+"paymentMethod",params={customerId:script.customerId,nonce:nonce};return $http.post(endpoint,params).then(function(response){var result=response.data;result.success?deferred.resolve(result):deferred.reject(result)}),deferred.promise},$.findCustomer=function(script){var deferred=$q.defer(),endpoint=$.basePath+"customer";return $http.get(endpoint,{params:{id:script.customerId}}).then(function(response){var customer=response.data;void 0!=customer.id?deferred.resolve(customer):deferred.reject(response)}),deferred.promise},$.getToken=function(script){var deferred=$q.defer(),paymentMethod=void 0;return $.findCustomer(script).then(function(customer){customer.paymentMethods.length>0?(customer.paymentMethods.forEach(function(method){method["default"]&&(paymentMethod=method)}),void 0!=paymentMethod?deferred.resolve(paymentMethod.token):deferred.reject("no default payment method")):deferred.reject("no payment methods for this customer")}),deferred.promise},$.newScriptNewCustomer=function(payload){var deferred=$q.defer();return $.createCustomer(payload).then(function(result){return console.log("new customer created"),$.createScript($.scope.script)}).then(function(braintreeId){return console.log("Script Created on Braintree"),$.scope.script.braintreeId=braintreeId,$.updateScript()}).then(function(){$rootScope.user.script=angular.copy($.scope.script),console.log("new script created"),deferred.resolve()})["catch"](function(result){result.errors&&(void 0!=$.scope.script.customerId&&$.deleteCustomer($.scope.script.customerId),$.scope.status.errors=result.errors,$.scope.status.errorMessage="Failed : "+result.message),deferred.reject(result)}),deferred.promise},$.newScriptExistingCustomer=function(script){var deferred=$q.defer();$.findCustomer(script).then(function(customer){return $.scope.token=customer.paymentMethods[0].token,$.createScript(script)}).then(function(braintreeId){return $.scope.script.braintreeId=braintreeId,$.updateScript()}).then(function(response){$rootScope.user.script=angular.copy($.scope.script),console.log("new script created"),deferred.resolve()})["catch"](function(response){result.errors&&(void 0!=$.scope.script.customerId&&$.deleteCustomer($.scope.script.customerId),$.scope.status.errors=result.errors,$.scope.status.errorMessage="Failed : "+result.message),deferred.reject(result)})},$.findSubscription=function(script){var deferred=$q.defer(),endpoint=$.basePath+"subscription";return $http.get(endpoint,{params:{id:script.braintreeId}}).then(function(response){var subscription=response.data;void 0!=subscription.id?deferred.resolve(subscription):deferred.reject(response)}),deferred.promise},$.updateScript=function(){var deferred=$q.defer(),script=$.scope.script,order=$.scope.order||{totalSeats:script.totalSeats,type:script.type};switch(script.startDate=new Date,script.expirationDate=new Date,script.autoRenew=!0,script.totalSeats=order.totalSeats,script.availableSeats=script.totalSeats-script.members.length,script.type=order.type,script.type){case"Monthly":var month=script.startDate.getMonth();month+=1,script.expirationDate.setMonth(month);break;case"Annually":var year=script.startDate.getFullYear();year+=1,script.expirationDate.setFullYear(year)}return ScriptService.update(script._id,script).then(function(){$rootScope.user.script=angular.copy($.scope.script),$.scope.$broadcast("show_message","Order Complete!"),deferred.resolve(script)}),deferred.promise},$.payMethReceived=function(payload){var script=$.scope.script;$.basePath+"customer";$.payCallCount++,console.log("PayMethRecieved - callCount = ",$.payCallCount),$.scope.token=void 0,$.scope.processCardDisabled=!0,$.scope.showCardEntry=!1,void 0==$.scope.status?$.scope.status={message:"Processing Payment...",errors:void 0}:($.scope.status.message="Processing Payment...",$.scope.status.errors=void 0),void 0==script.customerId?(console.log("calling newScriptNewCustomer"),$.newScriptNewCustomer(payload).then(function(){console.log("successfully added new customer/script"),$.callback()})):void 0==script.braintreeId&&(console.log("calling newScriptExistingCustomer"),$.newScriptExistingCustomer(script).then(function(){console.log("successfully added new script for the customer"),$.callback()}))},$.changeCard=function(payload){var script=$.scope.script,endpoint=$.basePath+"paymentMethod",oldToken=void 0;$.scope.showCardEntry=!1,$.scope.status.message="Updating Card...",$.getToken(script).then(function(token){oldToken=token,endpoint+="/change";var params={customerId:script.customerId,oldToken:oldToken,nonce:payload.nonce};return $http.post(endpoint,params)}).then(function(response){var result=response.data;return result.success?(script.newToken=result.creditCard.token,$.updateBTScript(script)):($.scope.status.errors=result.errors,void($.scope.status.errorMessage="Failed : "+result.message))}).then(function(){$.callback()})["catch"](function(err){console.log(err),$.scope.status.errors={},$.scope.status.errorMessage="Failed : "+err})}}]),angular.module("RevuMe").factory("Bridges",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/bridges/:id";return $resource(target,{id:"@id"})}]).service("BridgeService",["Bridges","$q","$ionicPopup","$rootScope",function(Bridges,$q,$ionicPopup,$rootScope){function buildTemplate(phone,confId,voip){var num="("+phone.slice(2,5)+") "+phone.slice(5,8)+"-"+phone.slice(8,12),dialIt=num+",,,"+confId+"#",template="<p><strong>Number:</strong></p>";return template+='<a href="tel:'+dialIt+'">'+num+"</a>",template+="<br><p><strong>ConfID:</strong></p><p>"+confId+"</p><br><p><strong>Voip:</strong></p><p>"+voip+"</p><br>"}var $=this;$.currentBridge={},$.activeBridge=function(){return void 0!=$.currentBridge.conferenceID?!0:!1},$.findBridge=function(id){var confId=id.replace(/-/g,"");Bridges.get({id:confId}).$promise.then(function(bridge){void 0!=bridge.conferenceID&&($.currentBridge=bridge)})},$.startBridge=function(id){var defer=$q.defer(),confId=id.replace(/-/g,"");return Bridges.save({confId:confId}).$promise.then(function(bridge){if($.currentBridge=bridge,!$rootScope.isMobile)return $.showBridgeInfo(bridge);var dialIt=bridge.tollNumber+",,,"+bridge.conferenceID;window.open("tel:"+dialIt,"_system"),defer.resolve()}).then(function(){defer.resolve()})["catch"](function(err){console.log("startBridge: ",err),defer.reject(err)}),defer.promise},$.showBridgeInfo=function(){var defer=$q.defer(),bridge=$.currentBridge;if(void 0!=bridge.conferenceID){var ph=(bridge.conferenceID.slice(0,3)+"-"+bridge.conferenceID.slice(3,6)+"-"+bridge.conferenceID.slice(6,9),bridge.tollNumber),num="("+ph.slice(2,5)+") "+ph.slice(5,8)+"-"+ph.slice(8,12),alertPopup=(num+",,,"+bridge.conferenceID+"#",$ionicPopup.alert({title:"Please Dial In",template:buildTemplate(bridge.tollNumber,bridge.conferenceID,bridge.sipURI)}));alertPopup.then(function(res){defer.resolve()})}return defer.promise},$.endBridge=function(id){var confId=id.replace(/-/g,"");Bridges["delete"]({id:confId}).$promise.then(function(){$.currentBridge={}})},$.endMeeting=function(){var m={action:"end"};$.currentChannel&&$.currentChannel.publish(m)},$.setChannel=function(channel){$.currentChannel=channel}}]),angular.module("RevuMe").factory("SendConfirm",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/confirm/email/:user";return $resource(target,{user:"@user"},{send:{method:"POST",params:{user:"@user"}}})}]).factory("DoConfirm",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/users/confirm/:id";return $resource(target,{id:"@id"},{confirm:{method:"PUT",params:{id:"@id"}}})}]),angular.module("RevuMe").factory("DashStats",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/dashboard/:type/:category";return $resource(target,{type:"@type",category:"@category"})}]).service("Dashboard",["DashStats","$rootScope","$q",function(DashStats,$rootScope,$q){var $=this;$.types=["stats"],$.categories=["files","meetings","views","engagement"],$.getFileStats=function(){var deferred=$q.defer(),type=$.types[0],category=$.categories[0];return DashStats.get({type:type,category:category,userId:$rootScope.user._id}).$promise.then(function(stats){deferred.resolve(stats)})["catch"](function(err){deferred.reject(err)}),deferred.promise},$.getMeetingStats=function(){var deferred=$q.defer(),type=$.types[0],category=$.categories[1];return DashStats.get({type:type,category:category,userId:$rootScope.user._id}).$promise.then(function(stats){deferred.resolve(stats)})["catch"](function(err){deferred.reject(err)}),deferred.promise},$.getRecentInteractions=function(){var deferred=$q.defer(),type=$.types[0],category=$.categories[2];return DashStats.get({type:type,category:category,userId:$rootScope.user._id}).$promise.then(function(interactions){deferred.resolve(interactions)})["catch"](function(err){deferred.reject(err)}),deferred.promise},$.getEngagment=function(){var deferred=$q.defer(),type=$.types[0],category=$.categories[3];return DashStats.get({type:type,category:category,userId:$rootScope.user._id}).$promise.then(function(engagement){deferred.resolve(engagement)})["catch"](function(err){deferred.reject(err)}),deferred.promise}}]),angular.module("RevuMe").service("introContent",["$rootScope","Session","Users","UploadedFiles","Decks","Teams","baseUrl","$q",function($rootScope,Session,Users,UploadedFiles,Decks,Teams,baseUrl,$q){function fixTime(session){console.log("offset before fix: ",session.time.getTimezoneOffset()),session.time.setDate(session.date.getDate()),session.time.setMonth(session.date.getMonth()),session.time.setFullYear(session.date.getFullYear()),session.offset=(new Date).getTimezoneOffset(),console.log("offset after fix: ",session.time.getTimezoneOffset())}var $=this;$.addFile=function(userId,superUser){var defer=$q.defer(),newFile=new UploadedFiles,introFile={};return UploadedFiles.query({user:superUser._id,name:"Getting Started.pptx"}).$promise.then(function(items){var refFile=items[0];return introFile=refFile,newFile.name=refFile.name,newFile.user={_id:userId},newFile.isArchived=!1,newFile.slides=[],newFile.thumb=refFile.thumb,newFile.$save()}).then(function(result){return newFile._id=result._id,introFile.slides.forEach(function(slide){newFile.slides.push(slide)}),UploadedFiles.update({id:newFile._id},newFile).$promise}).then(function(updated){defer.resolve(updated)}),defer.promise},$.addDeck=function(userId,superUser){var defer=$q.defer(),newDeck=new Decks,introDeck={};return UploadedFiles.query({user:superUser._id,name:"Getting Started.pptx"}).$promise.then(function(items){var file=items[0];return introDeck=file,newDeck.name=introDeck.name,newDeck.user={_id:userId},newDeck.isArchived=!1,newDeck.slides=[],newDeck.thumb=introDeck.thumb,newDeck.$save()}).then(function(result){return newDeck._id=result._id,introDeck.slides.forEach(function(slide){newDeck.slides.push(slide)}),Decks.update({id:newDeck._id},newDeck).$promise}).then(function(updated){defer.resolve(updated)}),defer.promise},$.addMeeting=function(userId,deckId){var defer=$q.defer(),tz=jstz.determine(),session=new Session;return session.decks=[],session.decks.push(deckId),session.timeZone=tz.name(),session.baseUrl=baseUrl.endpoint,session.date=new Date,session.time=session.date,session.time.setMilliseconds(0),session.time.setSeconds(0),session.bridge=!0,session.invite=!1,session.offset=(new Date).getTimezoneOffset(),session.showTeams=!1,session.length=30,session.name="Example Meeting",session.description="Show Meeting Features",session.attendees=[],session.attendees.push(userId),session.organizer=userId,fixTime(session),session.$save().then(function(){defer.resolve()})["catch"](function(err){defer.reject(err),console.log(err)}),defer.promise},$.addTeam=function(userId,deckId){var defer=$q.defer(),newTeam=new Teams,m={};return newTeam.name="Example Team",newTeam.members=[],newTeam.members.push({user:userId,role:"Admin"}),m.firstName="Jane",m.lastName="Doe",m.email="jdoe@volerro.com",m.role="Viewer",Users.byEmail.get({email:m.email}).$promise.then(function(user){newTeam.members.push({user:user._id,role:"Viewer"});var member={};return member.firstName="Fred",member.lastName="Smith",member.email="fsmith@volerro.com",member.role="Viewer",Users.byEmail.get({email:member.email}).$promise}).then(function(user){return newTeam.members.push({user:user._id,role:"Viewer"}),newTeam.$save()}).then(function(){defer.resolve()}),defer.promise},$.addIntroContent=function(userId){var defer=$q.defer(),superUser={};return Users.byEmail.get({email:"klynch@volerro.com"}).$promise.then(function(user){return superUser=user,$.addFile(userId,superUser)}).then(function(file){return $.addDeck(userId,superUser)}).then(function(deck){return $.addMeeting(userId,deck._id)}).then(function(){return $.addTeam(userId)}).then(function(){defer.resolve()})["catch"](function(err){console.log("addIntroContent: error: ",err)}),defer.promise}}]),angular.module("RevuMe").factory("Slides",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/library/slides/:slideId";return $resource(target)}]).factory("UploadedFiles",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/library/uploadedFiles/:id";return $resource(target,{id:"@id"},{"delete":{
method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}})}]).factory("Decks",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/library/decks/:id";return $resource(target,{id:"@id"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}})}]).factory("Categories",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/library/categories/:id";return $resource(target,{id:"@id"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}})}]).factory("Archiver",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/library/:modelName/setarchive/:id/:isArchived";return $resource(target,{modelName:"@modelName",id:"@id",isArchived:"@isArchived"},{update:{method:"PUT",params:{modelName:"@modelName",id:"@id",isArchived:"@isArchived"}}})}]).service("Library",["UploadedFiles","Decks","Categories","$q","$timeout","baseUrl","$resource","$rootScope","$ionicPopup","rightsManager","shareMediator","Archiver","pnFactory","Evaporate","onEvent",function(UploadedFiles,Decks,Categories,$q,$timeout,baseUrl,$resource,$rootScope,$ionicPopup,rightsManager,shareMediator,Archiver,pnFactory,Evaporate,onEvent){function uploadComplete(result){switch(result.event){case"end":$.uploadComplete(result),$.updateView(),$.$fire("uploadComplete");break;case"progress":$.uploadProgress(result);break;case"error":var alert=$ionicPopup.alert({title:"File Upload Fails",template:"message: "+result.error});alert.then(function(){$.uploadComplete(result),$.updateView(),$.$fire("uploadComplete")})}}function establishRights($scope){$.fileRights=rightsManager.register("files",$scope,$.actionList,$.files),$.deckRights=rightsManager.register("decks",$scope,$.actionList,$.decks),$.catRights=rightsManager.register("categories",$scope,$.actionList,$.categories),$.fileRights.setAll("Admin",!0),$.fileRights.setRight("Admin","Hide",!1),$.fileRights.setRight("Viewer","Share",!0),$.fileRights.setRight("Viewer","SlideShow",!0),$.catRights.setAll("Admin",!0),$.catRights.setRight("Admin","New Meeting",!1),$.catRights.setRight("Admin","Hide",!1),$.catRights.setRight("Viewer","Share",!0),$.deckRights.setAll("Admin",!0),$.deckRights.setRight("Admin","Hide",!1),$.deckRights.setRight("Viewer","Share",!0),$.deckRights.setRight("Viewer","SlideShow",!0)}function getExtention(f){return f.substr(f.lastIndexOf("."),f.length-1).toLowerCase()}function addActions($scope){var model=$scope.model,items=$scope.navItems,rights=rightsManager.findKey(model);items.forEach(function(item){var refActions=item.beingEdited?$scope.editActions:$scope.actions;item.actions=[];var idx=0;refActions.forEach(function(action){if(rights.getRight(item.role,action.name)){var newAction={};newAction.name=action.name,newAction["class"]=action["class"],newAction.callBack=action.callBack,newAction.idx=idx++,item.actions.push(newAction),rights.applyRights(item.role,item)}}),item.action={selected:item.actions[0]}})}function setEditStates($scope){for(var i=0;i<$scope.navItems.length;i++){var item=$scope.navItems[i];item.index=i,item.beingEdited=!1,$scope.isEditing&&$scope.model==collection.model&&collection.index==i&&(item.beingEdited=!0)}void 0==$scope.slides||$scope.slides.length<=0||$scope.slides.forEach(function(slide){$scope.navItems[$scope.selectedNavId].beingEdited?(slide.included=!0,slide.available=!1):(slide.included=!1,slide.available=!0,$scope.isEditing&&collection.instance.slides.forEach(function(s){s.link==slide._id&&(slide.included=!0)}))})}function indexOfFile(file){var idx=-1,i=0;return $.uploading.files.forEach(function(f){f.name==file.name&&(idx=i),i++}),idx}var $=this,collection={};$.files=UploadedFiles,$.files.modelName="files",$.decks=Decks,$.decks.modelName="decks",$.categories=Categories,$.categories.modelName="categories",$.uploading={files:[]},onEvent.attach($),$.channel=pnFactory.newChannel("library::fileEvents"),$rootScope.$on("Revu.Me:Ready",function(){$.channel.subscribe(uploadComplete)}),$.actionList=["Edit","New Meeting","Share","Hide","Archive","Delete","Reorder","SlideShow"],$.fileTypes=function(){var deferred=$q.defer(),target=baseUrl.endpoint+"/api/library/fileTypes",r=$resource(target);return r.query().$promise.then(function(types){$.validTypes=types,deferred.resolve(types)})["catch"](function(err){deferred.reject(err)}),deferred.promise},$.fileTypes(),$.init=function($scope){$.scope=$scope,$scope.navItems=[],$scope.slides=[],$scope.slideStates=[],$scope.isEditing=!1,$scope.editText="Edit",$scope.container={},collection.index=-1,$.scope.eva=Evaporate,void 0==$.fcEvent&&($.fcEvent=$.scope.eva.$on("fileComplete",function(file){$.scope.fullName=file.path_,console.log($.scope.fullName),file.spinner=!0,$.processUpload($.scope,file)})),void 0==$.fsEvent&&($.fsEvent=$.scope.eva.$on("fileSubmitted",function(file,length){var ext=getExtention(file.name);if($.validTypes.indexOf(ext)>=0)$.startUpload(file);else{var alert=$ionicPopup.alert({title:"Invalid File Type !",template:"valid types are: "+$.validTypes});alert.then(function(){})}})),establishRights($scope)},$.setModel=function($scope,model){$.model=model,$scope.model=model},$.cacheImages=function($scope){var deferred=$q.defer();$.cachedImages=[];var img={};return UploadedFiles.query({user:$rootScope.user._id,archiveOn:$rootScope.archiveOn()}).$promise.then(function(items){void 0!=items&&items.forEach(function(item){item.slides.forEach(function(slide){"img"==slide.type&&(img=new Image,img.src=slide.src=slide.src,$.cachedImages.push(img))})})}),shareMediator.getSharedForCache($.files).then(function(items){void 0!=items&&items.forEach(function(item){void 0!=item.item&&item.item.slides.forEach(function(slide){"img"==slide.type&&(img=new Image,img.src=slide.src=slide.src,$.cachedImages.push(img))})}),deferred.resolve(),console.log("Total Cached Images = ",$.cachedImages.length)}),deferred.promise},$.updateView=function(){var defer=$q.defer();return $rootScope.showLoading(),void 0!=$.scope.model?$.updateModel($.scope).then(function(){defer.resolve(),$rootScope.hideLoading(),$timeout(function(){$.scope.scrollDelegate.scrollTop()},0)})["catch"](function(err){defer.reject(err)}):$rootScope.hideLoading(),defer.promise},$.updateModel=function($scope){var deferred=$q.defer();return $.model!=$scope.model&&console.log("model error in Library service"),shareMediator.getItems($scope.model).then(function(items){$scope.selectedNavId=0,items.length>0?($scope.navItems=items,$scope.slides=$scope.navItems[$scope.selectedNavId].slides,setEditStates($scope),addActions($scope)):($scope.navItems=[],$scope.slides=[]),deferred.resolve($scope)})["catch"](function(err){deferred.reject(err)}),deferred.promise},$.updateSlides=function($scope){return $q(function(resolve,reject){$.model!=$scope.model&&console.log("model error in Library service"),$.model.get({id:$scope.navItems[$scope.selectedNavId]._id}).$promise.then(function(item){void 0!=item?($scope.slides=item.slides,$scope.navItems[$scope.selectedNavId].slides=item.slides,setEditStates($scope)):($scope.slides=[],$scope.navItems[$scope.selectedNavId].slides=[]),resolve($scope.slides)})["catch"](function(err){reject(err)})})},$.removeNavItem=function($scope,index){return $q(function(resolve,reject){var result=$scope.navItems.splice(index,1);if(result.length>0){var whichOne=result[0];void 0!=whichOne&&(console.log("removing item ,",index," item is ",whichOne),console.log(whichOne._id),$.model["delete"]({id:whichOne._id}).$promise.then(function(){resolve()})["catch"](function(err){reject(err)}))}else resolve()})},$.newDeckFromFile=function(navItem){var defer=$q.defer();return $.scope.addingTo=new $.decks,$.scope.addingTo.name=navItem.name,$.scope.addingTo.user={_id:$rootScope.user._id},$.scope.addingTo.slides=[],$.scope.addingTo.thumb="",$.scope.addingTo.isArchived=!1,$.newNavItem($.scope).then(function(result){return navItem.slides.forEach(function(slide){$.scope.addingTo.slides.push(slide)}),$.scope.addingTo.thumb=navItem.thumb,$.scope.addingTo.isArchived=!1,$.scope.addingTo._id=result._id,$.decks.update({id:$.scope.addingTo._id},$.scope.addingTo).$promise}).then(function(){defer.resolve($.scope.addingTo)}),defer.promise},$.newNavItem=function($scope){return $.model!=$scope.model&&console.log("model error in Library service"),$scope.addingTo.$save()},$.updateNavItem=function($scope){var defer=$q.defer();if(-1!=collection.index){var model=collection.model;model.update({id:collection.instance._id},collection.instance).$promise.then(function(){return model.get({id:collection.instance._id}).$promise}).then(function(item){$scope.navItems[$scope.selectedNavId].user=item.user,defer.resolve()})}else{var m=$scope.model,id=$scope.selectedNavId;m.update({id:$scope.navItems[id]._id},$scope.navItems[id]).$promise.then(function(){return m.get({id:$scope.navItems[id]._id}).$promise}).then(function(item){$scope.navItems[$scope.selectedNavId].user=item.user,defer.resolve()})}return defer.promise},$.openCollection=function($scope,$index){$scope.isEditing||($scope.selectedNavId=$index,$.updateSlides($scope).then(function(){$scope.isEditing=!0,$scope.editText="Done",collection.model=$scope.model,collection.index=$index,collection.instance=$scope.navItems[$index],$scope.navItems[$index].beingEdited=!0,setEditStates($scope),$timeout(function(){$scope.statesReady=!0},500)}))},$.closeCollection=function($scope,$index){$scope.isEditing&&$index==collection.index&&$scope.model==collection.model&&($scope.statesReady=!1,$scope.isEditing=!1,$scope.editText="Edit",$.updateNavItem($scope).then(function(){$scope.navItems[collection.index].beingEdited=!1,setEditStates($scope),collection.index=-1}))},$.doAdd=function($scope,$index){var target=collection.instance;target.slides.push($scope.slides[$index]);var length=target.slides.length;if(target.slides[length-1].originalOrder=length-1,target.slides[length-1].link=$scope.slides[$index]._id,$scope.slides[$index].included=!0,1==target.slides.length){var firstSlide=target.slides[0];switch(firstSlide.type){case"img":collection.instance.thumb=firstSlide.src;break;case"video":collection.instance.thumb=firstSlide.poster}}},$.addSlide=function($scope,$index){if($scope.isEditing)if($scope.slides[$index].included){var confirmPopup=$ionicPopup.confirm({title:"Add Duplicate Slide?",template:"Do you want to add this again?"});confirmPopup.then(function(res){res&&($.doAdd($scope,$index),$.updateNavItem($scope))})}else $.doAdd($scope,$index),$.updateNavItem($scope)},$.addAll=function($scope){if($scope.isEditing){for(var i=0;i<$scope.slides.length;i++)$scope.slides[i].included||$.doAdd($scope,i);$.updateNavItem($scope)}},$.deleteSlide=function($scope,$index){if($scope.isEditing){var target=collection.instance;if(target.slides.splice($index,1),0==$index)if(target.slides.length>=1){var firstSlide=target.slides[0];switch(firstSlide.type){case"img":collection.instance.thumb=firstSlide.src;break;case"video":collection.instance.thumb=firstSlide.poster}}else collection.instance.thumb="",$scope.navItems[$scope.selectedNavId].thumb="";$.updateNavItem($scope).then(function(){collection.instance.slides.length>0?$.updateSlides($scope):$.updateModel($scope)})}},$.setUserId=function(file_id){var defer=$q.defer(),target=baseUrl.endpoint+"/api/library/uploadedFiles/setuser/:id",r=$resource(target,{id:"@id"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}});return r.update({id:file_id},{id:$rootScope.user._id}).$promise.then(function(){defer.resolve()})["catch"](function(err){defer.reject(err)}),defer.promise},$.processUpload=function($scope,file){var defer=$q.defer(),target=baseUrl.endpoint+"/api/library/uploadedFiles/processFile/:filePath",r=$resource(target,{filePath:"@filePath"},{convertFile:{method:"GET",params:{filePath:"@filePath"}}});if(void 0==$scope.fullName){var alert=$ionicPopup.alert({title:"File Upload Error",template:"file name is missing"});alert.then(function(){})}else r.convertFile({filePath:encodeURI($scope.fullName),userId:$rootScope.user._id}).$promise.then(function(status){console.log(status);var time,timeLabel;file.size<5e6?(time=Math.floor(file.size/15e3),timeLabel=" seconds",time>60&&(timeLabel=" minute(s)",time=Math.floor(time/60))):(timeLabel=" minute(s)",time=Math.floor(file.size/4e6)),file.message="Processing: est time: "+time+timeLabel,defer.resolve(status)})["catch"](function(err){console.log(err),defer.reject(err)});return defer.promise},$.uploadComplete=function(result){var idx=indexOfFile(result.file);idx>=0&&($.uploading.files[idx].spinner=!1,$.uploading.files[idx].timeLeft=0,$.uploading.files.splice(idx,1))},$.uploadProgress=function(result){var idx=indexOfFile(result.file);idx>=0&&$.scope.$apply(function(){$.uploading.files[idx].message=result.message})},$.startUpload=function(file){file&&(file.spinner=!1,file.progress="0%",file.message="",$.uploading.files.push(file))},$.setArchive=function($scope,index){var defer=$q.defer();console.log($scope.navItems[index]);var navItem=$scope.navItems[index],modelName=$scope.modelName;return Archiver.update({modelName:modelName,id:navItem._id,isArchived:navItem.isArchived}).$promise.then(function(){defer.resolve()}),defer.promise}}]),angular.module("RevuMe").factory("UserLog",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/userLog/:id";return $resource(target,{id:"@id"})}]).service("logService",["$rootScope","UserLog","pnFactory","$q",function($rootScope,UserLog,pnFactory,$q){var $=this;$.remoteLog=UserLog,$.ready=!1,$rootScope.$on("Revu.Me:Ready",function(){$.logChannel=$rootScope.mainChannel,$.device=$rootScope.device,$.user=$rootScope.user,$.startTime=(new Date).getTime(),$.ready=!0}),$.log=function(event,fromState,toState){if($.ready){var now=(new Date).getTime(),elapsed=(now-$.startTime)/1e3;console.log("Log got: event: ",event," state :",toState),console.log("User is: ",$.user,"Device is: ",$.device),console.log("Elapsed Time is: ",elapsed," seconds");var m={user:$rootScope.user,device:$.device,fromState:fromState,toState:toState,elapsed:elapsed,date:now};$.logChannel.publish(m)}},$.getRecentHistory=function(numDaysPast){var deferred=$q.defer();return UserLog.query({days:numDaysPast}).$promise.then(function(activities){deferred.resolve(activities)})["catch"](function(err){deferred.reject(err)}),deferred.promise},$.getUserHistory=function(userId){var deferred=$q.defer();return UserLog.query({id:userId}).$promise.then(function(activities){deferred.resolve(activities)})["catch"](function(err){deferred.reject(err)}),deferred.promise},$.getRecentUserHistory=function(userId,numDaysPast){var deferred=$q.defer();return UserLog.query({id:userId,days:numDaysPast}).$promise.then(function(activities){deferred.resolve(activities)})["catch"](function(err){deferred.reject(err)}),deferred.promise}}]),angular.module("RevuMe").factory("pnFactory",["Users","$q",function(Users,$q){var pnFactory={};pnFactory.init=function(uuid){uuid=uuid||"anonymous",pnFactory.uuid=uuid,pnFactory.pubnub=PUBNUB.init({keepalive:30,publish_key:"pub-c-19a2e5ee-5b70-435d-9099-65ae53e5b149",subscribe_key:"sub-c-0f2a418a-b9f1-11e4-80fe-02ee2ddab7fe",uuid:uuid,ssl:!0})};var publish=function(message){1==arguments.length&&pnFactory.pubnub.publish({channel:this.name,message:message})},subscribe=function(mCallback,pCallback){var noop=function(){},mcb=mCallback||noop,pcb=pCallback||noop;pnFactory.pubnub.subscribe({channel:this.name,presence:pcb,message:mcb,heartbeat:60,connect:function(){console.log("Connected with SSL")}})},history=function(hCallback){var noop=function(){},hcb=hCallback||noop;pnFactory.pubnub.history({channel:this.name,count:100,callback:hcb})},unsubscribe=function(){pnFactory.pubnub.unsubscribe({channel:this.name})},hereNow=function(hnCallback){var noop=function(){},hncb=hnCallback||noop;pnFactory.pubnub.here_now({channel:this.name,callback:hncb})},findOnline=function(message){for(var found=-1,i=0;i<this.users.length;i++)this.users[i]._id==message.uuid&&(found=i);return found},resolve=function(message){var defer=$q.defer(),$$=this;switch(message.action){case"join":this.findOnline(message)<0&&this.getUser(message.uuid).then(function(usr){var user={_id:message.uuid,name:usr.userName};$$.users.push(user),defer.resolve($$.users)});break;case"leave":console.log("presence got leave action!");case"timeout":var found=this.findOnline(message);found>=0&&this.users.splice(found,1),defer.resolve(this.users)}return defer.promise},setUser=function(userName){pnFactory.pubnub.state({channel:this.name,state:{userName:userName}})},getUser=function(uuid){var defer=new $q.defer;return Users.byId.get({id:uuid}).$promise.then(function(usr){if(usr._id){var userName=usr.firstName+" "+usr.lastName;usr.userName=userName,defer.resolve(usr)}else defer.reject("pnFactory uuid in message not found in user db")})["catch"](function(err){defer.reject(err)}),defer.promise};return pnFactory.newChannel=function(channelName){var channel={name:channelName,publish:publish,subscribe:subscribe,unsubscribe:unsubscribe,hereNow:hereNow,history:history,resolveUsers:resolve,findOnline:findOnline,setUser:setUser,getUser:getUser,users:[]};return channel},pnFactory}]),angular.module("RevuMe").factory("EngagementMetrics",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/metrics/:sid/:did";return $resource(target)}]).service("presAnalyzer",["EngagementMetrics","$q",function(EngagementMetrics,$q){function setEndtime(array,endTime){if(array.length){var idx=array.length-1;array[idx].endTime=endTime,array[idx].duration=(endTime-array[idx].startTime)/1e3}}function setScreenShareEnd(array,endTime){array.forEach(function(slide){void 0!=slide.type&&(slide.endTime=endTime,slide.duration=(endTime-slide.startTime)/1e3)})}function findUser(users,name){var idx=0,retVal=null;return users.forEach(function(usr){void 0!=usr.name&&usr.name.valueOf()==name.valueOf()&&(retVal=users[idx],retVal.idx=idx),idx++}),retVal}function updateUser(users,usr,event){var found=findUser(users,usr.name),newUser={};if(found)found.events.push(event);else{var newUser=new Object;newUser.events=[],newUser.name=usr.name,newUser.events.push(event),users.push(newUser)}}function timeViewed(slide,user){var viewingTime=0,lastState={state:"init"},latestStart=0,currentState={},afterSlide=!1;return void 0==slide.endTime?100:(user.events.forEach(function(event){if(!afterSlide){switch(event.m.action){case"leave":case"timeout":currentState.state="gone",currentState.timestamp=event.timestamp;break;case"join":currentState.state="here",currentState.timestamp=event.timestamp;break;case"engagement":"engaged"==event.m.status?currentState.state="here":currentState.state="gone",currentState.timestamp=event.timestamp}if(currentState.timestamp>=slide.startTime&&currentState.timestamp<=slide.endTime)switch(latestStart=Math.max(lastState.timestamp,slide.startTime),lastState.state){case"init":"gone"==currentState.state&&(viewingTime+=(currentState.timestamp-slide.startTime)/1e3);break;case"here":viewingTime+=(currentState.timestamp-latestStart)/1e3}if(currentState.timestamp>=slide.endTime){switch(latestStart=Math.max(lastState.timestamp,slide.startTime),lastState.state){case"init":viewingTime=0;break;case"here":viewingTime+=(slide.endTime-latestStart)/1e3}afterSlide=!0}lastState.state=currentState.state,lastState.timestamp=currentState.timestamp}}),afterSlide||(latestStart=Math.max(lastState.timestamp,slide.startTime),"here"==lastState.state&&(viewingTime+=(slide.endTime-latestStart)/1e3)),console.log("Slide ",slide.number,"viewingTime : ",viewingTime," user :",user.name),viewingTime)}function process(results){for(var usr,i=0;i<results.slides.length;i++){results.slides[i].users=[];for(var j=0;j<results.users.length;j++)usr=new Object,usr.name=results.users[j].name,usr.idx=j,usr.engagement=timeViewed(results.slides[i],results.users[j]),results.slides[i].users.push(usr)}}function report(results){var str="";results.slides.forEach(function(slide){str=void 0==slide.type?"slide "+slide.number+"duration :"+slide.duration:"ScreenSharing duration:"+slide.duration,slide.users.forEach(function(user){str=str+" "+user.name+" "+user.engagement}),console.log(str)})}this.analyze=function(data){var results={},slide={};return results.presentation={},results.slides=[],results.users=[],this.messageStore=data,this.messageStore.forEach(function(event){var msg=event.m;switch(msg.action){case"new":results.presentation.id=msg.value,results.presentation.startTime=event.timestamp;break;case"end":results.presentation.endTime=event.timestamp,setEndtime(results.slides,event.timestamp);break;case"set":slide=new Object,slide.number=msg.value,slide.startTime=event.timestamp,setEndtime(results.slides,event.timestamp),results.slides.push(slide);break;case"screenShare":slide=new Object,slide.type="ScreenSharing",slide.startTime=event.timestamp,void 0!=msg.value?(setEndtime(results.slides,event.timestamp),results.slides.push(slide)):setScreenShareEnd(results.slides,event.timestamp);break;case"join":case"timeout":case"leave":var user={};user.name=msg.userName,updateUser(results.users,user,event);break;case"engagement":var u={};u.name=msg.who,updateUser(results.users,u,event)}}),process(results),report(results),results},this.save=function(record){var defer=$q.defer(),metrx=new EngagementMetrics,results=record.results,pres=results.presentation,slides=results.slides;metrx.session=record.session,metrx.eventDate=new Date,metrx.deck=record.presentation,metrx.duration=(pres.endTime-pres.startTime)/1e3,metrx.slideViews=[];for(var i=0;i<slides.length;i++){var sview={};"ScreenSharing"!=slides[i].type?sview.slideIndex=parseInt(slides[i].number):sview.slideIndex=-1,sview.duration=slides[i].duration,sview.views=[],slides[i].users.forEach(function(user){sview.views.push({userName:user.name,viewed:user.engagement})}),metrx.slideViews.push(sview)}return metrx.viewers=[],results.users.forEach(function(user){metrx.viewers.push(user.name)}),metrx.$save().then(function(_id){defer.resolve(_id)})["catch"](function(err){defer.reject(err),console.log(err)}),defer.promise},this.get=function(sid,did){return EngagementMetrics.query({sid:sid,did:did}).$promise}}]),angular.module("RevuMe").service("recorder",[function(){Date.now||(Date.now=function(){return(new Date).getTime()}),this.setChannel=function(channel){this.channel=channel,this.messageStore=[]},this.record=function(m){var timestamp=Date.now(),event={timestamp:timestamp,m:m},last={},doPush=!0;if(this.messageStore.length){var last=this.messageStore[this.messageStore.length-1];"set"==last.m.action&&"set"==m.action&&last.m.value==m.value&&(doPush=!1)}doPush&&this.messageStore.push(event)},this["export"]=function(){return this.messageStore},this.dump=function(){this.messageStore.forEach(function(event){console.log(event)})}}]),angular.module("RevuMe").factory("Revu",["$resource","baseUrl",function($resource,baseUrl){var startTarget=baseUrl.endpoint+"/api/revu/start",endTarget=baseUrl.endpoint+"/api/revu/end";return{start:$resource(startTarget,{},{send:{method:"POST",params:{}}}),end:$resource(endTarget,{},{send:{method:"POST",params:{}}})}}]),angular.module("RevuMe").service("rightsManager",["$rootScope",function($rootScope){function setAll(clientIdx,role,trueFalse){var roleIdx=$.roles.indexOf(role);$.clients.rights[clientIdx][roleIdx].forEach(function(right){right.enabled=trueFalse})}function newRightsArray(clientIdx,setAll){var rights=[],allActions=$.clients.allActions[clientIdx];return allActions.forEach(function(action){var r={};r.name=action,r.enabled=setAll,rights.push(r)}),rights}function setRight(clientIdx,role,action,enabled){var roleIdx=$.roles.indexOf(role),actionIdx=$.clients.allActions[clientIdx].indexOf(action);$.clients.rights[clientIdx][roleIdx][actionIdx].enabled=enabled}function getRight(clientIdx,role,action){var roleIdx=$.roles.indexOf(role),actionIdx=$.clients.allActions[clientIdx].indexOf(action),retVal=!0;return actionIdx>=0&&(retVal=$.clients.rights[clientIdx][roleIdx][actionIdx].enabled),retVal}function applyRights(clientIdx,role,optionalTarget){var target={};target=void 0!=optionalTarget?optionalTarget:$.clients.scopes[clientIdx],$.clients.allActions[clientIdx].forEach(function(action){var can=getRight(clientIdx,role,action),propName="_$"+action.replace(/\s/g,"");target[propName]=can})}var $=this;$.clients={scopes:[],names:[],allActions:[],rights:[],handles:[],keys:[]},$.roles=["Admin","Viewer"],$.register=function(name,$scope,actionList,key){var clientIdx=$.clients.names.indexOf(name);if(clientIdx>=0)return $.clients.scopes[clientIdx]=$scope,$.clients.allActions[clientIdx]=actionList,$.clients.keys[clientIdx]=key,$.clients.handles[clientIdx];$.clients.scopes.push($scope),$.clients.names.push(name),$.clients.allActions.push(actionList),clientIdx=$.clients.names.length-1,$.clients.rights[clientIdx]=[];for(var i=0;i<$.roles.length;i++)$.clients.rights[clientIdx].push(newRightsArray(clientIdx,!1));var handle={};return handle.setAll=function(role,trueFalse){setAll(clientIdx,role,trueFalse)},handle.setRight=function(role,action,enabled){setRight(clientIdx,role,action,enabled)},handle.getRight=function(role,action){var retVal=getRight(clientIdx,role,action);return retVal},handle.getName=function(){var retVal=$.clients.names[clientIdx];return retVal},handle.applyRights=function(role,optionalTarget){applyRights(clientIdx,role,optionalTarget)},$.clients.handles[clientIdx]=handle,$.clients.keys.push(key),$.clients.handles[clientIdx]},$.get=function(name){var clientIdx=$.clients.names.indexOf(name);return clientIdx>=0?$.clients.handles[clientIdx]:void console.log("rightsManager:client: "+clientName+" not found")},$.findKey=function(key){var clientIdx=$.clients.keys.indexOf(key);return clientIdx>=0?$.clients.handles[clientIdx]:void console.log("rightsManager:client: "+key.toString()+" not found")}}]),angular.module("RevuMe").provider("screenleap",function(){this.$get=function(){return screenleap}}).service("Screenleap",["screenleap","$http","$q","$ionicPopup","$rootScope","baseUrl","onEvent","$window","$cookieStore",function(screenleap,$http,$q,$ionicPopup,$rootScope,baseUrl,onEvent,$window,$cookieStore){var $=this;onEvent.attach($),$.screenleap=screenleap,$.sharingSession=void 0,$.api=baseUrl.endpoint+"/api/screenleap";var json="https://api.ipify.org/?format=json";$http.get(json).then(function(result){$.clientIP=result.data.ip},function(e){console.log("Screenleap Service - error getting IP")}),$.downloadAndStart=function(){$.screenleap.downloadAndStartNativeApp()},$.startFromClick=function(){$.screenleap.startAppUsingCustomProtocolHandler()},$.startSharing=function(){var deferred=$q.defer(),url=$.api+"/start";return $.reAspect(),$http.get(url,{params:{clientIP:$.clientIP,rectangle:$.rectangle}}).then(function(response){if(void 0!=response.data[1]){if($.sharingSession=JSON.parse(response.data[1]),void 0!=$.sharingSession.errorMessage){var response={errorMessage:$.sharingSession.errorMessage};throw response}$.screenleap.startSharing("NATIVE",$.sharingSession,$.callbacks),deferred.resolve($.sharingSession)}})["catch"](function(response){var template=response.errorMessage,alert=$ionicPopup.alert({title:"Screenleap API Error !",template:template});alert.then(function(){deferred.reject(response)})}),deferred.promise},$.endSharing=function(){var url=$.api+"/stop";void 0!=$.sharingSession&&$http.post(url,{sharingSession:$.sharingSession}).then(function(response){console.log("sharing sessions stopped: ",response)})["catch"](function(err){var template=err.statusText,alert=$ionicPopup.alert({title:"Screenleap API Error !",template:template});alert.then(function(){console.log("Alerted!")})})},$.screenleap.onScreenShareStart=function(){console.log("screenShare start");var cookie=$cookieStore.get("__aa");void 0==cookie&&$cookieStore.put("__aa",!0),$.$fire("screenShareStarted")},$.screenleap.onPresenterConnect=function(){console.log("Presenter Connected")},$.screenleap.onScreenShareEnd=function(){$.$fire("screenShareEnd"),console.log("Screen Share End")},$.screenleap.onViewerConnect=function(participantId,externalId){console.log("viewConnected participantID: ",participantId," externalId: ",externalId)},$.screenleap.onViewerDisconnect=function(participantId,externalId){console.log("viewDisconnected participantID: ",participantId," externalId: ",externalId)},$.onDownloadStarting=function(){console.log("downloadStarting"),$.$fire("downloadStarting")},$.onScreenShareStarting=function(){console.log("screenShareStarting"),$.$fire("screenShareStarting")},$.onAppConnectionFailed=function(){console.log("app connection failed")},$.onScreenShareStartError=function(){console.log("screen share start error")},$.onLocalServerFailed=function(){console.log("screen share local webserver failure")},$.callbacks={nativeDownloadStarting:$.onDownloadStarting,screenShareStarting:$.onScreenShareStarting,appConnectionFailed:$.onAppConnectionFailed,screenShareStartError:$.onScreenShareStartError,localWebServerStartFailed:$.onLocalServerFailed},$.reAspect=function(){if($window.screenX<0)var screenX=$window.screen.availWidth+$window.screenX;else var screenX=$window.screenX;console.log("screenX = ",screenX),$.rectangle={rectangleXPos:screenX,rectangleYPos:$window.screenY,rectangleWidth:$window.outerWidth,rectangleHeight:$window.outerHeight}}}]),angular.module("RevuMe").factory("Scripts",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/scripts/:id";return $resource(target,{id:"@id"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}})}]).service("ScriptService",["Teams","Users","Scripts","rightsManager","$q","$rootScope","$state",function(Teams,Users,Scripts,rightsManager,$q,$rootScope,$state){function setExpiration(script){var expMonth=script.expirationDate.getMonth();if(12==expMonth){expMonth=1;var year=script.expirationDate.getFullYear();year+=1,script.expirationDate.setFullYear(year),script.expirationDate.setMonth(expMonth)}else expMonth+=1,script.expirationDate.setMonth(expMonth)}var $=this;$.getAdmin=function(script){var admin=void 0;return script.members.forEach(function(member){"Admin"==member.role&&(admin=member.user,admin.name=admin.firstName+" "+admin.lastName)}),admin},$.getDaysLeft=function(script){var oneDay=864e5;if(void 0!=script){var today=new Date,expDate=new Date(script.expirationDate),left=Math.round((expDate.getTime()-today.getTime())/oneDay);return 0>left&&(left=0),"Elite"==script.type&&(left=36500),left}return-1},$.daysLeft=function(userId){var defer=$q.defer();return $.userScript(userId).then(function(script){var dLeft=$.getDaysLeft(script);dLeft>=0?defer.resolve(dLeft):defer.reject("no scripts found!")}),defer.promise},$.getMonthlyCost=function(totalSeats){return 25>totalSeats?35:30},$.calculateCost=function(script){var cost,monthlyCostPerSeat=$.getMonthlyCost(script.totalSeats);switch(script.type){case"Elite":case"Trial":cost=0;break;case"Monthly":cost=monthlyCostPerSeat*script.totalSeats;break;case"Annually":cost=monthlyCostPerSeat*script.totalSeats*10}return cost},$.annualSavings=function(script){var moCost=$.getMonthlyCost(script.totalSeats);return moCost*script.totalSeats*2},$.scriptTypes=["Trial","Monthly","Annually","Elite"],$.setPendingScript=function(script){$.pendingScript=angular.copy(script)},$.getPendingScript=function(){return void 0==$.pendingScript?$rootScope.user.script:$.pendingScript},$.newScript=function(type,members){var script={};return script.type=type,script.totalSeats=members.length,script.availableSeats=0,script.members=[],script.startDate=new Date,script.expirationDate=new Date,script.autoRenew=!1,setExpiration(script),members.forEach(function(member){script.members.push(member)}),script},$.setToTrial=function(){var deferred=$q.defer(),script={},btId=void 0;return $.userScript($rootScope.user._id).then(function(s){return script=s,script.type="Trial",script.totalSeats=1,script.availableSeats=0,script.startDate=new Date,script.expirationDate=new Date,
setExpiration(script),script.members=[{user:$rootScope.user._id,role:"Admin"}],script.customerId=void 0,script.autoRenew=!0,btId=script.braintreeId,script.braintreeId=void 0,$.update(script._id,script)}).then(function(){script.braintreeId=btId,deferred.resolve(script)})["catch"](function(err){console.log("error : ",err)}),deferred.promise},$.checkScript=function(script,event){var days=$.getDaysLeft(script);0>=days&&"Elite"!=script.type&&(void 0!=event&&event.preventDefault(),$state.go("app.myAccount"))},$.userScript=function(userId){var defer=$q.defer();return Scripts.query({user:userId}).$promise.then(function(scripts){defer.resolve(scripts[0])}),defer.promise},$.save=function(script){var defer=$q.defer();return Scripts.save(script).$promise.then(function(script){defer.resolve(script._id)}),defer.promise},$.update=function(_id,script){var defer=$q.defer();script.availableSeats=script.totalSeats-script.members.length,console.log("ScriptService update - script is: ",script);var scrCopy=angular.copy(script);return scrCopy.members.forEach(function(member){angular.isObject(member.user)&&(member.user=member.user._id)}),console.log("ScriptService update - scrCopy: ",scrCopy),Scripts.update({id:_id},scrCopy).$promise.then(function(){defer.resolve()}),defer.promise},$["delete"]=function(_id){var defer=$q.defer();return Scripts["delete"]({id:_id}).$promise.then(function(){defer.resolve()}),defer.promise}}]),angular.module("RevuMe").factory("Session",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/sessions/:id";return $resource(target,{id:"@id"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}})}]).factory("Sess",["$resource","baseUrl","$rootScope",function($resource,baseUrl,$rootScope){var oTarget=baseUrl.endpoint+"/api/sessions/organizer/:id",aTarget=baseUrl.endpoint+"/api/sessions/attendee/:id",target=baseUrl.endpoint+"/api/sessions/:id",lbTarget=baseUrl.endpoint+"/api/sessions/setLB/:id",archiveTarget=baseUrl.endpoint+"/api/sessions/archive/:id",inviteTarget=baseUrl.endpoint+"/api/sessions/resend/:id";return{orgSessions:$resource(oTarget,{id:"@id",isArchived:"@isArchived"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}},get:{method:"GET",params:{id:"@id",isArchived:"@isArchived"},isArray:!0}}),attSessions:$resource(aTarget,{id:"@id",isArchived:"@isArchived"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}},get:{method:"GET",params:{id:"@id",isArchived:"@isArchived"},isArray:!0}}),sessions:$resource(target,{id:"@id"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}},get:{method:"GET",params:{id:"@id"},isArray:!0}}),leaveBehind:$resource(lbTarget,{id:"@id"},{update:{method:"PUT",params:{id:"@id"}}}),archive:$resource(archiveTarget,{id:"@id"},{update:{method:"PUT",params:{id:"@id"}}}),invite:$resource(inviteTarget,{id:"@id"},{update:{method:"PUT",params:{id:"@id"}}})}}]).service("SessionBuilder",["$rootScope","Session","Decks","UploadedFiles","userService","$ionicModal","$ionicPopup","$q","$timeout","baseUrl","TeamService","shareMediator","Library",function($rootScope,Session,Decks,UploadedFiles,userService,$ionicModal,$ionicPopup,$q,$timeout,baseUrl,TeamService,shareMediator,Library){function initSession(){var deferred=$q.defer();return $.session.decks=[],$.session.name="",$.session.description="",$.session.date=new Date,$.session.attendees=[],$.session.attIds=[],$.session.length=60,$.session.lengthOptions=lengthOptions,$.session.time=$.session.date,$.session.time.setMilliseconds(0),$.session.time.setSeconds(0),$.session.bridge=!0,$.session.invite=!0,$.session.timeZone=tz.name(),$.session.baseUrl=baseUrl.endpoint,$.session.offset=(new Date).getTimezoneOffset(),$.session.showTeams=!1,TeamService.getAll($rootScope.user._id).then(function(teams){$.session.teamList=teams,$.session.teamList.length>0&&($.session.team=$.session.teamList[0]),deferred.resolve()}),deferred.promise}function showAlert(msg){var alertPopup=$ionicPopup.alert({title:"Build New Session",template:msg});return alertPopup}function find(member){var foundIdx=-1,idx=0;return $.session.attendees.forEach(function(a){a._id==member._id&&(foundIdx=idx)}),foundIdx}function fixTime(session){console.log("offset before fix: ",session.time.getTimezoneOffset()),session.time.setDate(session.date.getDate()),session.time.setMonth(session.date.getMonth()),session.time.setFullYear(session.date.getFullYear()),session.offset=(new Date).getTimezoneOffset(),console.log("offset after fix: ",session.time.getTimezoneOffset())}var $=this,$user=userService.user,lengthOptions=[30,60,90,120],tz=jstz.determine();Decks.modelName="decks",UploadedFiles.modelName="files",$.setScope=function($scope){$.scope=$scope},$.Library=Library,$.init=function($scope){var deferred=$q.defer();$.scope;return $.session={},$.scope=$scope,void 0==$.scope.library?($.scope.library=Library,Library.init($.scope)):Library.scope=$scope,$.showTeams=!1,$.session.baseUrl=baseUrl.endpoint,$.builderCallback=function(){},$.deckCallback=function(){},$.defer=[],initSession().then(function(){$ionicModal.fromTemplateUrl("templates/addDeckTemplate.html",{scope:$.scope,animation:"slide-in-up"}).then(function(modal){$.deckModal=modal,deferred.resolve()})}),deferred.promise},$.show=function(modal){var p=$q.defer();return $.defer.push(p),modal.show(),p.promise},$.processUpload=function(){shareMediator.getItems(UploadedFiles).then(function(files){if(files.length>0){var file=files[0];Library.newDeckFromFile(file).then(function(deck){var d=deck;$timeout(function(deck){$.decks.unshift(d)},0)})}})},$.loadDecks=function(){var deferred=$q.defer();return $rootScope.showLoading(),shareMediator.getItems(Decks).then(function(decks){$rootScope.hideLoading(),decks.length>0?($.decks=decks,$.decks.forEach(function(deck){deck.added=!1}),deferred.resolve($.decks)):(showAlert("No Decks Built Yet - Please Build one First"),deferred.resolve(void 0))}),deferred.promise},$.connect=function(){return void 0==$.ucEvent&&($.ucEvent=Library.$on("uploadComplete",$.processUpload)),Library},$.disconnect=function(){void 0!=$.ucEvent&&($.ucEvent=Library.$off($.ucEvent))},$["new"]=function(){$q.defer();return $.decks=[],$.session.decks=[],$.session.timeZone=tz.name(),$.session.baseUrl=baseUrl.endpoint,$.session},$.build=function(navItem){return $.session.decks[0]=navItem,$.session.timeZone=tz.name(),$.session.baseUrl=baseUrl.endpoint,$.session},$.edit=function(session){var defer=$q.defer();TeamService.getAll($rootScope.user._id).then(function(teams){$.session.teamList=teams,$.session.teamList.length>0&&($.session.team=$.session.teamList[0]),defer.resolve()});var t=session.time,d=session.date;return session.time=new Date(t),session.date=new Date(d),session.timeZone=tz.name(),session.baseUrl=baseUrl.endpoint,$.session=angular.copy(session),$.session.attIds=[],$.session.lengthOptions=lengthOptions,$.session.attendees.forEach(function(a){$.session.attIds.push(a._id)}),defer.promise},$.subEdit=function($scope){var deferred=$q.defer();return $rootScope.showLoading(),$.decks=[],shareMediator.getItems(Decks).then(function(decks){return 0!=decks.length?($.decks=decks,$.decks.forEach(function(deck){deck.added=!1}),$.deckModal.remove()):void showAlert("No Decks Built Yet - Please Build or Upload One First")}).then(function(){return $ionicModal.fromTemplateUrl("templates/addDeckTemplate.html",{scope:$scope,animation:"slide-in-up"})}).then(function(modal){return $.deckModal=modal,$.connect(),$rootScope.hideLoading(),$.show($.deckModal)}).then(function(){console.log("subEdit",$.defer),$.deckModal.hide(),deferred.resolve()})["catch"](function(){$rootScope.hideLoading(),console.log("subEdit reject",$.defer),$.deckModal.hide(),deferred.reject()}),deferred.promise},$.addDeck=function($index){$.session.decks.push($.decks[$index]);try{$.decks[$index].added=!0}catch(e){}},$.delDeck=function($index){$.session.decks.splice($index,1);try{$.decks[$index].added=!1}catch(e){}},$.addAttendee=function(a){var deferred=$q.defer(),attendee=new Object,_id=-1;return attendee=a,$user.byEmail.get({email:attendee.email}).$promise.then(function(user){if(void 0==user._id){var usr=new $user.byId;angular.extend(usr,attendee),usr.$save().then(function(usr){_id=usr._id,$.session.attendees.push(attendee),$.session.attIds.push(_id),$.session.formname="",$.session.formemail="",deferred.resolve()})["catch"](function(err){deferred.reject(),console.log(err)})}else _id=user._id,$.session.attendees.push(attendee),$.session.attIds.push(_id),$.session.formname="",$.session.formemail="",deferred.resolve()})["catch"](function(err){deferred.reject(),console.log(err)}),deferred.promise},$.delAttendee=function($index){$.session.attendees.splice($index,1),$.session.attIds.splice($index,1)},$.addTeam=function($index){if(void 0==$index){var team=$.session.team;team.members.forEach(function(member){$.session.attendees.push(member),$.session.attIds.push(member._id)})}else if($index<$.session.teamList.length){var team=$.session.teamList[$index];team.members.forEach(function(member){$.session.attendees.push(member),$.session.attIds.push(member._id)})}},$.removeTeam=function($index){if($index<$.session.teamList.length){var team=$.session.teamList[$index];team.members.forEach(function(member){var idx=find(member);idx>=0&&$.delAttendee(idx)})}},$.updateSession=function(){var defer=$q.defer(),updateSession={};return angular.extend(updateSession,$.session),fixTime(updateSession),console.log("Update Session"),updateSession.decks=[],$.session.decks.forEach(function(deck){updateSession.decks.push(deck._id)}),updateSession.attendees=$.session.attIds,Session.update({id:$.session._id},updateSession).$promise.then(function(){defer.resolve($.session)})["catch"](function(err){defer.reject(err)}),defer.promise},$.saveSession=function(){var defer=$q.defer(),saveSession=new Session;return angular.extend(saveSession,$.session),fixTime(saveSession),saveSession.decks=[],$.session.decks.forEach(function(deck){saveSession.decks.push(deck._id)}),saveSession.attendees=$.session.attIds,saveSession.organizer=$rootScope.user._id,saveSession.$save().then(function(){defer.resolve()})["catch"](function(err){defer.reject(err),console.log(err)}),defer.promise},$.deleteSession=function(session){Sess.session["delete"]({id:session._id})},$.destroy=function(){$.builderModal.remove(),$.deckModal.remove()}}]),angular.module("RevuMe").factory("Share",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/share/:id";return $resource(target,{id:"@id",path:"@path"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}})}]).service("shareMediator",["Share","rightsManager","TeamService","$rootScope","$ionicModal","$q",function(Share,rightsManager,TeamService,$rootScope,$ionicModal,$q){function setTeamIncluded(inc,teams){teams.forEach(function(team){inc.forEach(function(t){team._id==t._id&&(team.included=!0)})})}function roleFromTeams(teams){var role=void 0,roleIdx=void 0;return teams.forEach(function(team){if(team.members.length>0){var r=team.members[0].role;void 0==role?(role=r,roleIdx=rightsManager.roles.indexOf(role)):(idx=rightsManager.roles.indexOf(r),idx<roleIdx&&(role=r,roleIdx=idx))}}),role}function decorateItems(sList,allItems){sList.forEach(function(arr){if(0!=arr.length)for(var s=arr[0],i=0;i<allItems.length;i++)if(s.item==allItems[i]._id){allItems[i].sharingString="",s.teams.forEach(function(team){allItems[i].sharingString+=team.name+" "});break}})}var $=this;$.init=function($scope){$.scope=$scope,$.childScope=$scope.$new(),$.childScope.share=void 0,$.childScope.cancelShare=$.cancelShare,$.childScope.updateSharing=$.updateSharing,TeamService.getAll($rootScope.user._id).then(function(teams){$.childScope.teams=teams}),$ionicModal.fromTemplateUrl("templates/shareTemplate.html",{scope:$.childScope,animation:"slide-in-up"}).then(function(modal){$.childScope.shareModal=modal})},$.destroy=function(){void 0!=$.childScope&&($.childScope.shareModal.remove(),$.childScope.$destroy())},$.shareItem=function($index){var item=$.scope.navItems[$.scope.selectedNavId];TeamService.getAll($rootScope.user._id).then(function(teams){return $.childScope.teams=teams,Share.query({item:item._id,user:$rootScope.user._id}).$promise}).then(function(shares){var s=shares[0];void 0!=s&&($.childScope.share=s,setTeamIncluded(s.teams,$.childScope.teams)),$.childScope.shareModal.show()})["catch"](function(err){console.log("shareMediator shareItem - error: ",err)})},$.cancelShare=function(){$.childScope.shareModal.hide(),$.childScope.share=void 0},$.updateSharing=function(){var teamsToShare=[],model=$.scope.model,item=$.scope.navItems[$.scope.selectedNavId];0!=$.childScope.teams.length?item.sharingString="":item.sharingString=void 0,$.childScope.teams.forEach(function(team){team.included&&(teamsToShare.push(team._id),item.sharingString+=team.name+" ")}),$.saveShare(model,item,teamsToShare).then(function(){$.childScope.shareModal.hide()})},$.saveShare=function(model,item,teams){var deferred=$q.defer(),share=new Share,modelName=rightsManager.findKey(model).getName(),existing=$.childScope.share;return share.model=modelName,share.user=$rootScope.user._id,share.item=item._id,share.teams=[],teams.forEach(function(_id){share.teams.push(_id)}),0==share.teams.length?void 0!=existing?Share["delete"]({id:existing._id}).$promise.then(function(){$.childScope.share=void 0,deferred.resolve()}):deferred.resolve():void 0!=existing?Share.update({id:existing._id},share).$promise.then(function(){$.childScope.share=void 0,deferred.resolve()}):share.$save().then(function(_id){share._id=_id,$.childScope.share=void 0,deferred.resolve()})["catch"](function(err){deferred.reject(err)}),deferred.promise},$.getItems=function(inputModel){var deferred=$q.defer(),model=inputModel,modelName=inputModel.modelName,allItems=[],sharedItems=[],promises=[];return model.query({user:$rootScope.user._id,archiveOn:$rootScope.archiveOn()}).$promise.then(function(owned){return owned.forEach(function(item){item.role="Admin",allItems.push(item),promises.push(Share.query({item:item._id,user:$rootScope.user._id}).$promise)}),$q.all(promises)}).then(function(sList){return decorateItems(sList,allItems),Share.query({model:modelName,user:$rootScope.user._id}).$promise}).then(function(shares){shares.forEach(function(s){var item=s.item,teams=s.share.teams;item.role=roleFromTeams(teams),sharedItems.push(item)}),allItems=allItems.concat(sharedItems),deferred.resolve(allItems)}),deferred.promise},$.getSharedForCache=function(){var deferred=$q.defer();return Share.query({model:"files",user:$rootScope.user._id}).$promise.then(function(shares){deferred.resolve(shares)}),deferred.promise}}]),angular.module("RevuMe").service("slideShow",["$rootScope","$state",function($rootScope,$state){var $=this;$.presentation={},$.connect=function($scope){$.scope=$scope,$scope.presentation=$.presentation},$.startSlideShow=function(presentation){angular.extend($.presentation,presentation),$.lastState=$state.current.name,$state.go("app.slideShow")}}]),angular.module("RevuMe").factory("Teams",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/teams/:id";return $resource(target,{id:"@id"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}})}]).service("TeamService",["Teams","Users","rightsManager","$q","$ionicPopover","$rootScope","Share",function(Teams,Users,rightsManager,$q,$ionicPopover,$rootScope,Share){function nameToPermission(name){for(var i=0;i<permissionList.length;i++)if(name==permissionList[i].name)return permissionList[i]}function buildPreviewString(team){for(var members=team.members.slice(0,4),previewString="",i=0;i<members.length;i++){var name=members[i].firstName+" "+members[i].lastName;previewString+=name,i<members.length-1&&(previewString+=",")}team.previewString=previewString}function validateEmail(email){var re=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return re.test(email)}var $=this,permissionList=[];rightsManager.roles.forEach(function(role){var x={};x.name=role,permissionList.push(x)}),$.scope=void 0,$.registeredName="Team",$.actionList=["Save","Add Member","Delete Member","Change Role"],$.init=function($scope){$.scope=$scope,$scope.editTeamId=void 0,$scope.permissions=permissionList,$.rights=rightsManager.register($.registeredName,$scope,$.actionList,$),$.rights.setAll("Admin",!0),$.rights.setAll("Viewer",!1)},$.myRole=function(team){var myId=$rootScope.user._id,role=void 0;return team.members.forEach(function(member){member._id==myId&&(role=member.role.name)}),role},$.toMemberShim=function(dbTeam){dbTeam.members.forEach(function(member){var user=member.user;member.firstName=user.firstName,member.lastName=user.lastName,member.email=user.email,member._id=user._id,member.role=nameToPermission(member.role)})},$.fromMemberShim=function(team){team.members.forEach(function(member){var user={};user.firstName=member.firstName,user.lastName=member.lastName,user.email=member.email,user._id=member._id;member.user=user})},$.getAll=function(userId){var defer=$q.defer();return Teams.query({user:userId}).$promise.then(function(teams){teams.forEach(function(team){$.toMemberShim(team),buildPreviewString(team)}),defer.resolve(teams)}),defer.promise},$.refreshTeams=function($scope){var defer=$q.defer(),_id=$rootScope.user._id;return void 0!=_id&&$.getAll(_id).then(function(teams){$scope.teams=teams,defer.resolve()}),defer.promise},$.newTeam=function($scope){$scope.role="Admin",$.rights.applyRights($scope.role),$scope.addTeam={},$scope.addTeam.name="",$scope.addTeam.memberString="",$scope.addTeam.members=[],$scope.addTeam.nameString="",$scope.addTeam.emailString="",$scope.addTeam._id=void 0,$scope.autoComplete={},$scope.autoComplete.entries=[]},$.editTeam=function($scope,idx){var team=$scope.teams[idx];$scope.role=$.myRole(team),$.rights.applyRights($scope.role),$scope.editTeamId=team._id,$scope.addTeam={},$scope.addTeam.name=team.name,$scope.addTeam.memberString="",$scope.addTeam.members=[],team.members.forEach(function(member){$scope.addTeam.members.push(member),$scope.addTeam.memberString+=member.firstName+","+member.lastName+","+member.email+","+member.role.name+";"}),$scope.addTeam.nameString="",$scope.addTeam.emailString="",$scope.addTeam._id=void 0,$scope.autoComplete={},$scope.autoComplete.entries=[]},$.addMember=function($scope){var m={},nStr=$scope.addTeam.nameString.split(" ");m.firstName=nStr[0],m.lastName=nStr[1],m.email=$scope.addTeam.emailString,m.role=$scope.permissions[1],$scope.addTeam.memberString+=m.firstName+","+m.lastName+","+m.email+","+m.role.name+";",Users.byEmail.get({email:m.email}).$promise.then(function(user){void 0!=user._id&&(m._id=user._id),$scope.addTeam.members.unshift(m),$scope.addTeam.nameString="",$scope.addTeam.emailString="",$scope.addTeam._id=void 0})["catch"](function(err){console.log(err)})},$.delMember=function($scope,$index){$scope.addTeam.memberString="",$scope.addTeam.members.splice($index,1),$scope.addTeam.members.forEach(function(member){$scope.addTeam.memberString+=member.firstName+","+member.lastName+","+member.email+","+member.role.name+";"})},$.validateMembers=function($scope){var mStr=$scope.addTeam.memberString,memberList=[];$scope.addTeam.memberString=mStr.replace(/(\r\n|\n|\r)/gm,""),memberList=$scope.addTeam.memberString.split(";"),memberList.forEach(function(elem){if(elem.length>0){var m=elem.split(","),member={};m.length<3?member.valid=!1:(member.firstName=m[0],member.lastName=m[1],member.email=m[2],member.role=nameToPermission(m[3]),member.valid=validateEmail(member.email),$scope.addTeam.members.push(member))}})},$.teamFromInput=function($scope){var owner={},team={},name=$rootScope.user.name.split(" ");return team.members=[],owner.firstName=name[0],owner.lastName=name[1],owner.email=$rootScope.user.email,owner._id=$rootScope.user._id,owner.role=$scope.permissions[0],team.name=$scope.addTeam.name,void 0==$scope.editTeamId?team.members.push(owner):team._id=$scope.editTeamId,$scope.addTeam.members.forEach(function(member){team.members.push(member)}),$scope.editTeamId=void 0,team},$.teamFromTeam=function(team){var defer=$q.defer(),promises=[],dbTeam=new Teams;return $.fromMemberShim(team),dbTeam.name=team.name,dbTeam.members=[],void 0!=team._id&&(dbTeam._id=team._id),team.members.forEach(function(member){if(void 0==member.user._id){var usr=new Users.byId;angular.extend(usr,member.user),promises.push(usr.$save())}var m={};void 0!=member.user._id?m.user=member.user._id:m.user=member.user.email,m.role=member.role.name,dbTeam.members.push(m)}),$q.all(promises).then(function(usrList){usrList.forEach(function(usr){for(var i=0;i<dbTeam.members.length;i++)if(usr.email==dbTeam.members[i].user){dbTeam.members[i].user=usr._id;break}}),console.log("all promises - resolved"),defer.resolve(dbTeam)}),defer.promise},$.save=function(team){var defer=$q.defer();return $.teamFromTeam(team).then(function(dbTeam){return dbTeam.$save()}).then(function(){defer.resolve()}),defer.promise},$.update=function(team){var defer=$q.defer();return $.teamFromTeam(team).then(function(dbTeam){return Teams.update({id:dbTeam._id},dbTeam)}).then(function(){defer.resolve()}),defer.promise},$["delete"]=function(_id){var defer=$q.defer();return Teams["delete"]({id:_id}).$promise.then(function(){defer.resolve()}),defer.promise},$.getSharedItems=function(teamId){var deferred=$.defer();return Share.get({team:teamId,user:$rootScope.user._id}).$promise.then(function(items){deferred.resolve(items)}),deferred.promise}}]),angular.module("RevuMe").service("tourService",["$rootScope","$state","$ionicSideMenuDelegate","$q","$sce","$controller",function($rootScope,$state,$ionicSideMenuDelegate,$q,$sce,$controller){function transitionTo(step){var state;state=""==step.state?"app.welcome":step.state,$state.current.name!=state?$state.go(state).then(function(){return step.connect()}).then(function(){step.before(),step.show()}):step.connect().then(function(){step.before(),step.show()})}function newPosition(topSmall,top,left,smallClass,Class){var position={},position={};return $rootScope.smallScreen()?(position.left="20px",position.top=topSmall,position["class"]=smallClass||"tour-tip-container"):(position.top=top,position.left=left,position["class"]=Class||"tour-tip-container"),position}function next(pos){return pos.small+=60,pos.smallText=pos.small+"px",pos.large+=60,pos.largeText=pos.large+"px",pos}var $=this;$.steps=[],$.currentStep=0;var calloutStyles={none:"tour-tip-container",top:"tour-tip-container top",left:"tour-tip-container left",topLeft:"tour-tip-container topLeft",topRight:"tour-tip-container topRight"};$.start=function(){if($.currentStep=0,$.steps.length>0)var step=$.steps[0];transitionTo(step)},$.next=function(){if($.steps[$.currentStep].hide(),"ext"==$.steps[$.currentStep].after?$.steps[$.currentStep].ext():$.steps[$.currentStep].after(),$.currentStep<$.steps.length-1){$.currentStep++;var step=$.steps[$.currentStep];transitionTo(step)}},$.previous=function(){if($.steps[$.currentStep].hide(),$.steps[$.currentStep].after(),$.currentStep>0){$.currentStep--;var step=$.steps[$.currentStep];transitionTo(step)}},$.showAll=function(){$.steps.forEach(function(step){step.show()})},$.hideAll=function(){$.steps.forEach(function(step){void 0!=step.hide&&step.hide()})},$.end=function(){$.currentStep=0,$.hideAll()},$.newStep=function(state,text,position,before,after){var step={};return step.state=state,step.text=$sce.trustAsHtml(text),step.before=before||function(){},step.after=after||function(){},step.position=position||{},step.connect=function(){return step.defer=$q.defer(),void 0==step.show?step.defer.promise:void 0!=step.scope&&1==step.scope.$$destroyed?step.defer.promise:(step.defer.resolve(),step.scope.step=step,step.defer.promise)},step},$.subStep=function(parent,text,position,before,after){var step={};return angular.extend(step,parent),step.parent=parent,step.text=$sce.trustAsHtml(text),step.position=position||{},step.before=before||function(){},step.after=after||function(){},step.connect=function(){return step.defer=$q.defer(),step.show=step.parent.show,step.hide=step.parent.hide,step.ext=step.parent.ext,parent.scope.step=step,step.defer.resolve(),step.defer.promise},step},$.configure=function(){var cas=calloutStyles,pos={small:50,large:-18},position=newPosition("60%","30%","275px",cas.none,cas.left),rootStep=$.newStep("","Let's start with the menu. Click the corner to open and close",position,function(){$ionicSideMenuDelegate.toggleLeft(!0)});$.steps.push(rootStep),pos=next(pos),position=newPosition(pos.smallText,pos.largeText,"275px",cas.topLeft,cas.left),$.steps.push($.subStep(rootStep,"Settings let you change your password and log out.",position)),pos=next(pos),position=newPosition(pos.smallText,pos.largeText,"275px",cas.topLeft,cas.left),$.steps.push($.subStep(rootStep,"Dashboard gives you engagement and other statistics at a glance.",position)),pos=next(pos),position=newPosition(pos.smallText,pos.largeText,"275px",cas.topLeft,cas.left),$.steps.push($.subStep(rootStep,"Schedule or Start a New Meeting with One Click.",position)),pos=next(pos),position=newPosition(pos.smallText,pos.largeText,"275px",cas.topLeft,cas.left),$.steps.push($.subStep(rootStep,"The Library Stores all your Pitch Decks. Build a new deck just like making a playlist",position)),pos=next(pos),position=newPosition(pos.smallText,pos.largeText,"275px",cas.topLeft,cas.left),$.steps.push($.subStep(rootStep,"Teams Let You Share Pitch Decks and other items",position)),pos=next(pos),position=newPosition(pos.smallText,pos.largeText,"275px",cas.topLeft,cas.left),$.steps.push($.subStep(rootStep,"These are all the meetings you've organized",position)),pos=next(pos),position=newPosition(pos.smallText,pos.largeText,"275px",cas.topLeft,cas.left),$.steps.push($.subStep(rootStep,"Here are Invitations to Meetings you can Attend",position)),pos=next(pos),position=newPosition(pos.smallText,pos.largeText,"275px",cas.topLeft,cas.left),(!$rootScope.isMobile||$rootScope.showArchive)&&$.steps.push($.subStep(rootStep,"The Archive Holds All your Old Pitches and Meetings",position,function(){$ionicSideMenuDelegate.toggleLeft(!0)})),position=newPosition("44%","330px","30px",cas.top,cas.top);var state;state=$rootScope.smallScreen()?"app.mobileLib":"app.library";var libStep=$.newStep(state,"This is the slide library. Drop files here to upload (Desktop Only).<br> You can also import files from your Dropbox or Box account",position,function(){$ionicSideMenuDelegate.toggleLeft(!1)});$.steps.push(libStep),position=newPosition("16%","106px","30px",cas.top,cas.top),$.steps.push($.subStep(libStep,"You can categorize your slides for quick re-use. For example: file type, subject, industry, funnel-stage etc.",position)),position=newPosition("16%","106px","50px",cas.topRight,cas.topRight),$.steps.push($.subStep(libStep,"Combine your slides into pitch 'decks' using 'Pitch Perfect'. Just add a new deck, name it, and start adding the slides you need. Click (or Tap) on the slide to re-order and then Tap again on another slide. The slide will be placed in front of the slide you tap (or click).",position)),position=newPosition("425px","110px","275px"),$.steps.push($.subStep(libStep,"On a Mobile device, slide the item left to reveal options. For Desktops, just click the options drop down. Here you can edit an item, share it with your team or create a new meeting.",position)),position=newPosition("40%","300px","400px"),$.steps.push($.subStep(libStep,"Our 'Getting Started Guide' is a great way to get up to speed.",position,null,"ext"))},$.find=function(stateName){var idx=0,found=!1;return $.steps.some(function(step){return step.state==stateName?found=!0:idx++,found}),found?$.steps[idx]:{}},$.configure()}]),angular.module("RevuMe").factory("Users",["$resource","baseUrl",function($resource,baseUrl){var _idTarget=baseUrl.endpoint+"/api/users/:id",emailTarget=baseUrl.endpoint+"/api/users/email/:email",pwResetTarget=baseUrl.endpoint+"/api/users/password/reset/:email";return{byId:$resource(_idTarget,{id:"@id"},{update:{method:"PUT",params:{id:"@id"}}}),byEmail:$resource(emailTarget,{email:"@email"},{update:{method:"PUT",params:{email:"@email"}}}),pwReset:$resource(pwResetTarget,{email:"@email"},{reset:{method:"PUT",params:{email:"@email"}}})}}]).factory("TeamUsers",["$resource","baseUrl",function($resource,baseUrl){var target=baseUrl.endpoint+"/api/teams/justUsers/:id";return $resource(target,{id:"@id"},{update:{method:"PUT",params:{id:"@id"}}})}]).factory("Base64",[function(){var keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(input){var chr1,chr2,enc1,enc2,enc3,output="",chr3="",enc4="",i=0;do chr1=input.charCodeAt(i++),chr2=input.charCodeAt(i++),chr3=input.charCodeAt(i++),enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="";while(i<input.length);return output},decode:function(input){var chr1,chr2,enc1,enc2,enc3,output="",chr3="",enc4="",i=0,base64test=/[^A-Za-z0-9\+\/\=]/g;base64test.exec(input)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");do enc1=keyStr.indexOf(input.charAt(i++)),enc2=keyStr.indexOf(input.charAt(i++)),enc3=keyStr.indexOf(input.charAt(i++)),enc4=keyStr.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(15&enc2)<<4|enc3>>2,chr3=(3&enc3)<<6|enc4,output+=String.fromCharCode(chr1),64!=enc3&&(output+=String.fromCharCode(chr2)),64!=enc4&&(output+=String.fromCharCode(chr3)),chr1=chr2=chr3="",enc1=enc2=enc3=enc4="";while(i<input.length);return output}}}]).service("userService",["Users","TeamUsers","pnFactory","$q","$ionicPopup","$ionicPopover","$rootScope","Base64",function(Users,TeamUsers,pnFactory,$q,$ionicPopup,$ionicPopover,$rootScope,Base64){var $=this;$.user=Users,$.scope=$rootScope.$new(),$.directiveScope=void 0,$.creatingPopover=!1,$.createPopover=function(){void 0!=$.popover||$.creatingPopover||($.creatingPopover=!0,$ionicPopover.fromTemplateUrl("templates/autocomplete.html",{scope:$.scope}).then(function(pop){$.creatingPopover=!1,$.popover=pop}))},$.autoUser=void 0,$.showPopover=function(scope,el){$.autoUser=void 0,$.directiveScope=scope,$.popover.show(el)},$.hidePopover=function(scope){void 0!=$.popover&&$.popover.hide(),$.directiveScope=void 0},$.removePopover=function(scope){void 0!=$.popover&&($.popover.remove(),$.popover=void 0,$.directiveScope=void 0)},$.scope.auto={entries:[]},$.setResults=function(results){$.scope.auto.entries=results},$.getResults=function($index){return $.scope.auto.entries.length>0&&$index<$.scope.auto.entries.length?$.scope.auto.entries[$index]:void 0},$.callBacks=[],$.onAutoComplete=function(directiveScope){var cbPair={key:directiveScope.instanceName,callBack:directiveScope.doFinish};$.callBacks.push(cbPair)},$.doAutoComplete=function(directiveScope,$index){$.callBacks.forEach(function(cbPair){cbPair.key==directiveScope.instanceName&&cbPair.callBack($index)})},$.scope.finishComplete=function($index){$.doAutoComplete($.directiveScope,$index),$.autoUser=$.getResults($index)},$.getAutoUser=function(){var u=angular.copy($.autoUser);return $.autoUser=void 0,u},$.offAutoComplete=function(directiveScope){for(var found=[],i=$.callBacks.length-1;i>=0;i--)$.callBacks[i].key==directiveScope.instanceName&&found.push(i);found.forEach(function(index){$.callBacks.splice(index,1)})},$.find=function(query){return Users.byId.query(query).$promise},$.getAll=function($scope){var deferred=$q.defer();return Users.byId.query().$promise.then(function(users){$scope.allUsers=users,$scope.user.email="klynch@volerro.com",deferred.resolve();
}),deferred.promise},$.usersIKnow=function(query){if(void 0!=$rootScope.user._id){var userId=$rootScope.user._id,sendQuery={user:userId};for(var attrname in query)sendQuery[attrname]=query[attrname];return Users.byId.query(sendQuery).$promise}},$.getUser=function($scope){var defer=$q.defer();return $.getAll($scope).then(function(){var myPopup=$ionicPopup.show({template:'<select ng-model="user.email"><option ng-repeat="user in allUsers">{{user.email}}</option></select>',title:"Select Your Email",scope:$scope,buttons:[{text:"Cancel"},{text:"<b>Save</b>",type:"button-positive",onTap:function(e){return $scope.user.email?$scope.user.email:void e.preventDefault()}}]});myPopup.then(function(email){return $.user.byEmail.get({email:email}).$promise}).then(function(user){void 0==user._id&&defer.reject("not found"),defer.resolve(user)})["catch"](function(err){defer.reject(err)})}),defer.promise},$.checkExists=function(email){var defer=$q.defer();return $.user.byEmail.get({email:email}).$promise.then(function(user){void 0==user._id?defer.resolve(!1):defer.resolve(!0)})["catch"](function(err){defer.reject(err)}),defer.promise},$.signUp=function(newUser){var defer=$q.defer(),usr=new $.user.byId;return angular.extend(usr,newUser),usr.password=Base64.encode(usr.email+":"+usr.password),usr.$save().then(function(u){defer.resolve(u)})["catch"](function(err){defer.reject(err)}),defer.promise},$.resetPassword=function(credentials){var defer=$q.defer(),authData=Base64.encode(credentials.email+":"+credentials.password);credentials.password=authData;var oldAuthData=Base64.encode(credentials.email+":"+credentials.oldPassword);return credentials.oldPassword=oldAuthData,$.user.byEmail.update({email:credentials.email},credentials).$promise.then(function(response){defer.resolve(response)}),defer.promise},$.register=function($scope){var defer=$q.defer(),usr=new $.user.byId,myPopup=$ionicPopup.show({template:'<input type="name" placeholder="name" ng-model="user.name"><br><input type="email" placeholder="email" ng-model="user.email">',title:"Register on Revu.Me",scope:$scope,buttons:[{text:"Cancel"},{text:"<b>Save</b>",type:"button-positive",onTap:function(e){return $scope.user.email&&$scope.user.name?$scope.user:void e.preventDefault()}}]});return myPopup.then(function(user){var names=user.name.split(" ");usr.email=user.email,usr.firstName=names[0],usr.lastName=names[1],$scope.user.firstName=usr.firstName,$scope.user.lastName=usr.lastName,usr.$save().then(function(u){$scope.user._id=u._id,defer.resolve($scope.user)})["catch"](function(err){defer.reject(err)})}),defer.promise}}]).service("userMonitor",["$rootScope",function($rootScope){this.invited=[],this.present=[],this.everyone=[],this.init=function(attendees){this.invited=attendees,this.invited.forEach(function(usr){usr.userName=usr.firstName+" "+usr.lastName,usr._id==$rootScope.user._id?usr.itsme=!0:usr.itsme=!1})},this.rollCall=function(m){var found=!1;this.present=[];var $present=this.present;this.invited.forEach(function(usr){usr._id==m.uuid&&(found=!0,m.userName=usr.userName,"join"==m.action?(usr.isOnline=!0,$present.push(usr)):usr.isOnline=!1)}),found||console.log("we need to add an intruder!"),this.everyone=this.invited},this.noteEngagement=function(id,status){for(var i=0;i<this.everyone.length;i++)this.everyone[i]._id==id&&("distracted"==status?this.everyone[i].distracted=!0:this.everyone[i].distracted=!1)},$rootScope.$on("$destroy",function(){$.scope.$destroy()})}]),angular.module("RevuMe").controller("datetimeCtrl",["$scope","wizardService",function($scope,wizardService){function checkValid(){""!=$.name&&""!=$.description?$.wizardStep.valid=!0:$.wizardStep.valid=!1}$scope.step={};var $=$scope.step;$.date=new Date,$.time=$.date,$.name="",$.description="",$.idx=wizardService.findStep("templates/datetime.html"),$.wizardStep=wizardService.steps[$.idx],$scope.session=wizardService.sb.session,$.bridge=$scope.session.bridge,wizardService.sb.session.date=$.date;var hours=$.date.getHours();$.time.setHours(hours),$.time.setMinutes(0),$.time.setSeconds(0),$.time.setMilliseconds(0),wizardService.sb.session.time=$.time,$.datepickerObject=wizardService.datepickerObject,$.timePickerObject=wizardService.timePickerObject,$.timePickerObject.inputEpochTime=3600*$.time.getHours(),$.changeName=function(){wizardService.sb.session.name=$.name,checkValid()},$.changeDescription=function(){wizardService.sb.session.description=$.description,checkValid()},$.changeBridge=function(){wizardService.sb.session.bridge=$.bridge}}]).controller("sfdcCtrl",["$rootScope","$scope","wizardService","SalesforceService","$ionicModal","ionicToast","$timeout","$q","baseUrl","$ionicPopup",function($rootScope,$scope,wizardService,SalesforceService,$ionicModal,ionicToast,$timeout,$q,baseUrl,$ionicPopup){function buildQuery(){var sObj=$.object,ownerQs="Where owner.Name='"+$scope.nativeUser+"'",companyQs="",personQs="",qs="";""!=$.company&&(companyQs=sObj.query.where.company.replace("@company",$.company)),""!=$.person&&(personQs=sObj.query.where.person.replace("@person",$.person));var qs=sObj.query.base.replace("@owner",ownerQs).replace("@company",companyQs).replace("@person",personQs);return qs}$scope.sfdc={};var $=$scope.sfdc;$.banner=baseUrl.endpoint+"/img/sfdcBanner.png",$.img=baseUrl.endpoint+"/img/salesforce.png";var idx=wizardService.findStep("templates/attendees.html");$scope.step=wizardService.steps[idx],$scope.sObjects=[{name:"Account",query:{base:"Select (Select Name, Email, Account.Name from Contacts @person) from Account @owner @company",where:{company:"AND Name Like '@company%'",person:"Where Name Like '@person%'"}},processResults:function(results){var records=results.records,items=[];if(records.length>0){var validResult=!1;if(records.forEach(function(record){void 0!=record.Contacts&&(validResult=!0,record.Contacts.records.forEach(function(Contact){var u={};u.Name=Contact.Name,u.Email=Contact.Email,u.Company=Contact.Account.Name,items.push(u)}))}),!validResult){var u={Name:"No Records Found"};items.push(u),validResult=!0}}else{var u={Name:"No Records Found"};items.push(u)}return items}},{name:"Contact",query:{base:"Select Name, Email, Account.Name from Contact @owner @company @person",where:{company:"AND Account.Name Like '@company%'",person:"AND Name Like '@person%'"}},processResults:function(results){if(results.records.length>0)return results.records;var u={Name:"No Records Found"};return results.records.push(u),results.records}},{name:"Lead",query:{base:"Select Name, Email, Company from Lead @owner @company @person",where:{company:"AND Company LIKE '@company%'",person:"AND Name Like '@person%'"}},processResults:function(results){if(results.records.length>0)return results.records;var u={Name:"No Records Found"};return results.records.push(u),results.records}},{name:"Opportunity",query:{base:"Select Account.Name,(Select Contact.Name, Contact.Email from OpportunityContactRoles @person) from Opportunity @owner @company",where:{company:"AND Account.Name Like '@company%'",person:"Where Contact.Name Like '@person%'"}},processResults:function(results){var records=results.records,items=[],accountName="",exists=function(company){return items.some(function(item){return item.Company==company?!0:void 0})};if(records.length>0){var validResult=!1;if(records.forEach(function(record){if(accountName=record.Account.Name,!exists(accountName)){var ocr=record.OpportunityContactRoles;void 0!=ocr&&(validResult=!0,ocr.records.forEach(function(cr){var u={};u.Name=cr.Contact.Name,u.Email=cr.Contact.Email,u.Company=accountName,items.push(u)}))}}),!validResult){var u={Name:"No Records Found"};items.push(u),validResult=!0}}else{var u={Name:"No Records Found"};items.push(u)}return items}}],$.object=$scope.sObjects[1],$scope.init=function(){$.people=[],$.company="",$.person="";var idx=wizardService.findStep("templates/attendees.html");$scope.step=wizardService.steps[idx],$scope.step.attendees=[]},$scope.query=function(){var qs=buildQuery();qs=encodeURIComponent(qs),SalesforceService.query(qs).then(function(results){$timeout(function(){$.people=$.object.processResults(results)},0)})["catch"](function(error){console.log(error);var template="code : "+error.code;template+="<br> message : "+error.message;var alert=$ionicPopup.alert({title:"Salesforce API Error!",template:template});alert.then(function(){console.log("Alerted!")})})},$.changeAttendee=function(index){if($.people[index].included){var user=$.people[index],names=user.Name.split(" "),u={};u.firstName=names[0],u.lastName=names[1],u.email=user.Email,$scope.step.attendees.push(u);var msg=$.people[index].Name+" has been added";ionicToast.show(msg,"top",!1,2e3)}else{var user=$.people[index],idx=0,found=-1;if($scope.step.attendees.forEach(function(a){a.email==user.Email&&(found=idx),idx++}),found>=0){$scope.step.attendees.splice(found,1);var msg=user.Name+" has been removed";ionicToast.show(msg,"top",!1,2e3)}}},$.changePerson=function(){$scope.query()},$.changeCompany=function(){$scope.query()},$.changeObject=function(){$scope.init()},$scope.showSalesforce=function(fromWizard){void 0==fromWizard?$scope.fromWizard=!1:$scope.fromWizard=fromWizard,$rootScope.showLoading(),SalesforceService.getNativeUser().then(function(nativeUser){$scope.nativeUser=nativeUser,$scope.init(),$ionicModal.fromTemplateUrl("templates/sfdcAttendee.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){return $scope.sfdcModal=modal,$scope.sfdcModal.show()}).then(function(){$rootScope.hideLoading()})})},$scope.hideSalesforce=function(){var promises=[];$scope.step.attendees.forEach(function(attendee){promises.push(wizardService.sb.addAttendee(attendee))}),$q.all(promises).then(function(){$scope.sfdcModal.hide(),$scope.sfdcModal.remove(),$rootScope.$broadcast("Revu.Me:sfdcUpdate")})}}]).controller("attendeesCtrl",["$rootScope","$scope","wizardService","TeamService","ionicToast","$ionicPopup","$timeout","baseUrl","$q",function($rootScope,$scope,wizardService,TeamService,ionicToast,$ionicPopup,$timeout,baseUrl,$q){function eventName(event){var evt="step"+$.idx.toString()+"."+event;return evt}function checkValid(){var session=wizardService.sb.session;$.attendees=session.attendees.slice(0),session.attendees.length>0?$.wizardStep.valid=!0:$.wizardStep.valid=!1,$.setView(0)}$scope.step={};var $=$scope.step;$.idx=wizardService.findStep("templates/attendees.html"),$.wizardStep=wizardService.steps[$.idx],$.wizardStep.attendees=[],TeamService.getAll($rootScope.user._id).then(function(teams){$scope.teams=teams,$scope.teams.forEach(function(team){team.included=!1})}),$.showDelete=!1,$.showAdd=!1,$.views=[];var view=new Object;view.name="Invitees",$.views.push(view),view=new Object,view.name="Teams",$.views.push(view),view=new Object,view.name="",view.img=baseUrl.endpoint+"/img/salesforce.png",$.views.push(view),$scope.$on("Revu.Me:sfdcUpdate",function(){checkValid()}),$.setView=function(viewIdx){$.currentView=viewIdx,$.showAdd=!1;var cb=$.views[$.currentView].cb||function(){};cb()},$.setView(0),$.teamChange=function(index){var team=$scope.teams[index];if(1==team.included){wizardService.sb.addTeam(index),$.attendees=wizardService.sb.session.attendees.slice(0);var msg=team.members.length.toString()+" Members Added";ionicToast.show(msg,"top",!1,2e3)}else{wizardService.sb.removeTeam(index),$.attendees=wizardService.sb.session.attendees.slice(0);var msg=team.members.length.toString()+" Members Removed";ionicToast.show(msg,"top",!1,2e3)}checkValid()},$.delUser=function(idx){wizardService.sb.delAttendee(idx),checkValid()},$.addUser=function(){var user={};user.firstName=this.firstName,user.lastName=this.lastName,user.email=this.email.toLowerCase(),wizardService.sb.addAttendee(user).then(function(){var msg=$.firstName+" "+$.lastName+" has been added";ionicToast.show(msg,"top",!1,2e3),$.firstName=$.lastName=$.email="",checkValid()})},$.toggleShowDelete=function(){$.showDelete=!$.showDelete},$.addUserPopup=function(){function validateEmail(email){var re=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(email)}$.message="",$.firstName=$.lastName=$.email="",$.addMultiple=!1,$ionicPopup.show({scope:$scope,title:"Add New Invitee",templateUrl:"templates/addUserPopup.html",buttons:[{text:"Close",type:"button-assertive"},{text:"<b>Add</b>",type:"button-calm",onTap:function(e){if(""==$.firstName||""==$.lastName||""==$.email)$.message="Please Complete the Form!",$timeout(function(){$.message=""},2e3),e.preventDefault();else if(void 0==$.firstName||void 0==$.lastName||void 0==$.email)$.message="Please Complete the Form!",$timeout(function(){$.message=""},2e3),e.preventDefault();else if(validateEmail($.email)){if(!$.addMultiple)return!0;$.addUser(),e.preventDefault()}else $.message="Invalid Email!",$timeout(function(){$.message=""},2e3),e.preventDefault()}}]}).then(function(result){result===!0&&$.addUser()})},$scope.enter=wizardService.$on(eventName("enter"),function(){$.showAdd=$.showDelete=!1,$.setView(0)}),$scope.start=wizardService.$on("start",function(){$scope.teams=wizardService.sb.session.teamList,$scope.teams.forEach(function(team){team.included=!1}),$.attendees=[]}),$scope.$on("$destroy",function(){wizardService.$off($scope.enter),wizardService.$off($scope.start)})}]).controller("sharedContentCtrl",["$rootScope","$scope","wizardService",function($rootScope,$scope,wizardService){function eventName(event){var evt="step"+$.idx.toString()+"."+event;return evt}function insertBuildDeckinFront(){if(void 0!=$.wizardStep.buildIdx){var idx=$.wizardStep.buildIdx,theDeck=$.decks[idx];theDeck.added=!0,$.decks.splice(idx,1),$.decks.unshift(theDeck),$.wizardStep.buildIdx=void 0,checkValid()}}function loadDecks(){void 0==$.decks?$scope.sb.loadDecks().then(function(decks){void 0!=decks&&($.decks=decks),$rootScope.hideLoading(),insertBuildDeckinFront()}):($.decks=$scope.sb.decks,insertBuildDeckinFront())}function checkValid(){$scope.sb.session.decks.length>0?$.wizardStep.valid=!0:$.wizardStep.valid=!1}$scope.step={};var $=$scope.step;$.idx=wizardService.findStep("templates/sharedContent.html"),$.wizardStep=wizardService.steps[$.idx],$scope.sb=wizardService.sb,$scope.library=wizardService.sb.Library,loadDecks(),$scope.enter=wizardService.$on(eventName("enter"),function(){loadDecks()}),$.addDeck=function(index){$scope.sb.addDeck(index),checkValid()},$.delDeck=function(index){$scope.sb.delDeck(index),checkValid()},$scope.$on("$destroy",function(){wizardService.$off($scope.enter)})}]).controller("summaryCtrl",["$scope","wizardService","$timeout","$q","$ionicPopup",function($scope,wizardService,$timeout,$q,$ionicPopup){function checkValid(){$.decks.length>0&&$.attendees.length>0?$scope.wizardStep.valid=!0:$scope.wizardStep.valid=!1}function unsavedEdits(){var dirty=!1,ss=$scope.saveSession;return(ss.name!=$.name||ss.description!=$.description)&&(dirty=!0),(ss.bridge!=$.bridge||ss.length!=$.length)&&(dirty=!0),(ss.decks.length!=$.decks.length||ss.attendees.length!=$.attendees.length)&&(dirty=!0),$scope.saveDate!=$scope.datepickerObject.inputDate&&(dirty=!0),$scope.saveTime!=$scope.timePickerObject.inputEpochTime&&(dirty=!0),dirty}function confirmCancel(){var defer=$q.defer(),confirm=$ionicPopup.confirm({title:"Unsaved Changes",template:"Do you want to save your changes?"});return confirm.then(function(res){res?defer.resolve(!1):defer.resolve(!0)}),defer.promise}$scope.idx=wizardService.findStep("templates/summaryConfirm.html"),$scope.wizardStep=wizardService.steps[$scope.idx],$scope.modal=wizardService.modal,$scope.sb=wizardService.sb,$scope.saveSession=angular.copy(wizardService.sb.session),$scope.session=wizardService.sb.session,$scope.saveDate=wizardService.datepickerObject.inputDate,$scope.saveTime=wizardService.timePickerObject.inputEpochTime,$scope.saveDecks=angular.copy(wizardService.sb.decks);var $=$scope.session;$.shouldShowDelete=!1,$.showTeams=!1,$scope.datepickerObject=wizardService.datepickerObject,$scope.timePickerObject=wizardService.timePickerObject,$scope.datepickerObject.inputDate=wizardService.datepickerObject.inputDate,$scope.timePickerObject.inputEpochTime=wizardService.timePickerObject.inputEpochTime,checkValid(),$scope.$on("Revu.Me:sfdcUpdate",function(){checkValid()}),$scope.cancel=function(){switch(wizardService.action){case"New":case"Build":wizardService.sb.session=angular.copy($scope.saveSession),wizardService.datepickerObject.inputDate=$scope.saveDate,wizardService.timePickerObject.inputEpochTime=$scope.saveTime,wizardService.sb.decks=angular.copy($scope.saveDecks),wizardService.prevStep();break;case"Edit":unsavedEdits()?confirmCancel().then(function(cancel){cancel?wizardService.cancel():wizardService.complete()}):wizardService.cancel()}},$scope.confirm=function(){wizardService.complete()},$scope.showDecks=function(){wizardService.sb.subEdit($scope).then(function(){checkValid()})},$scope.delDeck=function($index){wizardService.sb.delDeck($index),checkValid()},$scope.addAttendee=function(){var fullName=$.formname,email=$.formemail,names=fullName.split(" "),user={};user.firstName=names[0],user.lastName=names[1],user.email=email,wizardService.sb.addAttendee(user).then(function(){$.formname="",$.formemail="",checkValid()})},$scope.delAttendee=function($index){wizardService.sb.delAttendee($index),checkValid()},$scope.addTeam=function(){wizardService.sb.addTeam(),checkValid()},$scope.toggleListDelete=function(){$.shouldShowDelete=!$.shouldShowDelete}}]).controller("wizardCtrl",["$rootScope","$scope","wizardService",function($rootScope,$scope,wizardService){$scope.step={},$scope.wizard=wizardService,$scope.wizard.name="Create a New Meeting",$scope.sb=wizardService.sb,wizardService.setStep(wizardService.current)}]).service("wizardService",["$rootScope","$ionicSlideBoxDelegate","$ionicScrollDelegate","$ionicModal","SessionBuilder","$q","ionicToast","onEvent",function($rootScope,$ionicSlideBoxDelegate,$ionicScrollDelegate,$ionicModal,SessionBuilder,$q,ionicToast,onEvent){function eventName(stepNumber,event){return"step"+stepNumber.toString()+"."+event}var $=this;$.steps=[],$.current=0,$.sb=SessionBuilder,$.action=void 0,$.ignoreSlide=!1,onEvent.attach($),$.initDateTime=function(){$.timePickerObject.inputEpochTime=3600*$.sb.session.time.getHours()+60*$.sb.session.time.getMinutes(),$.datepickerObject.inputDate=$.sb.session.date},$.init=function($scope){var deferred=$q.defer();return $.sb.init($scope).then(function(){$.current=0,$.scope=$scope,$.buildSteps(),$.datepickerObject={titleLabel:"Title",todayLabel:"Today",closeLabel:"Close",setLabel:"Set",setButtonType:"button-dark",todayButtonType:"button-stable",closeButtonType:"button-assertive",inputDate:$.sb.session.date,mondayFirst:!0,templateType:"popup",showTodayButton:"true",modalHeaderColor:"bar-positive",modalFooterColor:"bar-positive",from:new Date(2012,8,2),to:new Date(2018,8,25),callback:function(val){void 0!=val&&($.datepickerObject.inputDate=val,$.sb.session.date=val)},dateFormat:"dd-MM-yyyy",closeOnSelect:!1},$.timePickerObject={inputEpochTime:60*(new Date).getHours()*60,step:15,format:12,titleLabel:"12-hour Format",setLabel:"Set",closeLabel:"Close",setButtonType:"button-positive",closeButtonType:"button-stable",callback:function(val){if(void 0!=val){$.timePickerObject.inputEpochTime=val;var hours=Math.trunc(val/3600),minutes=(val-3600*hours)/60;$.time=$.sb.session.date,$.time.setHours(hours),$.time.setMinutes(minutes),$.time.setSeconds(0),$.time.setMilliseconds(0),$.sb.session.time=$.time}}},$.initDateTime(),deferred.resolve()}),deferred.promise},$.nextStep=function(){var c=$.current;$.setStep(++c)},$.prevStep=function(){var c=$.current;$.setStep(--c)},$.setStep=function(stepNumber){if($.ignoreSlide)$.ignoreSlide=!1;else if(0>=stepNumber&&(stepNumber=0),1==$.steps[$.current].valid||stepNumber<=$.current){var c=$.current,n=stepNumber;if($.$fire(eventName(c,"exit")),"modal"==$.steps[c].type&&void 0!=$.modal&&($.modal.hide(),$.modal.remove(),$.modal=void 0),$.$fire(eventName(n,"enter")),$.current=stepNumber,$.nextEnabled=!0,stepNumber>0&&($.prevEnabled=!0),"pane"==$.steps[$.current].type)$ionicSlideBoxDelegate.slide($.current),$ionicSlideBoxDelegate.update();else if("modal"==$.steps[$.current].type){var step=$.steps[$.current];$ionicModal.fromTemplateUrl(step.template,{scope:$.scope,animation:"slide-in-up"}).then(function(modal){$.modal=modal,$.modal.show()})}}else $.ignoreSlide=!0,$ionicSlideBoxDelegate.slide($.current)},$.buildSteps=function(){if($.steps.length>0)$.$fire("start"),$.steps.forEach(function(s){s.valid=!1});else{$.steps=[];var step={};step.heading="Date & Time",step.template="templates/datetime.html",step.showInLegend=!0,step.type="pane",$.steps.push(step),step={},step.heading="Who's Invited",step.template="templates/attendees.html",step.showInLegend=!0,step.type="pane",$.steps.push(step),step={},step.heading="Shared Content",step.template="templates/sharedContent.html",step.showInLegend=!0,step.type="pane",step.buildIdx=void 0,$.steps.push(step),step={},step.heading="Summary & Confirm",step.template="templates/summaryConfirm.html",step.showInLegend=!1,step.type="modal",$.steps.push(step),$.steps.forEach(function(s){s.valid=!1}),$.$fire("start"),$.stepsStandard=angular.copy($.steps)}},$.findStep=function(template){for(var idx=-1,i=0;i<$.steps.length;i++)if($.steps[i].template==template){idx=i;break}return idx},$.reorderSteps=function(){switch($.action){case"New":$.steps=angular.copy($.stepsStandard),$.current=0;break;case"Build":$.steps[0]=angular.copy($.stepsStandard[2]),$.steps[1]=angular.copy($.stepsStandard[0]),$.steps[2]=angular.copy($.stepsStandard[1]),$.steps[3]=angular.copy($.stepsStandard[3]),$.current=0;break;case"Edit":$.steps=angular.copy($.stepsStandard),$.steps.forEach(function(s){s.valid=!0}),$.current=3}},$["new"]=function($scope){return $.action="New",$.deferred=$q.defer(),$.init($scope).then(function(){return $.reorderSteps(),$.sb["new"](),$.initDateTime(),$ionicModal.fromTemplateUrl("templates/wizard.html",{scope:$.scope,animation:"slide-in-up"})}).then(function(modal){return $.wizardModal=modal,$.sb.connect(),$.wizardModal.show()}).then(function(){$rootScope.hideLoading()})["catch"](function(){$.sb.disconnect(),$rootScope.hideLoading()}),$.deferred.promise},$.build=function($scope,navItem,index){return $.action="Build",$.deferred=$q.defer(),$.init($scope).then(function(){return $.reorderSteps(),$.steps[0].buildIdx=index,$.sb.build(navItem,index),$.initDateTime(),$ionicModal.fromTemplateUrl("templates/wizard.html",{scope:$.scope,animation:"slide-in-up"})}).then(function(modal){return $.wizardModal=modal,$.sb.connect(),$.wizardModal.show()}).then(function(){$rootScope.hideLoading()})["catch"](function(){$.sb.disconnect(),$rootScope.hideLoading()}),$.deferred.promise},$.edit=function($scope,session){return $.action="Edit",$.deferred=$q.defer(),$.init($scope).then(function(){return $.reorderSteps(),$.sb.edit(session)}).then(function(){$.initDateTime();var step=$.steps[$.current];$ionicModal.fromTemplateUrl(step.template,{scope:$.scope,animation:"slide-in-up"}).then(function(modal){$.modal=modal,$.sb.connect(),$.modal.show(),$rootScope.hideLoading()})}),$.deferred.promise},$.complete=function(){switch($.sb.disconnect(),$.$fire("end"),void 0!=$.modal&&($.modal.hide(),$.modal.remove(),$.modal=void 0),$.action){case"New":case"Build":$.sb.saveSession().then(function(){$.wizardModal.hide(),$.wizardModal&&$.wizardModal.remove(),void 0!=$.deferred&&$.deferred.resolve()});break;case"Edit":$.sb.updateSession().then(function(session){ionicToast.show("Meeting has been updated","top",!1,2e3),$.wizardModal&&($.wizardModal.hide(),$.wizardModal.remove()),void 0!=$.deferred&&$.deferred.resolve(session)})}},$.cancel=function(){$.sb.disconnect(),void 0!=$.modal&&($.modal.hide(),$.modal.remove(),$.modal=void 0),void 0!=$.wizardModal&&$.wizardModal.hide(),$.$fire("end"),void 0!=$.wizardModal&&$.wizardModal.remove(),void 0!=$.deferred&&$.deferred.reject()}}]);