/* RevuMe - 2015-12-14 */"use strict";angular.module("RevuMe",["config","ionic","ngResource","ngAnimate","evaporate","ngCookies","FBAngular","braintree-angular","ngIOS9UIWebViewPatch","fileBox"]).run(["$ionicPlatform","$rootScope","$window","$http","userService","pnFactory","$timeout","$location","$state","$cookieStore","authService","$ionicLoading","$ionicHistory","Library","ScriptService","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),window.shouldRotateToOrientation=function(a){return!0}}),b.deepLink=!1,b.user={},b.archive={},b.archive.menu=!1,b.spinnerShowing=!1,b.toggleArchive=function(){b.archive.menu=!b.archive.menu,b.$broadcast("Revu.Me:Archive")},b.archiveOn=function(){var a=b.archive.menu;return a},b.showLoading=function(a){var c=a||"ripple";b.spinnerShowing||(b.spinnerShowing=!0,g(function(){l.show({template:'<ion-spinner icon="'+c+'"></ion-spinner>'})},0))},b.hideLoading=function(){b.spinnerShowing&&(b.spinnerShowing=!1,g(function(){l.hide()}))},b.history=m,b.userInit=function(a,d){var e=p.defer(),h=angular.extend({},d);return b.user._id=a._id,b.user.firstName=a.firstName,b.user.lastName=a.lastName,b.user.name=a.firstName+" "+a.lastName,b.user.email=a.email,b.user.authData=a.authData,o.userScript(a._id).then(function(d){return b.user.script=d,b.$broadcast("userID",b.user),b.mHandler=function(a){console.log("message from presence service",a)},b.pHandler=function(a){b.mainChannel.resolveUsers(a).then(function(c){b.users=c,console.log("got a status message",a),g(function(){b.$broadcast("presence_change")},0)})["catch"](function(a){console.log(a)})},f.init(a._id),b.mainChannel=f.newChannel("volerro_user"),b.mainChannel.setUser(b.user.name),b.mainChannel.subscribe(b.mHandler,b.pHandler),h.stealthMode||(b.isMobile?c.localStorage.setItem("user",JSON.stringify(b.user)):j.put("user",b.user)),b.$broadcast("Revu.Me:Ready"),b.isMobile||n.cacheImages().then(function(){"Cached "+n.cachedImages.length+" Images"}),e.resolve()}),e.promise},b.getLocalUser=function(){var a=c.localStorage.getItem("user"),b=void 0;return void 0!=a&&(b=JSON.parse(a)),b};var q={};q.isWebView=ionic.Platform.isWebView(),q.isIPad=ionic.Platform.isIPad(),q.isIOS=ionic.Platform.isIOS(),q.isAndroid=ionic.Platform.isAndroid(),q.isWindowsPhone=ionic.Platform.isWindowsPhone(),q.currentPlatform=ionic.Platform.platform(),q.currentPlatformVersion=ionic.Platform.version(),b.device=q,console.log("device is: ",b.device);var r=-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://");r?b.isMobile=!0:b.isMobile=!1,b.showArchive=!1,b.$on("$stateChangeStart",function(a,b,c,d,e){k.listen(a,b)}),b.goHome=function(){b.deepLink=!1,i.go("app.welcome")},b.newMeeting=function(a){i.go(a).then(function(){b.$broadcast("Revu.Me:NewMeeting")})},b.fullUrl=function(a){return baseUrl+a},b.screenSize=function(){var a=verge.viewportW(),b=verge.viewportH();return{width:a,height:b}},b.smallScreen=function(){var a=verge.viewportW();return 450>a?!0:!1},c.addEventListener("beforeunload",function(a){return void 0!=b.mainChannel&&b.mainChannel.unsubscribe(),null})}]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(a,b,c){c.views.maxCache(30),a.state("app",{url:"/app","abstract":!0,templateUrl:"templates/menu.html"}).state("app.welcome",{url:"/welcome",views:{menuContent:{templateUrl:"templates/splash.html",controller:"splashCtrl"}}}).state("app.tour",{url:"/tour",views:{menuContent:{templateUrl:"templates/splash.html",controller:"splashCtrl"}}}).state("app.signup",{url:"/signup",views:{menuContent:{templateUrl:"templates/signup.html",controller:"signupCtrl"}}}).state("app.signIn",{url:"/signin",views:{menuContent:{templateUrl:"templates/signin.html",controller:"signinCtrl"}}}).state("app.newMeeting",{url:"/newMeeting",views:{menuContent:{templateUrl:"templates/sessions.html",controller:"SessionsCtrl"}}}).state("app.library",{url:"/library",views:{menuContent:{templateUrl:"templates/library.html",controller:"libraryCtrl"}}}).state("app.mobileNewMeeting",{url:"/mobile/newMeeting",views:{menuContent:{templateUrl:"templates/sessions.html",controller:"SessionsCtrl"}}}).state("app.mobileLib",{url:"/mobile/library",views:{menuContent:{templateUrl:"templates/libNav.html",controller:"libraryCtrl"}}}).state("app.slideShow",{url:"/library/slideShow",views:{menuContent:{templateUrl:"templates/slideShow.html",controller:"slideShowCtrl"}}}).state("app.viewer",{url:"/viewer/:id?sessionId",resolve:{session:["Session","$stateParams","$q",function(a,b,c){var d,e=new c.defer,f={};return a.get({id:b.id}).$promise.then(function(a){f=a,d=0;f.decks[d]._id;e.resolve(f)})["catch"](function(a){e.reject(a)}),e.promise}]},views:{menuContent:{templateUrl:"templates/viewer.html",controller:"ViewCtrl"}}}).state("app.viewerSessions",{url:"/viewerSessions",views:{menuContent:{templateUrl:"templates/sessions.html",controller:"SessionsCtrl"}}}).state("app.sessions",{url:"/sessions",views:{menuContent:{templateUrl:"templates/sessions.html",controller:"SessionsCtrl"}}}).state("app.attendeeSessions",{url:"/attendeeSessions",views:{menuContent:{templateUrl:"templates/attendeeSessions.html",controller:"SessionsCtrl"}}}).state("app.session",{url:"/sessions/:id",resolve:{session:["Session","$stateParams","$q",function(a,b,c){var d,e=new c.defer,f={};return a.get({id:b.id}).$promise.then(function(a){if(void 0!=a._id){f=a,d=0;f.decks[d]._id;e.resolve(f)}else e.reject({})})["catch"](function(a){e.reject(a)}),e.promise}]},views:{menuContent:{templateUrl:"templates/session.html",controller:"SessionCtrl"}}}).state("app.attsession",{url:"/attsessions/:id",resolve:{session:["Session","$stateParams","$q",function(a,b,c){var d,e=new c.defer,f={};return a.get({id:b.id}).$promise.then(function(a){if(void 0!=a._id){f=a,d=0;f.decks[d]._id;e.resolve(f)}else e.reject({})})["catch"](function(a){e.reject(a)}),e.promise}]},views:{menuContent:{templateUrl:"templates/attendeesession.html",controller:"SessionCtrl"}}}).state("app.presentations",{url:"/presentations",views:{menuContent:{templateUrl:"templates/presentations.html",controller:"presentationsCtrl"}}}).state("app.presentation",{url:"/presentations/:id?idx",resolve:{session:["Session","Decks","$stateParams","$q",function(a,b,c,d){var e,f=new d.defer,g={};return a.get({id:c.id}).$promise.then(function(a){g=a,e=parseInt(c.idx);var d=g.decks[e]._id;return b.get({id:d}).$promise}).then(function(a){g.decks[e]=a,g.deckIdx=e,f.resolve(g)})["catch"](function(a){f.reject(a)}),f.promise}]},views:{menuContent:{templateUrl:"templates/presentation.html",controller:"presentationCtrl"}}}).state("app.revu",{url:"/revu/:id?uid",resolve:{session:["Session","Decks","$stateParams","$q",function(a,b,c,d){var e=new d.defer,f={};return a.get({id:c.id}).$promise.then(function(a){f=a;var c=[];return f.decks.forEach(function(a){c.push(b.get({id:a._id}).$promise)}),d.all(c)}).then(function(a){f.decks=[],a.forEach(function(a){f.decks.push(a)}),f.deckIdx=0,e.resolve(f)})["catch"](function(a){e.reject(a)}),e.promise}]},views:{menuContent:{templateUrl:"templates/review.html",controller:"reviewCtrl"}}}).state("app.teams",{url:"/teams",views:{menuContent:{templateUrl:"templates/teams.html",controller:"teamsCtrl"}}}).state("app.team",{url:"/team/:id?name",views:{menuContent:{templateUrl:"templates/team.html",controller:"teamsCtrl"}}}).state("app.newteam",{url:"/newTeam",views:{menuContent:{templateUrl:"templates/team.html",controller:"teamsCtrl"}}}).state("app.batman",{url:"/batman",views:{menuContent:{templateUrl:"templates/batman.html",controller:"batmanCtrl"}}}).state("app.settings",{url:"/settings",views:{menuContent:{templateUrl:"templates/settings.html",controller:"settingsCtrl"}}}).state("app.changePassword",{url:"/changepassword",views:{menuContent:{templateUrl:"templates/changePassword.html",controller:"changePasswordCtrl"}}}).state("app.confirmEmail",{url:"/confirmEmail/:id?",resolve:{user:["Users","DoConfirm","$stateParams","$q",function(a,b,c,d){var e=new d.defer,f=a.byId;return b.confirm({id:c.id}).$promise.then(function(a){a.success?f.get({id:c.id}).$promise.then(function(a){e.resolve(a)}):e.reject(a.reason)}),e.promise}]},views:{menuContent:{templateUrl:"templates/emailConfirmed.html",controller:"confirmCtrl"}}}).state("app.userAdmin",{url:"/useradmin",views:{menuContent:{templateUrl:"templates/userAdmin.html",controller:"userAdminCtrl"}}}).state("app.myAccount",{url:"/myAccount",views:{menuContent:{templateUrl:"templates/myAccount.html",controller:"accountCtrl"}}}).state("app.payment",{url:"/payment",views:{menuContent:{templateUrl:"templates/payment.html",controller:"paymentCtrl"}}}).state("app.changeCard",{url:"/changeCard",views:{menuContent:{templateUrl:"templates/changeCard.html",controller:"cardCtrl"}}}),b.otherwise("/app/signup")}]),angular.module("config",[]).constant("baseUrl",{name:"production",endpoint:"https://m.revu.me",volerro:"https://rb.volerro.com"}).constant("buildDate","Mon Dec 14 2015 19:21:33 GMT-0600 (CST)").constant("clientTokenPath","https://m.revu.me/api/braintree/client_token").constant("redirectUrl","https://m.revu.me/").constant("helloInitParams",{dropbox:"f9cdswrtfz1jsd9",box:"11rseev2g1yripmmx833cp5jhiqy82v2",google:"945597499290-106uaa9etsaft53ln0olrv8dbse6h9an.apps.googleusercontent.com",windows:"000000004C17505E"}),angular.module("RevuMe").controller("batmanCtrl",["$scope","$rootScope","$cookieStore","userService","$state","Library","introContent","buildDate","ScriptService","Braintree","$timeout",function(a,b,c,d,e,f,g,h,i,j,k){function l(){k(function(){b.user.batman=!0,a.utility.actions[1].name="Stop Snooping...",a.utility.actions[1].action=a.logOutAs},0)}function m(){k(function(){b.user.batman=!1,a.utility.actions[1].name="Log In As..",a.utility.actions[1].action=a.logInAs},0)}a.build={date:h},a.Library=f,a.start=new Date,a.clearUserCookie=function(){c.remove("user")},a.logInAs=function(){b.user={},b.user.email="klynch@volerro.com",d.getUser(b).then(function(a){b.userInit(a,{stealthMode:!0}),l(),e.go("app.welcome")},function(a){console.log(a)})},a.logOutAs=function(){b.isMobile?b.user=a.ls.user:b.user=c.get("user"),m()},a.setIntroContent=function(){b.user={},b.user.email="klynch@volerro.com",d.getUser(b).then(function(a){g.addIntroContent(a._id).then(function(){b.userInit(a,{stealthMode:!0}),l(),e.go("app.welcome")})},function(a){console.log(a)})},a.userAdmin=function(){e.go("app.userAdmin")},a.setToTrial=function(){i.setToTrial().then(function(a){return b.user.script=a,j.cancel(a)}).then(function(){b.user.script.braintreeId=void 0,b.user.script.members[0].user=b.user})["catch"](function(a){console.log(a)})},a.utility={actions:[{name:"Clear User Cookie",action:a.clearUserCookie},{name:"Log In As..",action:a.logInAs},{name:"Set Intro Content",action:a.setIntroContent},{name:"User Admin",action:a.userAdmin},{name:"Set to Trial",action:a.setToTrial}]},a.ls={},a.ls.user=b.getLocalUser()}]),angular.module("RevuMe").controller("cardCtrl",["$scope","$rootScope","Braintree","ScriptService","$state","baseUrl","$http","$q",function(a,b,c,d,e,f,g,h){a.init=function(){a.paymentDisabled=!1,a.script=d,a.script=d.getPendingScript(),a.status={},a.script.cost=d.calculateCost(a.script),a.processCardDisabled=!1,c.init(a,a.pmrCallback),void 0!=a.script.customerId?c.findCustomer(a.script).then(function(b){a.script.customer=b,a.script.defaultMethod=void 0,a.showCardEntry=!0,b.paymentMethods.forEach(function(b){b["default"]&&(a.script.defaultMethod=b)})}):a.showCardEntry=!1,a.dropinOptions={onPaymentMethodReceived:function(a){c.changeCard(a)},onError:function(a){console.log(a)}}},a.pmrCallback=function(){a.status.message="New Card Successfully Added",a.showCardEntry=!1,a.processCardDisabled=!0},a.cancel=function(){e.go("app.myAccount")},void 0==b.user.script?b.$on("Revu.Me:Ready",function(b,c){a.init()}):a.init()}]),angular.module("RevuMe").controller("libraryCtrl",["$scope","$rootScope","$state","$window","$timeout","$resource","Library","$ionicScrollDelegate","$ionicListDelegate","$ionicPopup","SessionBuilder","baseUrl","shareMediator","slideShow","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){a.addingTo.user={},a.addingTo.user._id=b.user._id,a.addingTo.slides=[],a.addingTo.thumb="",a.addingTo.isArchived=!1,g.newNavItem(a).then(function(b){g.updateModel(a).then(function(){e(function(){a.endNavAdd()},0)})})["catch"](function(a){var b=j.alert({title:"Error",template:"Error Code: "+a});b.then(function(){})})}function q(a){a.navItems.forEach(function(a){a.sharedTeams=[]})}function r(a){var b=j.confirm({title:"Delete "+a,template:"Are you sure to delete this?"});return b}function s(){b.smallScreen()&&"app.library"==c.current.name&&c.go("app.mobileLib"),a.width=verge.viewportW(),a.width<=1100?e(function(){a.navClass="col col-50",a.thumbClass="col col-50"},0):e(function(){a.navClass="col col-33",a.thumbClass="col col-67"},0),h.scrollTop()}function t(a,b,c){var d=a.slides[c],e=0;b>c&&b--,a.slides.splice(c,1),a.slides.splice(b,0,d),a.slides.forEach(function(a){a.originalOrder=e++}),e=0}function u(b,c,d,f){var g=a.navItems[b].actions[c];g.name="Done",g.callBack=v,a.editContainer(b),"button"!=f?(a.navItems[b].actions[0].name="Editing...",a.navItems[b].actions[0]["class"]="button-assertive"):(d.stopPropagation(),g["class"]="button-assertive"),e(function(){a.navItems[b].action.selected=a.navItems[b].actions[0]},0)}function v(b,c,d,f){var g=a.navItems[b].actions[c];g.name="Edit",g.callBack=u,a.editContainer(b),"button"!=f?(a.navItems[b].actions[0].name="Options",a.navItems[b].actions[0]["class"]="button-positive"):(g["class"]="button-positive",d.stopPropagation()),e(function(){a.navItems[b].action.selected=a.navItems[b].actions[0]},0)}function w(b,c,d,e){"button"==e&&d.stopPropagation(),"files"==a.modelName?g.newDeckFromFile(a.navItems[b]).then(function(c){a.buildSession(c),a.navItems[b].action.selected=a.navItems[b].actions[0]}):(a.buildSession(a.navItems[b]),a.navItems[b].action.selected=a.navItems[b].actions[0])}function x(b,c,d,e){"button"==e&&d.stopPropagation(),a.selectedNavId=b,m.shareItem(b),a.navItems[b].action.selected=a.navItems[b].actions[0]}function y(c,d,e,f){"button"==f&&e.stopPropagation(),b.archiveOn()?a.unArchiveNavItem(c):a.archiveNavItem(c),a.navItems[c].action.selected=a.navItems[c].actions[0]}function z(b,c,d,e){"button"==e&&d.stopPropagation(),a.selectedNavId=b,n.startSlideShow(a.navItems[b]),a.navItems[b].action.selected=a.navItems[b].actions[0]}function A(a){a.actions=[{name:"Options"},{name:"Edit","class":"button-positive"},{name:"Meeting","class":"button-calm"},{name:"Show","class":"button-balanced"},{name:"Share","class":"button-royal"},{name:"Archive","class":"button-energized"}],a.actions[1].callBack=u,a.actions[2].callBack=w,a.actions[3].callBack=z,a.actions[4].callBack=x,a.actions[5].callBack=y,a.editActions=[{name:"Editing..."},{name:"Done","class":"button-assertive"},{name:"Meeting","class":"button-calm"},{name:"Show","class":"button-balanced"},{name:"Share","class":"button-royal"},{name:"Archive","class":"button-energized"}],a.editActions[1].callBack=v,a.editActions[2].callBack=w,a.editActions[3].callBack=z,a.editActions[4].callBack=x,a.editActions[5].callBack=y}a.w=angular.element(d),a.init=function(){a.scrollDelegate=h,k.init(a),a.title="Slide Library",a.library=g,g.init(a),a.baseUrl=l.endpoint,a.slidePartial=l.endpoint+"/templates/slideItems.html",a.navPartial=l.endpoint+"/templates/navItems.html",a.sb=k,s(),a.user={},a.progress="0%",a.spinner=!1,a.timeLeft=0,A(a),a.selectedNavId=0,a.navItems=[],a.listName="Uploaded Files",a.setModel("files"),a.tap={on:!1,index:0},i.showDelete(!1),a.deck={name:""},a.category={name:""},a.addingTo=void 0,b.archiveOn()||(a.showAddItem=!0),m.init(a),a.fileTypes=void 0,g.fileTypes().then(function(b){a.fileTypes=b})},a.slideOver=function(){a.$broadcast("library::slide")},a.slideBack=function(){a.$broadcast("!library::slide")},a.editButton=function(b){return a.navItems[b].beingEdited?"Done":"Edit"},a.buildSession=function(b){a.sb.init(a).then(function(){return a.sb.build(b)}).then(function(){a.slideBack()})["catch"](function(b){a.slideBack()})},a.addSlide=function(b){g.addSlide(a,b)},a.addAll=function(){g.addAll(a)},a.deleteSlide=function(b){g.deleteSlide(a,b)},a.playVideo=function(b){a.slides[b].playing=!0},a.editContainer=function(b){a.isEditing?g.closeCollection(a,b):(a.slideOver(),g.openCollection(a,b))},a.doRefresh=function(){g.updateView().then(function(){a.$broadcast("scroll.refreshComplete")})},a.addDeck=function(){a.addingTo=new g.decks,a.addingTo.name=a.deck.name,p()},a.addCategory=function(){a.addingTo=new g.categories,a.addingTo.name=a.category.name,p()},a.setModel=function(c){switch(b.showLoading(),a.modelName=c,c){case"files":a.listName="Uploaded Files",a.showEdit=!1,g.setModel(a,g.files);break;case"decks":a.listName="Your Decks",a.showEdit=!0,g.setModel(a,g.decks);break;case"categories":a.listName="Your Categories",a.showEdit=!0,g.setModel(a,g.categories)}g.updateModel(a).then(function(){q(a),b.hideLoading(),e(function(){h.scrollTop()},0)})},a.toggleNavAdd=function(){a.showAddItem?a.endNavAdd():a.addNavItem()},a.addNavItem=function(){a.deck.name="",a.category.name="",a.showAddItem=!0},a.endNavAdd=function(){a.showAddItem=!1,i.showDelete(!1)},a.delNavItem=function(b){var c=a.navItems[b].name;r(c).then(function(c){c&&g.removeNavItem(a,b).then(function(){g.updateView()})})},a.toggleListDelete=function(){i.showDelete()?i.showDelete(!1):i.showDelete(!0)},a.setNavSelection=function(c){b.showLoading(),a.slideOver(),a.selectedNavId=c,g.updateSlides(a).then(function(){b.hideLoading()})},a.shareNavItem=function(c){TeamService.getAll(b.user._id).then(function(b){a.teams=b,a.selectedNavId=c,a.shareModal.show()})["catch"](function(a){console.log("library controller shaveNavItem - error: ",a)})},a.cancelNavShare=function(){a.shareModal.hide()},a.updateNavSharing=function(){console.log("updating sharing status for item: ",a.selectedNavId),console.log("Teams are...",a.teams),console.log("Sharing status is :",a.navItems[a.selectedNavId].sharedTeams),g.shareNavItem(a).then(function(){a.shareModal.hide()})},a.tapThumb=function(b){if(!a.isEditing&&a.navItems[a.selectedNavId]._$Reorder){var c=b,d=a.tap.index;a.tap.on&&(t(a,c,d),g.updateNavItem(a)),a.tap.on=!a.tap.on,a.tap.index=b}},a.archiveNavItem=function(b){console.log("Archive Nav Item: ",b),a.navItems[b].isArchived=!0,g.setArchive(a,b).then(function(){g.updateView()})},a.unArchiveNavItem=function(b,c){c.stopPropagation(),c.preventDefault(),console.log("UnArchive Nav Item: ",b),a.navItems[b].isArchived=!1,g.setArchive(a,b).then(function(){g.updateView()})},a.$on("$destroy",function(){void 0!=a.shareMediator&&a.shareMediator.destroy(),void 0!=channel&&channel.unsubscribe()}),a.w.on("orientationchange",function(){s()}),a.w.bind("resize",function(){s()}),void 0==b.user._id?b.$on("Revu.Me:Ready",function(b,c){a.init()}):a.init(),a.$on("$ionicView.enter",function(){void 0!=b.user._id&&"app.library"==c.current.name&&setTimeout(function(){g.init(a),a.setModel(a.modelName)},0)}),a.$on("Revu.Me:Archive",function(c){g.updateModel(a),b.archiveOn()?(a.title="Slide Library ARCHIVE",a.showAddItem=!1):(b.isMobile||b.smallScreen()||b.archiveOn()||(a.showAddItem=!0),a.title="Slide Library")}),a.$on("SUCCESS",function(){alert("ALL LOADED")}),a.tourShow=function(){var b=0,c=-1;a.navItems.forEach(function(a){"Getting Started.pptx"==a.name&&(c=b),b++}),c>=0&&n.startSlideShow(a.navItems[c])}}]),angular.module("RevuMe").controller("accountCtrl",["$scope","$rootScope","Braintree","ScriptService","$ionicScrollDelegate","$ionicModal","$ionicPopup","TeamService","userService","$state","$filter","$q",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){a.autoRenew?a.renewMessage="Subscription Renews in "+a.daysLeft+" days":a.renewMessage="Subscription Expires in "+a.daysLeft+" days"}function n(b){"Trial"==b.type?a.changeButton={text:"Upgrade Account"}:("Monthly"==b.type||"Annually"==b.type)&&(a.changeButton={text:"Change Account"})}function o(a){var b=g.confirm(a);return b}function p(){a.currentMembers=[],a.script.members.forEach(function(b){a.currentMembers.push(b)})}function q(){a.script.members=[],a.currentMembers.forEach(function(b){a.script.members.push(b)}),a.script.availableSeats=a.script.totalSeats-a.script.members.length}a.sd=e,a.User=i.user,f.fromTemplateUrl("templates/manageSeats.html",{scope:a,animation:"slide-in-up"}).then(function(b){a.seatModal=b}),a.init=function(){c.init(a),a.showChange=!1,a.script=b.user.script,void 0!=a.script.customerId&&c.findCustomer(a.script).then(function(b){a.script.customer=b,a.script.defaultMethod=void 0,a.showCardEntry=!1,b.paymentMethods.forEach(function(b){b["default"]&&(a.script.defaultMethod=b)})}),n(a.script),a.script.daysLeft=d.getDaysLeft(a.script),a.script.scriptTypes=d.scriptTypes,a.script.cost=d.calculateCost(a.script),m(a.script);var e=[{user:b.user._id,role:"Admin"}];a.order=d.newScript(d.scriptTypes[1],e),("Monthly"==a.script.type||"Annually"==a.script.type)&&(a.order.totalSeats=a.script.totalSeats,a.order.type=a.script.type),a.order.scriptTypes=d.scriptTypes.slice(1,3),a.order.stopRenew=!a.script.autoRenew,a.order.price=d.calculateCost(a.order),a.order.hint="Pay Annually and Save $"+d.annualSavings(a.order),a.admin=d.getAdmin(a.script),a.script.members.forEach(function(a){a.user.name=a.user.firstName+" "+a.user.lastName}),a.script.showTeams=!1,a.form={},h.getAll(b.user._id).then(function(b){a.script.teamList=b,a.script.teamList.length>0&&(a.script.team=a.script.teamList[0])}),a.newMember={}},a.changeAccount=function(){a.showChange=!0},a.cancelChange=function(){a.showChange=!1},a.changeTerm=function(){if("Trial"!=a.script.type)if("Monthly"==a.order.type&&"Annually"==a.script.type){var b={title:"Downgrade to Monthly",template:"Please Confirm Monthly Billing"};o(b).then(function(b){if(b){var e=k("date")(a.script.expirationDate,"shortDate");a.script.type=a.order.type,d.update(a.script._id,a.script),c.updateBTScript(a.script),a.order.hint="Monthly Billing Starts "+e}else a.order.type="Annually"})}else c.isAnnualPlan(a.script).then(function(b){b?(a.script.autoRenew=!0,a.script.type="Annually",d.update(a.script._id,a.script),c.updateBTScript(a.script),a.order.hint="Annual Plan Reinstated"):a.updateOrderSize()})},a.decreaseSeats=function(){var b=a.script,e=a.order,f=l.defer(),g={title:"Reduce Seats",template:"Please Confirm Fewer Seats"};return o(g).then(function(a){a?(b.totalSeats=e.totalSeats,b.availableSeats=b.totalSeats-b.members.length,c.updateBTScript(b).then(function(){return d.update(b._id,b)}).then(function(){f.resolve()})["catch"](function(a){f.reject(a)})):f.resolve()}),f.promise},a.changeSeatCount=function(){var b=a.order,c=a.script;b.totalSeats<c.totalSeats?a.decreaseSeats().then(function(){a.updateOrderSize()}):a.updateOrderSize()},a.updateOrderSize=function(){a.order.price=d.calculateCost(a.order);var b=d.annualSavings(a.order),c=k("number")(b,0);switch(a.order.type){case"Monthly":a.order.hint="Pay Annually and Save $"+c;break;case"Annually":a.order.hint="You Save $"+c+"!"}},a.renewChange=function(){a.script.autoRenew=!a.order.stopRenew,d.update(a.script._id,a.script),c.updateBTScript(a.script),m(a.script)},a.checkout=function(){var b=angular.copy(a.script);a.order.show=!1,a.sd.scrollTop(),a.sd.resize(),b.totalSeats=a.order.totalSeats,b.type=a.order.type,d.setPendingScript(b),j.go("app.payment")},a.changeCard=function(){j.go("app.changeCard")},a.manageSeats=function(){p(),a.seatModal.show()},a.cancelManager=function(){a.seatModal.hide(),q()},a.setPendingScript=function(){a.script.totalSeats=a.order.totalSeats,a.script.type=a.order.type},a.addMember=function(){var b=new Object,c=-1,d=a.newMember.name.split(" ");b.name=a.newMember.name,b.firstName=d[0],b.lastName=d[1],b.email=a.newMember.email,a.User.byEmail.get({email:b.email}).$promise.then(function(d){if(void 0==d._id){var e=new a.User.byId;angular.extend(e,b),e.$save().then(function(d){c=d._id,a.script.members.push({user:b,role:"Viewer"}),a.newMember.name="",a.newMember.email=""})["catch"](function(a){console.log(a)})}else b._id=d._id,a.script.members.push({user:b,role:"Viewer"}),a.newMember.name="",a.newMember.email="";a.script.availableSeats=a.script.totalSeats-a.script.members.length})["catch"](function(a){console.log(a)}),this.forms.members.aName.$dirty=!1,this.forms.members.aEmail.$dirty=!1},a.delMember=function(b){a.script.members.splice(b,1),a.script.availableSeats=a.script.totalSeats-a.script.members.length},a.addTeam=function(){a.script.team.members.forEach(function(b){a.script.availableSeats>0&&(b.name=b.firstName+" "+b.lastName,a.script.members.push({user:b,role:"Viewer"}),a.script.availableSeats=a.script.totalSeats-a.script.members.length)})},a.$on("$ionicView.enter",function(){void 0!=b.user._id&&"app.myAccount"==j.current.name&&setTimeout(function(){a.init()},0)}),void 0==b.user.script?b.$on("Revu.Me:Ready",function(b,c){a.init()}):a.init()}]),angular.module("RevuMe").controller("paymentCtrl",["$scope","$rootScope","Braintree","ScriptService","$state","baseUrl","$http","$q",function(a,b,c,d,e,f,g,h){a.status={message:void 0,errors:void 0},a.init=function(){a.paymentDisabled=!1,a.script=d.getPendingScript(),a.status={message:void 0,errors:void 0},a.script.cost=d.calculateCost(a.script),a.processCardDisabled=!1,c.init(a,a.pmrCallback).then(function(){console.log("payment controlller init: script is: ",a.script),void 0!=a.script.customerId?c.findCustomer(a.script).then(function(b){a.script.customer=b,a.script.defaultMethod=void 0,a.showCardEntry=!1,b.paymentMethods.forEach(function(b){b["default"]&&(a.script.defaultMethod=b)})}):a.showCardEntry=!0,a.dropinOptions={onPaymentMethodReceived:function(a){c.payMethReceived(a)},onError:function(a){console.log(a)}}})},a.pmrCallback=function(){a.status.message="Successfully Processed - Thank You!",a.showCardEntry=!1,a.processCardDisabled=!0},a.defaultPay=function(){a.paymentDisabled=!0,a.status.message="Processing Payment...",a.status.errors=void 0,c.updateBTScript(a.script).then(function(b){return a.showCardEntry=!1,d.update(a.script._id,a.script)}).then(function(c){b.user.script=angular.copy(a.script),a.status.message="Completed Successfully - Thank You!"})["catch"](function(b){a.status.errors=b.errors,a.status.errorMessage="Failed : "+b.message})},a.cancelOrder=function(){e.go("app.myAccount")},a.$on("$ionicView.enter",function(){void 0!=b.user._id&&"app.payment"==e.current.name&&setTimeout(function(){a.init()},0)}),void 0==b.user.script?b.$on("Revu.Me:Ready",function(b,c){a.init()}):a.init()}]),angular.module("RevuMe").controller("presentationCtrl",["$scope","$rootScope","$stateParams","$timeout","pnFactory","$ionicSlideBoxDelegate","session","userMonitor","recorder","presAnalyzer","BridgeService","$ionicScrollDelegate",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){a.session.attendees.forEach(function(a){a.initials=a.firstName[0]+a.lastName[0]});var b=a.session.organizer;b.initials=b.firstName[0]+b.lastName[0]}function n(){var a={action:"end"};i.record(a)}function o(b){var c={action:"new",value:b,caller:"newPresentation"};i.record(c),a.channel.publish(c)}function p(b){if(b.caller="handlePresence",h.rollCall(b),void 0!=b.userName){i.record(b);var c=b.userName+" has ";switch(b.action){case"join":c+="joined";break;case"leave":case"timeout":c+="left"}d(function(){a.everyone=h.everyone,a.present=h.present,a.$broadcast("show_message",c)},0),console.log(a.everyone)}}function q(b){switch(b.action){case"engagement":var c=b.who+" is "+b.status;console.log(c),b.caller="handleMessage",i.record(b),h.noteEngagement(b.id,b.status),d(function(){a.everyone=h.everyone},0)}}a.footerClasses=["normal","tall","hidden"],a.footer={},a.footer.index=0,a.footer["class"]=a.footerClasses[a.footer.index],a.session=g,a.deckIdx=g.deckIdx,a.name=g.name,a.presentation=a.session.decks[a.deckIdx],a.bridgeService=k,a.init=function(){m(),a.current=0,a.showUsers=!0;var d=a.session.attendees;d.push(a.session.organizer),h.init(d),a.everyone=d,a.present=[],a.mapShowing=!1,a.buttonText="Show All";var g=c.id.toString()+".view_channel";a.channel=e.newChannel(g),a.channel.setUser(b.user.name),i.setChannel(a.channel),k.setChannel(a.channel),a.channel.subscribe(q,p),o(a.presentation._id),a.setSlide(a.current),f.update(),a.session.bridge&&!a.bridgeService.activeBridge()&&a.bridgeService.startBridge(a.session.ufId)},a.showDialin=function(){k.showBridgeInfo()},a.endPresentation=function(){n();var b=j.analyze(i["export"]()),d={session:c.id,presentation:a.presentation._id,results:b};j.save(d).then(function(a){console.log(a)})},a.cleanUp=function(){a.endPresentation(),"undefined"!=a.channel&&a.channel.unsubscribe()},a.toggleShowUsers=function(){a.footer.index+=1,a.footer.index==a.footerClasses.length&&(a.footer.index=0),a.footer["class"]=a.footerClasses[a.footer.index]},a.toggleMap=function(){a.mapShowing=!a.mapShowing,a.buttonText=a.mapShowing?"Hide All":"Show All"},a.nextSlide=function(){a.setSlide(++a.current),f.slide(a.current),f.update()},a.prevSlide=function(){a.setSlide(--a.current),f.slide(a.current),f.update()},a.setSlide=function(b){b>=a.presentation.slides.length-1?(a.current=a.presentation.slides.length-1,a.nextEnabled=!1,a.prevEnabled=!0):0>=b?(a.current=0,a.prevEnabled=!1,a.nextEnabled=!0):(a.current=b,a.nextEnabled=!0,a.prevEnabled=!0),a.viewingSlide=a.presentation.slides[a.current];var c=a.current.toString(),d={action:"set",value:c,caller:"setSlide"};i.record(d),a.channel.publish(d),a.$broadcast("slideChange",c)},a.viewIdx=function(){return a.current},a.$on("$destroy",function(){a.cleanUp()}),void 0==b.user._id?b.$on("Revu.Me:Ready",function(b,c){a.init()}):a.init(),a.updateSlideStatus=function(a){var b=l.$getByHandle("scrollHandle"+a).getScrollPosition().zoom;1==b?f.enableSlide(!0):f.enableSlide(!1)}}]),angular.module("RevuMe").controller("resetPasswordCtrl",["$scope","$rootScope","userService","$timeout","$ionicPopup",function(a,b,c,d,e){a.resetPassword=function(){var b={};if(b.email=a.forms.resetPw.email,b.oldPassword=a.forms.resetPw.oldPassword,b.password=a.forms.resetPw.newPassword,b.repeat=a.forms.resetPw.repeat,b.password!=b.repeat){var d=e.alert({title:"Uh Oh!",template:"New Password Fields Don't Match"});d.then(function(a){})}else a.forms.resetPw.message="",c.checkExists(b.email).then(function(a){if(a)c.resetPassword(b).then(function(a){if(a.success){var b=e.alert({title:"Success!",template:"Your Password is Reset"});b.then(function(a){})}else{var b=e.alert({title:"Reset PW Error",template:a.reason});b.then(function(a){})}});else{var d=e.alert({title:"Reset PW Error",template:b.email+" not found"});d.then(function(a){})}})["catch"](function(a){console.log(a)})}}]),angular.module("RevuMe").controller("reviewCtrl",["$scope","$rootScope","$stateParams","$timeout","$window","session","$ionicSlideBoxDelegate","$ionicModal","EngagementMetrics","Revu","$q",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){a.cleanUp(),e.location.href="https://www.revu.me"}function m(a){if(void 0!=a.timeout){d.cancel(a.timeout);console.log("startTimeout - killing orphaned timeout")}a.timeout=d(function(){l(a)},w)}function n(a){var b=!1;void 0!=a.timeout&&(b=d.cancel(a.timeout),console.log("cancel timeout = ",b),a.timeout=void 0)}function o(a){var b={};n(a),b.timeStamp=Date.now(),b.deckIdx=a.deckIdx,b.page=u;var c=a.metrics.views.length;if(c>0){var d=a.metrics.views[c-1];d.duration=(b.timeStamp-d.timeStamp)/1e3}a.metrics.views.push(b),b.page>=0&&m(a)}function p(a){var c={};return c.viewers=[],c.slideViews=[],c.viewers.push(b.user._id),c.session=a.session._id,c.eventDate=new Date,c}function q(a){var c=[],d=p(a),e=a.metrics.views[0].deckIdx;return d.deck=a.session.decks[e]._id,a.metrics.views.forEach(function(f){if((f.deckIdx!=e||-1==f.page)&&(c.push(d),d=p(a),e=f.deckIdx,d.deck=a.session.decks[e]._id),f.page>=0){var g={},h={};g.slideIndex=f.page,
g.duration=f.duration,g._id=a.session.decks[f.deckIdx].slides[f.page]._id,g.views=[],h.userName=b.user.name,h.viewed=f.duration,h._id=g._id,g.views.push(h),d.slideViews.push(g)}}),c}function r(a){a.metrics.user=b.user,a.session.who=b.user,o(a),m(a),j.start.send({},a.session)}function s(a){var b=k.defer(),c=[];return a.forEach(function(a){var b=new i;angular.extend(b,a),c.push(b.$save())}),k.all(c).then(function(){b.resolve()})["catch"](function(a){b.reject()}),b.promise}function t(a){u=-1,o(a);var b=q(a);s(b).then(function(){})["catch"](function(a){console.log(a)}),j.end.send({},a.session)}var u=0,v=(b.user._id,b.user.name),w=3e5;Date.now||(Date.now=function(){return(new Date).getTime()}),a.session=f,a.deckId=f.decks[0]._id,a.name=f.name,a.init=function(){a.deckIdx=0,a.deckLength=a.session.decks[a.deckIdx].slides.length,a.offset=0,a.presentation={},angular.extend(a.presentation,a.session.decks[a.deckIdx]),a.presentation.slides=[];for(var b=0;b<a.session.decks.length;b++){var c=a.session.decks[b];c.slides.forEach(function(b){a.presentation.slides.push(b)})}u=0,a.nextEnabled=!0,a.prevEnabled=!1,a.metrics={},a.metrics.views=[],a.timeout=void 0,a.cleanupDone=!1,r(a)},a.cleanUp=function(){a.cleanupDone||(a.cleanupDone=!0,a.session.leaveBehind?a.welcomeModal.remove():a.contentRemoved.remove(),t(a))},a.nextSlide=function(){a.setSlide(++u),o(a)},a.prevSlide=function(){a.setSlide(--u),o(a)},a.setSlide=function(b){b>=a.deckLength-1?a.deckIdx<a.session.decks.length-1?(a.offset+=a.deckLength,a.deckIdx++,a.deckLength=a.session.decks[a.deckIdx].slides.length,u=0):(u=a.session.decks[a.deckIdx].slides.length-1,a.nextEnabled=!1,a.prevEnabled=!0):0>b?a.deckIdx>0?(a.deckIdx--,a.deckLength=a.session.decks[a.deckIdx].slides.length,a.offset-=a.deckLength,u=a.session.decks[a.deckIdx].slides.length-1):(u=0,a.prevEnabled=!1,a.nextEnabled=!0):(a.current=b,a.nextEnabled=!0,a.prevEnabled=!0),a.viewingSlide=a.presentation.slides[u+a.offset],g.slide(u+a.offset)},a.w=e,e.onfocus=function(a){({action:"engagement",status:"engaged",who:v,id:b.user._id});console.log("engaged")},e.onblur=function(a){({action:"engagement",status:"distracted",who:v,id:b.user._id});console.log("distracted")},e.onbeforeunload=function(b){a.cleanUp()},a.$on("$destroy",function(){a.cleanUp()}),a.session.leaveBehind?h.fromTemplateUrl("templates/welcomeTemplate.html",{scope:a}).then(function(b){a.welcomeModal=b,a.welcomeModal.show(),d(function(){a.welcomeModal.hide()},3500)}):h.fromTemplateUrl("templates/contentRemoved.html",{scope:a}).then(function(b){a.contentRemoved=b,a.contentRemoved.show()}),void 0==b.user._id?b.$on("Revu.Me:Ready",function(b,c){a.init()}):a.init()}]),angular.module("RevuMe").controller("SessionsCtrl",["$scope","$rootScope","Sess","Decks","$ionicListDelegate","$ionicPopup","SessionBuilder","$state",function(a,b,c,d,e,f,g,h){function i(a){var b=f.confirm({title:"Delete "+a,template:"Are you sure to delete this?"});return b}a.titles={},a.init=function(){var d=b.user._id;a.setTitles(),a.action={selected:a.actions[0]},void 0!=d&&c.orgSessions.get({id:d,isArchived:b.archiveOn()}).$promise.then(function(e){return a.orgSessions=e,c.attSessions.get({id:d,isArchived:b.archiveOn()}).$promise}).then(function(b){a.attSessions=b,a.sb=g,a.sb.init(a),a.bridge={},a.deferNewSession&&(a.deferNewSession=!1,a.newSession())})["catch"](function(a){console.log(a)})},a.doRefresh=function(){var d=b.user._id;a.checkArchive(),void 0!=d&&c.orgSessions.get({id:d,isArchived:b.archiveOn()}).$promise.then(function(e){return a.orgSessions=e,c.attSessions.get({id:d,isArchived:b.archiveOn()}).$promise}).then(function(b){a.attSessions=b,a.$broadcast("scroll.refreshComplete")})},a.go=function(a){h.transitionTo("app.session",{id:a})},a.toggleListDelete=function(a){e.$getByHandle(a).showDelete()?e.$getByHandle(a).showDelete(!1):e.$getByHandle(a).showDelete(!0)},a.delOrgSession=function(b){var d=a.orgSessions[b].name;i(d).then(function(d){if(d){var e=a.orgSessions[b]._id;c.sessions["delete"]({id:e}),a.orgSessions.splice(b,1)}})},a.delAttSession=function(b){var d=a.attSessions[b].name;i(d).then(function(d){if(d){var e=a.attSessions[b]._id;c.sessions["delete"]({id:e}),a.attSessions.splice(b,1)}})},a.editSession=function(b){var c=a.orgSessions[b].decks[0]._id;d.get({id:c}).$promise.then(function(c){return void 0!=c._id?(a.orgSessions[b].decks[0]=c,a.sb.init(a)):void 0}).then(function(){return a.sb.edit(a.orgSessions[b])}).then(function(){a.doRefresh()})},a.newSession=function(){a.sb.init(a).then(function(){return a.sb["new"]()}).then(function(){a.doRefresh()})},a.markArchive=function(d){var e=b.user,f=a.orgSessions[d]._id;a.orgSessions[d].archiveStatus.forEach(function(a){a.id==e._id&&(a.isArchived=!b.archiveOn())}),c.archive.update({id:f},a.orgSessions[d]).$promise.then(function(){a.doRefresh()})},a.markAttArchive=function(d){var e=b.user,f=a.attSessions[d]._id;a.attSessions[d].archiveStatus.forEach(function(a){a.id==e._id&&(a.isArchived=!b.archiveOn())}),c.archive.update({id:f},a.attSessions[d]).$promise.then(function(){a.doRefresh()})},a.actions=[{name:"Options",callback:{}},{name:"Edit",callback:a.editSession},{name:"Archive",callback:a.markArchive}],a.doAction=function(b){var c=a.action.selected;console.log("Session doAction: ",c),c.callback(b),a.action.selected=a.actions[0]},a.checkArchive=function(){b.archiveOn()?a.actions[2].name="UnArchive":a.actions[2].name="Archive"},a.setTitles=function(){b.archiveOn()?(a.titles.organizer="Your ARCHIVED Meetings",a.titles.attendee="Your ARCHIVED Invitations"):(a.titles.organizer="Your Meetings",a.titles.attendee="Your Invitations")},a.init(),a.$on("userID",function(b,c){a.init()}),a.$on("Revu.Me:NewMeeting",function(b){a.sb?a.newSession():a.deferNewSession=!0}),a.$on("Revu.Me:Archive",function(b){e.$getByHandle("att").showDelete()&&e.$getByHandle("att").showDelete(!1),e.$getByHandle("org").showDelete()&&e.$getByHandle("org").showDelete(!1),a.checkArchive(),a.init()}),b.$on("$stateChangeStart",function(b,c,d,e,f){("app.session"==c.name||"app.attendeeSessions"!=c.name)&&a.doRefresh()})}]).controller("SessionCtrl",["$scope","$rootScope","$stateParams","Sess","session","Decks","presAnalyzer","$ionicModal","$ionicPopup","$state","BridgeService","$timeout","SessionBuilder",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.bridgeService=k,a.session=e,a.init=function(){if(void 0!=e._id&&(a.sb=m,a.sb.init(a),a.activeMeeting=!1,a.bridgeService.findBridge(a.session.ufId),a.session.confId=a.session.ufId.replace(/-/g,""),a.session.decks.length>0)){var b=a.session._id;a.deckIdx=0,a.reportsEnabled=[];for(var c=0;c<a.session.decks.length;c++){var d=a.session.decks[c]._id;g.get(b,d).then(function(b){b.length>0?a.reportsEnabled.push(!0):a.reportsEnabled.push(!1)})["catch"](function(a){console.log(a)})}}},a.editSession=function(){a.sb.edit(a.session).then(function(b){a.session=b})},a.handyDial=function(){var b=a.session.ufId.replace(/-/g,""),c=a.session.bridgeNumber+",,,"+b+"#";return c},h.fromTemplateUrl("templates/presAnalytics.html",{scope:a,animation:"slide-in-up"}).then(function(b){a.modal=b}),a.go=function(c,d){a.session.organizer._id==b.user._id?(a.activeMeeting=!0,a.session.bridge&&!a.bridgeService.activeBridge()?a.bridgeService.startBridge(a.session.ufId).then(function(){j.transitionTo("app.presentation",{id:c,idx:d})}):j.transitionTo("app.presentation",{id:c,idx:d})):a.session.bridge?a.bridgeService.startBridge(a.session.ufId).then(function(){j.transitionTo("app.viewer",{id:a.session._id,idx:0})}):j.transitionTo("app.viewer",{id:a.session._id,idx:0})},a.showAlert=function(a,b){var c=i.alert({title:a,template:b});return c},a.showResults=function(b){if(a.session.decks.length>0){var c=a.session._id,d=a.session.decks[b]._id;g.get(c,d).then(function(c){c.length>0&&f.get({id:d}).$promise.then(function(d){void 0!=d._id&&(a.session,a.session.decks[b].metrics=c,a.session.decks[b].slides=d.slides,a.deckIdx=b,a.modal.show())})})["catch"](function(a){console.log(a)})}},a.closeModal=function(){a.modal.hide()},a.startMeeting=function(){a.activeMeeting=!0,a.session.bridge?a.bridgeService.startBridge(e.ufId).then(function(){1==a.session.decks.length?a.go(a.session._id,0):a.showAlert("Meeting Started","Please Select your Deck <br> by Clicking Click 'Show'")}):1==a.session.decks.length?a.go(a.session._id,0):a.showAlert("Meeting Started","Please Select your Deck <br> by Clicking 'Show'")},a.endMeeting=function(){a.activeMeeting=!1,a.bridgeService.endMeeting(),a.bridgeService.activeBridge()&&a.bridgeService.endBridge(a.session.ufId)},a.setLeaveBehind=function(){console.log(a.session.leaveBehind),d.leaveBehind.update({id:a.session._id},a.session)},a.resendInvites=function(){d.invite.update({id:a.session._id})},a.$on("$destroy",function(){a.modal.remove(),b.deepLink&&a.welcomeModal.remove()}),b.$on("$stateChangeStart",function(b,c,d,e,f){"app.session"==e.name&&"app.presentation"!=c.name&&a.activeMeeting&&a.endMeeting()}),b.deepLink&&h.fromTemplateUrl("templates/welcomeTemplate.html",{scope:a}).then(function(b){a.welcomeModal=b,a.welcomeModal.show(),l(function(){a.welcomeModal.hide()},3500)}),a.init()}]),angular.module("RevuMe").controller("settingsCtrl",["$scope","$rootScope","$state","$cookieStore",function(a,b,c,d){a.myAccount=function(){c.go("app.myAccount")},a.logOut=function(){d.remove("user"),b.user._id=void 0,c.go("app.welcome")},a.changePassword=function(){c.go("app.changePassword")},a.setting={actions:[{name:"My Account",action:a.myAccount},{name:"Log Out",action:a.logOut},{name:"Change My Password",action:a.changePassword}]}}]),angular.module("RevuMe").factory("Share",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/share/:id";return a(c,{id:"@id"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}})}]).service("shareMediator",["Share","libraryRights","teamService","$rootScope","$q",function(a,b,c,d,e){function f(a,b){var c=void 0;return a.members.forEach(function(a){a.user._id==b&&(c=a.role)}),c}var g=this;g.shareItem=function(b,c,d){var f=e.defer(),g=new a;return g.model=b,g.item=c._id,g.teams=[],d.forEach(function(a){g.teams.push(a._id)}),g.$save().then(function(){f.resolve()})["catch"](function(a){f.reject(a)}),f.promise},g.getItems=function(c){var g=e.defer();return c.query({user:d.user._id}).$promise.then(function(e){var f=e;return f.forEach(function(a){a.accessRights=b.getAccessRights(c,b.roles[0])}),a.query({model:c.name,user:d.user._id}).$promise}).then(function(a){var b=[];a.forEach(function(a){var b=a.item,e=f(a.team,d.user._id);b.accessRights=librRights.getAccessRights(c,e)}),ownedItems.concat(b),g.resolve()})["catch"](function(a){g.reject(a)}),g.promise}}]),angular.module("RevuMe").controller("signinCtrl",["$scope","$rootScope","authService","$ionicPopup","$state",function(a,b,c,d,e){a.doSignIn=function(){var f={};f.email=a.forms.signin.email,f.password=a.forms.signin.password,c.authenticate(f).then(function(a){if(a.success){var c=a.user;c.authData=c.password,b.userInit(c),e.go("app.welcome")}else{var f=d.alert({title:"Authentication Failed",template:a.reason});f.then(function(a){})}})}}]).controller("signupCtrl",["$scope","$rootScope","$state","authService","$ionicPopup","SendConfirm","DoConfirm","introContent","ScriptService","SigninPartners","$q",function(a,b,c,d,e,f,g,h,i,j,k){function l(a,f){var g=k.defer();if(f&&f.email)d.checkExists(f.email).then(function(e){e._id?b.userInit(e).then(function(){i.checkScript(b.user.script),c.go("app.welcome"),g.resolve()}):(f.service=a,f.password=d.randomKey(6),d.signUp(f).then(function(a){f._id=a._id;var b=[{user:f._id,role:"Admin"}],c=i.scriptTypes[0],d=i.newScript(c,b);return i.save(d)}).then(function(a){return b.userInit(f)}).then(function(){return h.addIntroContent(f._id)}).then(function(){b.firstLogin=!0,c.go("app.welcome"),g.resolve()}))});else{var j=a+"Authentication Failed!";e.alert({title:j,template:"Please Try Again"})}return g.promise}a.network=j.network,a.mouse={over:!1},a.doSignUp=function(){d.checkExists(a.forms.signup.email).then(function(j){if(j._id)if(j.password){var k=e.alert({title:"You're Already Signed Up",template:"Please Sign In"});k.then(function(){c.go("app.welcome")})}else{g.confirm({id:j._id});var l={};l.oldPassword="",l.email=a.forms.signup.email,l.password=a.forms.signup.password,d.resetPassword(l).then(function(a){if(a.success){var b=[{user:j._id,role:"Admin"}],d=i.scriptTypes[0],f=i.newScript(d,b);i.save(f).then(function(){return h.addIntroContent(j._id)}).then(function(){c.go("app.welcome")})}else{var g=e.alert({title:"Error Setting PW!",template:"Please Try Again"});g.then(function(){})}})}else{var m={};m.firstName=a.forms.signup.firstName,m.lastName=a.forms.signup.lastName,m.email=a.forms.signup.email,m.password=a.forms.signup.password,d.signUp(m).then(function(a){f.send(a),m._id=a._id;var b=[{user:a._id,role:"Admin"}],c=i.scriptTypes[0],d=i.newScript(c,b);return i.save(d)}).then(function(a){return h.addIntroContent(m._id)}).then(function(){b.firstLogin=!0,c.go("app.welcome")})}})},a.signIn=function(){d.forceCredentials("app.welcome")},a.signInWith=function(b){a.network.hasOwnProperty(b)&&a.network[b].getUser().then(function(a){return l(b,a)}).then(function(){a.network.authService.hideSignup(b)})},a.mouseEnter=function(){a.mouse.over=!0},a.mouseLeave=function(){a.mouse.over=!1}}]).controller("confirmCtrl",["$scope","user",function(a,b){a.user=b}]).controller("profileCtrl",["$scope","$rootScope","$state","authService","$ionicPopup",function(a,b,c,d,e){var f=b.user.name,g=f.split(" "),h=g[0],i=g[1],j=b.user.email;a.forms.signup.firstName=h,a.forms.signup.lastName=i,a.forms.signup.email=j,a.updateProfile=function(){d.checkExists(a.forms.signup.email).then(function(b){if(b){var f=e.alert({title:"You're Already Signed Up",template:"Please Sign In"});f.then(function(){c.go("app.welcome")})}else{var g={};g.firstName=a.forms.signup.firstName,g.lastName=a.forms.signup.lastName,g.email=a.forms.signup.email,g.password=a.forms.signup.password,d.signUp(g).then(function(a){console.log(a)})}})},a.signIn=function(){d.forceCredentials("app.welcome")}}]).controller("changePasswordCtrl",["$scope","$rootScope","authService","$timeout","$ionicPopup",function(a,b,c,d,e){a.resetPassword=function(){var b={};if(b.email=a.forms.resetPw.email,b.oldPassword=a.forms.resetPw.oldPassword,b.password=a.forms.resetPw.newPassword,b.repeat=a.forms.resetPw.repeat,b.password!=b.repeat){var d=e.alert({title:"Uh Oh!",template:"New Password Fields Don't Match"});d.then(function(a){})}else a.forms.resetPw.message="",c.checkExists(b.email).then(function(a){if(a)c.resetPassword(b).then(function(a){if(a.success){var b=e.alert({title:"Success!",template:"Your Password is Reset"});b.then(function(a){})}else{var b=e.alert({title:"Reset PW Error",template:a.reason});b.then(function(a){})}});else{var d=e.alert({title:"Reset PW Error",template:b.email+" not found"});d.then(function(a){})}})["catch"](function(a){console.log(a)})}}]),angular.module("RevuMe").controller("slideShowCtrl",["$scope","$rootScope","$state","$ionicSlideBoxDelegate","$ionicScrollDelegate","$timeout","slideShow","Fullscreen",function(a,b,c,d,e,f,g,h){function i(a){return"slide-box-"+a}function j(){var b=a.presentation.slides,c=0,e=0,f=i(e),g=d,h={idx:e,slides:new Array,handle:f,delegate:g,show:!0};a.slideBoxes.push(h);for(var j=0;j<b.length;j++)c<a.boxLength?(h.slides.push(b[j]),c++):(e++,f=i(e),g=d,h={idx:e,slides:new Array,handle:f,delegate:g,show:!1},a.slideBoxes.push(h),c=1,h.slides.push(b[j]))}function k(){a.current<a.presentation.slides.length-1?a.nextEnabled=!0:a.nextEnabled=!1,a.current>0?a.prevEnabled=!0:a.prevEnabled=!1}g.connect(a),a.current=0,a.nextEnabled=!0,a.prevEnabled=!1,a.boxLength=5,a.boxCurrent=0,a.expectEcho=!1,a.slideBoxes=[],a.slideBoxIdx=0,a.loadingMessage="",a.zoomFactor=1,a.fullScreen=!0,a.loadNext=function(){return a.boxCurrent+1>a.boxLength-1?(a.loadingMessage="Loading Slides...",a.slideBoxes[a.slideBoxIdx].show=!1,a.slideBoxIdx++,a.boxCurrent=0,a.current++,!0):!1},a.slidesDone=function(){f(function(){a.loadingMessage=""},300)},a.loadPrevious=function(){return a.boxCurrent-1<0?(a.loadingMessage="Loading Slides...",a.slideBoxIdx--,a.boxCurrent=a.boxLength-1,a.current--,!0):!1},j(),a.nextClicked=function(){1==a.zoomFactor&&a.current<a.presentation.slides.length-1&&(a.loadNext()||(a.current++,a.boxCurrent++,a.expectEcho=!0,a.slideBoxes[a.slideBoxIdx].delegate.slide(a.boxCurrent)),k())},a.previousClicked=function(){1==a.zoomFactor&&a.current>0&&(a.loadPrevious()||(a.current--,a.boxCurrent--,a.expectEcho=!0,a.slideBoxes[a.slideBoxIdx].delegate.slide(a.boxCurrent)),k())},a.onSlideChange=function(b){a.expectEcho?a.expectEcho=!1:(b>a.boxCurrent?a.loadNext()||(a.current++,a.boxCurrent++):b<a.boxCurrent&&(a.loadPrevious()||(a.current--,a.boxCurrent--)),k())},a.updateSlideStatus=function(b){"video"!=a.presentation.slides[a.current].type&&(a.zoomFactor=e.$getByHandle("scrollHandle"+b).getScrollPosition().zoom,1==a.zoomFactor?(d.enableSlide(!0),console.log("slide enabled")):(d.enableSlide(!1),console.log("slide disabled")))}}]),angular.module("RevuMe").controller("splashCtrl",["$scope","$rootScope","$timeout","$http","baseUrl","$ionicNavBarDelegate","tourService","ScriptService","$ionicSideMenuDelegate",function(a,b,c,d,e,f,g,h,i){a.image=e.endpoint+"/img/splash.png",a.init=function(){c(function(){a.user._id=b.user._id,a.user.name=b.user.name,a.user.script=b.user.script,a.users=b.users,a.user.daysLeft=h.getDaysLeft(a.user.script),a.buyButton={text:"Upgrade Now"};var c=a.user.script;c.autoRenew||("Monthly"==c.type||"Annually"==c.type)&&(a.buyButton.text="Renew Now")},0),void 0!=b.firstLogin&&1==b.firstLogin&&(b.firstLogin=!1,i.toggleLeft(!0),c(function(){i.toggleLeft(!1)},5e3))},a.$on("presence_change",function(){a.$apply(function(){a.users=b.users})}),void 0==b.user.script?b.$on("Revu.Me:Ready",function(b,c){a.init()}):a.init(),a.tourService=g}]),angular.module("RevuMe").controller("teamsCtrl",["$scope","$rootScope","TeamService","userService","$ionicListDelegate","$ionicPopup","$ionicModal","$state",function(a,b,c,d,e,f,g,h){function i(){c.validateMembers(a)}function j(a){var b=f.confirm({title:"Delete "+a,template:"Are you sure to delete this?"});return b}switch(h.current.name){case"app.team":a.teamName=h.params.name;break;case"app.newteam":a.teamName="New Team"}a.init=function(){var d=b.user._id;a.forms={},void 0!=d&&(c.init(a),c.getAll(d).then(function(b){switch(a.teams=b,h.current.name){case"app.team":var d=parseInt(h.params.id);setTimeout(function(){c.editTeam(a,d),a.addTeam.name=a.teams[d].name},0),a.modalCallback=a.updateTeam;break;case"app.newteam":c.newTeam(a),a.modalCallback=a.saveTeam}}),a.commaDelimited=!1)},a.doRefresh=function(){c.refreshTeams(a)},a.newTeam=function(){c.newTeam(a),a.modalTitle="New Team",a.modalCallback=a.saveTeam,h.go("app.newteam")},a.addMember=function(){c.addMember(a)},a.delMember=function(b){c.delMember(a,b)},a.saveTeam=function(){console.log("save team: ",a.addTeam.name),a.commaDelimited&&i();var b=c.teamFromInput(a);if(void 0==b.name||0==b.members.length){f.alert({title:"Save Team",template:"Your team needs a name and members"})}else c.save(b).then(function(){return c.refreshTeams(a)}).then(function(){void 0!=a.forms.teamForm&&a.forms.teamForm.$setPristine()})["catch"](function(a){console.log(a)})},a.toggleListDelete=function(a){e.$getByHandle(a).showDelete()?e.$getByHandle(a).showDelete(!1):e.$getByHandle(a).showDelete(!0)},a.delTeam=function(b,d){var e=a.teams[b].name;d.stopPropagation(),j(e).then(function(d){if(d){var e=a.teams[b]._id;c["delete"](e).then(function(){a.teams.splice(b,1)})["catch"](function(a){console.log(a)})}})},a.editTeam=function(b){c.editTeam(a,b),a.modalTitle="Edit Team",a.modalCallback=a.updateTeam;var d=a.teams[b].name;h.go("app.team",{id:b,name:d})},a.updateTeam=function(){a.commaDelimited&&i();var b=c.teamFromInput(a);c.update(b).then(function(){return c.refreshTeams(a)}).then(function(){a.forms.teamForm.$setPristine()})["catch"](function(a){console.log(a)})},a.setDirty=function(){a.forms.teamForm.$setDirty()},a.$on("userID",function(b,c){a.init()}),a.showNavConfirm=function(){var a=f.confirm({title:"Unsaved Work",template:"Should We Save It?"});return a},a.$on("$stateChangeStart",function(b,c,d,e,f){switch(e.name){case"app.team":case"app.newteam":void 0!=a.forms.teamForm&&(a.forms.teamForm.$pristine||a.showNavConfirm().then(function(b){b&&a.modalCallback()}))}}),a.$on("$ionicView.enter",function(){void 0!=b.user._id&&"app.teams"==h.current.name&&setTimeout(function(){c.refreshTeams(a)},0)}),void 0==b.user._id?b.$on("Revu.Me:Ready",function(b,c){a.init()}):a.init()}]),angular.module("RevuMe").controller("userAdminCtrl",["$scope","$rootScope","ScriptService","Users",function(a,b,c,d){a.revume={},a.revume.scriptTypes=c.scriptTypes,d.byId.query().$promise.then(function(b){a.revume.allUsers=b,a.revume.allUsers.forEach(function(b){c.userScript(b._id).then(function(d){if(void 0!=d)b.script=d;else{var e=[{user:b._id,role:"Admin"}],f=a.revume.scriptTypes[0];b.script=c.newScript(f,e),c.save(b.script).then(function(a){b.script._id=a._id,console.log("User: ",b.firstName+" "+b.lastName," new subscription created")})}})})}),a.updateScript=function(b){var d=a.revume.allUsers[b];c.update(d.script._id,d.script).then(function(){console.log("user subscription updated")})}}]),angular.module("RevuMe").controller("ViewCtrl",["$scope","$rootScope","$stateParams","$timeout","$window","pnFactory","userMonitor","session","Decks","$ionicSlideBoxDelegate","BridgeService","$q","$ionicModal","authService","$state","$ionicPopup","$ionicScrollDelegate",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(b){var c=l.defer();return i.get({id:b}).$promise.then(function(b){a.name=b.name,a.presentation=b,u=0,a.setSlide(u),j.update(),c.resolve()}),c.promise}function s(b){switch(b.action){case"new":r(b.value).then(function(){d(function(){a.name=a.presentation.name},0)});break;case"set":d(function(){var c=a.presentation.name;a.name=c,a.setSlide(b.value)}),console.log(a.presentation.name);break;case"end":a.signupModal.show()}}function t(b){if(g.rollCall(b),void 0!=b.userName){var c=b.userName+" has ";switch(b.action){case"join":c+="joined";break;case"leave":case"timeout":c+="left"}a.$broadcast("show_message",c)}}var u=0,v=(b.user._id,b.user.name);a.session=h,a.deckId=h.decks[0]._id,a.name=h.name,a.bridgeService=k,a.init=function(){r(a.deckId).then(function(){var b=c.id.toString()+".view_channel";a.channel=f.newChannel(b);var d=a.session.attendees;d.push(a.session.organizer),g.init(d),a.channel.subscribe(s,t)}),m.fromTemplateUrl("templates/presEndTemplate.html",{scope:a,animation:"slide-in-up"}).then(function(b){a.signupModal=b})},a.cleanUp=function(){a.channel.unsubscribe()},a.doSignUp=function(){a.signupModal.hide();var c={};if(void 0!=this.forms){var d=this.forms.signup.password,e=b.user.name.split(" ");c.firstName=e[0],c.lastName=e[1],c.email=b.user.email,c.password=d,c.oldPassword="",n.checkExists(c.email).then(function(a){a.password?o.go("app.welcome"):n.resetPassword(c).then(function(a){if(a.success)o.go("app.welcome");else{var b=p.alert({title:"Error Setting PW!",template:"Please Try Again"});b.then(function(){})}})})}},a.nextSlide=function(){a.setSlide(++u)},a.prevSlide=function(){a.setSlide(--u)},a.setSlide=function(b){u=b,a.viewingSlide=a.presentation.slides[u],j.slide(u)},a.w=e,e.onfocus=function(c){var d={action:"engagement",status:"engaged",who:v,id:b.user._id};console.log("engaged"),a.channel.publish(d)},e.onblur=function(c){var d={action:"engagement",status:"distracted",who:v,id:b.user._id};console.log("distracted"),a.channel.publish(d)},a.goFullScreen=function(){},a.$on("$destroy",function(){a.cleanUp()}),void 0==b.user._id?b.$on("Revu.Me:Ready",function(b,c){a.init()}):a.init()}]),angular.module("RevuMe").directive("addTemplate",[function(){return{restrict:"AE",templateUrl:function(a,b){return b.templateUrl}}}]),angular.module("RevuMe").directive("appearUp",["$animate","$timeout",function(a,b){return{restrict:"A",link:function(c,d,e){c.$on(e.appearUp,function(c,e){b(function(){d.html(e),a.addClass(d,"show").then(function(){b(function(){a.removeClass(d,"show")},1500)})})})}}}]),angular.module("RevuMe").directive("datePicker",[function(){return{restrict:"A",link:function(a,b,c){var d=b[0];if("fred"!=d.type){var e=new Pikaday({field:d,format:"yyyy-MM-dd"});e._o.onSelect=function(a){var b=(a.getMonth()+1).toString(),c=a.getUTCDate().toString(),e=a.getFullYear().toString(),f=(e+"-"+(b[1]?b:"0"+b)+"-"+(c[1]?c:"0"+c),(b[1]?b:"0"+b)+"/"+(c[1]?c:"0"+c)+"/"+e);d.value=f}}}}}]),angular.module("RevuMe").directive("timeFormat",["$filter",function(a){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(a){var b=a.split(" "),c=b[0].split(":");if(0!=c[0].length&&c[1].length>1){var d=parseInt(c[0]),e=c[1],f=b[1];switch(f){case"PM":break;case"AM":break;default:f="PM"}return"PM"==f&&12>d&&(d+=12),{hour:d.toString(),min:e,amPm:f}}return null}function f(a){var b=a.slice(0,a.indexOf(".")),c=b.split(":");if(c[0].length>0&&c[1].length>1){var d=parseInt(c[0]),e=d>=12?"PM":"AM";d>12&&(d-=12);var f=c[1];f.length<2&&(f="0"+f);var g=d.toString()+":"+f+" "+e;return g}return null}a.el=b[0],"time"!=a.el.type&&d&&(d.$formatters.unshift(function(a){var b=null;return void 0!=a&&""!=a&&(b=f(a)),b?b:a}),d.$parsers.unshift(function(a){var b=e(a);if(null!=b){var c=b.hour+":"+b.min+":00.000";return d.$setValidity("time",!0),c}return void 0}))}}}]).directive("dateFormat",["$parse",function(a){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=b[0];"date"!=e.type&&(d.$formatters.unshift(function(a){var b=a.split("-"),c=b[1]+"/"+b[2]+"/"+b[0];return c}),d.$parsers.unshift(function(a){var b=a.split("/"),c=b[2]+"-"+b[0]+"-"+b[1];return c}))}}}]),angular.module("RevuMe").directive("dragEnter",["$timeout",function(a){return{scope:!1,link:function(b,c,d){function e(a){var b=!1,c=a.dataTransfer||a.originalEvent.dataTransfer;return angular.forEach(c&&c.types,function(a){"Files"===a&&(b=!0)}),b}var f,g=!1;c.bind("dragover",function(c){e(c)&&(g||(b.$apply(d.dragEnter),g=!0),a.cancel(f),c.preventDefault())}),c.bind("dragleave drop",function(c){a.cancel(f),f=a(function(){b.$eval(d.dragLeave),f=null,g=!1},100)})}}}]).directive("dragDrop",function(){return{scope:!1,link:function(a,b,c){b.bind("drop",function(b){b.stopPropagation(),b.preventDefault();for(var c,d=b.dataTransfer.files,e=0;c=d[e];e++){var f=new FileReader;f.readAsArrayBuffer(c),f.onload=function(b){return function(c){var d={name:b.name,type:b.type,size:b.size,lastModifiedDate:b.lastModifiedDate};a.addfile(d)}}(c)}}),b.bind("change",function(a){console.log(a)})}}}),angular.module("RevuMe").directive("elemHeight",["$window","$timeout",function(a,b){return{restrict:"A",link:function(b,c,d){function e(){var a=verge.viewportH()*h,b=a.toString()+"px";g.style.height=b}var f=angular.element(a),g=c[0],h=d.elemHeight;e(),f.on("orientationchange",e),f.bind("resize",function(){e()})}}}]),angular.module("RevuMe").directive("elemSize",["$window","$timeout",function(a,b){return{restrict:"A",link:function(b,c,d){function e(){var a=verge.viewportW(),b=verge.viewportH()-i,c=a/b;if(c>h){var d=Math.trunc(b*h);console.log("height: ",b,"width: ",a,"targetW: ",d);var e=d.toString()+"px";g.style.width=e}else g.style.width="100%"}var f=angular.element(a),g=c[0],h=1.333333,i=60;void 0!=d.controls&&"true"==d.controls&&"true"!=d.host&&(i=0),e(),f.on("orientationchange",e),f.bind("resize",function(){e()})}}}]),angular.module("RevuMe").directive("flashWeight",["$animate","$timeout",function(a,b){return{restrict:"A",link:function(c,d,e){void 0!=e.flashWeight?c.$on(e.flashWeight,function(c,e){b(function(){d.html(e),a.addClass(d,"heavy").then(function(){b(function(){a.removeClass(d,"heavy")},100)})})}):b(function(){a.addClass(d,"heavy").then(function(){b(function(){a.removeClass(d,"heavy")},100)})})}}}]),angular.module("RevuMe").directive("fullScreen",[function(a,b){return{restrict:"A",scope:{goFull:"="},link:function(a,b,c){function d(){b[0].requestFullscreen?b[0].requestFullscreen():b[0].mozRequestFullScreen?b[0].mozRequestFullScreen():b[0].webkitRequestFullscreen?b[0].webkitRequestFullscreen():b[0].msRequestFullscreen&&b[0].msRequestFullscreen()}a.$watch("goFull",function(){1==a.goFull?d():cancellFullScreen()},!0)}}}]),angular.module("RevuMe").directive("portHeight",["$window","$timeout",function(a,b){return{restrict:"A",link:function(b,c,d){function e(){var a=d.portHeight;verge.viewportH()<verge.viewportW()&&(a=1.3*a);var b=verge.viewportH()*a,c=b.toString()+"px";g.style.height=c}var f=angular.element(a),g=c[0];e(),f.on("orientationchange",e),f.bind("resize",function(){e()})}}}]),angular.module("RevuMe").directive("slideRight",["$window","$timeout",function(a,b){return{restrict:"A",link:function(c,d,e){var f=(angular.element(a),d[0]),g=verge.viewportW()+10+"px",h=e.slideRight,i="!"+h;c.$on(h,function(a,c){b(function(){f.style.right=g},0)}),c.$on(i,function(a,c){b(function(){f.style.right="0px"},0)})}}}]),angular.module("RevuMe").directive("tourStep",["$state","tourService","$parse",function(a,b,c){return{restrict:"AE",templateUrl:"templates/tour-template.html",scope:{ext:"&"},link:function(c,d,e){c.step=b.find(a.current.name),c.step.scope=c,c.tourService=b,c.step.hide=function(){d.css("display","none")},c.step.show=function(a){d.css("position","absolute"),void 0!=c.step.position.top&&d.css("top",c.step.position.top),void 0!=c.step.position.left&&d.css("left",c.step.position.left),void 0!=c.step.position.right&&d.css("right",c.step.position.right),void 0!=c.step.position.bottom&&d.css("bottom",c.step.position.bottom),d.css("display","inherit")},c.step.hide(),void 0!=c.step.defer&&c.step.defer.resolve(),void 0!=c.ext&&(c.step.ext=c.ext)}}}]),angular.module("RevuMe").directive("userComplete",["$rootScope","userService","$parse","$state",function(a,b,c,d){return{restrict:"A",require:"ngModel",link:function(a,e,f,g){var h=e[0],i=f.fieldType,j=c(f.ngModel),k=!1;a.instanceName=f.instanceName,a.state=d.current.name,a.doFinish=function(c){var d=b.getResults(c);switch(i){case"name":var e=d.firstName+" "+d.lastName;k=!0,j.assign(a,e),b.hidePopover(a);break;case"email":k=!0,g.$setDirty(),j.assign(a,d.email),b.hidePopover(a)}},b.createPopover(),b.onAutoComplete(a),a.$watch(j,function(c){if(k)k=!1;else switch(void 0==b.popover&&b.createPopover(),i){case"name":if(void 0!=c)if(c.length>0){var d={first:c};b.usersIKnow(d).then(function(c){b.setResults(c),c.length>0?b.showPopover(a,h):b.hidePopover(a)})}else b.hidePopover(a);break;case"email":if(void 0!=c&&c.indexOf("@")>0){var d={email:c};b.usersIKnow(d).then(function(c){b.setResults(c),c.length>0?b.showPopover(a,h):b.hidePopover(a)})}}}),a.$on("$stateChangeStart",function(){b.removePopover(a)})}}}]),angular.module("RevuMe").directive("vBackgroundImage",function(){return function(a,b,c){b.css({width:"100%",height:"100%","background-image":"url("+c.vBackgroundImage+")","background-size":"cover","background-repeat":"no-repeat"})}}),angular.module("RevuMe").directive("vFollow",["pnFactory","$stateParams",function(a,b){return{restrict:"A",link:function(c,d,e){c.channelName=b.id.toString()+".vidActions";var f=a.newChannel(c.channelName);c.myPlayer=d[0];var g=function(){void 0!=c.myPlayer&&c.myPlayer.pause()};c.myPlayer.onplay=g;var h=function(a){var b=function(){};void 0!=c.myPlayer&&(c.myPlayer.onplay=b,c.myPlayer.currentTime=a,c.myPlayer.play(),c.myPlayer.controls=!1)},i=function(){void 0!=c.myPlayer&&c.myPlayer.pause()},j=function(a){void 0!=c.myPlayer&&(c.myPlayer.currentTime=a,console.log("seek!",a))},k=function(a){switch(a.command){case"play":h(a.where);break;case"pause":i();break;case"seekTo":j(a.where)}};f.subscribe(k),c.$on("slideChange",function(a,b){var d=b,f=e.vLead;d==f&&(c.myPlayer.onplay=g)}),c.$on("$destroy",function(){void 0!=f&&f.unsubscribe()})}}}]),angular.module("RevuMe").directive("vLead",["pnFactory","$stateParams",function(a,b){return{restrict:"A",link:function(c,d,e){c.channelName=b.id.toString()+".vidActions";
var f=a.newChannel(c.channelName),g=function(){var a=c.myPlayer.currentTime;f.publish({command:"play",where:a}),console.log("play!")},h=function(){f.publish({command:"pause"}),console.log("pause")},i=function(){var a=c.myPlayer.currentTime;f.publish({command:"seekTo",where:a}),console.log("seeked")};c.$on("slideChange",function(a,b){var d=b,f=e.vLead;d==f||c.myPlayer.pause()}),c.myPlayer=d[0],c.myPlayer.controls=!0,c.myPlayer.onplay=g,c.myPlayer.onpause=h,c.myPlayer.onseeked=i,c.$on("$destroy",function(){void 0!=f&&f.unsubscribe()})}}}]),angular.module("RevuMe").directive("vSource",["$parse",function(a){return{restrict:"A",link:function(b,c,d){if(b.myPlayer=c[0],b.myPlayer.setAttribute("src",d.vSource),void 0!=d.autoPlay){var e=a(d.autoPlay);b.$watch(e,function(a){var c=a;c&&b.myPlayer.play()})}}}}]),angular.module("RevuMe").run(["$templateCache",function(a){a.put("templates/addDeckTemplate.html",'<ion-modal-view><ion-header-bar class="bar-calm"><h1 class="title">Step 1: Add a Deck</h1><div class="buttons"><button class="button button-clear button-light" style="color:black" ng-click="sb.defer.pop().reject(\'cancel\')">Close</button></div></ion-header-bar><ion-content><file-box close-on-select="true"></file-box><div ng-show="eva.Data.ready"><div class="flow-drop-zone centered-container" drag-enter="class=\'flow-drag-enter\'" drag-leave="class=\'flow-drag-leave\'" evaporate eva-model="eva.Data" ng-model="eva.Inbox" ng-class="class" ng-if="!device.IOS() && !device.isIPad() && !device.isAndroid() && !device.isWindowsPhone()"><p>Drop your file(s) here</p></div><ion-list ng-if="library.uploading.files.length > 0"><ion-item ng-repeat="file in library.uploading.files" class="upload-content" style="min-height:70px" ng-cloak><ion-spinner icon="ios" class="upload-spinner" ng-if="file.spinner"></ion-spinner><h2>{{file.name}}</h2><p ng-show="file.timeLeft != 0">{{file.timeLeft}} seconds remaining...</p><p ng-show="file.message != \'\'">{{file.message}}</p><div ng-show="!file.spinner" class="progress-bar" elem-height="0.01" ng-style="{\'width\':file.progressString}"></div></ion-item></ion-list></div><ion-list><ion-item ng-repeat="deck in sb.decks" class="item-thumbnail-left item-button-right"><img ng-src="{{deck.thumb}}" alt="New" ng-class="{\'alt\':deck.thumb==undefined}"><h2>{{deck.name}} <span ng-show="deck.added" class="add-color heavy">-Added-</span></h2><p>{{deck.user.firstName}} {{deck.user.lastName}}</p><p>{{deck.createdDate | date:"MM/dd/yyyy h:mma"}}</p><button class="ion-plus-circled button icon button-icon add-color" ng-click="sb.addDeck($index)" ng-show="!deck.added"></button> <button class="ion-minus-circled button icon button-icon del-color" ng-click="sb.delDeck($index)" ng-show="deck.added"></button></ion-item></ion-list></ion-content><ion-footer-bar><div class="centered-container"><button ng-disabled="sb.session.decks.length==0" class="button button-positive button-calm" ng-click="sb.defer.pop().resolve()">Ok</button> <button class="button button-stable" ng-click="sb.defer.pop().reject(\'cancel\')">Cancel</button></div></ion-footer-bar></ion-modal-view>'),a.put("templates/attendeeSessions.html",'<ion-view title="{{titles.attendee}}"><ion-nav-buttons side="left"><button menu-toggle="left" class="button button-icon icon ion-navicon"></button></ion-nav-buttons><ion-content class="has-header"><div class="revu-list-header calm-bg"><button ng-if="!archiveOn()" class="button button-icon icon ion-minus-circled revu-list-button revu-left" ng-click="toggleListDelete(\'att\')"></button> You\'re an Attendee:</div><ion-scroll elem-height="0.8"><ion-refresher pulling-text="Pull to refresh..." on-refresh="doRefresh()"></ion-refresher><ion-list show-delete="shouldShowDelete" delegate-handle="att"><ion-item class="item-thumbnail-left item-button-right" ng-repeat="session in attSessions" href="#/app/attsessions/{{session._id}}"><ion-delete-button class="ion-minus-circled" ng-click="markAttArchive($index)" style="color:#ffe900"></ion-delete-button><img ng-src="{{session.decks[0].thumb}}"><h2>{{session.name}}</h2><p>{{session.date | date:"MM/dd/yyyy"}} {{session.time | date:"h:mma"}}</p><ion-option-button ng-if="smallScreen()&&archiveOn()" class="button button-energized" ng-click="markAttArchive($index); $event.preventDefault(); $event.stopPropagation();">UnArchive</ion-option-button><button ng-if="!smallScreen()&&archiveOn()" class="button item-button button-energized" ng-click="markAttArchive($index,$event); $event.preventDefault(); $event.stopPropagation();">UnArchive</button></ion-item></ion-list></ion-scroll></ion-content></ion-view>'),a.put("templates/attendeesession.html",'<ion-view view-title="{{session.name}}" ng-cloak><ion-content class="has-header"><div class="list card"><div class="item item-divider">Meeting Detalis</div><div class="item item-thumbnail-left item-button-right"><img ng-src="{{session.decks[0].thumb}}"><p><strong>Date:&#160&#160&#160&#160&#160&#160&#160&#160&#160&#160</strong>{{session.date | date:"MM/dd/yyyy"}}</p><p><strong>Time:&#160&#160&#160&#160&#160&#160&#160&#160&#160&#160</strong>{{session.time | date:"h:mma"}}</p><p><strong>Organizer:</strong> {{session.organizer.firstName}} {{session.organizer.lastName}}</p><p ng-if="session.bridge && !isMobile"><strong>Dial in:</strong>&#160&#160&#160&#160&#160&#160{{session.bridgeNumber}}</p><p ng-if="session.bridge && isMobile"><strong>Dial in:</strong>&#160&#160&#160&#160&#160&#160<a href="tel:{{session.bridgeNumber}},,,{{session.confId}}#">{{session.bridgeNumber}}</a></p><p><strong>meeting id:</strong> {{session.ufId}}</p><p ng-if="!bridgeService.activeBridge()" class="notice">Join to Open Bridge</p><p ng-if="bridgeService.activeBridge()" class="advise">Bridge is Open</p><button class="button button-positive" ng-click="go(session._id,0)">Join</button></div><div class="item item-divider">Attendees</div><div class="item"><span><strong>Organizer:</strong>{{session.organizer.firstName}} {{session.organizer.lastName}}</span><br><span ng-repeat="attendee in session.attendees">{{attendee.firstName}} {{attendee.lastName}} e: {{attendee.email}}<br></span></div><div class="item item-body">{{session.description}}</div></div></ion-content></ion-view>'),a.put("templates/autocomplete.html",'<ion-popover-view><ion-content><div class="list"><div class="item" ng-repeat="entry in auto.entries"><p ng-click="finishComplete($index)">{{entry.firstName}} {{entry.lastName}}</p></div></div></ion-content></ion-popover-view>'),a.put("templates/batman.html",'<ion-view view-title="Revu.Me Demo"><ion-content ng-class="{\'dark-bg\':isMobile}"><div class="centered-container"><div class="row row-center"><div class="col col-10 collapse"></div><div class="col col-80 collapse"><!--   <img ng-src="{{image}}" class="splash-image"> --><div class="centered-container hero-container positive-bg" elem-height="0.20"><h3 class="hero-welcome">Welcome Batman</h3></div></div><div class="col col-10 collapse"></div></div><div class="row row-center"><div class="col col-10 collapse"></div><div class="col col-80 collapse"><div class="centered-container user_list"><ion-list><div class="item item-divider">Utility Belt</div><ion-item ng-repeat="action in utility.actions" ng-click="action.action()"><h2>{{action.name}}</h2></ion-item><ion-item><h2>Device Info:</h2><p>Platform: {{device.currentPlatform}}</p><p>Mobile:{{isMobile}}</p><p ng-if="device.isIPad">iPad</p><p ng-if="device.isIOS">IOS</p><p ng-if="device.isAndroid">Android</p><p ng-if="device.isWindowsPhone">WindowPhone</p></ion-item><ion-item><h2>User From Local Store</h2><p>Name: {{ls.user.name}}</p><p>Email: {{ls.user.email}}</p><p>_id: {{ls.user._id}}</p></ion-item><ion-item><h2>Total Cached Images</h2><p>{{Library.cachedImages.length}}</p></ion-item><ion-item><h2>Build Date</h2><p>{{build.date}}</p></ion-item></ion-list></div></div><div class="col col-10 collapse"></div></div></div></ion-content></ion-view>'),a.put("templates/buildSession.html",'<ion-modal-view style="z-index:15"><ion-header-bar class="bar-dark"><h1 class="title">New Meeting</h1><div class="buttons"><button class="button button-clear button-light" ng-click="sb.defer.pop().reject()">Close</button></div></ion-header-bar><ion-content class="ionic-modal-hack"><div class="revu-list-header positive-bg"><button class="button button-icon icon ion-minus-circled revu-list-button revu-left" ng-click="toggleListDelete(\'sb\')"></button> Add or Remove Decks <button class="button button-icon icon ion-plus-circled revu-list-button revu-right" ng-click="sb.subEdit()"></button></div><form name="sb.sessionForm"><ion-list show-delete="shouldShowDelete" delegate-handle="sb"><ion-item ng-repeat="deck in sb.session.decks" class="item item-thumbnail-left"><ion-delete-button class="ion-minus-circled" ng-click="sb.delDeck($index)"></ion-delete-button><img class="thumb-small" ng-src="{{deck.thumb}}" alt="New" class="alt"><h2>{{deck.name}}</h2><p>{{deck.user.firstName}} {{deck.user.lastName}}</p><p>{{deck.createdDate | date:"MM/dd/yyyy h:mma"}}</p></ion-item></ion-list><label class="item item-input"><span class="input-label">Name</span> <input type="text" ng-model="sb.session.name" placeholder="Meeting Name" required></label><label class="item item-input"><span class="input-label">Description</span> <input type="text" ng-model="sb.session.description" placeholder="Description"></label><label class="item item-input"><span class="input-label">Date</span> <input type="Date" name="date" date-format ng-model="sb.session.date" placeholder="Date" required></label><div class="row"><div class="col col-50"><label class="item item-input"><span class="input-label">Time</span> <input type="time" name="time" time-format ng-model="sb.session.time" placeholder="Time" required></label></div><div class="col col-50"><label class="item item-input"><span class="input-label">length</span><select ng-model="sb.session.length"><option ng-repeat="l in sb.session.lengthOptions">{{l}}</option></select></label></div></div><!--\n              <div class="row">\n                <div class="col col-50">\n                <div class="item item-checkbox">\n                     <label class="checkbox">\n                       <input ng-model="sb.session.showTeams" type="checkbox">\n                     </label>\n                     Add Teams?\n                </div>\n                </div>\n                <div class="col col-50">\n                  <label class="item item-input">\n                    <span class="input-label">length</span>\n                    <select ng-model="sb.session.length">\n                        <option ng-repeat="l in sb.session.lengthOptions">{{l}}</option>\n                    </select>\n                  </label>    \n                </div>\n             </div>\n            --><div class="list"><div class="item item-input-inset"><label class="item-input-wrapper"><input type="text" name="aName" user-complete field-type="name" instance-name="session" ng-model="sb.session.formname" placeholder="Attendee Name"></label><label class="item-input-wrapper"><input type="email" name="aEmail" user-complete field-type="email" instance-name="session" ng-model="sb.session.formemail" placeholder="Attendee Email"></label><button class="button button-small" ng-click="sb.addAttendee()" ng-disabled="!sb.sessionForm.aName.$dirty || !sb.sessionForm.aEmail.$dirty \n                                             || sb.sessionForm.aEmail.$invalid">add</button></div><div class="item item-divider item-button-right">Attendees <button class="button button-small button-positive divider-button" ng-click="sb.session.showTeams=!sb.session.showTeams">Add Teams?</button></div><div class="item item-button-right" ng-if="sb.session.showTeams && sb.session.teamList.length > 0" style="padding:0px"><label class="item-input"><span class="input-label" style="width:20%">Teams</span><select ng-model="sb.session.team" ng-options="t.name for t in sb.session.teamList"></select></label><button class="button button-small" ng-click="sb.addTeam()" style="font-size:14px" ng-class="{\'shove-right\':smallScreen() == false}">add</button></div><div class="list"><div ng-repeat="attendee in sb.session.attendees" class="item item-icon-left"><i class="icon ion-minus-circled" style="font-size:95%" ng-click="sb.delAttendee($index)"><p class="padding-left">{{sb.session.attendees[$index].name}} {{sb.session.attendees[$index].email}}</p></i></div></div><div class="item item-checkbox"><label class="checkbox"><input ng-model="sb.session.bridge" type="checkbox"></label>conference bridge</div></div><div class="centered-container"><button class="button button-positive" ng-click="sb.defer.pop().resolve()" ng-disabled="sb.sessionForm.$invalid">OK</button> <button class="button padding-left button-stable" ng-click="sb.defer.pop().reject()">Cancel</button></div><div class="centered-container" style="padding-bottom:30px"><p ng-show="sb.sessionForm.sName.$invalid">Session Name is Required</p><p ng-show="sb.sessionForm.date.$invalid">Session Date is Required</p><p ng-show="sb.sessionForm.time.$invalid">Session Time is Required</p></div></form></ion-content></ion-modal-view>'),a.put("templates/changeCard.html",'<ion-view view-title="Change Card"><ion-content class="presentation-background"><div ng-class="{\'row row-center\':!smallScreen()}"><div ng-class="{\'col col-10\':!smallScreen()}"></div><div ng-class="{\'col col-80\':!smallScreen()}"><div class="centered-container account-list" style="background:white;padding-bottom:30px"><ion-item ng-if="showCardEntry"><h2>Current Card: <img ng-src="{{script.defaultMethod.imageUrl}}" style="width:30px"> {{script.defaultMethod.cardType}} ending in {{script.defaultMethod.last4}}</h2></ion-item><ion-item><form ng-if="showCardEntry"><braintree-dropin options="dropinOptions">Loading payment form...</braintree-dropin><div><button class="button button-small button-positive" style="margin-top:5px" type="submit">Change Card</button> <button class="button button-small button-stable" style="margin-top:5px" ng-click="cancel()">Cancel</button></div><span ng-if="status.errors!=undefined" class="assertive">{{status.errorMessage}}</span><p ng-if="status.errors==undefined">{{status.message}}</p></form></ion-item><ion-item><p ng-if="status.errors==undefined">{{status.message}}</p></ion-item></div><div ng-class="{\'col col-10\':!smallScreen()}"></div></div></div></ion-content></ion-view>'),a.put("templates/changePassword.html",'<ion-view view-title="Change Password"><ion-content ng-class="{\'dark-bg\':isMobile}"><div class="centered-container"><div class="row row-center"><div class="col col-10"></div><div class="col col-80"><!--   <img ng-src="{{image}}" class="splash-image"> --><div class="centered-container hero-container positive-bg padding-bottom rounded-corners"><span class="hero-header">Revu.Me</span><div class="signup-form"><form name="forms.resetPw" ng-controller="changePasswordCtrl"><div class="list list-inset"><label class="item item-input"><span class="input-label">Email</span> <input name="inpEmail" ng-model="forms.resetPw.email" type="email" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">Old Password</span> <input name="inpOldPassword" ng-model="forms.resetPw.oldPassword" type="password" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">New Password</span> <input name="inpNewPassword" ng-model="forms.resetPw.newPassword" type="password" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">Retype PW</span> <input name="inpResetPW" ng-model="forms.resetPw.repeat" type="password" required></label></div><button class="button" ng-click="resetPassword()" ng-disabled="!forms.resetPw.inpEmail.$dirty ||\n                                         forms.resetPw.inpEmail.$invalid ||\n                                         !forms.resetPw.inpOldPassword.$dirty ||\n                                         !forms.resetPw.inpNewPassword.$dirty ||\n                                         !forms.resetPw.inpResetPW.$dirty">Change Password</button><div><span ng-if="forms.resetPw.inpEmail.$dirty && forms.resetPw.inpEmail.$invalid" class="signin-message">Invalid Email Format</span> <span ng-if="forms.resetPw.inpOldPassword.$dirty &&\n                                     forms.resetPw.inpOldPassword.$error.required" class="signin-message">Old Password is Required</span> <span ng-if="forms.resetPw.inpNewPassword.$dirty &&\n                                     forms.resetPw.inpNewPassword.$error.required" class="signin-message">New Password is Required</span> <span ng-if="forms.resetPw.inpResetPW.$dirty &&\n                                     forms.resetPw.inpResetPW.$error.required" class="signin-message">Please Retype New Password</span></div></form></div></div></div><div class="col col-10"></div></div></div></ion-content></ion-view>'),a.put("templates/contentRemoved.html",'<ion-modal-view><ion-content><div class="centered-container hero-container positive-bg" style="margin-top:20px" elem-height="0.50"><span class="hero">Revu.me</span><h3 class="hero-welcome">The Presenter Closed this Meeting</h3></div></ion-content></ion-modal-view>'),a.put("templates/editProfile.html",'<ion-view view-title="Your Profile"><ion-content ng-class="{\'dark-bg\':isMobile}"><div class="centered-container"><div class="row row-center"><div class="col col-10"></div><div class="col col-80"><!--   <img ng-src="{{image}}" class="splash-image"> --><div class="centered-container hero-container positive-bg padding-bottom"><span class="hero-header">Revu.Me</span><div class="signup-form"><form name="forms.signup" ng-controller="signupCtrl"><div class="list list-inset"><label class="item item-input"><span class="input-label">First Name</span> <input name="fName" ng-model="forms.signup.firstName" type="text" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">Last Name</span> <input name="lName" ng-model="forms.signup.lastName" type="text" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">Email</span> <input name="inpEmail" ng-model="forms.signup.email" type="email" required></label></div><button class="button" ng-click="updateProfile()" ng-disabled="!forms.signup.fName.$dirty || \n                                         !forms.signup.lName.$dirty || \n                                         !forms.signup.inpEmail.$dirty || \n                                         forms.signup.inpEmail.$invalid">Update</button><div><span ng-if="forms.signup.inpEmail.$dirty && forms.signup.inpEmail.$invalid" class="signin-message">Invalid Email Format</span> <span ng-if="forms.signup.fName.$dirty && forms.signup.fName.$error.required" class="signin-message">First Name is Required</span> <span ng-if="forms.signup.lName.$dirty && forms.signup.lName.$error.required" class="signin-message">Last Name is Required</span></div></form></div></div></div><div class="col col-10"></div></div></div></ion-content></ion-view>'),a.put("templates/emailConfirmed.html",'<ion-view view-title="Revu.Me"><ion-content ng-class="{\'dark-bg\':isMobile}"><div class="centered-container"><div class="row row-center"><div class="col col-10"></div><div class="col col-80"><!--   <img ng-src="{{image}}" class="splash-image"> --><div class="centered-container hero-container positive-bg" elem-height="0.50"><h3 class="hero-welcome">Thank You {{user.firstName}}</h3><h3 class="hero-welcome">Your Email is Confirmed</h3></div></div><div class="col col-10"></div></div></div></ion-content></ion-view>'),a.put("templates/fileBox.html",'<div ng-controller="fileNavCtrl" resize><div class="import-header dark-bg"><span>Import From...</span></div><div class="button-bar" evaporate eva-model="eva.Data" ng-model="eva.Inbox" ng-if="elWidth>510"><a class="button button-light" ng-click="fileNavigator.show(\'Google\')" google-button></a> <a class="button button-light" ng-click="fileNavigator.show(\'dropBox\')" dropbox-button></a> <a class="button button-light" ng-click="fileNavigator.show(\'Box\')" box-button></a> <a class="button button-light" ng-click="fileNavigator.show(\'Windows\')" windows-button></a></div><div class="button-bar" evaporate eva-model="eva.Data" ng-model="eva.Inbox" ng-if="elWidth<=510"><a class="button button-light" ng-click="fileNavigator.show(\'Google\')" google-button></a> <a class="button button-light" ng-click="fileNavigator.show(\'dropBox\')" dropbox-button></a></div><div class="button-bar" evaporate eva-model="eva.Data" ng-model="eva.Inbox" ng-if="elWidth<=510"><a class="button button-light" ng-click="fileNavigator.show(\'Box\')" box-button></a> <a class="button button-light" ng-click="fileNavigator.show(\'Windows\')" windows-button></a></div></div>'),a.put("templates/fileNavigator.html",'<ion-modal-view><ion-header-bar class="bar-positive"><button class="button icon ion-chevron-up" ng-if="fileNavigator.active.toParentVisible" ng-click="fileNavigator.active.toParent()"></button><h1 class="title">{{fileNavigator.active.name}}</h1><div class="buttons"><button class="button button-clear" ng-click="fileNavigator.hide()">Close</button></div></ion-header-bar><ionc-header-bar class="bar bar-subheader"><ion-scroll direction="x" class="path-scroll" delegate-handle="path"><span ng-click="fileNavigator.active.showRoot()" style="cursor:pointer">Path:&nbsp {{fileNavigator.active.root}}</span> <span path-to-links ng-model="fileNavigator.active.folders" on-change="fileNavigator.active.showFolder"></span></ion-scroll></ionc-header-bar><ion-content class="has-header has-subheader" delegate-handle="fileNavigator"><div ng-if="fileNavigator.active.name == \'Dropbox\'"><ion-list><ion-item ng-repeat="file in fileNavigator.active.folders.data" ng-click="fileNavigator.active.select($index)" ng-class="{\'item-icon-left\':file.is_dir||!file.thumb_exists,\'item-thumbnail-left\':!file.is_dir&&file.thumb_exists}"><i ng-if="file.is_dir" class="icon ion-folder positive"></i> <img ng-if="file.thumb_exists" style="box-shadow:5px 5px 5px #888888" ng-src="{{file.thumb}}"> <i ng-if="!file.is_dir&&!file.thumb_exists &&!file.is_empty" class="icon ion-document calm"></i> <i ng-if="file.is_empty" class="icon ion-alert assertive"></i><h3>{{file.name}}</h3><p ng-if="!file.is_empty">Type: {{file.type}}</p></ion-item></ion-list></div><div ng-if="fileNavigator.active.name == \'Box\'"><ion-list><ion-item ng-repeat="file in fileNavigator.active.folders.item_collection.entries" ng-click="fileNavigator.active.select($index)" ng-class="{\'item-icon-left\':file.type == \'folder\' || file.type!=\'folder\'}"><i ng-if="file.type == \'folder\'" class="icon ion-folder positive"></i> <img ng-if="file.thumb" style="box-shadow:5px 5px 5px #888888" ng-src="{{file.thumb}}"> <i ng-if="file.type != \'folder\'&&!file.is_empty" class="icon ion-document calm"></i> <i ng-if="file.is_empty" class="icon ion-alert assertive"></i><h3>{{file.name}}</h3><p ng-if="!file.is_empty">Type: {{file.type}}</p></ion-item></ion-list></div><div ng-if="fileNavigator.active.name == \'Google\'"><ion-list><ion-item ng-repeat="file in fileNavigator.active.folders.data" ng-click="fileNavigator.active.select($index)" ng-class="{\'item-icon-left\':file.type == \'folder\' || file.type!=\'folder\',\'item-thumbnail-left\':file.thumbnail}"><i ng-if="file.type == \'folder\'" class="icon ion-folder positive"></i> <img ng-if="file.thumbnail" style="box-shadow:5px 5px 5px #888888" ng-src="{{file.thumbnailLink}}"> <i ng-if="file.type != \'folder\'&&!file.thumbnail &&!file.is_empty" class="icon ion-document calm"></i> <i ng-if="file.is_empty" class="icon ion-alert assertive"></i><h3>{{file.title}}</h3><p ng-if="!file.is_empty">Type: {{file.type}}</p></ion-item></ion-list></div><div ng-if="fileNavigator.active.name == \'Microsoft\'"><ion-list><ion-item ng-repeat="file in fileNavigator.active.folders.data" ng-click="fileNavigator.active.select($index)" ng-class="{\'item-icon-left\':!file.thumbnail,\'item-thumbnail-left\':file.thumbnail}"><i ng-if="file.type == \'folder\' || file.type==\'album\'" class="icon ion-folder positive"></i> <img ng-if="file.thumbnail" style="box-shadow:5px 5px 5px #888888" ng-src="{{file.thumbnail}}"> <i ng-if="file.type !=\'folder\'&&file.type!=\'album\'&&!file.thumbnail &&!file.is_empty" class="icon ion-document calm"></i> <i ng-if="file.is_empty" class="icon ion-alert assertive"></i><h3>{{file.name}}</h3><p ng-if="!file.is_empty">Type: {{file.type}}</p></ion-item></ion-list></div></ion-content></ion-modal-view>'),a.put("templates/libNav.html",'<ion-view view-title="{{title}}"><ion-content class="slideshow-container centered-container"><div class="revu-list-header positive-bg"><button class="button button-icon icon ion-chevron-left revu-list-button revu-left" ng-click="slideBack()"></button> {{navItems[selectedNavId].name}}</div><add-template template-url="templates/slideItems.html"></add-template></ion-content><ion-content slide-right="library::slide" style="background:white"><add-template template-url="templates/navItems.html"></add-template></ion-content><tour-step step-name="MobileLibrary" ext="tourShow()"></tour-step></ion-view>'),a.put("templates/library.html",'<ion-view view-title="{{title}}" ng-cloak><ion-nav-buttons side="right"><div ng-controller="signInCtrl"></div></ion-nav-buttons><ion-content has-bouncing="false" ng-class="{\'slideshow-container\':!archiveOn(),\'archive-container\':archiveOn()}"><div class="row" style="padding:0px 5px 0px 0px"><div class="{{navClass}}" style="padding:0px 5px 0px 0px"><add-template template-url="templates/navItems.html"></add-template></div><div class="{{thumbClass}}"><add-template template-url="templates/slideItems.html"></add-template></div></div></ion-content><div class="presence-message dark-bg centered-container" appear-up="show_message">""</div><tour-step step-name="Library" ext="tourShow()"></tour-step></ion-view>'),a.put("templates/manageSeats.html",'<ion-modal-view><ion-header-bar class="bar-calm"><h1 class="title">Allocate Seats</h1><div class="buttons"><button class="button button-light" ng-click="cancelManager()">Close</button></div></ion-header-bar><ion-header-bar class="bar bar-subheader bar-positive"><h2 class="title">Available Seats : {{script.availableSeats}}</h2></ion-header-bar>><ion-content has-header="true" has-subheader="true"><form name="forms.members"><div class="list"><div class="item item-input-inset"><label class="item-input-wrapper"><input type="text" name="aName" user-complete field-type="name" instance-name="script" ng-model="newMember.name" placeholder="Member Name" required></label><label class="item-input-wrapper"><input type="email" name="aEmail" user-complete field-type="email" instance-name="script" ng-model="newMember.email" placeholder="Member Email" required></label><button class="button button-small" ng-click="addMember()" ng-disabled="!forms.members.$valid || script.availableSeats ==0">add</button></div></div></form><div class="item item-divider item-button-right">Members <button class="button button-small button-positive divider-button" ng-click="script.showTeams=!script.showTeams">Add Teams?</button></div><div class="item item-button-right" ng-if="script.showTeams && script.teamList.length > 0" style="padding:0px"><label class="item-input"><span class="input-label" style="width:20%">Teams</span><select ng-model="script.team" ng-options="t.name for t in script.teamList"></select></label><button class="button button-small" ng-click="addTeam()" style="font-size:14px" ng-class="{\'move-left\':smallScreen() == false}" ng-disabled="script.availableSeats ==0">add</button></div><div class="list"><div ng-repeat="member in script.members" class="item item-icon-left"><i class="icon ion-minus-circled" style="font-size:95%" ng-click="delMember($index)"><p class="padding-left">{{script.members[$index].user.name}}</p></i></div></div></ion-content><ion-footer-bar><div class="centered-container"><button class="button button-positive button-positive" ng-click="updateSubscription()">Ok</button> <button class="button button-stable" ng-click="cancelManager()">Cancel</button></div></ion-footer-bar></ion-modal-view>'),a.put("templates/menu.html",'<ion-side-menus enable-menu-with-back-views="true"><ion-side-menu-content><ion-nav-bar class="bar-dark"><ion-nav-back-button class="button-clear"><i class="ion-arrow-left-c"></i> Back</ion-nav-back-button><ion-nav-buttons side="left"><button class="button button-icon button-clear ion-navicon" menu-toggle="left" ng-if="!deepLink"></button> <a class="button button-icon button-clear ion-home" ng-if="deepLink" href="https://www.revu.me"></a></ion-nav-buttons></ion-nav-bar><ion-nav-view style="background-color:transparent" name="menuContent"></ion-nav-view></ion-side-menu-content><ion-side-menu side="left"><ion-header-bar ng-class="{\'bar-calm\':!archive.menu,\'bar-stable\':archive.menu}"><h1 ng-if="!archive.menu" class="title">Menu</h1><h1 ng-if="archive.menu" class="title">Archive</h1></ion-header-bar><ion-content><ion-list><!-- Non-Archive Menu Items --><ion-item ng-if="!archive.menu" nav-clear menu-close href="#/app/settings"><i class="ion-gear-b menu-icon dark"></i>{{user.name}}</ion-item><ion-item nav-clear menu-close ng-if="smallScreen()&&!archive.menu" ng-click="newMeeting(\'app.mobileNewMeeting\')" href="#/app/mobile/newMeeting"><i class="ion-ios-monitor-outline menu-icon balanced"></i>New Meeting</ion-item><ion-item nav-clear menu-close ng-if="!smallScreen()&&!archive.menu" ng-click="newMeeting(\'app.newMeeting\')"><i class="ion-ios-monitor-outline menu-icon balanced"></i>New Meeting</ion-item><ion-item nav-clear menu-close ng-if="smallScreen()&&!archive.menu" href="#/app/mobile/library"><i class="ion-ios-paper menu-icon royal"></i>Library</ion-item><ion-item nav-clear menu-close ng-if="!smallScreen()&&!archive.menu" href="#/app/library"><i class="ion-ios-paper menu-icon royal"></i>Library</ion-item><ion-item ng-if="!archive.menu" nav-clear menu-close href="#/app/teams"><i class="ion-android-contacts menu-icon positive"></i>Teams</ion-item><ion-item ng-if="!archive.menu" nav-clear menu-close href="#/app/sessions"><i class="ion-speakerphone menu-icon balanced"></i>Meetings You Lead</ion-item><ion-item ng-if="!archive.menu" nav-clear menu-close href="#/app/attendeeSessions"><i class="ion-calendar menu-icon calm"></i>Meeting Invitations</ion-item><ion-item ng-if="(!archive.menu&&!isMobile) || (!achive.menu && isMobile && showArchive)" nav-clear menu-close ng-click="toggleArchive()"><i class="ion-filing menu-icon energized"></i>Archive</ion-item><ion-item ng-if="!archive.menu" nav-clear menu-close href="#/app/tour"><i class="ion-compass menu-icon dark"></i>Restart Tour</ion-item><!-- Archive Menu Items --><ion-item ng-if="archive.menu" nav-clear menu-close ng-click="toggleArchive()"><i class="ion-arrow-left-b menu-icon dark"></i>Main Menu</ion-item><ion-item nav-clear menu-close ng-if="smallScreen()&&archive.menu" href="#/app/mobile/library"><i class="ion-ios-paper menu-icon royal"></i>Library</ion-item><ion-item nav-clear menu-close ng-if="!smallScreen()&&archive.menu" href="#/app/library"><i class="ion-ios-paper menu-icon royal"></i>Library</ion-item><ion-item ng-if="archive.menu" nav-clear menu-close href="#/app/sessions"><i class="ion-speakerphone menu-icon balanced"></i>Past Meetings</ion-item><ion-item ng-if="archive.menu" nav-clear menu-close href="#/app/attendeeSessions"><i class="ion-calendar menu-icon calm"></i>Past Invitations</ion-item><!-- backdoor menu item for me --><ion-item ng-if="user.email==\'klynch@volerro.com\' || user.batman" nav-clear menu-close href="#/app/batman"></ion-item></ion-list></ion-content></ion-side-menu></ion-side-menus>'),a.put("templates/myAccount.html",'<ion-view view-title="My Account"><ion-content class="presentation-background"><div ng-class="{\'row row-center\':!smallScreen()}"><div ng-class="{\'col col-10\':!smallScreen()}"></div><div ng-class="{\'col col-80\':!smallScreen()}"><div class="centered-container account-list"><ion-list><div class="item item-divider positive-bg" style="color:white">Account Information</div><ion-item><h2>Subscription Type: {{script.type}}</h2><h2>Administrator: {{admin.firstName}} {{admin.lastName}}</h2><p>Days Left {{script.daysLeft}}</p></ion-item><ion-item><h2>Total Seats: {{script.totalSeats}}</h2><h2>Available Seats: {{script.availableSeats}}</h2><span ng-if="order.type == \'Monthly\'" class="positive">Monthly Cost (USD) : {{order.price | currency: \'$\':0}}</span> <span ng-if="order.type == \'Annually\'" class="positive">Annual Cost (USD) : {{order.price | currency: \'$\':0}}</span><div style="margin-top:7px"><button class="button button-small button-positive" ng-click="changeAccount()" ng-if="script.type != \'Elite\'">{{changeButton.text}}</button> <button class="button button-small button-calm" style="color:black" ng-click="manageSeats()" ng-disabled="script.availableSeats == 0">Manage Seats</button></div></ion-item><ion-item ng-if="script.customerId != undefined"><h2>Current Card: <img ng-src="{{script.defaultMethod.imageUrl}}" style="width:30px"> {{script.defaultMethod.cardType}} ending in {{script.defaultMethod.last4}}</h2><button class="button button-small button-dark" ng-click="changeCard()">Change Card</button></ion-item><div ng-if="showChange"><div class="item item-divider positive-bg" style="color:white">Upgrade/Change Your Account</div><div class="item"><div ng-class="{\'row\':screenSize().width>800}"><div ng-class="{\'col col-50\':screenSize().width>800}"><label class="item item-input" style="border-style:none"><span class="input-label push-number">Number of Seats</span> <input type="number" ng-model="order.totalSeats" min="1" ng-change="changeSeatCount()"></label></div><div ng-class="{\'col col-50\':screenSize().width>800}"><div class="item item-input item-select" style="border-style:none"><span class="input-label">Subscription Type</span><select ng-model="order.type" ng-options="script for script in order.scriptTypes" ng-change="changeTerm()"></select></div></div></div></div><div class="item centered-container"><span ng-if="order.type == \'Monthly\'" class="positive">Monthly Cost (USD) : {{order.price | currency: \'$\':0}}</span> <span ng-if="order.type == \'Annually\'" class="positive">Annual Cost (USD) : {{order.price | currency: \'$\':0}}</span><p>{{order.hint}}</p><button class="button button-small button-positive" style="margin-top:5px" ng-click="checkout()" ng-disabled="(script.totalSeats == order.totalSeats)&&(script.type == order.type)">Check Out</button> <button class="button button-small button-stable" style="margin-top:5px" ng-click="cancelChange()">Cancel</button></div></div><div ng-if="script.type==\'Monthly\' || script.type==\'Annually\'" class="item item-divider dark-bg" style="color:white">Close Your Account</div><div style="background:white" ng-if="script.type==\'Monthly\' || script.type==\'Annually\'"><div class="item item-checkbox no-border" ng-class="{\'half-item\':!smallScreen()}"><label class="checkbox"><input ng-model="order.stopRenew" type="checkbox" ng-change="renewChange()"></label>Do Not AutoRenew</div><p ng-class="{\'assertive\':order.stopRenew,\'balanced\':script.autoRenew}">{{script.renewMessage}}</p></div></ion-list></div><div ng-class="{\'col col-10\':!smallScreen()}"></div></div></div><div class="presence-message dark-bg" appear-up="show_message">""</div></ion-content></ion-view>'),
a.put("templates/navItems.html",'<div class="lib-list-header"><div class="button-bar bar-positive"><a class="button" ng-click="setModel(\'files\')" ng-class="{\'tab-selected\': modelName==\'files\'}">Files</a> <a class="button" ng-click="setModel(\'categories\')" ng-class="{\'tab-selected\': modelName==\'categories\'}">Categories</a> <a class="button" ng-click="setModel(\'decks\')" ng-class="{\'tab-selected\': modelName==\'decks\'}">Decks</a></div></div><div class="revu-list-header calm-bg"><button ng-if="archiveOn()" class="button button-icon icon ion-minus-circled revu-list-button revu-left" ng-click="toggleListDelete()"></button><p class="sub-title" ng-if="modelName==\'decks\'&&smallScreen()">(options:swipe left)</p>{{listName}} <button class="button button-icon icon ion-plus-circled revu-list-button revu-right" ng-click="toggleNavAdd()" ng-if="!archiveOn()"></button></div><div ng-show="eva.Data.ready && modelName==\'files\'" ng-if="!smallScreen()"><file-box close-on-select="false" file-box></file-box></div><div ng-show="eva.Data.ready && modelName==\'files\'" ng-if="smallScreen()"><file-box close-on-select="true" file-box></file-box></div><div ng-show="showAddItem"><div ng-switch on="modelName"><div ng-switch-when="files"><!------evaporate testing-------------><div ng-show="eva.Data.ready"><div class="flow-drop-zone centered-container" drag-enter="class=\'flow-drag-enter\'" drag-leave="class=\'flow-drag-leave\'" evaporate eva-model="eva.Data" ng-model="eva.Inbox" ng-class="class" ng-if="!device.IOS() && !device.isIPad() && !device.isAndroid() && !device.isWindowsPhone()"><p>Drop your file(s) here</p></div><ion-list ng-if="library.uploading.files.length > 0"><ion-item ng-repeat="file in library.uploading.files" class="upload-content" style="min-height:70px" ng-cloak><ion-spinner icon="ios" class="upload-spinner" ng-if="file.spinner"></ion-spinner><h2>{{file.name}}</h2><p ng-show="file.timeLeft != 0">{{file.timeLeft}} seconds remaining...</p><p ng-show="file.message != \'\'">{{file.message}}</p><div ng-show="!file.spinner" class="progress-bar" elem-height="0.01" ng-style="{\'width\':file.progressString}"></div></ion-item></ion-list></div><!---------end evaporate--------------></div><div ng-switch-when="categories"><form name="categoryForm"><div class="list"><div class="item item-input-inset"><label class="item-input-wrapper"><input type="text" ng-model="category.name" placeholder="Category Name:" required></label><button ng-click="addCategory()" ng-disabled="categoryForm.$invalid" class="button button-small">Submit</button></div></div></form></div><div ng-switch-when="decks"><form name="deckForm"><div class="list"><div class="item item-input-inset"><label class="item-input-wrapper"><input type="text" name="deckName" ng-model="deck.name" placeholder="Deck Name:" required></label><button ng-click="addDeck()" ng-disabled="deckForm.$invalid" class="button button-small">Submit</button></div></div></form></div></div></div><ion-scroll elem-height="0.70"><ion-refresher pulling-text="Pull to refresh..." on-refresh="doRefresh()" spinner="ripple"></ion-refresher><ion-list show-delete="shouldShowDelete"><ion-item ng-repeat="(itemIndex,item) in navItems" class="item-thumbnail-left" ng-class="{\'item-select\':!archiveOn()}" ng-click="setNavSelection($index)"><ion-delete-button ng-if="!archiveOn()" class="ion-minus-circled" ng-click="archiveNavItem($index)" ng-disabled="!item._$Archive" style="color:#ffe900"></ion-delete-button><ion-delete-button ng-if="archiveOn()" class="ion-minus-circled" ng-click="delNavItem($index)" ng-disabled="!item._$Delete"></ion-delete-button><img ng-if="item.slides.length != 0" ng-src="{{item.thumb}}" class="white-background"><h2>{{item.name}}</h2><p>{{item.user.firstName}} {{item.user.lastName}}</p><p>{{item.createdDate | date:"MM/dd/yyyy h:mma"}}</p><span ng-if="item.sharingString" class="positive">Sharing:{{item.sharingString}}</span><select ng-if="!smallScreen() && item.actions.length > 1 && !archiveOn()" ng-model="item.action.selected" ng-options="action.name for action in item.actions" ng-change="item.action.selected.callBack(itemIndex,item.action.selected.idx,$event,\'option\')" ng-class="{\'edit-color\':item.beingEdited}">{{option.callBack}}</select><div class="buttons"><button ng-if="!smallScreen()&&archiveOn()" class="button button-energized archive-button" ng-click="unArchiveNavItem($index,$event)">UnArchive</button></div><ion-option-button ng-repeat="action in item.actions" ng-model="item.action.selected" ng-if="smallScreen() && $index!=0 && !archiveOn()" ng-click="action.callBack(itemIndex,$index,$event,\'button\')" class="button ng-class:action.class;">{{action.name}}</ion-option-button><ion-option-button ng-if="smallScreen() && archiveOn()" class="button button-energized" ng-click="unArchiveNavItem($index,$event)">UnArchive</ion-option-button><i class="icon ion-plus-circled slide-adder top-corner" ng-show="isEditing && !showEdit && (selectedNavId == $index) " ng-click="addAll()"></i><p class="top-corner" ng-show="isEditing && !showEdit && (selectedNavId == $index) ">select all</p></ion-item></ion-list></ion-scroll><!--    ng-change="option.callBack(itemIndex,$idx,$event,\'option\')"-->'),a.put("templates/newTeamTemplate.html",'<ion-modal-view><ion-header-bar class="bar-positive"><h1 class="title">{{modalTitle}}</h1><div class="buttons"><button class="button button-clear button-light" ng-click="closeModal()">Close</button></div></ion-header-bar><ion-content><div><form name="teamForm"><label class="item item-input"><span class="input-label">Team Name</span> <input name="teamName" type="text" ng-model="addTeam.name" required></label><div class="list"><div class="item item-toggle">Comma Delimited Input<label class="toggle toggle-positive"><input type="checkbox" ng-model="commaDelimited"><div class="track"><div class="handle"></div></div></label></div><div ng-show="!commaDelimited"><div class="item item-input-inset"><label class="item-input-wrapper"><input type="text" name="mName" ng-model="addTeam.nameString" placeholder="Member Name" user-complete field-type="name" instance-name="team"></label><label class="item-input-wrapper"><input type="email" name="mEmail" ng-model="addTeam.emailString" placeholder="Member Email" user-complete field-type="email" instance-name="team"></label><button class="button button-small" ng-click="addMember()" ng-disabled="teamForm.mEmail.$invalid || teamForm.mName.$invalid">add</button></div><div class="item item-divider">Members</div><ion-scroll><div class="list" elem-height="0.12"><div ng-repeat="member in addTeam.members" class="item item-icon-left"><i class="icon ion-minus-circled" style="font-size:95%" ng-click="delMember($index)"><p class="padding-left">{{addTeam.members[$index].firstName}} {{addTeam.members[$index].lastName}} {{addTeam.members[$index].email}}</p></i></div></div></ion-scroll></div><div ng-show="commaDelimited"><label class="item item-input item-stacked-label"><span class="input-label">Add Members:(pattern:first,last,email;)</span><textarea class="team-textarea" name="members" ng-model="addTeam.memberString" style="width:97%" elem-height="0.185" wrap="hard">\n                        </textarea></label></div></div></form></div><div class="centered-container" style="margin-top:10px"><button class="button button-positive" ng-click="modalCallback()" ng-disabled="teamForm.teamName.$invalid || (addTeam.members.length == 0)">OK</button> <button class="button padding-left button-stable" ng-click="closeModal()">Cancel</button><p ng-show="teamForm.teamName.$invalid">Team Name is Required</p></div></ion-content></ion-modal-view>'),a.put("templates/payment.html",'<ion-view view-title="Payment"><ion-content class="presentation-background"><div ng-class="{\'row row-center\':!smallScreen()}"><div ng-class="{\'col col-10\':!smallScreen()}"></div><div ng-class="{\'col col-80\':!smallScreen()}"><div class="centered-container account-list" style="background:white;padding-bottom:30px"><ion-item><h2>Total Seats: {{script.totalSeats}}</h2><span class="positive" ng-if="script.type == \'Monthly\'">Monthly Fee (USD): {{script.cost | currency:\'$\':0}}</span> <span class="positive" ng-if="script.type == \'Annually\'">Annual Fee (USD): {{script.cost | currency:\'$\':0}}</span> <span ng-if="status.errors!=undefined" class="assertive">{{status.errorMessage}}</span><p ng-if="status.errors==undefined">{{status.message}}</p></ion-item><ion-item ng-if="script.defaultMethod!=undefined"><h2>Pay Using {{script.defaultMethod.cardType}} ending in {{script.defaultMethod.last4}} ?</h2><div><button class="button button-small button-positive" style="margin-top:5px" ng-click="defaultPay()" ng-disabled="paymentDisabled">OK</button> <button class="button button-small button-stable" style="margin-top:5px" ng-click="cancelOrder()">Cancel</button></div><span ng-if="status.errors!=undefined" class="assertive">{{status.errorMessage}}</span><p ng-if="status.errors==undefined">{{status.message}}</p></ion-item><form ng-if="showCardEntry"><braintree-dropin options="dropinOptions">Loading payment form...</braintree-dropin><div><button class="button button-small button-positive" style="margin-top:5px" type="submit">Place Order</button> <button class="button button-small button-stable" style="margin-top:5px" ng-click="cancelOrder()">Cancel</button></div><span ng-if="status.errors!=undefined" class="assertive">{{status.errorMessage}}</span><p ng-if="status.errors==undefined">{{status.message}}</p></form></div><div ng-class="{\'col col-10\':!smallScreen()}"></div><div class="presence-message dark-bg" appear-up="show_message">""</div></div></div></ion-content></ion-view>'),a.put("templates/presAnalytics.html",'<ion-modal-view><ion-header-bar class="bar-positive"><h1 class="title">{{session.name}}</h1><div class="buttons"><button class="button button-clear button-light" ng-click="closeModal()">Close</button></div></ion-header-bar><ion-content><div class="item item-divider">{{session.decks[deckIdx].name}}</div><div class="item item-divider" ng-repeat="metric in session.decks[deckIdx].metrics">{{metric.eventDate| date:"EEEE MM/dd/yyyy h:mma"}}<div class="list card" ng-repeat="sv in metric.slideViews"><div class="item item-avatar slide-report-header"><img ng-if="session.decks[deckIdx].slides[sv.slideIndex].type == \'img\'" ng-src="{{session.decks[deckIdx].slides[sv.slideIndex].src}}" class="no-corners"> <img ng-if="session.decks[deckIdx].slides[sv.slideIndex].type == \'video\'" ng-src="{{session.decks[deckIdx].slides[sv.slideIndex].poster}}" class="no-corners"><h2>Slide Number {{sv.slideIndex+1}}</h2><p>Slide Duration: {{sv.duration | number:2}}(sec)</p></div><div class="item"><div class="row"><div class="col col-50 centered-container">Viewer</div><div class="col col-50 centered-container">Time on Slide</div></div><div class="row" ng-repeat="view in sv.views"><div class="col col-50 centered-container">{{view.userName}}</div><div class="col col-50 centered-container">{{view.viewed| number:2}}(sec) {{(view.viewed/sv.duration)*100|number:0}}%</div></div></div></div></div></ion-content></ion-modal-view>'),a.put("templates/presEndTemplate.html",'<ion-modal-view><ion-header-bar class="bar-calm"><h1 class="title">Thank You</h1><div class="buttons"><button class="button button-clear button-light" ng-click="signupModal.hide()">Close</button></div></ion-header-bar><div class="bar bar-subheader"><h2 class="title">The Meeting Has Ended</h2></div><ion-content has-subheader="true"><div class="centered-container hero-container padding-bottom with-subheader" ng-class="{\'rounded-corners\': !smallScreen()}"><p class="positive">Presented By:</p><p class="pres-end-header positive" style="line-height:100%">Revu.Me</p><p class="positive">If You Like Our Product<br>Just Enter a Password<br>and Click "Sign Up"</p><form name="forms.signup"><label class="item item-input padding-bottom" ng-class="{narrow : !smallScreen()}"><span class="input-label">Password</span> <input name="inpPassword" ng-model="forms.signup.password" type="password" required></label><button class="button button-balanced" style="margin-top:10px" ng-click="doSignUp()" ng-disabled="!forms.signup.inpPassword.$dirty">Sign Up</button><div class="signin-button"><p class="signin-message" ng-click="signupModal.hide()">No Thanks</p></div></form></div></ion-content></ion-modal-view>'),a.put("templates/presentation.html",'<ion-view view-title="{{name}}"><ion-nav-buttons side="right"><button class="button icon ion-ios-telephone" ng-click="showDialin()"></button> <button class="button icon-left" ng-click="toggleShowUsers()"><i class="icon ion-person-stalker"></i><div class="user-indicator">{{present.length}}</div></button></ion-nav-buttons><ion-content class="has-header presentation-background" scroll="false" id="presentation" fullscreen><div class="centered-container slide" elem-size controls="true" host="true"><div class="row" ng-class="{\'vert-center\':screenSize().width < screenSize().height}"><div class="col col-5"><a class="button icon-left ion-chevron-left button-clear button-dark slider-button" ng-click="prevSlide();$event.preventDefault(); $event.stopPropagation();"></a></div><div class="col col-90"><ion-slide-box class="bordered-drop-shadow" on-slide-changed="setSlide(index)" show-pager="false"><ion-slide ng-repeat="slide in presentation.slides"><div ng-switch on="slide.type"><div ng-switch-when="img"><ion-scroll direction="xy" scrollbar-x="false" scrollbar-y="false" zooming="true" min-zoom="1.0" style="width: 100%; height: 100%" delegate-handle="scrollHandle{{$index}}" on-scroll="updateSlideStatus(current)" on-release="updateSlideStatus(current)"><img ng-src="{{slide.src}}" class="slide-content"></ion-scroll></div><div ng-switch-when="video"><video id="vid-slide" class="slide-content" v-source="{{slide.src}}" controls v-lead="{{$index}}"></video></div></div></ion-slide></ion-slide-box><div class="presence-message dark-bg" appear-up="show_message">""</div></div><div class="col col-5"><a class="button icon-right ion-chevron-right button-clear button-dark slider-button right" ng-click="nextSlide();$event.preventDefault(); $event.stopPropagation();"></a></div></div></div><div class="bar bar-footer bar-dark" ng-if="footer.class != \'hidden\'" ng-class="{\'tall\': footer.class == \'tall\'}"><div class="centered-container"><div ng-repeat="attendee in everyone" class="user-item"><div class="circle-initials" ng-class="{\'calm-bg\': attendee.isOnline,\n                                   \'circle-offline\':!attendee.isOnline,\n                                   \'ion-eye-disabled user-distracted circle-offline\': attendee.distracted}"><p ng-show="!attendee.distracted">{{attendee.initials}}</p></div><span ng-if="attendee.itsMe != true" class="user-item-text">{{attendee.firstName}} {{attendee.lastName}}</span> <span ng-if="attendee.itsMe" class="user-item-text">You</span></div></div></div></ion-content></ion-view>'),a.put("templates/presentations.html",'<ion-view title="Presentations"><ion-nav-buttons side="left"><button menu-toggle="left" class="button button-icon icon ion-navicon"></button></ion-nav-buttons><ion-content class="has-header"><ion-list><ion-item class="item-thumbnail-left" ng-repeat="deck in presentations" href="#/app/presentations/{{deck.id}}"><img ng-src="{{deck.slides[0].source}}"><h2>{{deck.name}}</h2><p>{{deck.slides.length}} total slides</p></ion-item></ion-list></ion-content></ion-view>'),a.put("templates/resetPassword.html",'<ion-view view-title="Change Password"><ion-content ng-class="{\'dark-bg\':isMobile}"><div class="centered-container"><div class="row row-center"><div class="col col-10"></div><div class="col col-80"><!--   <img ng-src="{{image}}" class="splash-image"> --><div class="centered-container hero-container positive-bg padding-bottom"><span class="hero-header">Revu.Me</span><div class="signup-form"><form name="forms.resetPw" ng-controller="resetPasswordCtrl"><div class="list list-inset"><label class="item item-input"><span class="input-label">Email</span> <input name="inpEmail" ng-model="forms.resetPw.email" type="email" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">Old Password</span> <input name="inpOldPassword" ng-model="forms.resetPw.oldPassword" type="password" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">New Password</span> <input name="inpNewPassword" ng-model="forms.resetPw.newPassword" type="password" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">Retype PW</span> <input name="inpResetPW" ng-model="forms.resetPw.repeat" type="password" required></label></div><button class="button" ng-click="resetPassword()" ng-disabled="!forms.resetPw.inpEmail.$dirty ||\n                                         forms.resetPw.inpEmail.$invalid ||\n                                         !forms.resetPw.inpOldPassword.$dirty ||\n                                         !forms.resetPw.inpNewPassword.$dirty ||\n                                         !forms.resetPw.inpResetPW.$dirty">Change Password</button><div><span ng-if="forms.resetPw.inpEmail.$dirty && forms.resetPw.inpEmail.$invalid" class="signin-message">Invalid Email Format</span> <span ng-if="forms.resetPw.inpOldPassword.$dirty &&\n                                     forms.resetPw.inpOldPassword.$error.required" class="signin-message">Old Password is Required</span> <span ng-if="forms.resetPw.inpNewPassword.$dirty &&\n                                     forms.resetPw.inpNewPassword.$error.required" class="signin-message">New Password is Required</span> <span ng-if="forms.resetPw.inpResetPW.$dirty &&\n                                     forms.resetPw.inpResetPW.$error.required" class="signin-message">Please Retype New Password</span></div></form></div></div></div><div class="col col-10"></div></div></div></ion-content></ion-view>'),a.put("templates/review.html",'<ion-view view-title="{{name}}"><ion-content class="has-header presentation-background" scroll="false"><div class="centered-container slide" elem-size controls="true"><div class="row"><div class="col col-5"><a class="button icon-left ion-chevron-left button-clear button-dark slider-button" ng-click="prevSlide()" ng-disabled="!prevEnabled"></a></div><div class="col col-90"><ion-slide-box disable-scroll="true" class="bordered-drop-shadow" show-pager="false"><ion-slide ng-repeat="slide in presentation.slides"><div ng-switch on="slide.type"><div ng-switch-when="img"><img ng-src="{{slide.src}}" class="slide-content"></div><div ng-switch-when="video"><video class="slide-content" controls="controls" v-source="{{slide.src}}" v-follow="{{$index}}"></video></div></div></ion-slide></ion-slide-box><div class="presence-message dark-bg" appear-up="show_message">""</div></div><div class="col col-5"><a class="button icon-right ion-chevron-right button-clear button-dark slider-button right" ng-click="nextSlide()" ng-disabled="!nextEnabled"></a></div></div></div></ion-content></ion-view>'),a.put("templates/search.html",'<ion-view view-title="Search"><ion-content><h1>Search</h1></ion-content></ion-view>'),a.put("templates/session.html",'<ion-view view-title="{{session.name}}" hide-back-button="false" ng-cloak><ion-nav-buttons side="right"><button class="button" ng-click="editSession()">Edit</button></ion-nav-buttons><ion-content class="has-header"><div class="list card"><div class="item item-divider">Meeting Details</div><div class="item item-button-right"><p><strong>Date:&#160&#160&#160&#160&#160&#160&#160&#160&#160&#160</strong>{{session.date | date:"MM/dd/yyyy"}}</p><p><strong>Time:&#160&#160&#160&#160&#160&#160&#160&#160&#160&#160</strong>{{session.time | date:"h:mma"}}</p><p><strong>Organizer:</strong> &#160 {{session.organizer.firstName}} {{session.organizer.lastName}}</p><p ng-if="session.bridge && isMobile"><strong>Dial in:</strong>&#160&#160&#160&#160&#160&#160 <a href="tel:{{session.bridgeNumber}},,,{{session.confId}}#">{{session.bridgeNumber}}</a></p><p ng-if="session.bridge && !isMobile"><strong>Dial in:</strong>&#160&#160&#160&#160&#160&#160 {{session.bridgeNumber}}</p><p><strong>Meeting Id:</strong>&#160{{session.ufId}}</p><button class="button button-balanced" ng-click="startMeeting()" ng-if="!activeMeeting">Start Meeting</button> <button class="button button-assertive" ng-click="endMeeting()" ng-if="activeMeeting">End Meeting</button> <button class="button button-positive" style="top:55px" ng-click="resendInvites()">Resend Invites</button></div><div class="item item-body">{{session.description}}</div><div class="item item-checkbox"><label class="checkbox"><input ng-model="session.bridge" type="checkbox"></label>conference bridge</div><div class="item item-checkbox" ng-if="!reportDisabled($index)"><label class="checkbox"><input ng-model="session.leaveBehind" type="checkbox" ng-click="setLeaveBehind()"></label>Allow Post Meeting Review</div><div class="item item-divider">Presentations Decks</div><div class="item item-thumbnail-left item-button-right" ng-repeat="deck in session.decks"><img ng-src="{{deck.thumb}}"><h2>{{deck.name}}</h2><p>{{deck.slides.length}} total slides</p><div class="buttons session-item-button"><button class="button button-positive" ng-click="go(session._id,$index)" ng-if="session.decks.length > 1">Show</button> <button class="button button-positive button-outline" ng-disabled="!reportsEnabled[$index]" ng-click="showResults($index)">Report</button></div></div><div class="item item-divider">Attendees</div><div class="item"><span><strong>Organizer:</strong>{{session.organizer.firstName}} {{session.organizer.lastName}}</span><br><span ng-repeat="attendee in session.attendees">{{attendee.firstName}} {{attendee.lastName}} e: {{attendee.email}}<br></span></div></div></ion-content></ion-view>'),a.put("templates/sessions.html",'<ion-view title="{{titles.organizer}}" ng-cloak><ion-nav-buttons side="left"><button menu-toggle="left" class="button button-icon icon ion-navicon"></button></ion-nav-buttons><ion-content class="has-header"><div class="revu-list-header balanced-bg"><button ng-if="!archiveOn()" class="button button-icon icon ion-minus-circled revu-list-button revu-left" ng-click="toggleListDelete(\'org\')"></button> You\'re the Organizer<p class="sub-title" ng-if="smallScreen()">(swipe left to edit)</p><button class="button button-icon icon ion-plus-circled revu-list-button revu-right" ng-click="newSession()"></button></div><ion-scroll elem-height="0.80"><ion-refresher pulling-text="Pull to refresh..." on-refresh="doRefresh()"></ion-refresher><ion-list show-delete="shouldShowDelete" delegate-handle="org"><ion-item class="item-thumbnail-left item-button-right" ng-repeat="session in orgSessions" href="#/app/sessions/{{session._id}}"><ion-delete-button class="ion-minus-circled" style="color:#ffe900" ng-click="markArchive($index)"></ion-delete-button><img ng-src="{{session.decks[0].thumb}}"><h2>{{session.name}}</h2><p>{{session.date | date:"MM/dd/yyyy"}} {{session.time | date:"h:mma"}}</p><p>Total Attendees: {{session.attendees.length}}</p><p>First Deck is: {{session.decks[0].name}} of {{session.decks.length}}</p><p ng-if="smallScreen()">(swipe left to edit)</p><ion-option-button ng-if="smallScreen()&&!archiveOn()" class="button button-positive" ng-click="editSession($index); $event.preventDefault(); $event.stopPropogation();">Edit</ion-option-button><ion-option-button ng-if="smallScreen()&&archiveOn()" class="button button-energized" ng-click="markArchive($index); $event.preventDefault(); $event.stopPropogation();">UnArchive</ion-option-button><!--\n              <ion-option-button ng-if="smallScreen()" class="button button-energized" \n                      ng-click="markArchive($index); $event.preventDefault(); $event.stopPropogation();">\n                  {{actions[2].name}}\n              </ion-option-button>\n              <select ng-if="!smallScreen()"\n                      ng-options="action as action.name for action in actions"\n                      ng-model="action.selected"\n                      ng-change="doAction($index)"\n                      style="z-index:500">\n              </select>\n                --><button ng-if="!smallScreen()&&!archiveOn()" class="button button-positive" ng-click="editSession($index); $event.preventDefault(); $event.stopPropogation();">Edit</button> <button ng-if="!smallScreen()&&archiveOn()" class="button button-energized" ng-click="markArchive($index); $event.preventDefault(); $event.stopPropogation();">UnArchive</button></ion-item></ion-list></ion-scroll></ion-content></ion-view>'),a.put("templates/settings.html",'<ion-view view-title="Settings"><ion-content class="presentation-background"><div ng-class="{\'row row-center\':!smallScreen()}"><div ng-class="{\'col col-10\':!smallScreen()}"></div><div ng-class="{\'col col-80\':!smallScreen()}"><div class="centered-container account-list"><ion-list><ion-item><h2 class="positive">Account Email:&nbsp{{user.email}}</h2></ion-item><div class="item item-divider">Setting List</div><ion-item ng-repeat="action in setting.actions" ng-click="action.action()"><h2>{{action.name}}</h2></ion-item><div style="background:white;margin-top:1px"><div class="item item-checkbox"><label class="checkbox"><input ng-model="$rootScope.showArchive" class="centered-checkbox" type="checkbox"></label>Show Archive on Mobile</div></div></ion-list></div></div><div ng-class="{\'col col-10\':!smallScreen()}"></div></div></ion-content></ion-view>'),a.put("templates/shareTemplate.html",'<ion-modal-view><ion-header-bar class="bar-calm"><h1 class="title">Share with Team</h1><div class="buttons"><button class="button button-clear button-light" ng-click="cancelShare()">Close</button></div></ion-header-bar><ion-content><ion-list><ion-item ng-repeat="team in teams" class="item-checkbox"><label class="checkbox"><input ng-model="team.included" type="checkbox"></label>{{team.name}}<p>Total Members: {{team.members.length}}</p></ion-item></ion-list></ion-content><ion-footer-bar><div class="centered-container"><button class="button button-positive button-calm" ng-click="updateSharing()">Ok</button> <button class="button button-stable" ng-click="cancelShare()">Cancel</button></div></ion-footer-bar></ion-modal-view>'),a.put("templates/signin.html",'<ion-view view-title="Sign In"><ion-content ng-class="{\'dark-bg\':isMobile}"><div class="centered-container"><div class="row row-center"><div class="col col-10"></div><div class="col col-80"><!--   <img ng-src="{{image}}" class="splash-image"> --><div class="centered-container hero-container positive-bg padding-bottom rounded-corners"><span class="hero-header">Revu.Me</span><p ng-if="message != undefined" class="signin-message">{{message}}</p><div class="signup-form"><form name="forms.signin" ng-controller="signinCtrl"><div class="list list-inset"><label class="item item-input"><span class="input-label">Email</span> <input name="inpEmail" ng-model="forms.signin.email" type="email" required></label><div class="input-spacer positive-bg"></div><label class="item item-input"><span class="input-label">Password</span> <input name="inpPassword" ng-model="forms.signin.password" type="password" required></label></div><button class="button" ng-click="doSignIn()" ng-disabled="!forms.signin.inpPassword.$dirty || !forms.signin.inpEmail.$dirty \n                                             || forms.signin.inpEmail.$invalid">Sign In</button><div><span ng-if="forms.signin.inpEmail.$dirty && forms.signin.inpEmail.$invalid" class="signin-message">Invalid Email Format</span> <span ng-if="forms.signin.inpPassword.$dirty && forms.signin.inpPassword.$error.required" class="signin-message">Password is Required</span></div></form></div></div></div><div class="col col-10"></div></div></div></ion-content></ion-view>'),a.put("templates/signinTemplate.html",'<div ng-controller="signupCtrl"><div class="row centered-container"><button class="button icon-left ion-social-google button-signin skinny google" ng-click="signInWith(\'Google\')">Sign-in with Google</button></div><div class="row centered-container"><button class="button icon-left ion-social-windows button-signin skinny windows" ng-click="signInWith(\'Windows\')">Sign-in with Microsoft</button></div><div class="row centered-container"><button class="button icon-left ion-social-dropbox button-signin skinny dropbox" ng-click="signInWith(\'Dropbox\')">Sign-in with Dropbox</button></div><div class="row centered-container"><button class="button button-signin skinny box" ng-click="signInWith(\'Box\')" ng-mouseenter="mouseEnter()" ng-mouseleave="mouseLeave()"><img ng-src="{{mouse.over && \'img/box_hover.png\' || \'img/box_white.png\'}}"> Sign-in with Box</button></div></div><input type="email" placeholder="email" ng-model="user.email"><br><input type="password" placeholder="password" ng-model="user.password"><br><input style="width:10%" type="checkbox" ng-model="user.resetPassword"><p class="dark" style="line-height:normal;display:inline">Reset My Password (add email)</p><br><p class="assertive" style="line-height:normal;text-align:center">{{user.message}}</p>'),a.put("templates/signup.html",'<ion-view view-title="Sign Up"><ion-content class="presentation-background"><div class="centered-container"><div ng-class="screenSize().width<800 ? \'col\' : \'row row-center signin-margin-top\'"><!--div ng-class="{\'col col-10\':screenSize().width<800, \'col col5\':screenSize().width>800}"--><div ng-class="screenSize().width<800 ? \'\' : \'col col-40\'"><div class="row centered-container"><button class="button icon-left ion-social-google button-signin google" ng-click="signInWith(\'Google\')">Sign-in with Google</button></div><div class="row centered-container"><button class="button icon-left ion-social-windows button-signin windows" ng-click="signInWith(\'Windows\')">Sign-in with Microsoft</button></div><div class="row centered-container"><button class="button icon-left ion-social-dropbox button-signin dropbox" ng-click="signInWith(\'Dropbox\')">Sign-in with Dropbox</button></div><div class="row centered-container"><button class="button button-signin box" ng-click="signInWith(\'Box\')" ng-mouseenter="mouseEnter()" ng-mouseleave="mouseLeave()"><img ng-src="{{mouse.over && \'img/box_hover.png\' || \'img/box_white.png\'}}"> Sign-in with Box</button></div></div><div ng-class="{\'col col-10\':screenSize().width>800}" ng-if="screenSize().width>800"></div><div ng-class="screenSize().width<800 ? \'row\' : \'col col-40\'"><div class="centered-container positive-bg padding-bottom full-width"><span class="signup-header">Sign in with Email</span><div class="signup-form"><form name="forms.signup" ng-controller="signupCtrl"><div class="list"><label class="item item-input item-floating-label light-bg"><span class="input-label" style="text-align:left">First Name</span> <input name="fName" ng-model="forms.signup.firstName" type="text" placeholder="firstName" required></label><label class="item item-input item-floating-label light-bg"><span class="input-label" style="text-align:left">Last Name</span> <input name="lName" ng-model="forms.signup.lastName" type="text" placeholder="Lastname" required></label><label class="item item-input item-floating-label light-bg"><span class="input-label" style="text-align:left">Email</span> <input name="inpEmail" ng-model="forms.signup.email" type="email" placeholder="Email" required></label><label class="item item-input item-floating-label light-bg"><span class="input-label" style="text-align:left">Password</span> <input name="inpPassword" ng-model="forms.signup.password" type="password" placeholder="Password" required></label></div><button class="button" ng-click="doSignUp()" ng-disabled="!forms.signup.fName.$dirty || \n                                             !forms.signup.lName.$dirty || \n                                             !forms.signup.inpPassword.$dirty || \n                                             !forms.signup.inpEmail.$dirty || \n                                             forms.signup.inpEmail.$invalid">Sign Up</button><div class="signin-button"><p class="signin-message" ng-click="signIn()">Sign In</p></div><div><span ng-if="forms.signup.inpEmail.$dirty && forms.signup.inpEmail.$invalid" class="signin-message">Invalid Email Format</span> <span ng-if="forms.signup.inpPassword.$dirty && forms.signup.inpPassword.$error.required" class="signin-message">Password is Required</span> <span ng-if="forms.signup.fName.$dirty && forms.signup.fName.$error.required" class="signin-message">First Name is Required</span> <span ng-if="forms.signup.lName.$dirty && forms.signup.lName.$error.required" class="signin-message">Last Name is Required</span></div></form></div></div></div><div ng-class="{\'col col-10\':screenSize().width<800, \'col col-5\':screenSize().width>800} "></div></div></div></ion-content></ion-view>'),
a.put("templates/slideItems.html",'<ion-scroll elem-height="0.875" overflow-scroll="true"><div ng-repeat="slide in slides" class="thumbnail" ng-class="{\'thumb-selected\':tap.on && tap.index==$index}" ng-cloak><div ng-switch on="slide.type"><div ng-switch-when="img"><div style="position:relative"><i class="icon ion-close-circled slide-deleter" ng-show="statesReady && isEditing && slide.included && !slide.available" ng-click="deleteSlide($index)" ng-cloak></i> <i class="icon ion-checkmark-round slide-included" ng-show="slide.included && slide.available"></i> <i class="icon ion-plus-circled slide-adder" ng-show="statesReady && isEditing && slide.available " ng-click="addSlide($index)" ng-cloak></i> <img ng-src="{{slide.src}}" style="width:100%" class="rounded-corners shadow white-background" ng-click="tapThumb($index)"></div></div><div ng-switch-when="video"><div style="position:relative"><i class="icon ion-close-circled slide-deleter" ng-show="statesReady && isEditing && slide.included && !slide.available" ng-click="deleteSlide($index)" ng-cloak></i> <i class="icon ion-checkmark-round slide-included" ng-show="slide.included && slide.available"></i> <i class="icon ion-plus-circled slide-adder" ng-show="statesReady && isEditing && slide.available " ng-click="addSlide($index)" ng-cloak></i><!--\n                    <i class="icon ion-play slide-play-video" \n                       ng-show="!slide.playing"  \n                       ng-click="playVideo($index)">\n                    </i>\n\n                    <video ng-show="slide.playing"\n                           class="rounded-corners shadow video-thumbnail"\n                           controls=true\n                           ng-click="tapThumb($index)"\n                           v-source={{slide.src}} auto-play="slide.playing">\n                    </video> \n--><video id="vid-slide" class="rounded-corners shadow" poster="https://dw69ofzd8w57f.cloudfront.net/transparant.png" v-source="{{slide.src}}" v-background-image="{{slide.poster}}" controls="true" ng-click="tapThumb($index)"></video><!--\n                    <img ng-show="!slide.playing"\n                         ng-src="{{slide.poster}}"  \n                         style="width:100%" class="rounded-corners shadow"\n                         ng-click="tapThumb($index)">\n--></div></div></div></div></ion-scroll>'),a.put("templates/slideShow.html",'<ion-view view-title="{{presentation.name}}"><ion-content class="has-header presentation-background" scroll="false" id="slideshow" fullscreen><div class="centered-container slide" elem-size controls="true" host="false"><div class="row" ng-class="{\'vert-center\':screenSize().width < screenSize().height}"><div class="col col-5"><a class="button icon-left ion-chevron-left button-clear button-dark slider-button" ng-click="previousClicked();$event.preventDefault(); $event.stopPropagation();" ng-disabled="!prevEnabled"></a></div><div class="col col-90"><ion-slide-box ng-repeat="box in slideBoxes" ng-if="box.idx == slideBoxIdx" disable-scroll="false" class="bordered-drop-shadow" show-pager="false" active-slide="boxCurrent" delegate-handle="{{box.handle}}" ng-cloak><ion-slide ng-repeat="slide in box.slides" ng-init="$last ? slidesDone() : null" ng-cloak><div ng-switch on="slide.type"><div ng-switch-when="img"><ion-scroll direction="xy" scrollbar-x="false" scrollbar-y="false" zooming="true" min-zoom="1.0" style="width: 100%; height: 100%" delegate-handle="scrollHandle{{$index}}" on-scroll="updateSlideStatus(boxCurrent)" on-release="updateSlideStatus(boxCurrent)"><img ng-src="{{slide.src}}" class="slide-content" on-swipe-left="nextClicked()" on-swipe-right="previousClicked()"></ion-scroll></div><div ng-switch-when="video"><video class="slide-content" controls="controls" v-source="{{slide.src}}" on-swipe-left="nextClicked()" on-swipe-right="previousClicked()"></video></div></div></ion-slide></ion-slide-box></div><div class="col col-5"><a class="button icon-right ion-chevron-right button-clear button-dark slider-button right" ng-click="nextClicked();$event.preventDefault(); $event.stopPropagation();" ng-disabled="!nextEnabled"></a></div></div></div></ion-content></ion-view>'),a.put("templates/splash.html",'<ion-view view-title="Revu.Me" hide-back-button="true"><ion-content class="presentation-background"><div class="centered-container" ng-intro-options="IntroOptions" ng-intro-method="DoIntro" ng-intro-oncomplete="CompletedEvent" ng-intro-onexit="ExitEvent" ng-intro-onchange="ChangeEvent" ng-intro-onbeforechange="BeforeChangeEvent" ng-intro-onafterchange="AfterChangeEvent" ng-intro-autostart="ShouldAutoStart"><div id="step1" class="row row-center"><div class="col col-10 collapse"></div><div class="col col-80 collapse"><!--   <img ng-src="{{image}}" class="splash-image"> --><div class="centered-container hero-container positive-bg" port-height="0.50"><h3 class="hero-welcome">Welcome {{user.name}}</h3><span class="hero" flash-weight="Revu.Me:Ready">Revu.Me</span> <button class="button button-stable tour-button" ng-click="tourService.start()">Take a Quick Tour</button></div></div><div class="col col-10 collapse"></div></div><div class="row row-center" ng-if="user.email==\'klynch@volerro.com\'"><div class="col col-10 collapse"></div><div class="col col-80 collapse"><div class="centered-container user_list"><ion-list><div id="step2" class="item item-divider">Users Online</div><ion-item class="item-icon-left" ng-repeat="user in users" ng-click="login()"><i class="icon ion-android-contact avatar_icon"></i><h2 ng-if="user.name != \'undefined undefined\'">{{user.name}}</h2></ion-item></ion-list></div></div><div class="col col-10 collapse"></div></div></div></ion-content><div class="bar bar-footer" ng-class="{\'bar-positive\':user.daysLeft>=14,\'bar-energized\':(user.daysLeft < 14 && user.daysLeft > 7), \'bar-assertive\':(user.daysLeft <= 7),\'bar-tall\':smallScreen()}" ng-if="user.script!=undefined && user.script.autoRenew == false"><div class="title">Your {{user.script.type}} Subsction has {{user.daysLeft}} days left</div><button class="button button-calm" ng-class="{\'bar-button-bottom\':smallScreen()}" ng-if="user.script.type!=\'Elite\' && user.daysLeft < 21">{{buyButton.text}}</button></div></ion-view>'),a.put("templates/team.html",'<ion-view title="{{teamName}}"><ion-nav-buttons side="right"><button class="button button-balanced" ng-disabled="teamForm.teamName.$invalid || (addTeam.members.length == 0) || !_$Save" ng-click="modalCallback()">Save</button></ion-nav-buttons><div class="bar bar-header item-input-inset"><label class="item-input-wrapper"><i class="icon ion-ios-search placeholder-icon"></i> <input type="search" placeholder="Search"></label></div><ion-content class="has-header"><form name="forms.teamForm"><label class="item item-input"><span class="input-label">Team Name</span> <input name="teamName" type="text" ng-model="addTeam.name" required></label><div class="list"><div class="item item-toggle">Comma Delimited Input<label class="toggle toggle-positive"><input type="checkbox" ng-model="commaDelimited"><div class="track"><div class="handle"></div></div></label></div><div ng-show="!commaDelimited"><div class="item item-input-inset"><label class="item-input-wrapper"><input type="text" name="mName" ng-model="addTeam.nameString" placeholder="Member Name" user-complete field-type="name" instance-name="team"></label><label class="item-input-wrapper"><input type="email" name="mEmail" ng-model="addTeam.emailString" placeholder="Member Email" user-complete field-type="email" instance-name="team"></label><button class="button button-small" ng-click="addMember()" ng-disabled="teamForm.mEmail.$invalid || teamForm.mName.$invalid || !_$AddMember">add</button></div></div><div ng-show="commaDelimited"><label class="item item-input item-stacked-label"><span class="input-label">Add Members:(pattern:first,last,email;)</span><textarea class="team-textarea" name="members" ng-model="addTeam.memberString" style="width:97%" elem-height="0.185" wrap="hard">\n                        </textarea></label></div></div></form><div class="revu-list-header positive-bg"><button class="button button-icon icon ion-minus-circled revu-list-button revu-left" ng-click="toggleListDelete(\'member\')" ng-disabled="!_$DeleteMember"></button> Members</div><ion-scroll elem-height="0.80"><ion-refresher pulling-text="Pull to refresh..." on-refresh="doRefresh()"></ion-refresher><ion-list show-delete="shouldShowDelete" delegate-handle="member"><ion-item ng-repeat="member in addTeam.members"><ion-delete-button class="ion-minus-circled" ng-click="delMember($index)"></ion-delete-button><div class="item item-input item-select" style="border-style:none"><div class="input label"><h2>{{member.firstName}} {{member.lastName}}</h2><p>email: {{member.email}}</p></div><select ng-model="member.role" ng-options="permission.name for permission in permissions" ng-disabled="!_$ChangeRole" ng-change="setDirty()"></select></div></ion-item></ion-list></ion-scroll></ion-content></ion-view>'),a.put("templates/teams.html",'<ion-view title=""><ion-content class="has-header"><div class="revu-list-header positive-bg"><button class="button button-icon icon ion-minus-circled revu-list-button revu-left" ng-click="toggleListDelete(\'team\')"></button> Your Teams <button class="button button-icon icon ion-plus-circled revu-list-button revu-right" ng-click="newTeam()"></button></div><ion-scroll elem-height="0.80"><ion-refresher pulling-text="Pull to refresh..." on-refresh="doRefresh()"></ion-refresher><ion-list show-delete="shouldShowDelete" delegate-handle="team"><ion-item class="item-button-right" ng-repeat="team in teams" ng-click="editTeam($index)"><ion-delete-button class="ion-minus-circled" ng-click="delTeam($index,$event); $event.stopPropogation();"></ion-delete-button><h2>{{team.name}}</h2><p>Total Members: {{team.members.length}}</p><p>{{team.previewString}}</p></ion-item></ion-list></ion-scroll></ion-content></ion-view>'),a.put("templates/tour-template.html",'<div class="tour-tip-container"><div class="tour-tip"><p ng-bind-html="step.text"></p></div><div class="tour-tip-buttons dark-bg"><a class="button button-clear button-small" ng-click="tourService.end()">End Tour</a><div class="tour-tip-controls"><a class="button button-clear button-small" ng-click="tourService.previous($event)">Previous</a> <a class="button button-clear button-small" ng-click="tourService.next($event)">Next</a></div></div></div>'),a.put("templates/tourTemplate.html",'<ion-modal-view><ion-header-bar class="bar-calm"><h1 class="title">Introductory Tour</h1><div class="buttons"><button class="button button-clear button-light" ng-click="cancelTour">Close</button></div></ion-header-bar><ion-content><div class="centered-container hero-container positive-bg" style="margin-top:20px" elem-height="0.50"><h3 class="hero-welcome">Welcome</h3><span class="hero">Revu.me</span></div></ion-content><ion-footer-bar><div class="centered-container"><button class="button button-assertive" ng-click="cancelTour()">Exit</button> <button class="button button-stable" ng-click="previousStep()">Previous</button> <button class="button button-positive" ng-click="nextStep">Next</button></div></ion-footer-bar></ion-modal-view>'),a.put("templates/userAdmin.html",'<ion-view title="User Admin"><ion-content><ion-scroll elem-height="0.95"><ion-refresher pulling-text="Pull to refresh..." on-refresh="doRefresh()"></ion-refresher><ion-list><ion-item ng-repeat="user in revume.allUsers"><div class="item item-input item-select" style="border-style:none"><div class="input label"><h2>{{user.firstName}} {{user.lastName}}</h2><p>email: {{user.email}}</p><p>Expires: {{user.script.expirationDate | date: \'mediumDate\'}}</p><p>AutoRenew: {{user.script.autoRenew}}</p></div><select ng-model="user.script.type" ng-options="script for script in revume.scriptTypes" ng-change="updateScript($index)"></select></div></ion-item></ion-list></ion-scroll></ion-content></ion-view>'),a.put("templates/users.html",'<ion-view title="Presentations"><ion-nav-buttons side="left"><button menu-toggle="left" class="button button-icon icon ion-navicon"></button></ion-nav-buttons><ion-content class="has-header"><ion-list><ion-item ng-repeat="deck in presentationList()" ng-click="setSelected($index)">{{deck.name}}</ion-item></ion-list></ion-content></ion-view>'),a.put("templates/viewer.html",'<ion-view view-title="{{name}}"><ion-nav-buttons side="right"><button class="button icon ion-ios-telephone" ng-click="bridgeService.showBridgeInfo()"></button></ion-nav-buttons><ion-content class="has-header presentation-background" scroll="false" id="viewer" fullscreen><div class="centered-container slide" ng-class="{\'vert-center\':screenSize().width < screenSize().height}" elem-size controls="false"><!--            <div class="row">\n                <div class="col col-10">\n                </div>\n\n                <div class="col col-80" >\n--><ion-slide-box disable-scroll="true" class="bordered-drop-shadow" show-pager="false"><ion-slide ng-repeat="slide in presentation.slides"><div ng-switch on="slide.type"><div ng-switch-when="img"><ion-scroll direction="xy" scrollbar-x="false" scrollbar-y="false" zooming="true" min-zoom="1.0" style="width: 100%; height: 100%"><img ng-src="{{slide.src}}" class="slide-content"></ion-scroll></div><div ng-switch-when="video"><video class="slide-content" controls="controls" v-source="{{slide.src}}" v-follow="{{$index}}"></video></div></div></ion-slide></ion-slide-box><div class="presence-message dark-bg" appear-up="show_message">""</div></div><!--                </div>\n\n                <div class="col col-10 ">\n                </div>  \n--></ion-content></ion-view>'),a.put("templates/welcomeTemplate.html",'<ion-modal-view><ion-content><div class="centered-container hero-container positive-bg" style="margin-top:20px" elem-height="0.50"><h3 class="hero-welcome">Welcome {{user.name}}</h3><span class="hero">Revu.me</span></div></ion-content></ion-modal-view>')}]),angular.module("RevuMe").factory("Auth",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/users/auth/:email";return a(c,{email:"@email"},{auth:{method:"PUT",params:{email:"@email"}}})}]).factory("Base64",[function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(b){var c,d,e,f,g,h="",i="",j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),i=b.charCodeAt(k++),e=c>>2,f=(3&c)<<4|d>>4,g=(15&d)<<2|i>>6,j=63&i,isNaN(d)?g=j=64:isNaN(i)&&(j=64),h=h+a.charAt(e)+a.charAt(f)+a.charAt(g)+a.charAt(j),c=d=i="",e=f=g=j="";while(k<b.length);return h},decode:function(b){var c,d,e,f,g,h="",i="",j="",k=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(b)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do e=a.indexOf(b.charAt(k++)),f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),j=a.indexOf(b.charAt(k++)),c=e<<2|f>>4,d=(15&f)<<4|g>>2,i=(3&g)<<6|j,h+=String.fromCharCode(c),64!=g&&(h+=String.fromCharCode(d)),64!=j&&(h+=String.fromCharCode(i)),c=d=i="",e=f=g=j="";while(k<b.length);return h}}}]).service("authService",["Auth","Users","pnFactory","$q","$ionicPopup","$rootScope","Base64","$location","$cookieStore","$state","ScriptService",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){var b=!0;return f.user.batman?b=!1:n.forEach(function(c){a.name==c&&(b=!1)}),b}var m=this;m.user=b,m.signinPopup=void 0,m.checkExists=function(a){var b=d.defer();return m.user.byEmail.get({email:a}).$promise.then(function(a){b.resolve(a)})["catch"](function(a){b.reject(a)}),b.promise},m.signUp=function(a){var b=d.defer(),c=new m.user.byId;return angular.extend(c,a),c.password=g.encode(c.email+":"+c.password),c.$save().then(function(a){b.resolve(a)})["catch"](function(a){b.reject(a)}),b.promise},m.resetPassword=function(a){var b=d.defer(),c=g.encode(a.email+":"+a.password);a.password=c;var e=g.encode(a.email+":"+a.oldPassword);return a.oldPassword=e,m.user.byEmail.update({email:a.email},a).$promise.then(function(a){b.resolve(a)}),b.promise},m.authenticate=function(b){var c=d.defer(),e=g.encode(b.email+":"+b.password);return b.password=e,a.auth({email:b.email},b).$promise.then(function(a){c.resolve(a)})["catch"](function(a){c.reject(a)}),c.promise},m.signIn=function(){var a=d.defer();return f.user={},f.user.message="",m.signinPopup=e.show({templateUrl:"templates/signinTemplate.html",title:"Sign In",scope:f,buttons:[{text:"<b>Sign In</b>",type:"button-positive",onTap:function(a){if(!f.user.resetPassword&&f.user.email&&f.user.password)return f.user.email.replace(/ /g,""),f.user.password.replace(/ /g,""),f.user;if(f.user.resetPassword){if(f.user.email)return f.user.message="",f.user.email.replace(/ /g,""),f.user;f.user.message="Please Enter Your Email!",a.preventDefault()}else a.preventDefault()}}]}),m.signinPopup.then(function(b){if(m.signinPopup=void 0,void 0!=f.user.network){var c={success:!0};a.resolve(c)}else if(b.resetPassword){var c={success:!1,reason:"resetPassword",user:b};a.resolve(c)}else{var d={};d.email=b.email,d.password=b.password,m.authenticate(d).then(function(b){if(b.success)b.user.authData=b.user.password,a.resolve(b);else{var c=e.alert({title:"Authentication Failed",template:b.reason});c.then(function(){var b={success:!1,reason:"authentication failed"};a.resolve(b)})}})}}),a.promise},m.hideSignup=function(a){f.user.network=a,void 0!=m.signinPopup&&(m.signinPopup.close(),m.signinPopup=void 0)};var n=["app.signup","app.changePassword","app.confirmEmail","app.myAccount","app.settings","app.batman"];m.randomKey=function(a){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;a>d;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b},m.forceCredentials=function(a){m.signIn().then(function(b){if(b.success)void 0==f.user.network&&f.userInit(b.user).then(function(){k.checkScript(f.user.script),void 0!=a&&j.go(a)});else if("resetPassword"==b.reason){if(b.user&&b.user.email){var c=m.user.pwReset,d={};d.email=b.user.email,d.pw=m.randomKey(6),d.authData=g.encode(d.email+":"+d.pw),c.reset({email:b.user.email},d).$promise.then(function(){var c=e.alert({title:"Password Reset",template:"A New Password was Emailed to: "+b.user.email});c.then(function(){m.forceCredentials(a)})})}}else m.forceCredentials(a)})},m.listen=function(a,b){if(f.deepLink=!1,l(b)){var c=h.search();if(void 0!=c.uid){f.deepLink=!0;var d=m.user.byId;d.get({id:c.uid}).$promise.then(function(a){f.user={},f.userInit(a)})}else if(f.user._id)f.user.script&&k.checkScript(f.user.script,a);else if(f.isMobile){var e=f.getLocalUser();if(void 0!=e){var d=m.user.byId;d.get({id:e._id}).$promise.then(function(a){return f.user={},f.userInit(a)}).then(function(){k.checkScript(f.user.script,a)})}}else if(void 0!=i.get("user")){var g=i.get("user"),d=m.user.byId;d.get({id:g._id}).$promise.then(function(a){return f.user={},f.userInit(a)}).then(function(){k.checkScript(f.user.script,a)})}else(void 0==f.user||void 0==f.user._id)&&(f.deepLink=!1,m.forceCredentials())}else if(void 0==f.user._id){var e=f.getLocalUser();if(void 0!=e){var d=m.user.byId;d.get({id:e._id}).$promise.then(function(a){f.user={},f.userInit(a),"app.signup"==b.name&&j.go("app.welcome")})}else{var g=i.get("user");if(void 0!=g){var d=m.user.byId;d.get({id:g._id}).$promise.then(function(a){f.user={},f.userInit(a),"app.signup"==b.name&&j.go("app.welcome")})}}}}}]),angular.module("RevuMe").service("Braintree",["$rootScope","ScriptService","$http","baseUrl","$q",function(a,b,c,d,e){var f=this;f.planData=void 0,f.basePath=d.endpoint+"/api/braintree/",f.init=function(a,b){var c=e.defer();return f.scope=a,f.payCallCount=0,f.scope.error={},f.callback=b||function(){},f.getPlansAndAddons().then(function(a){f.planData=a.data,c.resolve()}),c.promise},f.getPlansAndAddons=function(){var a=e.defer(),b=f.basePath+"plans";return c.get(b).then(function(b){a.resolve(b)}),a.promise},f.getPlan=function(a){var b=void 0,c=f.planData.plans;return c.forEach(function(c){c.name==a&&(b=c)}),b},f.getAddOn=function(a){var b=void 0,c=f.planData.addOns;return c.forEach(function(c){c.name==a&&(b=c)}),b},f.getDiscount=function(a){var b=void 0,c=f.planData.discounts;return c.forEach(function(c){c.name==a&&(b=c)}),b},f.createCustomer=function(a){var d=e.defer(),g=f.scope.script,h=f.basePath+"customer",i=b.getAdmin(g),j={firstName:i.firstName,lastName:i.lastName,email:i.email,nonce:a.nonce};return c.post(h,j).then(function(a){var b=a.data;b.success?(f.scope.script.customerId=b.customer.id,f.scope.token=b.customer.paymentMethods[0].token,d.resolve(b)):d.reject(b)}),d.promise},f.deleteCustomer=function(a){var b=e.defer(),d=f.basePath+"customer/delete",g={id:a};return c.post(d,g).then(function(a){var c=a.data;c.success?b.resolve(c):b.reject(c)}),b.promise},f.createScript=function(a){var b=e.defer(),d=f.scope.token,g=f.basePath+"subscription",h=void 0,i=f.getAddOn("RevuMe Seat Full Price"),j=f.getDiscount("RevuMe L1 Seat Discount"),k=f.getDiscount("RevuMe Annual Discount"),l=a.totalSeats-1;if("Monthly"==a.type)h=f.getPlan("RevuMe Monthly AutoRenew");else{h=f.getPlan("RevuMe Annually AutoRenew");var m=k}if(i=f.getAddOn("RevuMe Seat Full Price"),j=f.getDiscount("RevuMe L1 Seat Discount"),h&&i&&j){var n={token:d,plan:h.id,addOn:{id:i.id,quantity:l},discount:{id:j.id,quantity:0},annualDiscount:{id:void 0,quantity:1}};void 0!=m&&(n.annualDiscount.id=m.id),0==l&&(n.addOn.id=void 0),a.totalSeats>=j["break"]?n.discount.quantity=a.totalSeats:n.discount.id=void 0,c.post(g,n).then(function(a){var c=a.data;c.success?b.resolve(c.subscription.id):b.reject(c)})}else b.reject("CreateScript: Undefined plan elements");return b.promise},f.cancel=function(a){var b=e.defer(),d=f.basePath+"subscription/cancel",g={id:a.braintreeId};return void 0!=a.braintreeId?(c.post(d,g).then(function(a){var c=a.data;try{var d=c.errors.errorCollections.subscription.validationErrors.status[0].code;"81905"==d&&(c.success=!0)}catch(e){console.log("some other error")}c.success?b.resolve(c):b.reject(c)}),b.promise):void b.resolve()},f.upgradeToAnnual=function(a){var b=e.defer();f.basePath+"subscription",{id:a.braintreeId};return f.cancel(a).then(function(c){c.success?f.createScript(a).then(function(b){return a.braintreeId=b,f.updateScript(a)}).then(function(c){var c={success:!0};c.subscription={id:a.braintreeId},b.resolve(c)}):b.reject(c)}),b.promise},f.isAnnualPlan=function(a){var b=e.defer();return f.findSubscription(a).then(function(a){a.planId==f.getPlan("RevuMe Annually AutoRenew").id?b.resolve(!0):b.resolve(!1)}),b.promise},f.updateBTScript=function(a){var b=e.defer(),d=f.basePath+"subscription",g=void 0,h=f.getAddOn("RevuMe Seat Full Price"),i=f.getDiscount("RevuMe L1 Seat Discount"),j=a.totalSeats-1,k=0,l=f.getPlan("RevuMe Monthly AutoRenew"),m=f.getPlan("RevuMe Annually AutoRenew"),n=!1;return f.findSubscription(a).then(function(e){if("Annually"==a.type?(e.planId==l.id&&(n=!0,f.getToken(a).then(function(b){return f.scope.token=b,f.upgradeToAnnual(a)}).then(function(a){b.resolve(a)})),g=m):e.planId==m.id?(g=m,a.autoRenew=!1):g=l,g&&h&&i&&!n){var o={id:a.braintreeId,plan:g.id,addOn:{id:h.id,quantity:j},discount:{id:i.id,quantity:k}};a.totalSeats>=i["break"]?k=a.totalSeats:o.discount.id=void 0,0==j&&(o.addOn.id=void 0),void 0!=a.newToken&&(o.newToken=a.newToken),1==e.neverExpires&&0==a.autoRenew?(o.numberOfBillingCycles=e.currentBillingCycle,o.neverExpires=!1):0==e.neverExpires&&1==a.autoRenew&&(o.neverExpires=!0),c.put(d,o).then(function(a){var c=a.data;c.success?b.resolve(c.subscription.id):b.reject(c)})}}),b.promise},f.createToken=function(a,b){var d=e.defer(),g=f.basePath+"paymentMethod",h={customerId:a.customerId,nonce:b};return c.post(g,h).then(function(a){var b=a.data;b.success?d.resolve(b):d.reject(b)}),d.promise},f.findCustomer=function(a){var b=e.defer(),d=f.basePath+"customer";return c.get(d,{params:{id:a.customerId}}).then(function(a){var c=a.data;void 0!=c.id?b.resolve(c):b.reject(a)}),b.promise},f.getToken=function(a){var b=e.defer(),c=void 0;return f.findCustomer(a).then(function(a){a.paymentMethods.length>0?(a.paymentMethods.forEach(function(a){a["default"]&&(c=a)}),void 0!=c?b.resolve(c.token):b.reject("no default payment method")):b.reject("no payment methods for this customer")}),b.promise},f.newScriptNewCustomer=function(b){var c=e.defer();return f.createCustomer(b).then(function(a){return console.log("new customer created"),f.createScript(f.scope.script)}).then(function(a){return console.log("Script Created on Braintree"),f.scope.script.braintreeId=a,f.updateScript()}).then(function(){a.user.script=angular.copy(f.scope.script),console.log("new script created"),c.resolve()})["catch"](function(a){a.errors&&(void 0!=f.scope.script.customerId&&f.deleteCustomer(f.scope.script.customerId),f.scope.status.errors=a.errors,f.scope.status.errorMessage="Failed : "+a.message),c.reject(a)}),c.promise},f.newScriptExistingCustomer=function(b){var c=e.defer();f.findCustomer(b).then(function(a){return f.scope.token=a.paymentMethods[0].token,f.createScript(b)}).then(function(a){return f.scope.script.braintreeId=a,f.updateScript()}).then(function(b){a.user.script=angular.copy(f.scope.script),console.log("new script created"),c.resolve()})["catch"](function(a){result.errors&&(void 0!=f.scope.script.customerId&&f.deleteCustomer(f.scope.script.customerId),f.scope.status.errors=result.errors,f.scope.status.errorMessage="Failed : "+result.message),c.reject(result)})},f.findSubscription=function(a){var b=e.defer(),d=f.basePath+"subscription";return c.get(d,{params:{id:a.braintreeId}}).then(function(a){var c=a.data;void 0!=c.id?b.resolve(c):b.reject(a)}),b.promise},f.updateScript=function(){var c=e.defer(),d=f.scope.script,g=f.scope.order||{totalSeats:d.totalSeats,type:d.type};switch(d.startDate=new Date,d.expirationDate=new Date,d.autoRenew=!0,d.totalSeats=g.totalSeats,d.availableSeats=d.totalSeats-d.members.length,d.type=g.type,d.type){case"Monthly":var h=d.startDate.getMonth();h+=1,d.expirationDate.setMonth(h);break;case"Annually":var i=d.startDate.getFullYear();i+=1,d.expirationDate.setFullYear(i)}return b.update(d._id,d).then(function(){a.user.script=angular.copy(f.scope.script),f.scope.$broadcast("show_message","Order Complete!"),c.resolve(d)}),c.promise},f.payMethReceived=function(a){var b=f.scope.script;f.basePath+"customer";f.payCallCount++,console.log("PayMethRecieved - callCount = ",f.payCallCount),f.scope.token=void 0,f.scope.processCardDisabled=!0,f.scope.showCardEntry=!1,void 0==f.scope.status?f.scope.status={message:"Processing Payment...",errors:void 0}:(f.scope.status.message="Processing Payment...",f.scope.status.errors=void 0),void 0==b.customerId?(console.log("calling newScriptNewCustomer"),f.newScriptNewCustomer(a).then(function(){console.log("successfully added new customer/script"),f.callback()})):void 0==b.braintreeId&&(console.log("calling newScriptExistingCustomer"),f.newScriptExistingCustomer(b).then(function(){console.log("successfully added new script for the customer"),f.callback()}))},f.changeCard=function(a){var b=f.scope.script,d=f.basePath+"paymentMethod",e=void 0;f.scope.showCardEntry=!1,f.scope.status.message="Updating Card...",f.getToken(b).then(function(f){e=f,d+="/change";var g={customerId:b.customerId,oldToken:e,nonce:a.nonce};return c.post(d,g)}).then(function(a){var c=a.data;return c.success?(b.newToken=c.creditCard.token,f.updateBTScript(b)):(f.scope.status.errors=c.errors,void(f.scope.status.errorMessage="Failed : "+c.message))}).then(function(){f.callback()})["catch"](function(a){console.log(a),f.scope.status.errors={},f.scope.status.errorMessage="Failed : "+a})}}]),angular.module("RevuMe").factory("Bridges",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/bridges/:id";return a(c,{id:"@id"})}]).service("BridgeService",["Bridges","$q","$ionicPopup","$rootScope",function(a,b,c,d){function e(a,b,c){var d="("+a.slice(2,5)+") "+a.slice(5,8)+"-"+a.slice(8,12),e=d+",,,"+b+"#",f="<p><strong>Number:</strong></p>";return f+='<a href="tel:'+e+'">'+d+"</a>",f+="<br><p><strong>ConfID:</strong></p><p>"+b+"</p><br><p><strong>Voip:</strong></p><p>"+c+"</p><br>"}var f=this;f.currentBridge={},f.activeBridge=function(){return void 0!=f.currentBridge.conferenceID?!0:!1},f.findBridge=function(b){var c=b.replace(/-/g,"");a.get({id:c}).$promise.then(function(a){void 0!=a.conferenceID&&(f.currentBridge=a)})},f.startBridge=function(c){var e=b.defer(),g=c.replace(/-/g,"");return a.save({confId:g}).$promise.then(function(a){if(f.currentBridge=a,!d.isMobile)return f.showBridgeInfo(a);var b=a.tollNumber+",,,"+a.conferenceID;window.open("tel:"+b,"_system"),e.resolve()}).then(function(){e.resolve()})["catch"](function(a){console.log("startBridge: ",a),e.reject(a)}),e.promise},f.showBridgeInfo=function(){var a=b.defer(),d=f.currentBridge;if(void 0!=d.conferenceID){var g=(d.conferenceID.slice(0,3)+"-"+d.conferenceID.slice(3,6)+"-"+d.conferenceID.slice(6,9),d.tollNumber),h="("+g.slice(2,5)+") "+g.slice(5,8)+"-"+g.slice(8,12),i=(h+",,,"+d.conferenceID+"#",c.alert({title:"Please Dial In",template:e(d.tollNumber,d.conferenceID,d.sipURI)}));i.then(function(b){a.resolve()})}return a.promise},f.endBridge=function(b){var c=b.replace(/-/g,"");a["delete"]({id:c}).$promise.then(function(){f.currentBridge={}})},f.endMeeting=function(){var a={action:"end"};f.currentChannel&&f.currentChannel.publish(a)},f.setChannel=function(a){f.currentChannel=a}}]),angular.module("RevuMe").factory("SendConfirm",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/confirm/email/:user";return a(c,{user:"@user"},{send:{method:"POST",params:{user:"@user"}}})}]).factory("DoConfirm",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/users/confirm/:id";return a(c,{id:"@id"},{confirm:{method:"PUT",params:{id:"@id"}}})}]),angular.module("RevuMe").service("introContent",["$rootScope","Session","Users","UploadedFiles","Decks","Teams","baseUrl","$q",function(a,b,c,d,e,f,g,h){function i(a){console.log("offset before fix: ",a.time.getTimezoneOffset()),a.time.setDate(a.date.getDate()),a.time.setMonth(a.date.getMonth()),a.time.setFullYear(a.date.getFullYear()),a.offset=(new Date).getTimezoneOffset(),console.log("offset after fix: ",a.time.getTimezoneOffset())}var j=this;j.addFile=function(a,b){var c=h.defer(),e=new d,f={};return d.query({user:b._id,name:"Getting Started.pptx"}).$promise.then(function(b){var c=b[0];return f=c,e.name=c.name,e.user={_id:a},e.isArchived=!1,e.slides=[],e.thumb=c.thumb,e.$save()}).then(function(a){return e._id=a._id,f.slides.forEach(function(a){e.slides.push(a)}),d.update({id:e._id},e).$promise}).then(function(a){c.resolve(a)}),c.promise},j.addDeck=function(a,b){var c=h.defer(),f=new e,g={};return d.query({user:b._id,name:"Getting Started.pptx"}).$promise.then(function(b){var c=b[0];return g=c,f.name=g.name,f.user={_id:a},f.isArchived=!1,f.slides=[],f.thumb=g.thumb,f.$save()}).then(function(a){return f._id=a._id,g.slides.forEach(function(a){f.slides.push(a)}),e.update({id:f._id},f).$promise}).then(function(a){c.resolve(a)}),c.promise},j.addMeeting=function(a,c){var d=h.defer(),e=jstz.determine(),f=new b;return f.decks=[],f.decks.push(c),f.timeZone=e.name(),f.baseUrl=g.endpoint,f.date=new Date,f.time=f.date,f.time.setMilliseconds(0),f.time.setSeconds(0),f.bridge=!0,f.invite=!1,f.offset=(new Date).getTimezoneOffset(),f.showTeams=!1,f.length=30,f.name="Example Meeting",f.description="Show Meeting Features",f.attendees=[],f.attendees.push(a),f.organizer=a,i(f),f.$save().then(function(){d.resolve()})["catch"](function(a){d.reject(a),console.log(a)}),d.promise},j.addTeam=function(a,b){var d=h.defer(),e=new f,g={};return e.name="Example Team",e.members=[],e.members.push({user:a,role:"Admin"}),g.firstName="Jane",g.lastName="Doe",g.email="jdoe@volerro.com",g.role="Viewer",c.byEmail.get({email:g.email}).$promise.then(function(a){e.members.push({user:a._id,role:"Viewer"});var b={};return b.firstName="Fred",
b.lastName="Smith",b.email="fsmith@volerro.com",b.role="Viewer",c.byEmail.get({email:b.email}).$promise}).then(function(a){return e.members.push({user:a._id,role:"Viewer"}),e.$save()}).then(function(){d.resolve()}),d.promise},j.addIntroContent=function(a){var b=h.defer(),d={};return c.byEmail.get({email:"klynch@volerro.com"}).$promise.then(function(b){return d=b,j.addFile(a,d)}).then(function(b){return j.addDeck(a,d)}).then(function(b){return j.addMeeting(a,b._id)}).then(function(){return j.addTeam(a)}).then(function(){b.resolve()})["catch"](function(a){console.log("addIntroContent: error: ",a)}),b.promise}}]),angular.module("RevuMe").factory("Slides",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/library/slides/:slideId";return a(c)}]).factory("UploadedFiles",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/library/uploadedFiles/:id";return a(c,{id:"@id"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}})}]).factory("Decks",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/library/decks/:id";return a(c,{id:"@id"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}})}]).factory("Categories",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/library/categories/:id";return a(c,{id:"@id"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}})}]).factory("Archiver",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/library/:modelName/setarchive/:id/:isArchived";return a(c,{modelName:"@modelName",id:"@id",isArchived:"@isArchived"},{update:{method:"PUT",params:{modelName:"@modelName",id:"@id",isArchived:"@isArchived"}}})}]).service("Library",["UploadedFiles","Decks","Categories","$q","$timeout","baseUrl","$resource","$rootScope","$ionicPopup","rightsManager","shareMediator","Archiver","pnFactory","Evaporate","onEvent",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a){switch(a.event){case"end":v.uploadComplete(a),v.updateView(),v.$fire("uploadComplete");break;case"progress":v.uploadProgress(a);break;case"error":var b=i.alert({title:"File Upload Fails",template:"message: "+a.error});b.then(function(){v.uploadComplete(a),v.updateView(),v.$fire("uploadComplete")})}}function q(a){v.fileRights=j.register("files",a,v.actionList,v.files),v.deckRights=j.register("decks",a,v.actionList,v.decks),v.catRights=j.register("categories",a,v.actionList,v.categories),v.fileRights.setAll("Admin",!0),v.fileRights.setRight("Admin","Hide",!1),v.fileRights.setRight("Viewer","Share",!0),v.fileRights.setRight("Viewer","SlideShow",!0),v.catRights.setAll("Admin",!0),v.catRights.setRight("Admin","New Meeting",!1),v.catRights.setRight("Admin","Hide",!1),v.catRights.setRight("Viewer","Share",!0),v.deckRights.setAll("Admin",!0),v.deckRights.setRight("Admin","Hide",!1),v.deckRights.setRight("Viewer","Share",!0),v.deckRights.setRight("Viewer","SlideShow",!0)}function r(a){return a.substr(a.lastIndexOf("."),a.length-1).toLowerCase()}function s(a){var b=a.model,c=a.navItems,d=j.findKey(b);c.forEach(function(b){var c=b.beingEdited?a.editActions:a.actions;b.actions=[];var e=0;c.forEach(function(a){if(d.getRight(b.role,a.name)){var c={};c.name=a.name,c["class"]=a["class"],c.callBack=a.callBack,c.idx=e++,b.actions.push(c),d.applyRights(b.role,b)}}),b.action={selected:b.actions[0]}})}function t(a){for(var b=0;b<a.navItems.length;b++){var c=a.navItems[b];c.beingEdited=!1,a.isEditing&&a.model==w.model&&w.index==b&&(c.beingEdited=!0)}void 0==a.slides||a.slides.length<=0||a.slides.forEach(function(b){a.navItems[a.selectedNavId].beingEdited?(b.included=!0,b.available=!1):(b.included=!1,b.available=!0,a.isEditing&&w.instance.slides.forEach(function(a){a.link==b._id&&(b.included=!0)}))})}function u(a){var b=-1,c=0;return v.uploading.files.forEach(function(d){d.name==a.name&&(b=c),c++}),b}var v=this,w={};v.files=a,v.files.modelName="files",v.decks=b,v.decks.modelName="decks",v.categories=c,v.categories.modelName="categories",v.uploading={files:[]},o.attach(v),v.channel=m.newChannel("library::fileEvents"),h.$on("Revu.Me:Ready",function(){v.channel.subscribe(p)}),v.actionList=["Edit","New Meeting","Share","Hide","Archive","Delete","Reorder","SlideShow"],v.fileTypes=function(){var a=d.defer(),b=f.endpoint+"/api/library/fileTypes",c=g(b);return c.query().$promise.then(function(b){v.validTypes=b,a.resolve(b)})["catch"](function(b){a.reject(b)}),a.promise},v.fileTypes(),v.init=function(a){v.scope=a,a.navItems=[],a.slides=[],a.slideStates=[],a.isEditing=!1,a.editText="Edit",a.container={},w.index=-1,v.scope.eva=n,void 0==v.fcEvent&&(v.fcEvent=v.scope.eva.$on("fileComplete",function(a){v.scope.fullName=a.path_,console.log(v.scope.fullName),a.spinner=!0,v.processUpload(v.scope,a)})),void 0==v.fsEvent&&(v.fsEvent=v.scope.eva.$on("fileSubmitted",function(a,b){var c=r(a.name);if(v.validTypes.indexOf(c)>=0)v.startUpload(a);else{var d=i.alert({title:"Invalid File Type !",template:"valid types are: "+v.validTypes});d.then(function(){})}})),q(a)},v.setModel=function(a,b){v.model=b,a.model=b},v.cacheImages=function(b){var c=d.defer();v.cachedImages=[];var e={};return a.query({user:h.user._id,archiveOn:h.archiveOn()}).$promise.then(function(a){void 0!=a&&a.forEach(function(a){a.slides.forEach(function(a){"img"==a.type&&(e=new Image,e.src=a.src=a.src,v.cachedImages.push(e))})})}),k.getSharedForCache(v.files).then(function(a){void 0!=a&&a.forEach(function(a){void 0!=a.item&&a.item.slides.forEach(function(a){"img"==a.type&&(e=new Image,e.src=a.src=a.src,v.cachedImages.push(e))})}),c.resolve(),console.log("Total Cached Images = ",v.cachedImages.length)}),c.promise},v.updateView=function(){var a=d.defer();return h.showLoading(),void 0!=v.scope.model?v.updateModel(v.scope).then(function(){a.resolve(),h.hideLoading(),e(function(){v.scope.scrollDelegate.scrollTop()},0)})["catch"](function(b){a.reject(b)}):h.hideLoading(),a.promise},v.updateModel=function(a){var b=d.defer();return v.model!=a.model&&console.log("model error in Library service"),k.getItems(a.model).then(function(c){a.selectedNavId=0,c.length>0?(a.navItems=c,a.slides=a.navItems[a.selectedNavId].slides,t(a),s(a)):(a.navItems=[],a.slides=[]),b.resolve(a)})["catch"](function(a){b.reject(a)}),b.promise},v.updateSlides=function(a){return d(function(b,c){v.model!=a.model&&console.log("model error in Library service"),v.model.get({id:a.navItems[a.selectedNavId]._id}).$promise.then(function(c){void 0!=c?(a.slides=c.slides,a.navItems[a.selectedNavId].slides=c.slides,t(a)):(a.slides=[],a.navItems[a.selectedNavId].slides=[]),b(a.slides)})["catch"](function(a){c(a)})})},v.removeNavItem=function(a,b){return d(function(c,d){var e=a.navItems.splice(b,1);if(e.length>0){var f=e[0];void 0!=f&&(console.log("removing item ,",b," item is ",f),console.log(f._id),v.model["delete"]({id:f._id}).$promise.then(function(){c()})["catch"](function(a){d(a)}))}else c()})},v.newDeckFromFile=function(a){var b=d.defer();return v.scope.addingTo=new v.decks,v.scope.addingTo.name=a.name,v.scope.addingTo.user={_id:h.user._id},v.scope.addingTo.slides=[],v.scope.addingTo.thumb="",v.scope.addingTo.isArchived=!1,v.newNavItem(v.scope).then(function(b){return a.slides.forEach(function(a){v.scope.addingTo.slides.push(a)}),v.scope.addingTo.thumb=a.thumb,v.scope.addingTo.isArchived=!1,v.scope.addingTo._id=b._id,v.decks.update({id:v.scope.addingTo._id},v.scope.addingTo).$promise}).then(function(){b.resolve(v.scope.addingTo)}),b.promise},v.newNavItem=function(a){return v.model!=a.model&&console.log("model error in Library service"),a.addingTo.$save()},v.updateNavItem=function(a){var b=d.defer();if(-1!=w.index){var c=w.model;c.update({id:w.instance._id},w.instance).$promise.then(function(){return c.get({id:w.instance._id}).$promise}).then(function(c){a.navItems[a.selectedNavId].user=c.user,b.resolve()})}else{var e=a.model,f=a.selectedNavId;e.update({id:a.navItems[f]._id},a.navItems[f]).$promise.then(function(){return e.get({id:a.navItems[f]._id}).$promise}).then(function(c){a.navItems[a.selectedNavId].user=c.user,b.resolve()})}return b.promise},v.openCollection=function(a,b){a.isEditing||(a.selectedNavId=b,v.updateSlides(a).then(function(){a.isEditing=!0,a.editText="Done",w.model=a.model,w.index=b,w.instance=a.navItems[b],a.navItems[b].beingEdited=!0,t(a),e(function(){a.statesReady=!0},500)}))},v.closeCollection=function(a,b){a.isEditing&&b==w.index&&a.model==w.model&&(a.statesReady=!1,a.isEditing=!1,a.editText="Edit",v.updateNavItem(a).then(function(){a.navItems[w.index].beingEdited=!1,t(a),w.index=-1}))},v.doAdd=function(a,b){var c=w.instance;c.slides.push(a.slides[b]);var d=c.slides.length;if(c.slides[d-1].originalOrder=d-1,c.slides[d-1].link=a.slides[b]._id,a.slides[b].included=!0,1==c.slides.length){var e=c.slides[0];switch(e.type){case"img":w.instance.thumb=e.src;break;case"video":w.instance.thumb=e.poster}}},v.addSlide=function(a,b){if(a.isEditing)if(a.slides[b].included){var c=i.confirm({title:"Add Duplicate Slide?",template:"Do you want to add this again?"});c.then(function(c){c&&(v.doAdd(a,b),v.updateNavItem(a))})}else v.doAdd(a,b),v.updateNavItem(a)},v.addAll=function(a){if(a.isEditing){for(var b=0;b<a.slides.length;b++)a.slides[b].included||v.doAdd(a,b);v.updateNavItem(a)}},v.deleteSlide=function(a,b){if(a.isEditing){var c=w.instance;if(c.slides.splice(b,1),0==b)if(c.slides.length>=1){var d=c.slides[0];switch(d.type){case"img":w.instance.thumb=d.src;break;case"video":w.instance.thumb=d.poster}}else w.instance.thumb="",a.navItems[a.selectedNavId].thumb="";v.updateNavItem(a).then(function(){w.instance.slides.length>0?v.updateSlides(a):v.updateModel(a)})}},v.setUserId=function(a){var b=d.defer(),c=f.endpoint+"/api/library/uploadedFiles/setuser/:id",e=g(c,{id:"@id"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}});return e.update({id:a},{id:h.user._id}).$promise.then(function(){b.resolve()})["catch"](function(a){b.reject(a)}),b.promise},v.processUpload=function(a,b){var c=d.defer(),e=f.endpoint+"/api/library/uploadedFiles/processFile/:filePath",j=g(e,{filePath:"@filePath"},{convertFile:{method:"GET",params:{filePath:"@filePath"}}});if(void 0==a.fullName){var k=i.alert({title:"File Upload Error",template:"file name is missing"});k.then(function(){})}else j.convertFile({filePath:encodeURI(a.fullName),userId:h.user._id}).$promise.then(function(a){console.log(a);var d,e;b.size<5e6?(d=Math.floor(b.size/15e3),e=" seconds",d>60&&(e=" minute(s)",d=Math.floor(d/60))):(e=" minute(s)",d=Math.floor(b.size/4e6)),b.message="Processing: est time: "+d+e,c.resolve(a)})["catch"](function(a){console.log(a),c.reject(a)});return c.promise},v.uploadComplete=function(a){var b=u(a.file);b>=0&&(v.uploading.files[b].spinner=!1,v.uploading.files[b].timeLeft=0,v.uploading.files.splice(b,1))},v.uploadProgress=function(a){var b=u(a.file);b>=0&&v.scope.$apply(function(){v.uploading.files[b].message=a.message})},v.startUpload=function(a){a&&(a.spinner=!1,a.progress="0%",a.message="",v.uploading.files.push(a))},v.setArchive=function(a,b){var c=d.defer();console.log(a.navItems[b]);var e=a.navItems[b],f=a.modelName;return l.update({modelName:f,id:e._id,isArchived:e.isArchived}).$promise.then(function(){c.resolve()}),c.promise}}]),angular.module("RevuMe").factory("pnFactory",["Users","$q",function(a,b){var c={};c.init=function(a){a=a||"anonymous",c.uuid=a,c.pubnub=PUBNUB.init({keepalive:30,publish_key:"pub-c-19a2e5ee-5b70-435d-9099-65ae53e5b149",subscribe_key:"sub-c-0f2a418a-b9f1-11e4-80fe-02ee2ddab7fe",uuid:a,ssl:!0})};var d=function(a){1==arguments.length&&c.pubnub.publish({channel:this.name,message:a})},e=function(a,b){var d=function(){},e=a||d,f=b||d;c.pubnub.subscribe({channel:this.name,presence:f,message:e,heartbeat:60,connect:function(){console.log("Connected with SSL")}})},f=function(a){var b=function(){},d=a||b;c.pubnub.history({channel:this.name,count:100,callback:d})},g=function(){c.pubnub.unsubscribe({channel:this.name})},h=function(a){var b=function(){},d=a||b;c.pubnub.here_now({channel:this.name,callback:d})},i=function(a){for(var b=-1,c=0;c<this.users.length;c++)this.users[c]._id==a.uuid&&(b=c);return b},j=function(a){var c=b.defer(),d=this;switch(a.action){case"join":this.findOnline(a)<0&&this.getUser(a.uuid).then(function(b){var e={_id:a.uuid,name:b.userName};d.users.push(e),c.resolve(d.users)});break;case"leave":console.log("presence got leave action!");case"timeout":var e=this.findOnline(a);e>=0&&this.users.splice(e,1),c.resolve(this.users)}return c.promise},k=function(a){c.pubnub.state({channel:this.name,state:{userName:a}})},l=function(c){var d=new b.defer;return a.byId.get({id:c}).$promise.then(function(a){if(a._id){var b=a.firstName+" "+a.lastName;a.userName=b,d.resolve(a)}else d.reject("pnFactory uuid in message not found in user db")})["catch"](function(a){d.reject(a)}),d.promise};return c.newChannel=function(a){var b={name:a,publish:d,subscribe:e,unsubscribe:g,hereNow:h,history:f,resolveUsers:j,findOnline:i,setUser:k,getUser:l,users:[]};return b},c}]),angular.module("RevuMe").factory("EngagementMetrics",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/metrics/:sid/:did";return a(c)}]).service("presAnalyzer",["EngagementMetrics","$q",function(a,b){function c(a,b){if(a.length){var c=a.length-1;a[c].endTime=b,a[c].duration=(b-a[c].startTime)/1e3}}function d(a,b){var c=0,d=null;return a.forEach(function(e){void 0!=e.name&&e.name.valueOf()==b.valueOf()&&(d=a[c],d.idx=c),c++}),d}function e(a,b,c){var e=d(a,b.name),f={};if(e)e.events.push(c);else{var f=new Object;f.events=[],f.name=b.name,f.events.push(c),a.push(f)}}function f(a,b){var c=0,d={state:"init"},e=0,f={},g=!1;return void 0==a.endTime?100:(b.events.forEach(function(b){if(!g){switch(b.m.action){case"leave":case"timeout":f.state="gone",f.timestamp=b.timestamp;break;case"join":f.state="here",f.timestamp=b.timestamp;break;case"engagement":"engaged"==b.m.status?f.state="here":f.state="gone",f.timestamp=b.timestamp}if(f.timestamp>=a.startTime&&f.timestamp<=a.endTime)switch(e=Math.max(d.timestamp,a.startTime),d.state){case"init":"gone"==f.state&&(c+=(f.timestamp-a.startTime)/1e3);break;case"here":c+=(f.timestamp-e)/1e3}if(f.timestamp>=a.endTime){switch(e=Math.max(d.timestamp,a.startTime),d.state){case"init":c=0;break;case"here":c+=(a.endTime-e)/1e3}g=!0}d.state=f.state,d.timestamp=f.timestamp}}),g||(e=Math.max(d.timestamp,a.startTime),"here"==d.state&&(c+=(a.endTime-e)/1e3)),console.log("Slide ",a.number,"viewingTime : ",c," user :",b.name),c)}function g(a){for(var b,c=0;c<a.slides.length;c++){a.slides[c].users=[];for(var d=0;d<a.users.length;d++)b=new Object,b.name=a.users[d].name,b.idx=d,b.engagement=f(a.slides[c],a.users[d]),a.slides[c].users.push(b)}}function h(a){var b="";a.slides.forEach(function(a){b="",b="slide "+a.number+"duration :"+a.duration,a.users.forEach(function(a){b=b+" "+a.name+" "+a.engagement}),console.log(b)})}this.analyze=function(a){var b={},d={};return b.presentation={},b.slides=[],b.users=[],this.messageStore=a,this.messageStore.forEach(function(a){var f=a.m;switch(f.action){case"new":b.presentation.id=f.value,b.presentation.startTime=a.timestamp;break;case"end":b.presentation.endTime=a.timestamp,c(b.slides,a.timestamp);break;case"set":d=new Object,d.number=f.value,d.startTime=a.timestamp,c(b.slides,a.timestamp),b.slides.push(d);break;case"join":case"timeout":case"leave":var g={};g.name=f.userName,e(b.users,g,a);break;case"engagement":var h={};h.name=f.who,e(b.users,h,a)}}),g(b),h(b),b},this.save=function(c){var d=b.defer(),e=new a,f=c.results,g=f.presentation,h=f.slides;e.session=c.session,e.eventDate=new Date,e.deck=c.presentation,e.duration=(g.endTime-g.startTime)/1e3,e.slideViews=[];for(var i=0;i<h.length;i++){var j={};j.slideIndex=parseInt(h[i].number),j.duration=h[i].duration,j.views=[],h[i].users.forEach(function(a){j.views.push({userName:a.name,viewed:a.engagement})}),e.slideViews.push(j)}return e.viewers=[],f.users.forEach(function(a){e.viewers.push(a.name)}),e.$save().then(function(a){d.resolve(a)})["catch"](function(a){d.reject(a),console.log(a)}),d.promise},this.get=function(b,c){return a.query({sid:b,did:c}).$promise}}]),angular.module("RevuMe").service("Presentation",["$resource","baseUrl",function(a,b){}]),angular.module("RevuMe").service("recorder",[function(){Date.now||(Date.now=function(){return(new Date).getTime()}),this.setChannel=function(a){this.channel=a,this.messageStore=[]},this.record=function(a){var b=Date.now(),c={timestamp:b,m:a},d={},e=!0;if(this.messageStore.length){var d=this.messageStore[this.messageStore.length-1];"set"==d.m.action&&"set"==a.action&&d.m.value==a.value&&(e=!1)}e&&this.messageStore.push(c)},this["export"]=function(){return this.messageStore},this.dump=function(){this.messageStore.forEach(function(a){console.log(a)})}}]),angular.module("RevuMe").factory("Revu",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/revu/start",d=b.endpoint+"/api/revu/end";return{start:a(c,{},{send:{method:"POST",params:{}}}),end:a(d,{},{send:{method:"POST",params:{}}})}}]),angular.module("RevuMe").service("rightsManager",["$rootScope",function(a){function b(a,b,c){var d=g.roles.indexOf(b);g.clients.rights[a][d].forEach(function(a){a.enabled=c})}function c(a,b){var c=[],d=g.clients.allActions[a];return d.forEach(function(a){var d={};d.name=a,d.enabled=b,c.push(d)}),c}function d(a,b,c,d){var e=g.roles.indexOf(b),f=g.clients.allActions[a].indexOf(c);g.clients.rights[a][e][f].enabled=d}function e(a,b,c){var d=g.roles.indexOf(b),e=g.clients.allActions[a].indexOf(c),f=!0;return e>=0&&(f=g.clients.rights[a][d][e].enabled),f}function f(a,b,c){var d={};d=void 0!=c?c:g.clients.scopes[a],g.clients.allActions[a].forEach(function(c){var f=e(a,b,c),g="_$"+c.replace(/\s/g,"");d[g]=f})}var g=this;g.clients={scopes:[],names:[],allActions:[],rights:[],handles:[],keys:[]},g.roles=["Admin","Viewer"],g.register=function(a,h,i,j){var k=g.clients.names.indexOf(a);if(k>=0)return g.clients.scopes[k]=h,g.clients.allActions[k]=i,g.clients.keys[k]=j,g.clients.handles[k];g.clients.scopes.push(h),g.clients.names.push(a),g.clients.allActions.push(i),k=g.clients.names.length-1,g.clients.rights[k]=[];for(var l=0;l<g.roles.length;l++)g.clients.rights[k].push(c(k,!1));var m={};return m.setAll=function(a,c){b(k,a,c)},m.setRight=function(a,b,c){d(k,a,b,c)},m.getRight=function(a,b){var c=e(k,a,b);return c},m.getName=function(){var a=g.clients.names[k];return a},m.applyRights=function(a,b){f(k,a,b)},g.clients.handles[k]=m,g.clients.keys.push(j),g.clients.handles[k]},g.get=function(a){var b=g.clients.names.indexOf(a);return b>=0?g.clients.handles[b]:void console.log("rightsManager:client: "+clientName+" not found")},g.findKey=function(a){var b=g.clients.keys.indexOf(a);return b>=0?g.clients.handles[b]:void console.log("rightsManager:client: "+a.toString()+" not found")}}]),angular.module("RevuMe").factory("Scripts",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/scripts/:id";return a(c,{id:"@id"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}})}]).service("ScriptService",["Teams","Users","Scripts","rightsManager","$q","$rootScope","$state",function(a,b,c,d,e,f,g){function h(a){var b=a.expirationDate.getMonth();if(12==b){b=1;var c=a.expirationDate.getFullYear();c+=1,a.expirationDate.setFullYear(c),a.expirationDate.setMonth(b)}else b+=1,a.expirationDate.setMonth(b)}var i=this;i.getAdmin=function(a){var b=void 0;return a.members.forEach(function(a){"Admin"==a.role&&(b=a.user,b.name=b.firstName+" "+b.lastName)}),b},i.getDaysLeft=function(a){var b=864e5;if(void 0!=a){var c=new Date,d=new Date(a.expirationDate),e=Math.round((d.getTime()-c.getTime())/b);return 0>e&&(e=0),"Elite"==a.type&&(e=36500),e}return-1},i.daysLeft=function(a){var b=e.defer();return i.userScript(a).then(function(a){var c=i.getDaysLeft(a);c>=0?b.resolve(c):b.reject("no scripts found!")}),b.promise},i.getMonthlyCost=function(a){return 25>a?35:30},i.calculateCost=function(a){var b,c=i.getMonthlyCost(a.totalSeats);switch(a.type){case"Elite":case"Trial":b=0;break;case"Monthly":b=c*a.totalSeats;break;case"Annually":b=c*a.totalSeats*10}return b},i.annualSavings=function(a){var b=i.getMonthlyCost(a.totalSeats);return b*a.totalSeats*2},i.scriptTypes=["Trial","Monthly","Annually","Elite"],i.setPendingScript=function(a){i.pendingScript=angular.copy(a)},i.getPendingScript=function(){return void 0==i.pendingScript?f.user.script:i.pendingScript},i.newScript=function(a,b){var c={};return c.type=a,c.totalSeats=b.length,c.availableSeats=0,c.members=[],c.startDate=new Date,c.expirationDate=new Date,c.autoRenew=!1,h(c),b.forEach(function(a){c.members.push(a)}),c},i.setToTrial=function(){var a=e.defer(),b={},c=void 0;return i.userScript(f.user._id).then(function(a){return b=a,b.type="Trial",b.totalSeats=1,b.availableSeats=0,b.startDate=new Date,b.expirationDate=new Date,h(b),b.members=[{user:f.user._id,role:"Admin"}],b.customerId=void 0,b.autoRenew=!0,c=b.braintreeId,b.braintreeId=void 0,i.update(b._id,b)}).then(function(){b.braintreeId=c,a.resolve(b)})["catch"](function(a){console.log("error : ",a)}),a.promise},i.checkScript=function(a,b){var c=i.getDaysLeft(a);0>=c&&"Elite"!=a.type&&(void 0!=b&&b.preventDefault(),g.go("app.myAccount"))},i.userScript=function(a){var b=e.defer();return c.query({user:a}).$promise.then(function(a){b.resolve(a[0])}),b.promise},i.save=function(a){var b=e.defer();return c.save(a).$promise.then(function(a){b.resolve(a._id)}),b.promise},i.update=function(a,b){var d=e.defer();b.availableSeats=b.totalSeats-b.members.length,console.log("ScriptService update - script is: ",b);var f=angular.copy(b);return f.members.forEach(function(a){angular.isObject(a.user)&&(a.user=a.user._id)}),console.log("ScriptService update - scrCopy: ",f),c.update({id:a},f).$promise.then(function(){d.resolve()}),d.promise},i["delete"]=function(a){var b=e.defer();return c["delete"]({id:a}).$promise.then(function(){b.resolve()}),b.promise}}]),angular.module("RevuMe").factory("Session",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/sessions/:id";return a(c,{id:"@id"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}})}]).factory("Sess",["$resource","baseUrl","$rootScope",function(a,b,c){var d=b.endpoint+"/api/sessions/organizer/:id",e=b.endpoint+"/api/sessions/attendee/:id",f=b.endpoint+"/api/sessions/:id",g=b.endpoint+"/api/sessions/setLB/:id",h=b.endpoint+"/api/sessions/archive/:id",i=b.endpoint+"/api/sessions/resend/:id";return{orgSessions:a(d,{id:"@id",isArchived:"@isArchived"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}},get:{method:"GET",params:{id:"@id",isArchived:"@isArchived"},isArray:!0}}),attSessions:a(e,{id:"@id",isArchived:"@isArchived"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}},get:{method:"GET",params:{id:"@id",isArchived:"@isArchived"},isArray:!0}}),sessions:a(f,{id:"@id"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}},get:{method:"GET",params:{id:"@id"},isArray:!0}}),leaveBehind:a(g,{id:"@id"},{update:{method:"PUT",params:{id:"@id"}}}),archive:a(h,{id:"@id"},{update:{method:"PUT",params:{id:"@id"}}}),invite:a(i,{id:"@id"},{update:{method:"PUT",params:{id:"@id"}}})}}]).service("SessionBuilder",["$rootScope","Session","Decks","UploadedFiles","userService","$ionicModal","$ionicPopup","$q","$timeout","baseUrl","TeamService","shareMediator","Library",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){void 0!=q.sessionForm&&q.sessionForm.$setPristine(),q.session.decks=[],q.session.name="",q.session.description="",q.session.date=new Date,q.session.attendees=[],q.session.attIds=[],q.session.length=60,q.session.lengthOptions=s,q.session.time=q.session.date,q.session.time.setMilliseconds(0),q.session.time.setSeconds(0),q.session.bridge=!1,q.session.invite=!0,q.session.timeZone=t.name(),q.session.baseUrl=j.endpoint,q.session.offset=(new Date).getTimezoneOffset(),q.session.showTeams=!1,k.getAll(a.user._id).then(function(a){q.session.teamList=a,q.session.teamList.length>0&&(q.session.team=q.session.teamList[0])})}function o(a){var b=g.alert({title:"Build New Session",template:a});return b}function p(a){console.log("offset before fix: ",a.time.getTimezoneOffset()),a.time.setDate(a.date.getDate()),a.time.setMonth(a.date.getMonth()),a.time.setFullYear(a.date.getFullYear()),a.offset=(new Date).getTimezoneOffset(),console.log("offset after fix: ",a.time.getTimezoneOffset())}var q=this,r=e.user,s=[30,60,90,120],t=jstz.determine();c.modelName="decks",d.modelName="files",q.setScope=function(a){q.scope=a},q.init=function(a){var b=h.defer();return q.session={},q.scope=a,q.scope.library=m,m.init(q.scope),q.session.baseUrl=j.endpoint,q.builderCallback=function(){},q.deckCallback=function(){},q.defer=[],q.ucEvent=void 0,n(),f.fromTemplateUrl("templates/addDeckTemplate.html",{scope:q.scope,animation:"slide-in-up"}).then(function(a){return q.deckModal=a,f.fromTemplateUrl("templates/buildSession.html",{scope:q.scope,animation:"slide-in-up"})}).then(function(a){q.builderModal=a,b.resolve()}),b.promise},q.show=function(a){var b=h.defer();return q.defer.push(b),a.show(),b.promise},q.processUpload=function(){l.getItems(d).then(function(a){if(a.length>0){var b=a[0];m.newDeckFromFile(b).then(function(a){var b=a;i(function(a){q.decks.unshift(b)},0)})}})},q["new"]=function(){var a=h.defer();return q.decks=[],q.session.decks=[],q.session.timeZone=t.name(),q.session.baseUrl=j.endpoint,l.getItems(c).then(function(a){return a.length>0?(q.decks=a,q.decks.forEach(function(a){a.added=!1}),void 0==q.ucEvent&&(q.ucEvent=m.$on("uploadComplete",q.processUpload)),q.show(q.deckModal)):void o("No Decks Built Yet - Please Build one First")}).then(function(){return q.deckModal.hide(),void 0!=q.ucEvent&&(q.ucEvent=m.$off(q.ucEvent)),q.session.date=new Date,q.session.lengthOptions=s,q.show(q.builderModal)}).then(function(){return q.saveSession()}).then(function(){q.builderModal.hide(),a.resolve()})["catch"](function(b){q.builderModal.hide(),q.deckModal.hide(),void 0!=q.ucEvent&&(q.ucEvent=m.$off(q.ucEvent)),a.reject(b),console.log(b)}),a.promise},q.build=function(a){var b=h.defer();return q.session.decks[0]=a,q.show(q.builderModal).then(function(){return q.saveSession()}).then(function(){q.builderModal.hide(),b.resolve()})["catch"](function(a){q.builderModal.hide(),b.reject(a)}),b.promise},q.edit=function(a){var b=h.defer(),c=a.time,d=a.date;return a.time=new Date(c),a.date=new Date(d),a.timeZone=t.name(),a.baseUrl=j.endpoint,q.session=angular.copy(a),q.session.attIds=[],q.session.lengthOptions=s,q.session.attendees.forEach(function(a){q.session.attIds.push(a._id)}),q.show(q.builderModal).then(function(){return console.log("edit",q.defer),q.updateSession()}).then(function(a){q.builderModal.hide(),b.resolve(a)})["catch"](function(c){if(q.sessionForm.$dirty||q.session.attendees.length!=a.attendees.length){var d=g.confirm({title:"Unsaved Changes",template:"Do you want to save your changes?"});d.then(function(a){a?q.updateSession().then(function(a){console.log("Changes saved after cancel"),q.builderModal.hide(),b.resolve(a)}):(console.log("Changes were denied"),q.builderModal.hide(),b.reject())})}else console.log("edit cancel",q.defer),q.builderModal.hide(),b.reject(c)}),b.promise},q.subEdit=function(){q.decks=[],l.getItems(c).then(function(a){return 0!=a.length?(q.decks=a,q.decks.forEach(function(a){a.added=!1}),q.deckModal.remove()):void o("No Decks Built Yet - Please Build or Upload One First")}).then(function(){return f.fromTemplateUrl("templates/addDeckTemplate.html",{scope:q.scope,animation:"slide-in-up"})}).then(function(a){return q.deckModal=a,void 0==q.ucEvent&&(q.ucEvent=m.$on("uploadComplete",q.processUpload)),q.show(q.deckModal)}).then(function(){console.log("subEdit",q.defer),void 0!=q.ucEvent&&(q.ucEvent=m.$off(q.ucEvent)),q.deckModal.hide()})["catch"](function(){console.log("subEdit reject",q.defer),void 0!=q.ucEvent&&(q.ucEvent=m.$off(q.ucEvent)),q.deckModal.hide()})},q.addDeck=function(a){q.session.decks.push(q.decks[a]);try{q.decks[a].added=!0}catch(b){}},q.delDeck=function(a){q.session.decks.splice(a,1);try{q.decks[a].added=!1}catch(b){}},q.addAttendee=function(){var a=new Object,b=-1,c=q.session.formname.split(" ");a.firstName=c[0],a.lastName=c[1],a.email=q.session.formemail,r.byEmail.get({email:a.email}).$promise.then(function(c){if(void 0==c._id){var d=new r.byId;angular.extend(d,a),d.$save().then(function(c){b=c._id,q.session.attendees.push(a),q.session.attIds.push(b),q.session.formname="",q.session.formemail=""})["catch"](function(a){console.log(a)})}else b=c._id,q.session.attendees.push(a),q.session.attIds.push(b),q.session.formname="",q.session.formemail=""})["catch"](function(a){console.log(a)})},q.delAttendee=function(a){q.session.attendees.splice(a,1),q.session.attIds.splice(a,1)},q.addTeam=function(){q.session.team.members.forEach(function(a){q.session.attendees.push(a),q.session.attIds.push(a._id)})},q.updateSession=function(){var a=h.defer(),c={};return angular.extend(c,q.session),p(c),console.log("Update Session"),c.decks=[],q.session.decks.forEach(function(a){c.decks.push(a._id)}),c.attendees=q.session.attIds,b.update({id:q.session._id},c).$promise.then(function(){a.resolve(q.session)})["catch"](function(b){a.reject(b)}),a.promise},q.saveSession=function(){var c=h.defer(),d=new b;return angular.extend(d,q.session),p(d),d.decks=[],q.session.decks.forEach(function(a){d.decks.push(a._id)}),d.attendees=q.session.attIds,d.organizer=a.user._id,d.$save().then(function(){c.resolve()})["catch"](function(a){c.reject(a),console.log(a)}),c.promise},q.deleteSession=function(a){Sess.session["delete"]({id:a._id})},q.destroy=function(){q.builderModal.remove(),q.deckModal.remove()}}]),angular.module("RevuMe").factory("Share",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/share/:id";return a(c,{id:"@id",path:"@path"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}})}]).service("shareMediator",["Share","rightsManager","TeamService","$rootScope","$ionicModal","$q",function(a,b,c,d,e,f){function g(a,b){b.forEach(function(b){a.forEach(function(a){b._id==a._id&&(b.included=!0)})})}function h(a){var c=void 0,d=void 0;return a.forEach(function(a){if(a.members.length>0){var e=a.members[0].role;void 0==c?(c=e,d=b.roles.indexOf(c)):(idx=b.roles.indexOf(e),idx<d&&(c=e,d=idx))}}),c}function i(a,b){a.forEach(function(a){if(0!=a.length)for(var c=a[0],d=0;d<b.length;d++)if(c.item==b[d]._id){b[d].sharingString="",c.teams.forEach(function(a){b[d].sharingString+=a.name+" "});break}})}var j=this;j.init=function(a){j.scope=a,j.childScope=a.$new(),j.childScope.share=void 0,j.childScope.cancelShare=j.cancelShare,j.childScope.updateSharing=j.updateSharing,c.getAll(d.user._id).then(function(a){j.childScope.teams=a}),e.fromTemplateUrl("templates/shareTemplate.html",{scope:j.childScope,animation:"slide-in-up"}).then(function(a){j.childScope.shareModal=a})},j.destroy=function(){void 0!=j.childScope&&(j.childScope.shareModal.remove(),j.childScope.$destroy())},j.shareItem=function(b){var e=j.scope.navItems[j.scope.selectedNavId];c.getAll(d.user._id).then(function(b){return j.childScope.teams=b,a.query({item:e._id,user:d.user._id}).$promise}).then(function(a){var b=a[0];void 0!=b&&(j.childScope.share=b,g(b.teams,j.childScope.teams)),j.childScope.shareModal.show()})["catch"](function(a){console.log("shareMediator shareItem - error: ",a)})},j.cancelShare=function(){j.childScope.shareModal.hide(),j.childScope.share=void 0},j.updateSharing=function(){var a=[],b=j.scope.model,c=j.scope.navItems[j.scope.selectedNavId];0!=j.childScope.teams.length?c.sharingString="":c.sharingString=void 0,j.childScope.teams.forEach(function(b){b.included&&(a.push(b._id),c.sharingString+=b.name+" ")}),j.saveShare(b,c,a).then(function(){j.childScope.shareModal.hide()})},j.saveShare=function(c,e,g){var h=f.defer(),i=new a,k=b.findKey(c).getName(),l=j.childScope.share;
return i.model=k,i.user=d.user._id,i.item=e._id,i.teams=[],g.forEach(function(a){i.teams.push(a)}),0==i.teams.length?void 0!=l?a["delete"]({id:l._id}).$promise.then(function(){j.childScope.share=void 0,h.resolve()}):h.resolve():void 0!=l?a.update({id:l._id},i).$promise.then(function(){j.childScope.share=void 0,h.resolve()}):i.$save().then(function(a){i._id=a,j.childScope.share=void 0,h.resolve()})["catch"](function(a){h.reject(a)}),h.promise},j.getItems=function(b){var c=f.defer(),e=b,g=b.modelName,j=[],k=[],l=[];return e.query({user:d.user._id,archiveOn:d.archiveOn()}).$promise.then(function(b){return b.forEach(function(b){b.role="Admin",j.push(b),l.push(a.query({item:b._id,user:d.user._id}).$promise)}),f.all(l)}).then(function(b){return i(b,j),a.query({model:g,user:d.user._id}).$promise}).then(function(a){a.forEach(function(a){var b=a.item,c=a.share.teams;b.role=h(c),k.push(b)}),j=j.concat(k),c.resolve(j)}),c.promise},j.getSharedForCache=function(){var b=f.defer();return a.query({model:"files",user:d.user._id}).$promise.then(function(a){b.resolve(a)}),b.promise}}]),angular.module("RevuMe").service("slideShow",["$rootScope","$state",function(a,b){var c=this;c.presentation={},c.connect=function(a){c.scope=a,a.presentation=c.presentation},c.startSlideShow=function(a){angular.extend(c.presentation,a),c.lastState=b.current.name,b.go("app.slideShow")}}]),angular.module("RevuMe").factory("Teams",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/teams/:id";return a(c,{id:"@id"},{"delete":{method:"DELETE",params:{id:"@id"}},update:{method:"PUT",params:{id:"@id"}}})}]).service("TeamService",["Teams","Users","rightsManager","$q","$ionicPopover","$rootScope","Share",function(a,b,c,d,e,f,g){function h(a){for(var b=0;b<l.length;b++)if(a==l[b].name)return l[b]}function i(a){for(var b=a.members.slice(0,4),c="",d=0;d<b.length;d++){var e=b[d].firstName+" "+b[d].lastName;c+=e,d<b.length-1&&(c+=",")}a.previewString=c}function j(a){var b=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return b.test(a)}var k=this,l=[];c.roles.forEach(function(a){var b={};b.name=a,l.push(b)}),k.scope=void 0,k.registeredName="Team",k.actionList=["Save","Add Member","Delete Member","Change Role"],k.init=function(a){k.scope=a,a.editTeamId=void 0,a.permissions=l,k.rights=c.register(k.registeredName,a,k.actionList,k),k.rights.setAll("Admin",!0),k.rights.setAll("Viewer",!1)},k.myRole=function(a){var b=f.user._id,c=void 0;return a.members.forEach(function(a){a._id==b&&(c=a.role.name)}),c},k.toMemberShim=function(a){a.members.forEach(function(a){var b=a.user;a.firstName=b.firstName,a.lastName=b.lastName,a.email=b.email,a._id=b._id,a.role=h(a.role)})},k.fromMemberShim=function(a){a.members.forEach(function(a){var b={};b.firstName=a.firstName,b.lastName=a.lastName,b.email=a.email,b._id=a._id;a.user=b})},k.getAll=function(b){var c=d.defer();return a.query({user:b}).$promise.then(function(a){a.forEach(function(a){k.toMemberShim(a),i(a)}),c.resolve(a)}),c.promise},k.refreshTeams=function(a){var b=d.defer(),c=f.user._id;return void 0!=c&&k.getAll(c).then(function(c){a.teams=c,b.resolve()}),b.promise},k.newTeam=function(a){a.role="Admin",k.rights.applyRights(a.role),a.addTeam={},a.addTeam.name="",a.addTeam.memberString="",a.addTeam.members=[],a.addTeam.nameString="",a.addTeam.emailString="",a.addTeam._id=void 0,a.autoComplete={},a.autoComplete.entries=[]},k.editTeam=function(a,b){var c=a.teams[b];a.role=k.myRole(c),k.rights.applyRights(a.role),a.editTeamId=c._id,a.addTeam={},a.addTeam.name=c.name,a.addTeam.memberString="",a.addTeam.members=[],c.members.forEach(function(b){a.addTeam.members.push(b),a.addTeam.memberString+=b.firstName+","+b.lastName+","+b.email+","+b.role.name+";"}),a.addTeam.nameString="",a.addTeam.emailString="",a.addTeam._id=void 0,a.autoComplete={},a.autoComplete.entries=[]},k.addMember=function(a){var c={},d=a.addTeam.nameString.split(" ");c.firstName=d[0],c.lastName=d[1],c.email=a.addTeam.emailString,c.role=a.permissions[1],a.addTeam.memberString+=c.firstName+","+c.lastName+","+c.email+","+c.role.name+";",b.byEmail.get({email:c.email}).$promise.then(function(b){void 0!=b._id&&(c._id=b._id),a.addTeam.members.unshift(c),a.addTeam.nameString="",a.addTeam.emailString="",a.addTeam._id=void 0})["catch"](function(a){console.log(a)})},k.delMember=function(a,b){a.addTeam.memberString="",a.addTeam.members.splice(b,1),a.addTeam.members.forEach(function(b){a.addTeam.memberString+=b.firstName+","+b.lastName+","+b.email+","+b.role.name+";"})},k.validateMembers=function(a){var b=a.addTeam.memberString,c=[];a.addTeam.memberString=b.replace(/(\r\n|\n|\r)/gm,""),c=a.addTeam.memberString.split(";"),c.forEach(function(b){if(b.length>0){var c=b.split(","),d={};c.length<3?d.valid=!1:(d.firstName=c[0],d.lastName=c[1],d.email=c[2],d.role=h(c[3]),d.valid=j(d.email),a.addTeam.members.push(d))}})},k.teamFromInput=function(a){var b={},c={},d=f.user.name.split(" ");return c.members=[],b.firstName=d[0],b.lastName=d[1],b.email=f.user.email,b._id=f.user._id,b.role=a.permissions[0],c.name=a.addTeam.name,void 0==a.editTeamId?c.members.push(b):c._id=a.editTeamId,a.addTeam.members.forEach(function(a){c.members.push(a)}),a.editTeamId=void 0,c},k.teamFromTeam=function(c){var e=d.defer(),f=[],g=new a;return k.fromMemberShim(c),g.name=c.name,g.members=[],void 0!=c._id&&(g._id=c._id),c.members.forEach(function(a){if(void 0==a.user._id){var c=new b.byId;angular.extend(c,a.user),f.push(c.$save())}var d={};void 0!=a.user._id?d.user=a.user._id:d.user=a.user.email,d.role=a.role.name,g.members.push(d)}),d.all(f).then(function(a){a.forEach(function(a){for(var b=0;b<g.members.length;b++)if(a.email==g.members[b].user){g.members[b].user=a._id;break}}),console.log("all promises - resolved"),e.resolve(g)}),e.promise},k.save=function(a){var b=d.defer();return k.teamFromTeam(a).then(function(a){return a.$save()}).then(function(){b.resolve()}),b.promise},k.update=function(b){var c=d.defer();return k.teamFromTeam(b).then(function(b){return a.update({id:b._id},b)}).then(function(){c.resolve()}),c.promise},k["delete"]=function(b){var c=d.defer();return a["delete"]({id:b}).$promise.then(function(){c.resolve()}),c.promise},k.getSharedItems=function(a){var b=k.defer();return g.get({team:a,user:f.user._id}).$promise.then(function(a){b.resolve(a)}),b.promise}}]),angular.module("RevuMe").service("tourService",["$rootScope","$state","$ionicSideMenuDelegate","$q","$sce","$controller",function(a,b,c,d,e,f){function g(a){var c;c=""==a.state?"app.welcome":a.state,b.current.name!=c?b.go(c).then(function(){return a.connect()}).then(function(){a.before(),a.show()}):a.connect().then(function(){a.before(),a.show()})}function h(b,c,d){var e={},e={};return a.smallScreen()?(e.left="20px",e.top=b):(e.top=c,e.left=d),e}var i=this;i.steps=[],i.currentStep=0,i.start=function(){if(i.currentStep=0,i.steps.length>0)var a=i.steps[0];g(a)},i.next=function(){if(i.steps[i.currentStep].hide(),"ext"==i.steps[i.currentStep].after?i.steps[i.currentStep].ext():i.steps[i.currentStep].after(),i.currentStep<i.steps.length-1){i.currentStep++;var a=i.steps[i.currentStep];g(a)}},i.previous=function(){if(i.steps[i.currentStep].hide(),i.steps[i.currentStep].after(),i.currentStep>0){i.currentStep--;var a=i.steps[i.currentStep];g(a)}},i.showAll=function(){i.steps.forEach(function(a){a.show()})},i.hideAll=function(){i.steps.forEach(function(a){void 0!=a.hide&&a.hide()})},i.end=function(){i.currentStep=0,i.hideAll()},i.newStep=function(a,b,c,f,g){var h={};return h.state=a,h.text=e.trustAsHtml(b),h.before=f||function(){},h.after=g||function(){},h.position=c||{},h.connect=function(){return h.defer=d.defer(),void 0==h.show?h.defer.promise:void 0!=h.scope&&1==h.scope.$$destroyed?h.defer.promise:(h.defer.resolve(),h.scope.step=h,h.defer.promise)},h},i.subStep=function(a,b,c,f,g){var h={};return angular.extend(h,a),h.parent=a,h.text=e.trustAsHtml(b),h.position=c||{},h.before=f||function(){},h.after=g||function(){},h.connect=function(){return h.defer=d.defer(),h.show=h.parent.show,h.hide=h.parent.hide,h.ext=h.parent.ext,a.scope.step=h,h.defer.resolve(),h.defer.promise},h},i.configure=function(){var b=h("60%","30%","275px"),d=i.newStep("","Let's start with the menu. Click the corner to open and close",b,function(){c.toggleLeft(!0)});i.steps.push(d),b=h("110px","7%","275px"),i.steps.push(i.subStep(d,"Settings let you change your password and log out.",b)),b=h("170px","102px","275px"),i.steps.push(i.subStep(d,"Schedule or Start a New Meeting with One Click.",b)),b=h("230px","160px","275px"),i.steps.push(i.subStep(d,"The Library Stores all your Pitch Decks.",b)),b=h("290px","220px","275px"),i.steps.push(i.subStep(d,"Teams Let You Share Pitch Decks and other items",b)),b=h("350px","280px","275px"),i.steps.push(i.subStep(d,"These are all the meetings you've organized",b)),b=h("410px","340px","275px"),i.steps.push(i.subStep(d,"Here are Invitations to Meetings you can Attend",b)),b=h("470px","400px","275px"),(!a.isMobile||a.showArchive)&&i.steps.push(i.subStep(d,"The Archive Holds All your Old Pitches and Meetings",b,function(){c.toggleLeft(!0)})),b=h("47%","47%","30px");var e;e=a.smallScreen()?"app.mobileLib":"app.library";var f=i.newStep(e,"This is the slide library. Drop files here to upload (Desktop Only).<br> You can also import files from your Dropbox or Box account",b,function(){c.toggleLeft(!1)});i.steps.push(f),b=h("16%","16%px","120px"),i.steps.push(i.subStep(f,"You can categorize your slides for quick re-use. For example: file type, subject, industry, funnel-stage etc.",b)),b=h("20%","20%px","50px"),i.steps.push(i.subStep(f,"Combine your slides into pitch 'decks' using 'Pitch Perfect'. Just add a new deck, name it, and start adding the slides you need. Click (or Tap) on the slide to re-order and then Tap again on another slide. The slide will be placed in front of the slide you tap (or click).",b)),b=h("425px","110px","275px"),i.steps.push(i.subStep(f,"On a Mobile device, slide the item left to reveal options. For Desktops, just click the options drop down. Here you can edit an item, share it with your team or create a new meeting.",b)),b=h("40%","300px","400px"),i.steps.push(i.subStep(f,"Our 'Getting Started Guide' is a great way to get up to speed.",b,null,"ext"))},i.find=function(a){var b=0,c=!1;return i.steps.some(function(d){return d.state==a?c=!0:b++,c}),c?i.steps[b]:{}},i.configure()}]),angular.module("RevuMe").factory("Users",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/users/:id",d=b.endpoint+"/api/users/email/:email",e=b.endpoint+"/api/users/password/reset/:email";return{byId:a(c,{id:"@id"},{update:{method:"PUT",params:{id:"@id"}}}),byEmail:a(d,{email:"@email"},{update:{method:"PUT",params:{email:"@email"}}}),pwReset:a(e,{email:"@email"},{reset:{method:"PUT",params:{email:"@email"}}})}}]).factory("TeamUsers",["$resource","baseUrl",function(a,b){var c=b.endpoint+"/api/teams/justUsers/:id";return a(c,{id:"@id"},{update:{method:"PUT",params:{id:"@id"}}})}]).factory("Base64",[function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(b){var c,d,e,f,g,h="",i="",j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),i=b.charCodeAt(k++),e=c>>2,f=(3&c)<<4|d>>4,g=(15&d)<<2|i>>6,j=63&i,isNaN(d)?g=j=64:isNaN(i)&&(j=64),h=h+a.charAt(e)+a.charAt(f)+a.charAt(g)+a.charAt(j),c=d=i="",e=f=g=j="";while(k<b.length);return h},decode:function(b){var c,d,e,f,g,h="",i="",j="",k=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(b)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do e=a.indexOf(b.charAt(k++)),f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),j=a.indexOf(b.charAt(k++)),c=e<<2|f>>4,d=(15&f)<<4|g>>2,i=(3&g)<<6|j,h+=String.fromCharCode(c),64!=g&&(h+=String.fromCharCode(d)),64!=j&&(h+=String.fromCharCode(i)),c=d=i="",e=f=g=j="";while(k<b.length);return h}}}]).service("userService",["Users","TeamUsers","pnFactory","$q","$ionicPopup","$ionicPopover","$rootScope","Base64",function(a,b,c,d,e,f,g,h){var i=this;i.user=a,i.scope=g.$new(),i.directiveScope=void 0,i.creatingPopover=!1,i.createPopover=function(){void 0!=i.popover||i.creatingPopover||(i.creatingPopover=!0,f.fromTemplateUrl("templates/autocomplete.html",{scope:i.scope}).then(function(a){i.creatingPopover=!1,i.popover=a}))},i.autoUser=void 0,i.showPopover=function(a,b){i.autoUser=void 0,i.directiveScope=a,i.popover.show(b)},i.hidePopover=function(a){void 0!=i.popover&&i.popover.hide(),i.directiveScope=void 0},i.removePopover=function(a){void 0!=i.popover&&(i.popover.remove(),i.popover=void 0,i.directiveScope=void 0)},i.scope.auto={entries:[]},i.setResults=function(a){i.scope.auto.entries=a},i.getResults=function(a){return i.scope.auto.entries.length>0&&a<i.scope.auto.entries.length?i.scope.auto.entries[a]:void 0},i.callBacks=[],i.onAutoComplete=function(a){var b={key:a.instanceName,callBack:a.doFinish};i.callBacks.push(b)},i.doAutoComplete=function(a,b){i.callBacks.forEach(function(c){c.key==a.instanceName&&c.callBack(b)})},i.scope.finishComplete=function(a){i.doAutoComplete(i.directiveScope,a),i.autoUser=i.getResults(a)},i.getAutoUser=function(){var a=angular.copy(i.autoUser);return i.autoUser=void 0,a},i.offAutoComplete=function(a){for(var b=[],c=i.callBacks.length-1;c>=0;c--)i.callBacks[c].key==a.instanceName&&b.push(c);b.forEach(function(a){i.callBacks.splice(a,1)})},i.find=function(b){return a.byId.query(b).$promise},i.getAll=function(b){a.byId.query().$promise.then(function(a){b.allUsers=a,b.user.email="klynch@volerro.com"})},i.usersIKnow=function(b){if(void 0!=g.user._id){var c=g.user._id,d={user:c};for(var e in b)d[e]=b[e];return a.byId.query(d).$promise}},i.getUser=function(a){var b=d.defer();i.getAll(a);var c=e.show({template:'<select ng-model="user.email"><option ng-repeat="user in allUsers">{{user.email}}</option></select>',title:"Select Your Email",scope:a,buttons:[{text:"Cancel"},{text:"<b>Save</b>",type:"button-positive",onTap:function(b){return a.user.email?a.user.email:void b.preventDefault()}}]});return c.then(function(a){return i.user.byEmail.get({email:a}).$promise}).then(function(a){void 0==a._id&&b.reject("not found"),b.resolve(a)})["catch"](function(a){b.reject(a)}),b.promise},i.checkExists=function(a){var b=d.defer();return i.user.byEmail.get({email:a}).$promise.then(function(a){void 0==a._id?b.resolve(!1):b.resolve(!0)})["catch"](function(a){b.reject(a)}),b.promise},i.signUp=function(a){var b=d.defer(),c=new i.user.byId;return angular.extend(c,a),c.password=h.encode(c.email+":"+c.password),c.$save().then(function(a){b.resolve(a)})["catch"](function(a){b.reject(a)}),b.promise},i.resetPassword=function(a){var b=d.defer(),c=h.encode(a.email+":"+a.password);a.password=c;var e=h.encode(a.email+":"+a.oldPassword);return a.oldPassword=e,i.user.byEmail.update({email:a.email},a).$promise.then(function(a){b.resolve(a)}),b.promise},i.register=function(a){var b=d.defer(),c=new i.user.byId,f=e.show({template:'<input type="name" placeholder="name" ng-model="user.name"><br><input type="email" placeholder="email" ng-model="user.email">',title:"Register on Revu.Me",scope:a,buttons:[{text:"Cancel"},{text:"<b>Save</b>",type:"button-positive",onTap:function(b){return a.user.email&&a.user.name?a.user:void b.preventDefault()}}]});return f.then(function(d){var e=d.name.split(" ");c.email=d.email,c.firstName=e[0],c.lastName=e[1],a.user.firstName=c.firstName,a.user.lastName=c.lastName,c.$save().then(function(c){a.user._id=c._id,b.resolve(a.user)})["catch"](function(a){b.reject(a)})}),b.promise}}]).service("userMonitor",["$rootScope",function(a){this.invited=[],this.present=[],this.everyone=[],this.init=function(b){this.invited=b,this.invited.forEach(function(b){b.userName=b.firstName+" "+b.lastName,b._id==a.user._id?b.itsme=!0:b.itsme=!1})},this.rollCall=function(a){var b=!1;this.present=[];var c=this.present;this.invited.forEach(function(d){d._id==a.uuid&&(b=!0,a.userName=d.userName,"join"==a.action?(d.isOnline=!0,c.push(d)):d.isOnline=!1)}),b||console.log("we need to add an intruder!"),this.everyone=this.invited},this.noteEngagement=function(a,b){for(var c=0;c<this.everyone.length;c++)this.everyone[c]._id==a&&("distracted"==b?this.everyone[c].distracted=!0:this.everyone[c].distracted=!1)},a.$on("$destroy",function(){$.scope.$destroy()})}]);